var background=function(){"use strict";var Nl=Object.defineProperty;var Ul=(Nt,It,te)=>It in Nt?Nl(Nt,It,{enumerable:!0,configurable:!0,writable:!0,value:te}):Nt[It]=te;var G=(Nt,It,te)=>Ul(Nt,typeof It!="symbol"?It+"":It,te);var mo,go,vo,bo,wo,_o,Ao,So;function Nt(o){return o==null||typeof o=="function"?{main:o}:o}const te=(go=(mo=globalThis.browser)==null?void 0:mo.runtime)!=null&&go.id?globalThis.browser:globalThis.chrome;class Yo{constructor(t){G(this,"_settings");G(this,"_onSyncedElementCallbacks",[]);G(this,"_onAsbplayerInstanceCallbacks",[]);this._settings=t,te.tabs.onRemoved.addListener((a,n)=>{this._removeVideoElementsInTab(a),this._removeAsbplayersInTab(a)}),te.tabs.onUpdated.addListener((a,n)=>{let s=!1;(n.status==="loading"&&n.url===void 0||n.url!==void 0)&&(s=!0),s&&(this._removeVideoElementsInTab(a),this._removeAsbplayersInTab(a))})}async _fetchVideoElementState(){const t=await te.storage.session.get("tabRegistryVideoElements");return(t&&t.tabRegistryVideoElements)??{}}async _saveVideoElementState(t){await te.storage.session.set({tabRegistryVideoElements:t})}async _removeVideoElementsInTab(t){await this._videoElements(a=>{let n=!1;for(const[s,f]of Object.entries(a))f.tab.id===t&&(delete a[s],n=!0);return n})}async _videoElements(t){const a=await this._fetchVideoElementState(),n={...a};let s=!1;t!==void 0&&(s=t(a)||s),s&&await this._saveVideoElementState(a);const f=Object.values(n).find(A=>A.synced)!==void 0,_=Object.values(a).find(A=>A.synced)!==void 0;if(this._onSyncedElementCallbacks.length>0&&!f&&_)for(const A of this._onSyncedElementCallbacks)A();return a}async _fetchAsbplayerState(){const t=await te.storage.session.get("tabRegistryAsbplayers");return(t&&t.tabRegistryAsbplayers)??{}}async _saveAsbplayerState(t){await te.storage.session.set({tabRegistryAsbplayers:t})}async _removeAsbplayersInTab(t){await this._asbplayers(a=>{var s;let n=!1;for(const[f,_]of Object.entries(a))((s=_.tab)==null?void 0:s.id)===t&&(delete a[f],n=!0);return n})}async _asbplayers(t){const a=await this._fetchAsbplayerState(),n={...a};let s=!1;const f=Date.now();for(const A in a){const T=a[A];T.sidePanel&&f-T.timestamp>=5e3&&(s=!0,delete a[A])}t!==void 0&&(s=t(a)||s);let _=!1;if(s&&(await this._saveAsbplayerState(a),_=Object.keys(a).some(A=>!(A in n))),_)for(const A of this._onAsbplayerInstanceCallbacks)A();return a}async onAsbplayerHeartbeat(t,{id:a,videoPlayer:n,sidePanel:s,receivedTabs:f,loadedSubtitles:_,syncedVideoElement:A}){this._updateAsbplayers(t,a,n,s??!1,_??!1,f,A);try{const T={sender:"asbplayer-extension-to-player",message:{command:"tabs",tabs:await this.activeVideoElements(),asbplayers:await this._asbplayerInstances(),ackRequested:!1}};t!=null&&t.id?await te.tabs.sendMessage(t.id,T):await te.runtime.sendMessage(T)}catch{}}async onAsbplayerAckTabs(t,{id:a,videoPlayer:n,sidePanel:s,loadedSubtitles:f,receivedTabs:_,syncedVideoElement:A}){this._updateAsbplayers(t,a,n,s??!1,f??!1,_,A)}async _updateAsbplayers(t,a,n,s,f,_,A){const T=t===void 0||t.id===void 0?void 0:{id:t.id,title:t.title??"",url:t.url??"",faviconUrl:t.favIconUrl};await this._asbplayers(j=>(j[a]={tab:T,id:a,timestamp:Date.now(),receivedTabs:_,sidePanel:s,loadedSubtitles:f,videoPlayer:n,syncedVideoElement:A},!0))}async activeVideoElements(){const t=await this._videoElements(),a=[];for(const n in t){const s=t[n];if(s.tab.id){const f={id:s.tab.id,title:s.tab.title,faviconUrl:s.tab.faviconUrl,src:s.src,subscribed:s.subscribed,synced:s.synced,syncedTimestamp:s.syncedTimestamp};a.push(f)}}return a}async _asbplayerInstances(){var n;const t=await this._asbplayers(),a=[];for(const s of Object.values(t))a.push({id:s.id,tabId:(n=s.tab)==null?void 0:n.id,sidePanel:s.sidePanel??!1,timestamp:s.timestamp,videoPlayer:s.videoPlayer});return a}async onVideoElementHeartbeat(t,a,{subscribed:n,synced:s,syncedTimestamp:f,loadedSubtitles:_}){if(t.id===void 0)return;const A=t.id;await this._videoElements(T=>(T[`${t.id}:${a}`]={tab:{id:A,title:t.title??"",url:t.url??"",faviconUrl:t.favIconUrl},src:a,subscribed:n,timestamp:Date.now(),synced:s,syncedTimestamp:f,loadedSubtitles:_},!0))}async onVideoElementDisappeared(t,a){await this._videoElements(n=>{const s=`${t.id}:${a}`;return s in n?(delete n[s],!0):!1})}onSyncedElement(t){this._onSyncedElementCallbacks.push(t)}onAsbplayerInstance(t){this._onAsbplayerInstanceCallbacks.push(t)}async publishTabsToAsbplayers(){const t={sender:"asbplayer-extension-to-player",message:{command:"tabs",tabs:await this.activeVideoElements(),asbplayers:await this._asbplayerInstances(),ackRequested:!0}};await this.publishCommandToAsbplayers({commandFactory:a=>a.videoPlayer?void 0:t})}async publishCommandToAsbplayers({asbplayerId:t,commandFactory:a}){const n=await this._asbplayers();if(t!==void 0){if(t in n){const s=n[t],f=a(s);f!==void 0&&await this._sendCommand(n[t],f)}}else for(const s in n){const f=n[s],_=a(f);_!==void 0&&await this._sendCommand(f,_)}}async _sendCommand(t,a){var n;try{((n=t.tab)==null?void 0:n.id)!==void 0?await te.tabs.sendMessage(t.tab.id,a):t.sidePanel&&await te.runtime.sendMessage(a)}catch{}}async publishCommandToVideoElements(t){const a=await this._videoElements();for(const n in a){const s=a[n],f=s.tab.id;if(typeof f<"u"){const _=t(s);_!==void 0&&te.tabs.sendMessage(f,_)}}}async publishCommandToVideoElementTabs(t){const a=await this._videoElements(),n=[];for(const s of Object.values(a))n.find(f=>f.id===s.tab.id)===void 0&&n.push(s.tab);if(n.length>0)for(const s of n){const f=t(s);f!==void 0&&te.tabs.sendMessage(s.id,f)}}async findAsbplayer({filter:t,allowTabCreation:a}){let n=null;const s=Date.now();let f=null;const _=await this._asbplayers();let A=0;for(const T in _){const j=_[T];if(j.sidePanel||++A,t===void 0||t(j)){const x=s-j.timestamp;(f===null||x<f)&&(f=x,n=j.id)}}if(n)return n;if(a)return new Promise(async(T,j)=>{A===0&&await this._createNewTab(),this._anyAsbplayerTab(T,j,0,10,t)})}async _createNewTab(){return new Promise(async(t,a)=>{const n=await te.tabs.query({active:!0}),s=!n||n.length===0?void 0:n[0].index+1;te.tabs.create({active:!1,url:await this._settings.getSingle("streamingAppUrl"),index:s},t)})}async _anyAsbplayerTab(t,a,n,s,f){if(n>=s){a(new Error("Could not find or create an asbplayer tab"));return}const _=await this._asbplayers();for(const A in _)if(f===void 0||f(_[A])){t(A);return}setTimeout(()=>this._anyAsbplayerTab(t,a,n+1,s,f),1e3)}}const Xa=async o=>{const t=await te.tabs.get(o);return await te.tabs.captureVisibleTab(t.windowId,{format:"jpeg",quality:100})};class Xo{constructor(t){G(this,"settings");G(this,"imageBase64Promise");G(this,"imageBase64Resolve");G(this,"imageBase64Reject");G(this,"lastCaptureTimeoutId");G(this,"_capturing",!1);G(this,"_lastImageBase64");this.settings=t}get lastImageBase64(){return this._lastImageBase64}capture(t,a,n,s){return this._capturing?Promise.reject(new Error("Already capturing visible tab")):(this._lastImageBase64=void 0,this.imageBase64Resolve!==void 0&&this.imageBase64Reject!==void 0&&this.imageBase64Promise!==void 0?(this._captureWithDelay(t,a,n,s,this.imageBase64Resolve,this.imageBase64Reject),this.imageBase64Promise):(this.imageBase64Promise=new Promise((f,_)=>{this.imageBase64Resolve=f,this.imageBase64Reject=_,this._captureWithDelay(t,a,n,s,this.imageBase64Resolve,this.imageBase64Reject)}),this.imageBase64Promise))}_captureWithDelay(t,a,n,s,f,_){const A=setTimeout(()=>{this._capturing=!0,Xa(t).then(async T=>{try{if(this._capturing=!1,A!==this.lastCaptureTimeoutId)return;const j=await this._cropAndResize(T,t,a,s);if(A!==this.lastCaptureTimeoutId)return;this._lastImageBase64=j.substring(j.indexOf(",")+1),f(this._lastImageBase64)}catch(j){_(j)}}).catch(_).finally(()=>{this._capturing=!1,this.imageBase64Promise=void 0,this.imageBase64Resolve=void 0,this.imageBase64Reject=void 0,this.lastCaptureTimeoutId=void 0})},n);this.lastCaptureTimeoutId=A}_cropAndResize(t,a,n,s){return new Promise(async(f,_)=>{try{if(!await this.settings.getSingle("streamingCropScreenshot")){f(t);return}const T={sender:"asbplayer-extension-to-video",message:{command:"crop-and-resize",dataUrl:t,...s},src:n},j=await te.tabs.sendMessage(a,T);f(j.dataUrl)}catch(A){_(A)}})}}class es{constructor(t){G(this,"tabRegistry");this.tabRegistry=t}get sender(){return"asbplayer-video"}get command(){return"heartbeat"}handle(t,a){const n=t;return a.tab&&this.tabRegistry.onVideoElementHeartbeat(a.tab,n.src,n.message),!1}}const ts=(o,t,a,n)=>new Promise((s,f)=>{const _=a<=0?1:a/o.width,A=n<=0?1:n/o.height,T=Math.min(1,Math.min(_,A));if(T<1){const j=o.width*T,x=o.height*T;createImageBitmap(o,{resizeWidth:j,resizeHeight:x,resizeQuality:"high"}).then(v=>{o.width=j,o.height=x,t.drawImage(v,0,0),s(o)}).catch(v=>f(v))}else s(o)});var nr=(o=>(o[o.captureFailed=1]="captureFailed",o[o.fileLinkLost=2]="fileLinkLost",o))(nr||{}),Ut=(o=>(o[o.drmProtected=1]="drmProtected",o[o.fileLinkLost=2]="fileLinkLost",o))(Ut||{}),tt=(o=>(o[o.none=0]="none",o[o.showAnkiDialog=1]="showAnkiDialog",o[o.updateLastCard=2]="updateLastCard",o[o.exportCard=3]="exportCard",o))(tt||{}),ei=(o=>(o[o.remember=0]="remember",o[o.play=1]="play",o[o.pause=2]="pause",o))(ei||{}),ti=(o=>(o[o.atStart=1]="atStart",o[o.atEnd=2]="atEnd",o))(ti||{}),ri=(o=>(o[o.remove=0]="remove",o[o.render=1]="render",o))(ri||{}),kr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ni(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function rs(o){if(Object.prototype.hasOwnProperty.call(o,"__esModule"))return o;var t=o.default;if(typeof t=="function"){var a=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};a.prototype=t.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(o).forEach(function(n){var s=Object.getOwnPropertyDescriptor(o,n);Object.defineProperty(a,n,s.get?s:{enumerable:!0,get:function(){return o[n]}})}),a}var hn,ai;function ns(){if(ai)return hn;ai=1;function o(a){return a>=55296&&a<=56319}function t(a){return a>=56320&&a<=57343}return hn=function(n,s,f){if(typeof s!="string")throw new Error("Input must be string");for(var _=s.length,A=0,T,j,x=0;x<_;x+=1){if(T=s.charCodeAt(x),j=s[x],o(T)&&t(s.charCodeAt(x+1))&&(x+=1,j+=s[x]),A+=n(j),A===f)return s.slice(0,x+1);if(A>f)return s.slice(0,x-j.length+1)}return s},hn}var mn,ii;function as(){if(ii)return mn;ii=1;function o(a){return a>=55296&&a<=56319}function t(a){return a>=56320&&a<=57343}return mn=function(n){if(typeof n!="string")throw new Error("Input must be string");for(var s=n.length,f=0,_=null,A=null,T=0;T<s;T++)_=n.charCodeAt(T),t(_)?A!=null&&o(A)?f+=1:f+=3:_<=127?f+=1:_>=128&&_<=2047?f+=2:_>=2048&&_<=65535&&(f+=3),A=_;return f},mn}var gn,oi;function is(){if(oi)return gn;oi=1;var o=ns(),t=as();return gn=o.bind(null,t),gn}var vn,si;function os(){if(si)return vn;si=1;var o=is(),t=/[\/\?<>\\:\*\|"]/g,a=/[\x00-\x1f\x80-\x9f]/g,n=/^\.+$/,s=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,f=/[\. ]+$/;function _(A,T){if(typeof A!="string")throw new Error("Input must be string");var j=A.replace(t,T).replace(a,T).replace(n,T).replace(s,T).replace(f,T);return o(j,255)}return vn=function(A,T){var j=T&&T.replacement||"",x=_(A,j);return j===""?x:_(x,"")},vn}var ss=os();const ui=ni(ss);function li(o,t=!1){const a=Math.floor(o/1e3);let n;t?n=Math.round(o/1e3%60*10)/10:n=a%60;const s=Math.floor(a/60)%60,f=Math.floor(a/3600);return f>0?f+"h"+String(s).padStart(2,"0")+"m"+String(n).padStart(2,"0")+"s":s+"m"+String(n).padStart(2,"0")+"s"}function us(o,t,a){const n=[o],s=o.start-o.originalStart;if(o.end<t){const f=Math.min(t,o.end+a);n.push({text:"",start:o.end,end:f,originalStart:o.end-s,originalEnd:f-s,track:o.track})}if(o.start>0){const f=Math.max(0,o.start-a);n.unshift({text:"",start:f,end:o.start,originalStart:f-s,originalEnd:o.start-s,track:o.track})}return n}function ls(o,t){const a=Math.max(0,o.end-o.start);if(a===0)return!1;const n=Math.max(o.start,t[0]);return Math.min(o.end,t[1])-n>=a/2}function cs(o){return o.filter(t=>t.text.trim()!=="").map(t=>t.text).join(`
`)}function Rr(o,t,a){if(t.length===0)return o.text;const n=[o.start,o.end];return cs(t.filter(s=>ls(s,n)).filter(s=>a===void 0||s.track===a))}function ci(o,t){const a=window.URL.createObjectURL(o),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=a,n.download=ui(t),n.click(),URL.revokeObjectURL(a),n.remove()}function fs(o,t){return t===0?o:`${o} (${li(t)})`}const ds={},fi=o=>o in ds,ps=24,di=(o,t)=>`${o.replaceAll(" ","_").substring(0,Math.min(o.length,ps))}_${Math.floor(t)}`;class ys{constructor(t,a,n,s,f){G(this,"_name");G(this,"_timestamp");G(this,"_base64");G(this,"_extension");G(this,"_error");G(this,"cachedBlob");this._name=t,this._timestamp=a,this._base64=n,this._extension=s,this._error=f}get name(){return this._name}get timestamp(){return this._timestamp}get extension(){return this._extension}get error(){return this._error}atTimestamp(t){return this}get canChangeTimestamp(){return!1}async base64(){return this._base64}async blob(){return await this._blob()}async _blob(){return this.cachedBlob||(this.cachedBlob=await(await fetch(this._dataUrl())).blob()),this.cachedBlob}async dataUrl(){return this._dataUrl()}_dataUrl(){return"data:image/"+this.extension+";base64,"+this._base64}dispose(){}}class hs extends Error{}class bn{constructor(t,a,n,s,f,_){G(this,"_file");G(this,"_timestamp");G(this,"_maxWidth");G(this,"_maxHeight");G(this,"_name");G(this,"_video");G(this,"_canvas");G(this,"_canvasPromise");G(this,"_canvasPromiseReject");this._file=t,this._name=`${di(t.name,a)}.jpeg`,this._timestamp=a,this._maxWidth=n,this._maxHeight=s,this._video=f,this._canvas=_}get name(){return this._name}get timestamp(){return this._timestamp}get extension(){return"jpeg"}get error(){if(this._file.blobUrl)return fi(this._file.blobUrl)?void 0:nr.fileLinkLost}atTimestamp(t){var a;return t===this._timestamp?this:((a=this._canvasPromiseReject)==null||a.call(this,new hs),new bn(this._file,t,this._maxWidth,this._maxHeight,this._video,this._canvas))}get canChangeTimestamp(){return!0}async base64(){return new Promise((t,a)=>{this._getCanvas().then(n=>{const s=n.toDataURL("image/jpeg");t(s.substring(s.indexOf(",")+1))}).catch(a)})}async blob(){return new Promise((t,a)=>{this._getCanvas().then(n=>{n.toBlob(s=>{s===null?a(new Error("Could not obtain blob")):t(s)},"image/jpeg")}).catch(a)})}async dataUrl(){return(await this._getCanvas()).toDataURL()}async _getCanvas(){return this._canvasPromise?this._canvasPromise:(this._canvasPromise=new Promise(async(t,a)=>{this._canvasPromiseReject=a;const n=await this._videoElement(this._file),s=()=>Math.max(0,Math.min(n.duration,this._timestamp/1e3));Number.isFinite(n.duration)?n.currentTime=s():n.onloadedmetadata=()=>{n.currentTime=s(),n.onloadedmetadata=null},n.onseeked=async()=>{try{this._canvasPromiseReject=void 0,this._canvas||(this._canvas=document.createElement("canvas"));const f=this._canvas;f.width=n.videoWidth,f.height=n.videoHeight;const _=f.getContext("2d");_.drawImage(n,0,0,f.width,f.height),n.onseeked=null,(this._maxWidth>0||this._maxHeight>0)&&await ts(f,_,this._maxWidth,this._maxHeight),t(f)}catch(f){a(f)}},n.onerror=()=>{var f;a(((f=n.error)==null?void 0:f.message)??"Could not load video to obtain screenshot")}}),this._canvasPromise)}async _videoElement(t){return this._video?this._video:new Promise((a,n)=>{const s=document.createElement("video");s.src=t.blobUrl,s.preload="auto",s.autoplay=!1,s.volume=0,s.controls=!1,s.pause();const f=Date.now(),_=setInterval(()=>{(s.seekable.length>0&&s.seekable.end(0)===s.duration||Date.now()-f>=5e3)&&(this._video=s,clearInterval(_),a(s))},100)})}dispose(){var t;this._video&&(this._video.removeAttribute("src"),this._video.load(),this._video.remove(),this._video=void 0,(t=this._canvas)==null||t.remove())}}class $t{constructor(t){G(this,"data");this.data=t}static fromCard(t,a,n){if(t.image)return $t.fromBase64(t.subtitleFileName,t.subtitle.start,t.image.base64,t.image.extension,t.image.error);if(t.file)return $t.fromFile(t.file,t.mediaTimestamp??t.subtitle.start,a,n)}static fromBase64(t,a,n,s,f){const _=t.substring(0,t.lastIndexOf(".")),A=`${di(_,a)}.${s}`;return new $t(new ys(A,a,n,s,f))}static fromFile(t,a,n,s){return new $t(new bn(t,a,n,s))}get name(){return this.data.name}get timestamp(){return this.data.timestamp}get extension(){return this.data.extension}get error(){return this.data.error}async base64(){return await this.data.base64()}async dataUrl(){return await this.data.dataUrl()}async blob(){return await this.data.blob()}async pngBlob(){return new Promise(async(t,a)=>{try{createImageBitmap(await this.blob()).then(n=>{const s=document.createElement("canvas");s.width=n.width,s.height=n.height,s.getContext("2d").drawImage(n,0,0),s.toBlob(f=>{f?t(f):a("Failed to convert to PNG")},"image/png")})}catch(n){a(n)}})}atTimestamp(t){return new $t(this.data.atTimestamp(t))}get canChangeTimestamp(){return this.data.canChangeTimestamp}dispose(){return this.data.dispose()}async download(){const t=await this.data.blob();ci(t,this.data.name)}}var Or=(o=>(o[o.noActiveTabPermission=1]="noActiveTabPermission",o[o.drmProtected=2]="drmProtected",o[o.other=3]="other",o))(Or||{}),pi=(o=>(o[o.timedAudioRecordingInProgress=1]="timedAudioRecordingInProgress",o[o.other=2]="other",o))(pi||{});class ms{async fetch(t,a){return await(await fetch(t,{method:"POST",body:JSON.stringify(a)})).json()}}var Ir,gs=new Uint8Array(16);function vs(){if(!Ir&&(Ir=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Ir))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ir(gs)}const bs=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ws(o){return typeof o=="string"&&bs.test(o)}for(var Ge=[],wn=0;wn<256;++wn)Ge.push((wn+256).toString(16).substr(1));function _s(o){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=(Ge[o[t+0]]+Ge[o[t+1]]+Ge[o[t+2]]+Ge[o[t+3]]+"-"+Ge[o[t+4]]+Ge[o[t+5]]+"-"+Ge[o[t+6]]+Ge[o[t+7]]+"-"+Ge[o[t+8]]+Ge[o[t+9]]+"-"+Ge[o[t+10]]+Ge[o[t+11]]+Ge[o[t+12]]+Ge[o[t+13]]+Ge[o[t+14]]+Ge[o[t+15]]).toLowerCase();if(!ws(a))throw TypeError("Stringified UUID is invalid");return a}function _n(o,t,a){o=o||{};var n=o.random||(o.rng||vs)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,_s(n)}class Cr extends Error{}class yi extends Error{}class As{constructor(t,a){G(this,"_tabRegistry");G(this,"_delegate");G(this,"audioBase64Promise");G(this,"audioBase64Resolve");G(this,"audioBase64Reject");G(this,"currentRecordRequestId");this._tabRegistry=t,this._delegate=a}onAudioBase64(t,a){var n;this.currentRecordRequestId===a&&((n=this.audioBase64Resolve)==null||n.call(this,t),this.audioBase64Resolve=void 0,this.audioBase64Promise=void 0,this.audioBase64Reject=void 0,this.currentRecordRequestId=void 0)}async startWithTimeout(t,a,n){const s=_n();try{const f=await this._delegate.startWithTimeout(t,a,s,n);if(f.started)return this._notifyRecordingStarted(n),await this._prepareForAudioDataResponse(s);throw this._handleStartError(f,n)}finally{this._notifyRecordingFinished(n)}}async start(t){try{const a=_n(),n=await this._delegate.start(a,t);if(!n.started)throw this._handleStartError(n,t);this._prepareForAudioDataResponse(a),this._notifyRecordingStarted(t)}catch(a){throw this._notifyRecordingFinished(t),a}}_handleStartError(t,{tabId:a,src:n}){const s=t.error.code,f=`Failed to start audio recording: "${t.error.message}"`;switch(s){case Or.noActiveTabPermission:return a!==void 0&&this._requestActiveTab(a,n),new Error(f);case Or.other:return this._notifyError(f,{tabId:a,src:n}),new Error(f);case Or.drmProtected:return new Cr}}_requestActiveTab(t,a){const n={sender:"asbplayer-extension-to-video",message:{command:"request-active-tab-permission"},src:a};te.tabs.sendMessage(t,n)}async stop(t,a){if(this.audioBase64Promise===void 0){const s="Cannot stop because audio recording is not in progress";throw this._notifyError(s,a),this._notifyRecordingFinished(a),new Error(s)}const n=await this._delegate.stop(t,a);if(!n.stopped){if(n.error.code===pi.timedAudioRecordingInProgress)throw new yi;const s=`Failed to stop audio recording: ${n.error.message}`;throw this._notifyError(s,a),new Error(s)}return this._notifyRecordingFinished(a),await this.audioBase64Promise}_notifyRecordingStarted({tabId:t,src:a}){const n={sender:"asbplayer-extension-to-player",message:{command:"recording-started"}};this._tabRegistry.publishCommandToAsbplayers({commandFactory:f=>f.sidePanel?n:void 0});const s={sender:"asbplayer-extension-to-video",message:{command:"recording-started"},src:a};te.tabs.sendMessage(t,s)}_notifyRecordingFinished({tabId:t,src:a}){const n={sender:"asbplayer-extension-to-player",message:{command:"recording-finished"}};this._tabRegistry.publishCommandToAsbplayers({commandFactory:f=>f.sidePanel?n:void 0});const s={sender:"asbplayer-extension-to-video",message:{command:"recording-finished"},src:a};te.tabs.sendMessage(t,s)}_prepareForAudioDataResponse(t){return this.audioBase64Promise!==void 0&&(this.audioBase64Reject(new Error("New audio recording request received before the current one could finish")),this.audioBase64Resolve=void 0,this.audioBase64Reject=void 0,this.audioBase64Promise=void 0,this.currentRecordRequestId=void 0),this.audioBase64Promise=new Promise((a,n)=>{this.audioBase64Resolve=a,this.audioBase64Reject=n,this.currentRecordRequestId=t}),this.audioBase64Promise}_notifyError(t,{tabId:a,src:n}){const s={sender:"asbplayer-extension-to-video",message:{command:"notify-error",message:t},src:n};te.tabs.sendMessage(a,s)}}class Ss{constructor(t,a,n,s){G(this,"_audioRecorder");G(this,"_imageCapturer");G(this,"_cardPublisher");G(this,"_settingsProvider");this._audioRecorder=t,this._imageCapturer=a,this._cardPublisher=n,this._settingsProvider=s}get sender(){return"asbplayer-video"}get command(){return"record-media-and-forward-subtitle"}async handle(t,a){const n=a.tab,s=t;await this._recordAndForward(s,a,n)}async _recordAndForward(t,a,n){var v;const s=t.message.subtitle;let f,_,A,T,j=!1;if(t.message.record){const d=(s.end-s.start)/t.message.playbackRate+t.message.audioPaddingEnd;t.message.postMineAction!==tt.showAnkiDialog&&(j=await this._settingsProvider.getSingle("preferMp3")),f=this._audioRecorder.startWithTimeout(d,j,{src:t.src,tabId:(v=a.tab)==null?void 0:v.id})}if(t.message.screenshot){const{maxWidth:d,maxHeight:m,rect:g,frameId:l}=t.message;_=this._imageCapturer.capture(n.id,t.src,Math.min(s.end-s.start,t.message.imageDelay),{maxWidth:d,maxHeight:m,rect:g,frameId:l}),_.finally(()=>{const p={sender:"asbplayer-extension-to-video",message:{command:"screenshot-taken"},src:t.src};te.tabs.sendMessage(n.id,p)})}if(f){const{audioPaddingStart:d,audioPaddingEnd:m,playbackRate:g}=t.message,l={base64:"",extension:j?"mp3":"webm",paddingStart:d,paddingEnd:m,playbackRate:g};try{const p=await f;T={...l,base64:p}}catch(p){if(!(p instanceof Cr))throw p;T={...l,error:Ut.drmProtected}}}if(_)try{await _,A={base64:this._imageCapturer.lastImageBase64,extension:"jpeg"}}catch(d){console.error(d),A={base64:"",extension:"jpeg",error:nr.captureFailed}}const x={image:A,audio:T,...t.message};this._cardPublisher.publish(x,t.message.postMineAction,n.id,t.src)}}class Ps{constructor(t,a,n){G(this,"_settingsProvider");G(this,"_audioRecorder");G(this,"_cardPublisher");this._settingsProvider=t,this._audioRecorder=a,this._cardPublisher=n}get sender(){return"asbplayer-video"}get command(){return"rerecord-media"}async handle(t,a){var T;const n=t,s={base64:"",extension:"webm",paddingStart:n.message.audioPaddingStart,paddingEnd:n.message.audioPaddingEnd,start:n.message.timestamp,end:n.message.timestamp+n.message.duration/n.message.playbackRate,playbackRate:n.message.playbackRate};let f;try{f={...s,base64:await this._audioRecorder.startWithTimeout(n.message.duration/n.message.playbackRate+n.message.audioPaddingEnd,!1,{src:n.src,tabId:(T=a.tab)==null?void 0:T.id})}}catch(j){if(!(j instanceof Cr))throw j;f={...s,error:Ut.drmProtected}}this._cardPublisher.publish({audio:f,image:n.message.uiState.image,url:n.message.uiState.url,subtitle:n.message.uiState.subtitle,surroundingSubtitles:n.message.uiState.surroundingSubtitles,subtitleFileName:n.message.subtitleFileName,mediaTimestamp:n.message.timestamp},void 0,a.tab.id,n.src);const A={sender:"asbplayer-extension-to-video",message:{command:"show-anki-ui-after-rerecord",uiState:{...n.message.uiState,audio:f,lastAppliedTimestampIntervalToAudio:n.message.uiState.timestampInterval}},src:n.src};te.tabs.sendMessage(a.tab.id,A)}}class xs{constructor(t,a,n,s){G(this,"_audioRecorder");G(this,"_imageCapturer");G(this,"_cardPublisher");G(this,"_settings");this._audioRecorder=t,this._imageCapturer=a,this._cardPublisher=n,this._settings=s}get sender(){return"asbplayer-video"}get command(){return"start-recording-media"}async handle(t,a){var _;const n=t;let s;if(n.message.record)try{await this._audioRecorder.start({src:n.src,tabId:(_=a.tab)==null?void 0:_.id})}catch(A){if(!(A instanceof Cr))throw A;s=A}let f;if(n.message.screenshot){const A=n.message.record?n.message.imageDelay:0,{maxWidth:T,maxHeight:j,rect:x,frameId:v}=n.message;try{f={base64:await this._imageCapturer.capture(a.tab.id,n.src,A,{maxWidth:T,maxHeight:j,rect:x,frameId:v}),extension:"jpeg"}}catch(d){console.error(d),f={base64:"",extension:"jpeg",error:nr.captureFailed}}finally{const d={sender:"asbplayer-extension-to-video",message:{command:"screenshot-taken"},src:n.src};te.tabs.sendMessage(a.tab.id,d)}}if(!n.message.record||s!==void 0){const A=n.message.mediaTimestamp,T={text:"",start:A,originalStart:A,end:A,originalEnd:A,track:0};let j=!1;n.message.postMineAction!==tt.showAnkiDialog&&(j=await this._settings.getSingle("preferMp3"));const x=s===void 0?void 0:{base64:"",extension:j?"mp3":"webm",paddingStart:0,paddingEnd:0,start:A,end:A,playbackRate:1,error:Ut.drmProtected};this._cardPublisher.publish({subtitle:T,surroundingSubtitles:[],image:f,audio:x,url:n.message.url,subtitleFileName:n.message.subtitleFileName,mediaTimestamp:n.message.mediaTimestamp},n.message.postMineAction,a.tab.id,n.src)}}}class Es{constructor(t,a,n,s){G(this,"_audioRecorder");G(this,"_imageCapturer");G(this,"_cardPublisher");G(this,"_settingsProvider");this._audioRecorder=t,this._imageCapturer=a,this._cardPublisher=n,this._settingsProvider=s}get sender(){return"asbplayer-video"}get command(){return"stop-recording-media"}async handle(t,a){const n=t,s=n.message.subtitle??{text:"",start:n.message.startTimestamp,end:n.message.endTimestamp,originalStart:n.message.startTimestamp,originalEnd:n.message.startTimestamp,track:0},f=n.message.surroundingSubtitles??us(s,n.message.videoDuration,5e3);let _;if(n.message.screenshot)try{let A=this._imageCapturer.lastImageBase64;if(A===void 0){const{maxWidth:T,maxHeight:j,rect:x,frameId:v}=n.message;A=await this._imageCapturer.capture(a.tab.id,n.src,0,{maxWidth:T,maxHeight:j,rect:x,frameId:v})}_={base64:A,extension:"jpeg"}}catch(A){console.error(A),_={base64:"",extension:"jpeg",error:nr.captureFailed}}try{let A=!1;n.message.postMineAction!==tt.showAnkiDialog&&(A=await this._settingsProvider.getSingle("preferMp3"));const j={base64:await this._audioRecorder.stop(A,{tabId:a.tab.id,src:n.src}),extension:A?"mp3":"webm",paddingStart:0,paddingEnd:0,start:n.message.startTimestamp,end:n.message.endTimestamp,playbackRate:n.message.playbackRate};this._cardPublisher.publish({subtitle:s,surroundingSubtitles:f,image:_,audio:j,url:n.message.url,subtitleFileName:n.message.subtitleFileName,mediaTimestamp:n.message.startTimestamp},n.message.postMineAction,a.tab.id,n.src)}catch(A){if(!(A instanceof yi))throw A}}}class Fs{constructor(t,a){G(this,"settings");G(this,"tabRegistry");this.settings=t,this.tabRegistry=a}get sender(){return["asbplayer-video","asbplayer-mobile-overlay-to-video"]}get command(){return"toggle-subtitles"}async handle(t,a){const n=await this.settings.getSingle("streamingDisplaySubtitles");await this.settings.set({streamingDisplaySubtitles:!n}),this.tabRegistry.publishCommandToVideoElements(s=>({sender:"asbplayer-extension-to-video",message:{command:"settings-updated"},src:s.src}))}}class ks{constructor(t){G(this,"tabRegistry");this.tabRegistry=t}get sender(){return"asbplayer-video"}get command(){return"sync"}async handle(t,a){try{const n=t;await this.tabRegistry.publishTabsToAsbplayers();const s=await this.tabRegistry.findAsbplayer({filter:_=>{var A;return _.receivedTabs===void 0||a.tab===void 0||_.sidePanel?!1:n.message.withSyncedAsbplayerOnly?_.syncedVideoElement!==void 0&&_.syncedVideoElement.id===((A=a.tab)==null?void 0:A.id)&&_.syncedVideoElement.src===n.src:n.message.withAsbplayerId?_.id===n.message.withAsbplayerId:_.receivedTabs.find(T=>T.id===a.tab.id&&T.src===n.src)!==void 0},allowTabCreation:!n.message.withSyncedAsbplayerOnly}),f={sender:"asbplayer-extension-to-player",message:{command:"syncv2",subtitles:n.message.subtitles,flatten:n.message.flatten},src:n.src,tabId:a.tab.id};s!==void 0&&this.tabRegistry.publishCommandToAsbplayers({asbplayerId:s,commandFactory:()=>f})}catch(n){console.error(n)}}}const Rs=["version","action","params"],Os=["guiAddCards","deckNames","modelNames","modelFieldNames","findNotes","guiBrowse","requestPermission","findNotes","notesInfo","updateNoteFields","addNote","storeMediaFile","version","addTags"];class Is{constructor(){}get sender(){return["asbplayer-video","asbplayer-video-tab","asbplayer-popup"]}get command(){return"http-post"}handle(t,a,n){const s=t.message;if(!this._validateBody(s.body)){n({error:"Invalid request"});return}return fetch(s.url,{method:"POST",body:JSON.stringify(s.body)}).then(f=>f.json()).then(f=>n(f)).catch(f=>n({error:f.message})),!0}_validateBody(t){const a=Object.keys(t);for(const f of a)if(!Rs.includes(f))return!1;const n=t.version;if(n!==void 0&&typeof n!="number")return!1;const s=t.action;return!(s!==void 0&&!Os.includes(s))}}class Cs{constructor(t){G(this,"tabRegistry");this.tabRegistry=t}get sender(){return"asbplayer-video"}get command(){return null}handle(t,a){var s;const n=t;if(typeof((s=a.tab)==null?void 0:s.id)<"u"){const f={sender:"asbplayer-extension-to-player",message:t.message,tabId:a.tab.id,src:n.src};this.tabRegistry.publishCommandToAsbplayers({commandFactory:()=>f})}return!1}}let Ts=class{get sender(){return"asbplayer"}get command(){return null}handle(t,a){const n=t,s={sender:"asbplayer-extension-to-video",message:n.message,src:n.src};return te.tabs.sendMessage(n.tabId,s),!1}};class Bs{constructor(){}get sender(){return"asbplayerv2"}get command(){return null}handle(t,a){const n=t;if(n.tabId){const s={sender:"asbplayer-extension-to-video",message:n.message,src:n.src};te.tabs.sendMessage(n.tabId,s)}return!1}}let Ms=class{constructor(t){G(this,"tabRegistry");this.tabRegistry=t}get sender(){return"asbplayerv2"}get command(){return"heartbeat"}handle(t,a){const n=t.message;return this.tabRegistry.onAsbplayerHeartbeat(a.tab,n),!1}};const An=Object.keys({ankiConnectUrl:!0,deck:!0,noteType:!0,sentenceField:!0,definitionField:!0,audioField:!0,imageField:!0,wordField:!0,sourceField:!0,urlField:!0,track1Field:!0,track2Field:!0,track3Field:!0,customAnkiFields:!0,tags:!0,recordWithAudioPlayback:!0,preferMp3:!0,audioPaddingStart:!0,audioPaddingEnd:!0,maxImageWidth:!0,maxImageHeight:!0,surroundingSubtitlesCountRadius:!0,surroundingSubtitlesTimeRadius:!0,ankiFieldSettings:!0,customAnkiFieldSettings:!0});var hi=(o=>(o.noSubtitleList="noSubtitleList",o.app="app",o))(hi||{});((bo=(vo=globalThis.browser)==null?void 0:vo.runtime)==null?void 0:bo.id)==null?globalThis.chrome:globalThis.browser;const Je=((Ao=(_o=((wo=navigator.userAgentData)==null?void 0:wo.platform)??navigator.platform)==null?void 0:_o.toUpperCase())==null?void 0:Ao.indexOf("MAC"))>-1,at={ankiConnectUrl:"http://127.0.0.1:8765",deck:"",noteType:"",sentenceField:"",definitionField:"",audioField:"",imageField:"",wordField:"",sourceField:"",urlField:"",track1Field:"",track2Field:"",track3Field:"",ankiFieldSettings:{sentence:{order:1,display:!0},definition:{order:2,display:!0},word:{order:3,display:!0},audio:{order:4,display:!0},image:{order:5,display:!0},source:{order:6,display:!0},url:{order:7,display:!0},track1:{order:8,display:!1},track2:{order:9,display:!1},track3:{order:10,display:!1}},customAnkiFieldSettings:{},...{subtitleSize:36,subtitleColor:"#ffffff",subtitleThickness:700,subtitleOutlineThickness:0,subtitleOutlineColor:"#000000",subtitleShadowThickness:3,subtitleShadowColor:"#000000",subtitleBackgroundColor:"#000000",subtitleBackgroundOpacity:0,subtitleFontFamily:"",subtitlePreview:"アあ安Aa",subtitleCustomStyles:[],subtitleBlur:!1},subtitlePositionOffset:75,topSubtitlePositionOffset:75,subtitleAlignment:"bottom",subtitleTracksV2:[],subtitlesWidth:-1,audioPaddingStart:0,audioPaddingEnd:500,maxImageWidth:0,maxImageHeight:0,surroundingSubtitlesCountRadius:2,surroundingSubtitlesTimeRadius:1e4,autoPausePreference:ti.atEnd,subtitleHtml:ri.remove,speedChangeStep:.1,fastForwardModePlaybackRate:2.7,keyBindSet:{togglePlay:{keys:"space"},toggleAutoPause:{keys:Je?"⇧+P":"shift+P"},toggleCondensedPlayback:{keys:Je?"⇧+O":"shift+O"},toggleFastForwardPlayback:{keys:Je?"⇧+F":"shift+F"},toggleSubtitles:{keys:"down"},toggleVideoSubtitleTrack1:{keys:"1"},toggleVideoSubtitleTrack2:{keys:"2"},toggleVideoSubtitleTrack3:{keys:"3"},toggleAsbplayerSubtitleTrack1:{keys:"W+1"},toggleAsbplayerSubtitleTrack2:{keys:"W+2"},toggleAsbplayerSubtitleTrack3:{keys:"W+3"},unblurAsbplayerTrack1:{keys:"B+1"},unblurAsbplayerTrack2:{keys:"B+2"},unblurAsbplayerTrack3:{keys:"B+3"},seekBackward:{keys:"A"},seekForward:{keys:"D"},seekToPreviousSubtitle:{keys:"left"},seekToNextSubtitle:{keys:"right"},seekToBeginningOfCurrentSubtitle:{keys:"up"},adjustOffsetToPreviousSubtitle:{keys:Je?"⇧+left":"ctrl+left"},adjustOffsetToNextSubtitle:{keys:Je?"⇧+right":"ctrl+right"},decreaseOffset:{keys:Je?"⇧+⌃+right":"ctrl+shift+right"},increaseOffset:{keys:Je?"⇧+⌃+left":"ctrl+shift+left"},resetOffset:{keys:Je?"⇧+⌃+down":"ctrl+shift+down"},copySubtitle:{keys:Je?"⇧+⌃+Z":"ctrl+shift+Z"},ankiExport:{keys:Je?"⇧+⌃+X":"ctrl+shift+X"},updateLastCard:{keys:Je?"⇧+⌃+U":"ctrl+shift+U"},exportCard:{keys:""},takeScreenshot:{keys:Je?"⇧+⌃+V":"ctrl+shift+V"},toggleRecording:{keys:Je?"⇧+⌃+R":"ctrl+shift+R"},decreasePlaybackRate:{keys:Je?"⇧+⌃+[":"ctrl+shift+["},increasePlaybackRate:{keys:Je?"⇧+⌃+]":"ctrl+shift+]"},toggleSidePanel:{keys:"`"},toggleRepeat:{keys:Je?"⇧+R":"shift+R"}},recordWithAudioPlayback:!0,preferMp3:!0,tabName:"asbplayer",miningHistoryStorageLimit:25,clickToMineDefaultAction:tt.showAnkiDialog,postMiningPlaybackState:ei.remember,themeType:"dark",copyToClipboardOnMine:!1,rememberSubtitleOffset:!0,lastSubtitleOffset:0,autoCopyCurrentSubtitle:!1,alwaysPlayOnSubtitleRepeat:!0,subtitleRegexFilter:"",subtitleRegexFilterTextReplacement:"",language:"en",customAnkiFields:{},tags:[],imageBasedSubtitleScaleFactor:1,streamingAppUrl:"https://app.asbplayer.dev",streamingDisplaySubtitles:!0,streamingRecordMedia:!0,streamingTakeScreenshot:!0,streamingCleanScreenshot:!0,streamingCropScreenshot:!0,streamingSubsDragAndDrop:!0,streamingAutoSync:!1,streamingAutoSyncPromptOnFailure:!1,streamingLastLanguagesSynced:{},streamingCondensedPlaybackMinimumSkipIntervalMs:1e3,streamingScreenshotDelay:1e3,streamingSubtitleListPreference:hi.noSubtitleList,streamingEnableOverlay:!0,webSocketClientEnabled:!1,webSocketServerUrl:"ws://127.0.0.1:8766/ws",pauseOnHoverMode:0,lastSelectedAnkiExportMode:"default"};Object.fromEntries(Object.entries(at).map(([o,t])=>{if(typeof t=="string")return[o,a=>a];if(typeof t=="boolean")return[o,a=>a==="true"];if(typeof t=="number")return[o,a=>Number(a)];if(typeof t=="object")return[o,a=>JSON.parse(a)];throw new Error("Could not determine deserializer for setting")}));const Sn=(o,t)=>{if(typeof o!=typeof t)return!1;if(typeof o!="object")return o===t;const a=Object.keys(o),n=Object.keys(t);if(o.length!==t.length)return!1;for(const s of a)if(!Sn(o[s],t[s]))return!1;for(const s of n)if(!Sn(o[s],t[s]))return!1;return!0},Ds=o=>{let t=!1,a={},n=!1,s={};if(o.keyBindSet!==void 0){const f=o.keyBindSet;for(const _ of Object.keys(at.keyBindSet)){const A=_;f[A]===void 0?(a[A]=at.keyBindSet[A],t=!0):a[A]=f[A]}}if(o.ankiFieldSettings!==void 0){const f=o.ankiFieldSettings;for(const _ of Object.keys(at.ankiFieldSettings)){const A=_;f[A]===void 0?(s[A]=at.ankiFieldSettings[A],n=!0):s[A]=f[A]}}return!n&&!t?o:{...o,ankiFieldSettings:s,keyBindSet:a}},js=Object.fromEntries(Object.keys(at).filter(o=>typeof at[o]=="object").map(o=>[o,!0]));class Pn{constructor(t){G(this,"_storage");G(this,"_complexValues",{});this._storage=t}async getAll(){return this.get(Object.keys(at))}async getSingle(t){return(await this.get([t]))[t]}async get(t){let a={};for(const f of t)a[f]=at[f];const n=await this._storage.get(a),s={};for(const f in a){const _=(n&&n[f])??at[f];if(js[f]){const A=this._complexValues[f];A!==void 0&&Sn(A,_)?s[f]=A:(this._complexValues[f]=_,s[f]=_)}else s[f]=_}return Ds(s)}async set(t){await this._storage.set(await this._ensureConsistencyOnWrite(t))}async _ensureConsistencyOnWrite(t){if(t.customAnkiFields===void 0)return t;const a=t.customAnkiFieldSettings??(await this._storage.get({customAnkiFieldSettings:at.customAnkiFieldSettings})).customAnkiFieldSettings;let n=!1;for(const s of Object.keys(a))s in t.customAnkiFields||(delete a[s],n=!0);return n?{...t,customAnkiFieldSettings:a}:t}async activeProfile(){return await this._storage.activeProfile()}async setActiveProfile(t){await this._storage.setActiveProfile(t)}async profiles(){return await this._storage.profiles()}async addProfile(t){await this._storage.addProfile(t)}async removeProfile(t){await this._storage.removeProfile(t)}}const Ns=o=>`_prof_${o}_`,Us=(o,t)=>`${Ns(t)}${o}`,$s=(o,t)=>o.substring(t.length+7),Tr=(o,t)=>{const a={};for(const n of Object.keys(o))a[Us(n,t)]=o[n];return a},qs=(o,t)=>{const a={};for(const n of Object.keys(o)){const s=$s(n,t);a[s]=o[n]}return a};var wt={},qt={},fr={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var Ks=fr.exports,mi;function Ls(){return mi||(mi=1,function(o,t){(function(a){var n=t&&!t.nodeType&&t,s=o&&!o.nodeType&&o,f=typeof kr=="object"&&kr;(f.global===f||f.window===f||f.self===f)&&(a=f);var _,A=2147483647,T=36,j=1,x=26,v=38,d=700,m=72,g=128,l="-",p=/^xn--/,h=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,F={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},U=T-j,S=Math.floor,K=String.fromCharCode,k;function pe(L){throw new RangeError(F[L])}function ve(L,Q){for(var se=L.length,ee=[];se--;)ee[se]=Q(L[se]);return ee}function ye(L,Q){var se=L.split("@"),ee="";se.length>1&&(ee=se[0]+"@",L=se[1]),L=L.replace(b,".");var X=L.split("."),be=ve(X,Q).join(".");return ee+be}function Ae(L){for(var Q=[],se=0,ee=L.length,X,be;se<ee;)X=L.charCodeAt(se++),X>=55296&&X<=56319&&se<ee?(be=L.charCodeAt(se++),(be&64512)==56320?Q.push(((X&1023)<<10)+(be&1023)+65536):(Q.push(X),se--)):Q.push(X);return Q}function Z(L){return ve(L,function(Q){var se="";return Q>65535&&(Q-=65536,se+=K(Q>>>10&1023|55296),Q=56320|Q&1023),se+=K(Q),se}).join("")}function _e(L){return L-48<10?L-22:L-65<26?L-65:L-97<26?L-97:T}function Se(L,Q){return L+22+75*(L<26)-((Q!=0)<<5)}function ge(L,Q,se){var ee=0;for(L=se?S(L/d):L>>1,L+=S(L/Q);L>U*x>>1;ee+=T)L=S(L/U);return S(ee+(U+1)*L/(L+v))}function Re(L){var Q=[],se=L.length,ee,X=0,be=g,we=m,Pe,Oe,Y,Ee,xe,me,Ke,Ne,De;for(Pe=L.lastIndexOf(l),Pe<0&&(Pe=0),Oe=0;Oe<Pe;++Oe)L.charCodeAt(Oe)>=128&&pe("not-basic"),Q.push(L.charCodeAt(Oe));for(Y=Pe>0?Pe+1:0;Y<se;){for(Ee=X,xe=1,me=T;Y>=se&&pe("invalid-input"),Ke=_e(L.charCodeAt(Y++)),(Ke>=T||Ke>S((A-X)/xe))&&pe("overflow"),X+=Ke*xe,Ne=me<=we?j:me>=we+x?x:me-we,!(Ke<Ne);me+=T)De=T-Ne,xe>S(A/De)&&pe("overflow"),xe*=De;ee=Q.length+1,we=ge(X-Ee,ee,Ee==0),S(X/ee)>A-be&&pe("overflow"),be+=S(X/ee),X%=ee,Q.splice(X++,0,be)}return Z(Q)}function fe(L){var Q,se,ee,X,be,we,Pe,Oe,Y,Ee,xe,me=[],Ke,Ne,De,ht;for(L=Ae(L),Ke=L.length,Q=g,se=0,be=m,we=0;we<Ke;++we)xe=L[we],xe<128&&me.push(K(xe));for(ee=X=me.length,X&&me.push(l);ee<Ke;){for(Pe=A,we=0;we<Ke;++we)xe=L[we],xe>=Q&&xe<Pe&&(Pe=xe);for(Ne=ee+1,Pe-Q>S((A-se)/Ne)&&pe("overflow"),se+=(Pe-Q)*Ne,Q=Pe,we=0;we<Ke;++we)if(xe=L[we],xe<Q&&++se>A&&pe("overflow"),xe==Q){for(Oe=se,Y=T;Ee=Y<=be?j:Y>=be+x?x:Y-be,!(Oe<Ee);Y+=T)ht=Oe-Ee,De=T-Ee,me.push(K(Se(Ee+ht%De,0))),Oe=S(ht/De);me.push(K(Se(Oe,0))),be=ge(se,Ne,ee==X),se=0,++ee}++se,++Q}return me.join("")}function H(L){return ye(L,function(Q){return p.test(Q)?Re(Q.slice(4).toLowerCase()):Q})}function re(L){return ye(L,function(Q){return h.test(Q)?"xn--"+fe(Q):Q})}if(_={version:"1.4.1",ucs2:{decode:Ae,encode:Z},decode:Re,encode:fe,toASCII:re,toUnicode:H},n&&s)if(o.exports==n)s.exports=_;else for(k in _)_.hasOwnProperty(k)&&(n[k]=_[k]);else a.punycode=_})(Ks)}(fr,fr.exports)),fr.exports}var xn,gi;function En(){return gi||(gi=1,xn=Error),xn}var Fn,vi;function kn(){return vi||(vi=1,Fn=EvalError),Fn}var Rn,bi;function On(){return bi||(bi=1,Rn=RangeError),Rn}var In,wi;function Cn(){return wi||(wi=1,In=ReferenceError),In}var Tn,_i;function Br(){return _i||(_i=1,Tn=SyntaxError),Tn}var Bn,Ai;function Kt(){return Ai||(Ai=1,Bn=TypeError),Bn}var Mn,Si;function Dn(){return Si||(Si=1,Mn=URIError),Mn}var jn,Pi;function Vs(){return Pi||(Pi=1,jn=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},a=Symbol("test"),n=Object(a);if(typeof a=="string"||Object.prototype.toString.call(a)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var s=42;t[a]=s;for(a in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var f=Object.getOwnPropertySymbols(t);if(f.length!==1||f[0]!==a||!Object.prototype.propertyIsEnumerable.call(t,a))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var _=Object.getOwnPropertyDescriptor(t,a);if(_.value!==s||_.enumerable!==!0)return!1}return!0}),jn}var Nn,xi;function Mr(){if(xi)return Nn;xi=1;var o=typeof Symbol<"u"&&Symbol,t=Vs();return Nn=function(){return typeof o!="function"||typeof Symbol!="function"||typeof o("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Nn}var Un,Ei;function Dr(){if(Ei)return Un;Ei=1;var o={foo:{}},t=Object;return Un=function(){return{__proto__:o}.foo===o.foo&&!({__proto__:null}instanceof t)},Un}var $n,Fi;function zs(){if(Fi)return $n;Fi=1;var o="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,a=Math.max,n="[object Function]",s=function(T,j){for(var x=[],v=0;v<T.length;v+=1)x[v]=T[v];for(var d=0;d<j.length;d+=1)x[d+T.length]=j[d];return x},f=function(T,j){for(var x=[],v=j,d=0;v<T.length;v+=1,d+=1)x[d]=T[v];return x},_=function(A,T){for(var j="",x=0;x<A.length;x+=1)j+=A[x],x+1<A.length&&(j+=T);return j};return $n=function(T){var j=this;if(typeof j!="function"||t.apply(j)!==n)throw new TypeError(o+j);for(var x=f(arguments,1),v,d=function(){if(this instanceof v){var h=j.apply(this,s(x,arguments));return Object(h)===h?h:this}return j.apply(T,s(x,arguments))},m=a(0,j.length-x.length),g=[],l=0;l<m;l++)g[l]="$"+l;if(v=Function("binder","return function ("+_(g,",")+"){ return binder.apply(this,arguments); }")(d),j.prototype){var p=function(){};p.prototype=j.prototype,v.prototype=new p,p.prototype=null}return v},$n}var qn,ki;function ar(){if(ki)return qn;ki=1;var o=zs();return qn=Function.prototype.bind||o,qn}var Kn,Ri;function jr(){if(Ri)return Kn;Ri=1;var o=Function.prototype.call,t=Object.prototype.hasOwnProperty,a=ar();return Kn=a.call(o,t),Kn}var Ln,Oi;function Vn(){if(Oi)return Ln;Oi=1;var o,t=En(),a=kn(),n=On(),s=Cn(),f=Br(),_=Kt(),A=Dn(),T=Function,j=function(fe){try{return T('"use strict"; return ('+fe+").constructor;")()}catch{}},x=Object.getOwnPropertyDescriptor;if(x)try{x({},"")}catch{x=null}var v=function(){throw new _},d=x?function(){try{return arguments.callee,v}catch{try{return x(arguments,"callee").get}catch{return v}}}():v,m=Mr()(),g=Dr()(),l=Object.getPrototypeOf||(g?function(fe){return fe.__proto__}:null),p={},h=typeof Uint8Array>"u"||!l?o:l(Uint8Array),b={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?o:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?o:ArrayBuffer,"%ArrayIteratorPrototype%":m&&l?l([][Symbol.iterator]()):o,"%AsyncFromSyncIteratorPrototype%":o,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":typeof Atomics>"u"?o:Atomics,"%BigInt%":typeof BigInt>"u"?o:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?o:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?o:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?o:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":a,"%Float32Array%":typeof Float32Array>"u"?o:Float32Array,"%Float64Array%":typeof Float64Array>"u"?o:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?o:FinalizationRegistry,"%Function%":T,"%GeneratorFunction%":p,"%Int8Array%":typeof Int8Array>"u"?o:Int8Array,"%Int16Array%":typeof Int16Array>"u"?o:Int16Array,"%Int32Array%":typeof Int32Array>"u"?o:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":m&&l?l(l([][Symbol.iterator]())):o,"%JSON%":typeof JSON=="object"?JSON:o,"%Map%":typeof Map>"u"?o:Map,"%MapIteratorPrototype%":typeof Map>"u"||!m||!l?o:l(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?o:Promise,"%Proxy%":typeof Proxy>"u"?o:Proxy,"%RangeError%":n,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?o:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?o:Set,"%SetIteratorPrototype%":typeof Set>"u"||!m||!l?o:l(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?o:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":m&&l?l(""[Symbol.iterator]()):o,"%Symbol%":m?Symbol:o,"%SyntaxError%":f,"%ThrowTypeError%":d,"%TypedArray%":h,"%TypeError%":_,"%Uint8Array%":typeof Uint8Array>"u"?o:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?o:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?o:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?o:Uint32Array,"%URIError%":A,"%WeakMap%":typeof WeakMap>"u"?o:WeakMap,"%WeakRef%":typeof WeakRef>"u"?o:WeakRef,"%WeakSet%":typeof WeakSet>"u"?o:WeakSet};if(l)try{null.error}catch(fe){var F=l(l(fe));b["%Error.prototype%"]=F}var U=function fe(H){var re;if(H==="%AsyncFunction%")re=j("async function () {}");else if(H==="%GeneratorFunction%")re=j("function* () {}");else if(H==="%AsyncGeneratorFunction%")re=j("async function* () {}");else if(H==="%AsyncGenerator%"){var L=fe("%AsyncGeneratorFunction%");L&&(re=L.prototype)}else if(H==="%AsyncIteratorPrototype%"){var Q=fe("%AsyncGenerator%");Q&&l&&(re=l(Q.prototype))}return b[H]=re,re},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},K=ar(),k=jr(),pe=K.call(Function.call,Array.prototype.concat),ve=K.call(Function.apply,Array.prototype.splice),ye=K.call(Function.call,String.prototype.replace),Ae=K.call(Function.call,String.prototype.slice),Z=K.call(Function.call,RegExp.prototype.exec),_e=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Se=/\\(\\)?/g,ge=function(H){var re=Ae(H,0,1),L=Ae(H,-1);if(re==="%"&&L!=="%")throw new f("invalid intrinsic syntax, expected closing `%`");if(L==="%"&&re!=="%")throw new f("invalid intrinsic syntax, expected opening `%`");var Q=[];return ye(H,_e,function(se,ee,X,be){Q[Q.length]=X?ye(be,Se,"$1"):ee||se}),Q},Re=function(H,re){var L=H,Q;if(k(S,L)&&(Q=S[L],L="%"+Q[0]+"%"),k(b,L)){var se=b[L];if(se===p&&(se=U(L)),typeof se>"u"&&!re)throw new _("intrinsic "+H+" exists, but is not available. Please file an issue!");return{alias:Q,name:L,value:se}}throw new f("intrinsic "+H+" does not exist!")};return Ln=function(H,re){if(typeof H!="string"||H.length===0)throw new _("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof re!="boolean")throw new _('"allowMissing" argument must be a boolean');if(Z(/^%?[^%]*%?$/,H)===null)throw new f("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var L=ge(H),Q=L.length>0?L[0]:"",se=Re("%"+Q+"%",re),ee=se.name,X=se.value,be=!1,we=se.alias;we&&(Q=we[0],ve(L,pe([0,1],we)));for(var Pe=1,Oe=!0;Pe<L.length;Pe+=1){var Y=L[Pe],Ee=Ae(Y,0,1),xe=Ae(Y,-1);if((Ee==='"'||Ee==="'"||Ee==="`"||xe==='"'||xe==="'"||xe==="`")&&Ee!==xe)throw new f("property names with quotes must have matching quotes");if((Y==="constructor"||!Oe)&&(be=!0),Q+="."+Y,ee="%"+Q+"%",k(b,ee))X=b[ee];else if(X!=null){if(!(Y in X)){if(!re)throw new _("base intrinsic for "+H+" exists, but the property is not available.");return}if(x&&Pe+1>=L.length){var me=x(X,Y);Oe=!!me,Oe&&"get"in me&&!("originalValue"in me.get)?X=me.get:X=X[Y]}else Oe=k(X,Y),X=X[Y];Oe&&!be&&(b[ee]=X)}}return X},Ln}var zn={exports:{}},Wn,Ii;function Ws(){if(Ii)return Wn;Ii=1;var o,t=En(),a=kn(),n=On(),s=Cn(),f=Br(),_=Kt(),A=Dn(),T=Function,j=function(fe){try{return T('"use strict"; return ('+fe+").constructor;")()}catch{}},x=Object.getOwnPropertyDescriptor;if(x)try{x({},"")}catch{x=null}var v=function(){throw new _},d=x?function(){try{return arguments.callee,v}catch{try{return x(arguments,"callee").get}catch{return v}}}():v,m=Mr()(),g=Dr()(),l=Object.getPrototypeOf||(g?function(fe){return fe.__proto__}:null),p={},h=typeof Uint8Array>"u"||!l?o:l(Uint8Array),b={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?o:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?o:ArrayBuffer,"%ArrayIteratorPrototype%":m&&l?l([][Symbol.iterator]()):o,"%AsyncFromSyncIteratorPrototype%":o,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":typeof Atomics>"u"?o:Atomics,"%BigInt%":typeof BigInt>"u"?o:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?o:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?o:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?o:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":a,"%Float32Array%":typeof Float32Array>"u"?o:Float32Array,"%Float64Array%":typeof Float64Array>"u"?o:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?o:FinalizationRegistry,"%Function%":T,"%GeneratorFunction%":p,"%Int8Array%":typeof Int8Array>"u"?o:Int8Array,"%Int16Array%":typeof Int16Array>"u"?o:Int16Array,"%Int32Array%":typeof Int32Array>"u"?o:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":m&&l?l(l([][Symbol.iterator]())):o,"%JSON%":typeof JSON=="object"?JSON:o,"%Map%":typeof Map>"u"?o:Map,"%MapIteratorPrototype%":typeof Map>"u"||!m||!l?o:l(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?o:Promise,"%Proxy%":typeof Proxy>"u"?o:Proxy,"%RangeError%":n,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?o:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?o:Set,"%SetIteratorPrototype%":typeof Set>"u"||!m||!l?o:l(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?o:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":m&&l?l(""[Symbol.iterator]()):o,"%Symbol%":m?Symbol:o,"%SyntaxError%":f,"%ThrowTypeError%":d,"%TypedArray%":h,"%TypeError%":_,"%Uint8Array%":typeof Uint8Array>"u"?o:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?o:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?o:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?o:Uint32Array,"%URIError%":A,"%WeakMap%":typeof WeakMap>"u"?o:WeakMap,"%WeakRef%":typeof WeakRef>"u"?o:WeakRef,"%WeakSet%":typeof WeakSet>"u"?o:WeakSet};if(l)try{null.error}catch(fe){var F=l(l(fe));b["%Error.prototype%"]=F}var U=function fe(H){var re;if(H==="%AsyncFunction%")re=j("async function () {}");else if(H==="%GeneratorFunction%")re=j("function* () {}");else if(H==="%AsyncGeneratorFunction%")re=j("async function* () {}");else if(H==="%AsyncGenerator%"){var L=fe("%AsyncGeneratorFunction%");L&&(re=L.prototype)}else if(H==="%AsyncIteratorPrototype%"){var Q=fe("%AsyncGenerator%");Q&&l&&(re=l(Q.prototype))}return b[H]=re,re},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},K=ar(),k=jr(),pe=K.call(Function.call,Array.prototype.concat),ve=K.call(Function.apply,Array.prototype.splice),ye=K.call(Function.call,String.prototype.replace),Ae=K.call(Function.call,String.prototype.slice),Z=K.call(Function.call,RegExp.prototype.exec),_e=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Se=/\\(\\)?/g,ge=function(H){var re=Ae(H,0,1),L=Ae(H,-1);if(re==="%"&&L!=="%")throw new f("invalid intrinsic syntax, expected closing `%`");if(L==="%"&&re!=="%")throw new f("invalid intrinsic syntax, expected opening `%`");var Q=[];return ye(H,_e,function(se,ee,X,be){Q[Q.length]=X?ye(be,Se,"$1"):ee||se}),Q},Re=function(H,re){var L=H,Q;if(k(S,L)&&(Q=S[L],L="%"+Q[0]+"%"),k(b,L)){var se=b[L];if(se===p&&(se=U(L)),typeof se>"u"&&!re)throw new _("intrinsic "+H+" exists, but is not available. Please file an issue!");return{alias:Q,name:L,value:se}}throw new f("intrinsic "+H+" does not exist!")};return Wn=function(H,re){if(typeof H!="string"||H.length===0)throw new _("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof re!="boolean")throw new _('"allowMissing" argument must be a boolean');if(Z(/^%?[^%]*%?$/,H)===null)throw new f("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var L=ge(H),Q=L.length>0?L[0]:"",se=Re("%"+Q+"%",re),ee=se.name,X=se.value,be=!1,we=se.alias;we&&(Q=we[0],ve(L,pe([0,1],we)));for(var Pe=1,Oe=!0;Pe<L.length;Pe+=1){var Y=L[Pe],Ee=Ae(Y,0,1),xe=Ae(Y,-1);if((Ee==='"'||Ee==="'"||Ee==="`"||xe==='"'||xe==="'"||xe==="`")&&Ee!==xe)throw new f("property names with quotes must have matching quotes");if((Y==="constructor"||!Oe)&&(be=!0),Q+="."+Y,ee="%"+Q+"%",k(b,ee))X=b[ee];else if(X!=null){if(!(Y in X)){if(!re)throw new _("base intrinsic for "+H+" exists, but the property is not available.");return}if(x&&Pe+1>=L.length){var me=x(X,Y);Oe=!!me,Oe&&"get"in me&&!("originalValue"in me.get)?X=me.get:X=X[Y]}else Oe=k(X,Y),X=X[Y];Oe&&!be&&(b[ee]=X)}}return X},Wn}var Hn,Ci;function Hs(){if(Ci)return Hn;Ci=1;var o,t=En(),a=kn(),n=On(),s=Cn(),f=Br(),_=Kt(),A=Dn(),T=Function,j=function(fe){try{return T('"use strict"; return ('+fe+").constructor;")()}catch{}},x=Object.getOwnPropertyDescriptor;if(x)try{x({},"")}catch{x=null}var v=function(){throw new _},d=x?function(){try{return arguments.callee,v}catch{try{return x(arguments,"callee").get}catch{return v}}}():v,m=Mr()(),g=Dr()(),l=Object.getPrototypeOf||(g?function(fe){return fe.__proto__}:null),p={},h=typeof Uint8Array>"u"||!l?o:l(Uint8Array),b={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?o:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?o:ArrayBuffer,"%ArrayIteratorPrototype%":m&&l?l([][Symbol.iterator]()):o,"%AsyncFromSyncIteratorPrototype%":o,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":typeof Atomics>"u"?o:Atomics,"%BigInt%":typeof BigInt>"u"?o:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?o:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?o:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?o:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":a,"%Float32Array%":typeof Float32Array>"u"?o:Float32Array,"%Float64Array%":typeof Float64Array>"u"?o:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?o:FinalizationRegistry,"%Function%":T,"%GeneratorFunction%":p,"%Int8Array%":typeof Int8Array>"u"?o:Int8Array,"%Int16Array%":typeof Int16Array>"u"?o:Int16Array,"%Int32Array%":typeof Int32Array>"u"?o:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":m&&l?l(l([][Symbol.iterator]())):o,"%JSON%":typeof JSON=="object"?JSON:o,"%Map%":typeof Map>"u"?o:Map,"%MapIteratorPrototype%":typeof Map>"u"||!m||!l?o:l(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?o:Promise,"%Proxy%":typeof Proxy>"u"?o:Proxy,"%RangeError%":n,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?o:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?o:Set,"%SetIteratorPrototype%":typeof Set>"u"||!m||!l?o:l(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?o:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":m&&l?l(""[Symbol.iterator]()):o,"%Symbol%":m?Symbol:o,"%SyntaxError%":f,"%ThrowTypeError%":d,"%TypedArray%":h,"%TypeError%":_,"%Uint8Array%":typeof Uint8Array>"u"?o:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?o:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?o:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?o:Uint32Array,"%URIError%":A,"%WeakMap%":typeof WeakMap>"u"?o:WeakMap,"%WeakRef%":typeof WeakRef>"u"?o:WeakRef,"%WeakSet%":typeof WeakSet>"u"?o:WeakSet};if(l)try{null.error}catch(fe){var F=l(l(fe));b["%Error.prototype%"]=F}var U=function fe(H){var re;if(H==="%AsyncFunction%")re=j("async function () {}");else if(H==="%GeneratorFunction%")re=j("function* () {}");else if(H==="%AsyncGeneratorFunction%")re=j("async function* () {}");else if(H==="%AsyncGenerator%"){var L=fe("%AsyncGeneratorFunction%");L&&(re=L.prototype)}else if(H==="%AsyncIteratorPrototype%"){var Q=fe("%AsyncGenerator%");Q&&l&&(re=l(Q.prototype))}return b[H]=re,re},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},K=ar(),k=jr(),pe=K.call(Function.call,Array.prototype.concat),ve=K.call(Function.apply,Array.prototype.splice),ye=K.call(Function.call,String.prototype.replace),Ae=K.call(Function.call,String.prototype.slice),Z=K.call(Function.call,RegExp.prototype.exec),_e=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Se=/\\(\\)?/g,ge=function(H){var re=Ae(H,0,1),L=Ae(H,-1);if(re==="%"&&L!=="%")throw new f("invalid intrinsic syntax, expected closing `%`");if(L==="%"&&re!=="%")throw new f("invalid intrinsic syntax, expected opening `%`");var Q=[];return ye(H,_e,function(se,ee,X,be){Q[Q.length]=X?ye(be,Se,"$1"):ee||se}),Q},Re=function(H,re){var L=H,Q;if(k(S,L)&&(Q=S[L],L="%"+Q[0]+"%"),k(b,L)){var se=b[L];if(se===p&&(se=U(L)),typeof se>"u"&&!re)throw new _("intrinsic "+H+" exists, but is not available. Please file an issue!");return{alias:Q,name:L,value:se}}throw new f("intrinsic "+H+" does not exist!")};return Hn=function(H,re){if(typeof H!="string"||H.length===0)throw new _("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof re!="boolean")throw new _('"allowMissing" argument must be a boolean');if(Z(/^%?[^%]*%?$/,H)===null)throw new f("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var L=ge(H),Q=L.length>0?L[0]:"",se=Re("%"+Q+"%",re),ee=se.name,X=se.value,be=!1,we=se.alias;we&&(Q=we[0],ve(L,pe([0,1],we)));for(var Pe=1,Oe=!0;Pe<L.length;Pe+=1){var Y=L[Pe],Ee=Ae(Y,0,1),xe=Ae(Y,-1);if((Ee==='"'||Ee==="'"||Ee==="`"||xe==='"'||xe==="'"||xe==="`")&&Ee!==xe)throw new f("property names with quotes must have matching quotes");if((Y==="constructor"||!Oe)&&(be=!0),Q+="."+Y,ee="%"+Q+"%",k(b,ee))X=b[ee];else if(X!=null){if(!(Y in X)){if(!re)throw new _("base intrinsic for "+H+" exists, but the property is not available.");return}if(x&&Pe+1>=L.length){var me=x(X,Y);Oe=!!me,Oe&&"get"in me&&!("originalValue"in me.get)?X=me.get:X=X[Y]}else Oe=k(X,Y),X=X[Y];Oe&&!be&&(b[ee]=X)}}return X},Hn}var Gn,Ti;function Zn(){if(Ti)return Gn;Ti=1;var o=Hs(),t=o("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return Gn=t,Gn}var Jn,Bi;function Gs(){if(Bi)return Jn;Bi=1;var o,t=SyntaxError,a=Function,n=TypeError,s=function(Z){try{return a('"use strict"; return ('+Z+").constructor;")()}catch{}},f=Object.getOwnPropertyDescriptor;if(f)try{f({},"")}catch{f=null}var _=function(){throw new n},A=f?function(){try{return arguments.callee,_}catch{try{return f(arguments,"callee").get}catch{return _}}}():_,T=Mr()(),j=Dr()(),x=Object.getPrototypeOf||(j?function(Z){return Z.__proto__}:null),v={},d=typeof Uint8Array>"u"||!x?o:x(Uint8Array),m={"%AggregateError%":typeof AggregateError>"u"?o:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?o:ArrayBuffer,"%ArrayIteratorPrototype%":T&&x?x([][Symbol.iterator]()):o,"%AsyncFromSyncIteratorPrototype%":o,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":typeof Atomics>"u"?o:Atomics,"%BigInt%":typeof BigInt>"u"?o:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?o:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?o:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?o:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?o:Float32Array,"%Float64Array%":typeof Float64Array>"u"?o:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?o:FinalizationRegistry,"%Function%":a,"%GeneratorFunction%":v,"%Int8Array%":typeof Int8Array>"u"?o:Int8Array,"%Int16Array%":typeof Int16Array>"u"?o:Int16Array,"%Int32Array%":typeof Int32Array>"u"?o:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":T&&x?x(x([][Symbol.iterator]())):o,"%JSON%":typeof JSON=="object"?JSON:o,"%Map%":typeof Map>"u"?o:Map,"%MapIteratorPrototype%":typeof Map>"u"||!T||!x?o:x(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?o:Promise,"%Proxy%":typeof Proxy>"u"?o:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?o:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?o:Set,"%SetIteratorPrototype%":typeof Set>"u"||!T||!x?o:x(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?o:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":T&&x?x(""[Symbol.iterator]()):o,"%Symbol%":T?Symbol:o,"%SyntaxError%":t,"%ThrowTypeError%":A,"%TypedArray%":d,"%TypeError%":n,"%Uint8Array%":typeof Uint8Array>"u"?o:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?o:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?o:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?o:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?o:WeakMap,"%WeakRef%":typeof WeakRef>"u"?o:WeakRef,"%WeakSet%":typeof WeakSet>"u"?o:WeakSet};if(x)try{null.error}catch(Z){var g=x(x(Z));m["%Error.prototype%"]=g}var l=function Z(_e){var Se;if(_e==="%AsyncFunction%")Se=s("async function () {}");else if(_e==="%GeneratorFunction%")Se=s("function* () {}");else if(_e==="%AsyncGeneratorFunction%")Se=s("async function* () {}");else if(_e==="%AsyncGenerator%"){var ge=Z("%AsyncGeneratorFunction%");ge&&(Se=ge.prototype)}else if(_e==="%AsyncIteratorPrototype%"){var Re=Z("%AsyncGenerator%");Re&&x&&(Se=x(Re.prototype))}return m[_e]=Se,Se},p={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},h=ar(),b=jr(),F=h.call(Function.call,Array.prototype.concat),U=h.call(Function.apply,Array.prototype.splice),S=h.call(Function.call,String.prototype.replace),K=h.call(Function.call,String.prototype.slice),k=h.call(Function.call,RegExp.prototype.exec),pe=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,ve=/\\(\\)?/g,ye=function(_e){var Se=K(_e,0,1),ge=K(_e,-1);if(Se==="%"&&ge!=="%")throw new t("invalid intrinsic syntax, expected closing `%`");if(ge==="%"&&Se!=="%")throw new t("invalid intrinsic syntax, expected opening `%`");var Re=[];return S(_e,pe,function(fe,H,re,L){Re[Re.length]=re?S(L,ve,"$1"):H||fe}),Re},Ae=function(_e,Se){var ge=_e,Re;if(b(p,ge)&&(Re=p[ge],ge="%"+Re[0]+"%"),b(m,ge)){var fe=m[ge];if(fe===v&&(fe=l(ge)),typeof fe>"u"&&!Se)throw new n("intrinsic "+_e+" exists, but is not available. Please file an issue!");return{alias:Re,name:ge,value:fe}}throw new t("intrinsic "+_e+" does not exist!")};return Jn=function(_e,Se){if(typeof _e!="string"||_e.length===0)throw new n("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Se!="boolean")throw new n('"allowMissing" argument must be a boolean');if(k(/^%?[^%]*%?$/,_e)===null)throw new t("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var ge=ye(_e),Re=ge.length>0?ge[0]:"",fe=Ae("%"+Re+"%",Se),H=fe.name,re=fe.value,L=!1,Q=fe.alias;Q&&(Re=Q[0],U(ge,F([0,1],Q)));for(var se=1,ee=!0;se<ge.length;se+=1){var X=ge[se],be=K(X,0,1),we=K(X,-1);if((be==='"'||be==="'"||be==="`"||we==='"'||we==="'"||we==="`")&&be!==we)throw new t("property names with quotes must have matching quotes");if((X==="constructor"||!ee)&&(L=!0),Re+="."+X,H="%"+Re+"%",b(m,H))re=m[H];else if(re!=null){if(!(X in re)){if(!Se)throw new n("base intrinsic for "+_e+" exists, but the property is not available.");return}if(f&&se+1>=ge.length){var Pe=f(re,X);ee=!!Pe,ee&&"get"in Pe&&!("originalValue"in Pe.get)?re=Pe.get:re=re[X]}else ee=b(re,X),re=re[X];ee&&!L&&(m[H]=re)}}return re},Jn}var Qn,Mi;function Di(){if(Mi)return Qn;Mi=1;var o=Gs(),t=o("%Object.getOwnPropertyDescriptor%",!0);if(t)try{t([],"length")}catch{t=null}return Qn=t,Qn}var Yn,ji;function Zs(){if(ji)return Yn;ji=1;var o=Zn(),t=Br(),a=Kt(),n=Di();return Yn=function(f,_,A){if(!f||typeof f!="object"&&typeof f!="function")throw new a("`obj` must be an object or a function`");if(typeof _!="string"&&typeof _!="symbol")throw new a("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new a("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new a("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new a("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new a("`loose`, if provided, must be a boolean");var T=arguments.length>3?arguments[3]:null,j=arguments.length>4?arguments[4]:null,x=arguments.length>5?arguments[5]:null,v=arguments.length>6?arguments[6]:!1,d=!!n&&n(f,_);if(o)o(f,_,{configurable:x===null&&d?d.configurable:!x,enumerable:T===null&&d?d.enumerable:!T,value:A,writable:j===null&&d?d.writable:!j});else if(v||!T&&!j&&!x)f[_]=A;else throw new t("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Yn}var Xn,Ni;function Js(){if(Ni)return Xn;Ni=1;var o=Zn(),t=function(){return!!o};return t.hasArrayLengthDefineBug=function(){if(!o)return null;try{return o([],"length",{value:1}).length!==1}catch{return!0}},Xn=t,Xn}var ea,Ui;function Qs(){if(Ui)return ea;Ui=1;var o=Ws(),t=Zs(),a=Js()(),n=Di(),s=Kt(),f=o("%Math.floor%");return ea=function(A,T){if(typeof A!="function")throw new s("`fn` is not a function");if(typeof T!="number"||T<0||T>4294967295||f(T)!==T)throw new s("`length` must be a positive 32-bit integer");var j=arguments.length>2&&!!arguments[2],x=!0,v=!0;if("length"in A&&n){var d=n(A,"length");d&&!d.configurable&&(x=!1),d&&!d.writable&&(v=!1)}return(x||v||!j)&&(a?t(A,"length",T,!0,!0):t(A,"length",T)),A},ea}var $i;function Ys(){return $i||($i=1,function(o){var t=ar(),a=Vn(),n=Qs(),s=Kt(),f=a("%Function.prototype.apply%"),_=a("%Function.prototype.call%"),A=a("%Reflect.apply%",!0)||t.call(_,f),T=Zn(),j=a("%Math.max%");o.exports=function(d){if(typeof d!="function")throw new s("a function is required");var m=A(t,_,arguments);return n(m,1+j(0,d.length-(arguments.length-1)),!0)};var x=function(){return A(t,f,arguments)};T?T(o.exports,"apply",{value:x}):o.exports.apply=x}(zn)),zn.exports}var ta,qi;function Xs(){if(qi)return ta;qi=1;var o=Vn(),t=Ys(),a=t(o("String.prototype.indexOf"));return ta=function(s,f){var _=o(s,!!f);return typeof _=="function"&&a(s,".prototype.")>-1?t(_):_},ta}const eu=rs(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var ra,Ki;function tu(){if(Ki)return ra;Ki=1;var o=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&o?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,a=o&&t&&typeof t.get=="function"?t.get:null,n=o&&Map.prototype.forEach,s=typeof Set=="function"&&Set.prototype,f=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,_=s&&f&&typeof f.get=="function"?f.get:null,A=s&&Set.prototype.forEach,T=typeof WeakMap=="function"&&WeakMap.prototype,j=T?WeakMap.prototype.has:null,x=typeof WeakSet=="function"&&WeakSet.prototype,v=x?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,m=d?WeakRef.prototype.deref:null,g=Boolean.prototype.valueOf,l=Object.prototype.toString,p=Function.prototype.toString,h=String.prototype.match,b=String.prototype.slice,F=String.prototype.replace,U=String.prototype.toUpperCase,S=String.prototype.toLowerCase,K=RegExp.prototype.test,k=Array.prototype.concat,pe=Array.prototype.join,ve=Array.prototype.slice,ye=Math.floor,Ae=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Z=Object.getOwnPropertySymbols,_e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Se=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ge=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Se||!0)?Symbol.toStringTag:null,Re=Object.prototype.propertyIsEnumerable,fe=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function($){return $.__proto__}:null);function H($,V){if($===1/0||$===-1/0||$!==$||$&&$>-1e3&&$<1e3||K.call(/e/,V))return V;var Ce=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof $=="number"){var ie=$<0?-ye(-$):ye($);if(ie!==$){var $e=String(ie),Fe=b.call(V,$e.length+1);return F.call($e,Ce,"$&_")+"."+F.call(F.call(Fe,/([0-9]{3})/g,"$&_"),/_$/,"")}}return F.call(V,Ce,"$&_")}var re=eu,L=re.custom,Q=xe(L)?L:null;ra=function $(V,Ce,ie,$e){var Fe=Ce||{};if(Ne(Fe,"quoteStyle")&&Fe.quoteStyle!=="single"&&Fe.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ne(Fe,"maxStringLength")&&(typeof Fe.maxStringLength=="number"?Fe.maxStringLength<0&&Fe.maxStringLength!==1/0:Fe.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var ot=Ne(Fe,"customInspect")?Fe.customInspect:!0;if(typeof ot!="boolean"&&ot!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ne(Fe,"indent")&&Fe.indent!==null&&Fe.indent!=="	"&&!(parseInt(Fe.indent,10)===Fe.indent&&Fe.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ne(Fe,"numericSeparator")&&typeof Fe.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var le=Fe.numericSeparator;if(typeof V>"u")return"undefined";if(V===null)return"null";if(typeof V=="boolean")return V?"true":"false";if(typeof V=="string")return hr(V,Fe);if(typeof V=="number"){if(V===0)return 1/0/V>0?"0":"-0";var Ze=String(V);return le?H(V,Ze):Ze}if(typeof V=="bigint"){var gt=String(V)+"n";return le?H(V,gt):gt}var Ht=typeof Fe.depth>"u"?5:Fe.depth;if(typeof ie>"u"&&(ie=0),ie>=Ht&&Ht>0&&typeof V=="object")return X(V)?"[Array]":"[Object]";var Et=mr(Fe,ie);if(typeof $e>"u")$e=[];else if(xt($e,V)>=0)return"[Circular]";function rt(bt,or,_t){if(or&&($e=ve.call($e),$e.push(or)),_t){var vr={depth:Fe.depth};return Ne(Fe,"quoteStyle")&&(vr.quoteStyle=Fe.quoteStyle),$(bt,vr,ie+1,$e)}return $(bt,Fe,ie+1,$e)}if(typeof V=="function"&&!we(V)){var Hr=ht(V),Gr=ct(V,rt);return"[Function"+(Hr?": "+Hr:" (anonymous)")+"]"+(Gr.length>0?" { "+pe.call(Gr,", ")+" }":"")}if(xe(V)){var Ft=Se?F.call(String(V),/^(Symbol\(.*\))_[^)]*$/,"$1"):_e.call(V);return typeof V=="object"&&!Se?it(Ft):Ft}if(Vt(V)){for(var ft="<"+S.call(String(V.nodeName)),Gt=V.attributes||[],kt=0;kt<Gt.length;kt++)ft+=" "+Gt[kt].name+"="+se(ee(Gt[kt].value),"double",Fe);return ft+=">",V.childNodes&&V.childNodes.length&&(ft+="..."),ft+="</"+S.call(String(V.nodeName))+">",ft}if(X(V)){if(V.length===0)return"[]";var Ue=ct(V,rt);return Et&&!Wt(Ue)?"["+Ct(Ue,Et)+"]":"[ "+pe.call(Ue,", ")+" ]"}if(Pe(V)){var Le=ct(V,rt);return!("cause"in Error.prototype)&&"cause"in V&&!Re.call(V,"cause")?"{ ["+String(V)+"] "+pe.call(k.call("[cause]: "+rt(V.cause),Le),", ")+" }":Le.length===0?"["+String(V)+"]":"{ ["+String(V)+"] "+pe.call(Le,", ")+" }"}if(typeof V=="object"&&ot){if(Q&&typeof V[Q]=="function"&&re)return re(V,{depth:Ht-ie});if(ot!=="symbol"&&typeof V.inspect=="function")return V.inspect()}if(pr(V)){var Zr=[];return n&&n.call(V,function(bt,or){Zr.push(rt(or,V,!0)+" => "+rt(bt,V))}),ir("Map",a.call(V),Zr,Et)}if(lt(V)){var Zt=[];return A&&A.call(V,function(bt){Zt.push(rt(bt,V))}),ir("Set",_.call(V),Zt,Et)}if(Pa(V))return mt("WeakMap");if(Wr(V))return mt("WeakSet");if(yr(V))return mt("WeakRef");if(Y(V))return it(rt(Number(V)));if(me(V))return it(rt(Ae.call(V)));if(Ee(V))return it(g.call(V));if(Oe(V))return it(rt(String(V)));if(typeof window<"u"&&V===window)return"{ [object Window] }";if(V===kr)return"{ [object globalThis] }";if(!be(V)&&!we(V)){var Tt=ct(V,rt),Jt=fe?fe(V)===Object.prototype:V instanceof Object||V.constructor===Object,gr=V instanceof Object?"":"null prototype",vt=!Jt&&ge&&Object(V)===V&&ge in V?b.call(De(V),8,-1):gr?"Object":"",Bt=Jt||typeof V.constructor!="function"?"":V.constructor.name?V.constructor.name+" ":"",dt=Bt+(vt||gr?"["+pe.call(k.call([],vt||[],gr||[]),": ")+"] ":"");return Tt.length===0?dt+"{}":Et?dt+"{"+Ct(Tt,Et)+"}":dt+"{ "+pe.call(Tt,", ")+" }"}return String(V)};function se($,V,Ce){var ie=(Ce.quoteStyle||V)==="double"?'"':"'";return ie+$+ie}function ee($){return F.call(String($),/"/g,"&quot;")}function X($){return De($)==="[object Array]"&&(!ge||!(typeof $=="object"&&ge in $))}function be($){return De($)==="[object Date]"&&(!ge||!(typeof $=="object"&&ge in $))}function we($){return De($)==="[object RegExp]"&&(!ge||!(typeof $=="object"&&ge in $))}function Pe($){return De($)==="[object Error]"&&(!ge||!(typeof $=="object"&&ge in $))}function Oe($){return De($)==="[object String]"&&(!ge||!(typeof $=="object"&&ge in $))}function Y($){return De($)==="[object Number]"&&(!ge||!(typeof $=="object"&&ge in $))}function Ee($){return De($)==="[object Boolean]"&&(!ge||!(typeof $=="object"&&ge in $))}function xe($){if(Se)return $&&typeof $=="object"&&$ instanceof Symbol;if(typeof $=="symbol")return!0;if(!$||typeof $!="object"||!_e)return!1;try{return _e.call($),!0}catch{}return!1}function me($){if(!$||typeof $!="object"||!Ae)return!1;try{return Ae.call($),!0}catch{}return!1}var Ke=Object.prototype.hasOwnProperty||function($){return $ in this};function Ne($,V){return Ke.call($,V)}function De($){return l.call($)}function ht($){if($.name)return $.name;var V=h.call(p.call($),/^function\s*([\w$]+)/);return V?V[1]:null}function xt($,V){if($.indexOf)return $.indexOf(V);for(var Ce=0,ie=$.length;Ce<ie;Ce++)if($[Ce]===V)return Ce;return-1}function pr($){if(!a||!$||typeof $!="object")return!1;try{a.call($);try{_.call($)}catch{return!0}return $ instanceof Map}catch{}return!1}function Pa($){if(!j||!$||typeof $!="object")return!1;try{j.call($,j);try{v.call($,v)}catch{return!0}return $ instanceof WeakMap}catch{}return!1}function yr($){if(!m||!$||typeof $!="object")return!1;try{return m.call($),!0}catch{}return!1}function lt($){if(!_||!$||typeof $!="object")return!1;try{_.call($);try{a.call($)}catch{return!0}return $ instanceof Set}catch{}return!1}function Wr($){if(!v||!$||typeof $!="object")return!1;try{v.call($,v);try{j.call($,j)}catch{return!0}return $ instanceof WeakSet}catch{}return!1}function Vt($){return!$||typeof $!="object"?!1:typeof HTMLElement<"u"&&$ instanceof HTMLElement?!0:typeof $.nodeName=="string"&&typeof $.getAttribute=="function"}function hr($,V){if($.length>V.maxStringLength){var Ce=$.length-V.maxStringLength,ie="... "+Ce+" more character"+(Ce>1?"s":"");return hr(b.call($,0,V.maxStringLength),V)+ie}var $e=F.call(F.call($,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,zt);return se($e,"single",V)}function zt($){var V=$.charCodeAt(0),Ce={8:"b",9:"t",10:"n",12:"f",13:"r"}[V];return Ce?"\\"+Ce:"\\x"+(V<16?"0":"")+U.call(V.toString(16))}function it($){return"Object("+$+")"}function mt($){return $+" { ? }"}function ir($,V,Ce,ie){var $e=ie?Ct(Ce,ie):pe.call(Ce,", ");return $+" ("+V+") {"+$e+"}"}function Wt($){for(var V=0;V<$.length;V++)if(xt($[V],`
`)>=0)return!1;return!0}function mr($,V){var Ce;if($.indent==="	")Ce="	";else if(typeof $.indent=="number"&&$.indent>0)Ce=pe.call(Array($.indent+1)," ");else return null;return{base:Ce,prev:pe.call(Array(V+1),Ce)}}function Ct($,V){if($.length===0)return"";var Ce=`
`+V.prev+V.base;return Ce+pe.call($,","+Ce)+`
`+V.prev}function ct($,V){var Ce=X($),ie=[];if(Ce){ie.length=$.length;for(var $e=0;$e<$.length;$e++)ie[$e]=Ne($,$e)?V($[$e],$):""}var Fe=typeof Z=="function"?Z($):[],ot;if(Se){ot={};for(var le=0;le<Fe.length;le++)ot["$"+Fe[le]]=Fe[le]}for(var Ze in $)Ne($,Ze)&&(Ce&&String(Number(Ze))===Ze&&Ze<$.length||Se&&ot["$"+Ze]instanceof Symbol||(K.call(/[^\w$]/,Ze)?ie.push(V(Ze,$)+": "+V($[Ze],$)):ie.push(Ze+": "+V($[Ze],$))));if(typeof Z=="function")for(var gt=0;gt<Fe.length;gt++)Re.call($,Fe[gt])&&ie.push("["+V(Fe[gt])+"]: "+V($[Fe[gt]],$));return ie}return ra}var na,Li;function ru(){if(Li)return na;Li=1;var o=Vn(),t=Xs(),a=tu(),n=Kt(),s=o("%WeakMap%",!0),f=o("%Map%",!0),_=t("WeakMap.prototype.get",!0),A=t("WeakMap.prototype.set",!0),T=t("WeakMap.prototype.has",!0),j=t("Map.prototype.get",!0),x=t("Map.prototype.set",!0),v=t("Map.prototype.has",!0),d=function(p,h){for(var b=p,F;(F=b.next)!==null;b=F)if(F.key===h)return b.next=F.next,F.next=p.next,p.next=F,F},m=function(p,h){var b=d(p,h);return b&&b.value},g=function(p,h,b){var F=d(p,h);F?F.value=b:p.next={key:h,next:p.next,value:b}},l=function(p,h){return!!d(p,h)};return na=function(){var h,b,F,U={assert:function(S){if(!U.has(S))throw new n("Side channel does not contain "+a(S))},get:function(S){if(s&&S&&(typeof S=="object"||typeof S=="function")){if(h)return _(h,S)}else if(f){if(b)return j(b,S)}else if(F)return m(F,S)},has:function(S){if(s&&S&&(typeof S=="object"||typeof S=="function")){if(h)return T(h,S)}else if(f){if(b)return v(b,S)}else if(F)return l(F,S);return!1},set:function(S,K){s&&S&&(typeof S=="object"||typeof S=="function")?(h||(h=new s),A(h,S,K)):f?(b||(b=new f),x(b,S,K)):(F||(F={key:{},next:null}),g(F,S,K))}};return U},na}var aa,Vi;function ia(){if(Vi)return aa;Vi=1;var o=String.prototype.replace,t=/%20/g,a={RFC1738:"RFC1738",RFC3986:"RFC3986"};return aa={default:a.RFC3986,formatters:{RFC1738:function(n){return o.call(n,t,"+")},RFC3986:function(n){return String(n)}},RFC1738:a.RFC1738,RFC3986:a.RFC3986},aa}var oa,zi;function Wi(){if(zi)return oa;zi=1;var o=ia(),t=Object.prototype.hasOwnProperty,a=Array.isArray,n=function(){for(var p=[],h=0;h<256;++h)p.push("%"+((h<16?"0":"")+h.toString(16)).toUpperCase());return p}(),s=function(h){for(;h.length>1;){var b=h.pop(),F=b.obj[b.prop];if(a(F)){for(var U=[],S=0;S<F.length;++S)typeof F[S]<"u"&&U.push(F[S]);b.obj[b.prop]=U}}},f=function(h,b){for(var F=b&&b.plainObjects?Object.create(null):{},U=0;U<h.length;++U)typeof h[U]<"u"&&(F[U]=h[U]);return F},_=function p(h,b,F){if(!b)return h;if(typeof b!="object"){if(a(h))h.push(b);else if(h&&typeof h=="object")(F&&(F.plainObjects||F.allowPrototypes)||!t.call(Object.prototype,b))&&(h[b]=!0);else return[h,b];return h}if(!h||typeof h!="object")return[h].concat(b);var U=h;return a(h)&&!a(b)&&(U=f(h,F)),a(h)&&a(b)?(b.forEach(function(S,K){if(t.call(h,K)){var k=h[K];k&&typeof k=="object"&&S&&typeof S=="object"?h[K]=p(k,S,F):h.push(S)}else h[K]=S}),h):Object.keys(b).reduce(function(S,K){var k=b[K];return t.call(S,K)?S[K]=p(S[K],k,F):S[K]=k,S},U)},A=function(h,b){return Object.keys(b).reduce(function(F,U){return F[U]=b[U],F},h)},T=function(p,h,b){var F=p.replace(/\+/g," ");if(b==="iso-8859-1")return F.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(F)}catch{return F}},j=1024,x=function(h,b,F,U,S){if(h.length===0)return h;var K=h;if(typeof h=="symbol"?K=Symbol.prototype.toString.call(h):typeof h!="string"&&(K=String(h)),F==="iso-8859-1")return escape(K).replace(/%u[0-9a-f]{4}/gi,function(_e){return"%26%23"+parseInt(_e.slice(2),16)+"%3B"});for(var k="",pe=0;pe<K.length;pe+=j){for(var ve=K.length>=j?K.slice(pe,pe+j):K,ye=[],Ae=0;Ae<ve.length;++Ae){var Z=ve.charCodeAt(Ae);if(Z===45||Z===46||Z===95||Z===126||Z>=48&&Z<=57||Z>=65&&Z<=90||Z>=97&&Z<=122||S===o.RFC1738&&(Z===40||Z===41)){ye[ye.length]=ve.charAt(Ae);continue}if(Z<128){ye[ye.length]=n[Z];continue}if(Z<2048){ye[ye.length]=n[192|Z>>6]+n[128|Z&63];continue}if(Z<55296||Z>=57344){ye[ye.length]=n[224|Z>>12]+n[128|Z>>6&63]+n[128|Z&63];continue}Ae+=1,Z=65536+((Z&1023)<<10|ve.charCodeAt(Ae)&1023),ye[ye.length]=n[240|Z>>18]+n[128|Z>>12&63]+n[128|Z>>6&63]+n[128|Z&63]}k+=ye.join("")}return k},v=function(h){for(var b=[{obj:{o:h},prop:"o"}],F=[],U=0;U<b.length;++U)for(var S=b[U],K=S.obj[S.prop],k=Object.keys(K),pe=0;pe<k.length;++pe){var ve=k[pe],ye=K[ve];typeof ye=="object"&&ye!==null&&F.indexOf(ye)===-1&&(b.push({obj:K,prop:ve}),F.push(ye))}return s(b),h},d=function(h){return Object.prototype.toString.call(h)==="[object RegExp]"},m=function(h){return!h||typeof h!="object"?!1:!!(h.constructor&&h.constructor.isBuffer&&h.constructor.isBuffer(h))},g=function(h,b){return[].concat(h,b)},l=function(h,b){if(a(h)){for(var F=[],U=0;U<h.length;U+=1)F.push(b(h[U]));return F}return b(h)};return oa={arrayToObject:f,assign:A,combine:g,compact:v,decode:T,encode:x,isBuffer:m,isRegExp:d,maybeMap:l,merge:_},oa}var sa,Hi;function nu(){if(Hi)return sa;Hi=1;var o=ru(),t=Wi(),a=ia(),n=Object.prototype.hasOwnProperty,s={brackets:function(p){return p+"[]"},comma:"comma",indices:function(p,h){return p+"["+h+"]"},repeat:function(p){return p}},f=Array.isArray,_=Array.prototype.push,A=function(l,p){_.apply(l,f(p)?p:[p])},T=Date.prototype.toISOString,j=a.default,x={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,format:j,formatter:a.formatters[j],indices:!1,serializeDate:function(p){return T.call(p)},skipNulls:!1,strictNullHandling:!1},v=function(p){return typeof p=="string"||typeof p=="number"||typeof p=="boolean"||typeof p=="symbol"||typeof p=="bigint"},d={},m=function l(p,h,b,F,U,S,K,k,pe,ve,ye,Ae,Z,_e,Se,ge,Re,fe){for(var H=p,re=fe,L=0,Q=!1;(re=re.get(d))!==void 0&&!Q;){var se=re.get(p);if(L+=1,typeof se<"u"){if(se===L)throw new RangeError("Cyclic object value");Q=!0}typeof re.get(d)>"u"&&(L=0)}if(typeof ve=="function"?H=ve(h,H):H instanceof Date?H=Z(H):b==="comma"&&f(H)&&(H=t.maybeMap(H,function(De){return De instanceof Date?Z(De):De})),H===null){if(S)return pe&&!ge?pe(h,x.encoder,Re,"key",_e):h;H=""}if(v(H)||t.isBuffer(H)){if(pe){var ee=ge?h:pe(h,x.encoder,Re,"key",_e);return[Se(ee)+"="+Se(pe(H,x.encoder,Re,"value",_e))]}return[Se(h)+"="+Se(String(H))]}var X=[];if(typeof H>"u")return X;var be;if(b==="comma"&&f(H))ge&&pe&&(H=t.maybeMap(H,pe)),be=[{value:H.length>0?H.join(",")||null:void 0}];else if(f(ve))be=ve;else{var we=Object.keys(H);be=ye?we.sort(ye):we}var Pe=k?h.replace(/\./g,"%2E"):h,Oe=F&&f(H)&&H.length===1?Pe+"[]":Pe;if(U&&f(H)&&H.length===0)return Oe+"[]";for(var Y=0;Y<be.length;++Y){var Ee=be[Y],xe=typeof Ee=="object"&&typeof Ee.value<"u"?Ee.value:H[Ee];if(!(K&&xe===null)){var me=Ae&&k?Ee.replace(/\./g,"%2E"):Ee,Ke=f(H)?typeof b=="function"?b(Oe,me):Oe:Oe+(Ae?"."+me:"["+me+"]");fe.set(p,L);var Ne=o();Ne.set(d,fe),A(X,l(xe,Ke,b,F,U,S,K,k,b==="comma"&&ge&&f(H)?null:pe,ve,ye,Ae,Z,_e,Se,ge,Re,Ne))}}return X},g=function(p){if(!p)return x;if(typeof p.allowEmptyArrays<"u"&&typeof p.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof p.encodeDotInKeys<"u"&&typeof p.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(p.encoder!==null&&typeof p.encoder<"u"&&typeof p.encoder!="function")throw new TypeError("Encoder has to be a function.");var h=p.charset||x.charset;if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var b=a.default;if(typeof p.format<"u"){if(!n.call(a.formatters,p.format))throw new TypeError("Unknown format option provided.");b=p.format}var F=a.formatters[b],U=x.filter;(typeof p.filter=="function"||f(p.filter))&&(U=p.filter);var S;if(p.arrayFormat in s?S=p.arrayFormat:"indices"in p?S=p.indices?"indices":"repeat":S=x.arrayFormat,"commaRoundTrip"in p&&typeof p.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var K=typeof p.allowDots>"u"?p.encodeDotInKeys===!0?!0:x.allowDots:!!p.allowDots;return{addQueryPrefix:typeof p.addQueryPrefix=="boolean"?p.addQueryPrefix:x.addQueryPrefix,allowDots:K,allowEmptyArrays:typeof p.allowEmptyArrays=="boolean"?!!p.allowEmptyArrays:x.allowEmptyArrays,arrayFormat:S,charset:h,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:x.charsetSentinel,commaRoundTrip:p.commaRoundTrip,delimiter:typeof p.delimiter>"u"?x.delimiter:p.delimiter,encode:typeof p.encode=="boolean"?p.encode:x.encode,encodeDotInKeys:typeof p.encodeDotInKeys=="boolean"?p.encodeDotInKeys:x.encodeDotInKeys,encoder:typeof p.encoder=="function"?p.encoder:x.encoder,encodeValuesOnly:typeof p.encodeValuesOnly=="boolean"?p.encodeValuesOnly:x.encodeValuesOnly,filter:U,format:b,formatter:F,serializeDate:typeof p.serializeDate=="function"?p.serializeDate:x.serializeDate,skipNulls:typeof p.skipNulls=="boolean"?p.skipNulls:x.skipNulls,sort:typeof p.sort=="function"?p.sort:null,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:x.strictNullHandling}};return sa=function(l,p){var h=l,b=g(p),F,U;typeof b.filter=="function"?(U=b.filter,h=U("",h)):f(b.filter)&&(U=b.filter,F=U);var S=[];if(typeof h!="object"||h===null)return"";var K=s[b.arrayFormat],k=K==="comma"&&b.commaRoundTrip;F||(F=Object.keys(h)),b.sort&&F.sort(b.sort);for(var pe=o(),ve=0;ve<F.length;++ve){var ye=F[ve];b.skipNulls&&h[ye]===null||A(S,m(h[ye],ye,K,k,b.allowEmptyArrays,b.strictNullHandling,b.skipNulls,b.encodeDotInKeys,b.encode?b.encoder:null,b.filter,b.sort,b.allowDots,b.serializeDate,b.format,b.formatter,b.encodeValuesOnly,b.charset,pe))}var Ae=S.join(b.delimiter),Z=b.addQueryPrefix===!0?"?":"";return b.charsetSentinel&&(b.charset==="iso-8859-1"?Z+="utf8=%26%2310003%3B&":Z+="utf8=%E2%9C%93&"),Ae.length>0?Z+Ae:""},sa}var ua,Gi;function au(){if(Gi)return ua;Gi=1;var o=Wi(),t=Object.prototype.hasOwnProperty,a=Array.isArray,n={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:o.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},s=function(d){return d.replace(/&#(\d+);/g,function(m,g){return String.fromCharCode(parseInt(g,10))})},f=function(d,m){return d&&typeof d=="string"&&m.comma&&d.indexOf(",")>-1?d.split(","):d},_="utf8=%26%2310003%3B",A="utf8=%E2%9C%93",T=function(m,g){var l={__proto__:null},p=g.ignoreQueryPrefix?m.replace(/^\?/,""):m;p=p.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var h=g.parameterLimit===1/0?void 0:g.parameterLimit,b=p.split(g.delimiter,h),F=-1,U,S=g.charset;if(g.charsetSentinel)for(U=0;U<b.length;++U)b[U].indexOf("utf8=")===0&&(b[U]===A?S="utf-8":b[U]===_&&(S="iso-8859-1"),F=U,U=b.length);for(U=0;U<b.length;++U)if(U!==F){var K=b[U],k=K.indexOf("]="),pe=k===-1?K.indexOf("="):k+1,ve,ye;pe===-1?(ve=g.decoder(K,n.decoder,S,"key"),ye=g.strictNullHandling?null:""):(ve=g.decoder(K.slice(0,pe),n.decoder,S,"key"),ye=o.maybeMap(f(K.slice(pe+1),g),function(Z){return g.decoder(Z,n.decoder,S,"value")})),ye&&g.interpretNumericEntities&&S==="iso-8859-1"&&(ye=s(ye)),K.indexOf("[]=")>-1&&(ye=a(ye)?[ye]:ye);var Ae=t.call(l,ve);Ae&&g.duplicates==="combine"?l[ve]=o.combine(l[ve],ye):(!Ae||g.duplicates==="last")&&(l[ve]=ye)}return l},j=function(d,m,g,l){for(var p=l?m:f(m,g),h=d.length-1;h>=0;--h){var b,F=d[h];if(F==="[]"&&g.parseArrays)b=g.allowEmptyArrays&&(p===""||g.strictNullHandling&&p===null)?[]:[].concat(p);else{b=g.plainObjects?Object.create(null):{};var U=F.charAt(0)==="["&&F.charAt(F.length-1)==="]"?F.slice(1,-1):F,S=g.decodeDotInKeys?U.replace(/%2E/g,"."):U,K=parseInt(S,10);!g.parseArrays&&S===""?b={0:p}:!isNaN(K)&&F!==S&&String(K)===S&&K>=0&&g.parseArrays&&K<=g.arrayLimit?(b=[],b[K]=p):S!=="__proto__"&&(b[S]=p)}p=b}return p},x=function(m,g,l,p){if(m){var h=l.allowDots?m.replace(/\.([^.[]+)/g,"[$1]"):m,b=/(\[[^[\]]*])/,F=/(\[[^[\]]*])/g,U=l.depth>0&&b.exec(h),S=U?h.slice(0,U.index):h,K=[];if(S){if(!l.plainObjects&&t.call(Object.prototype,S)&&!l.allowPrototypes)return;K.push(S)}for(var k=0;l.depth>0&&(U=F.exec(h))!==null&&k<l.depth;){if(k+=1,!l.plainObjects&&t.call(Object.prototype,U[1].slice(1,-1))&&!l.allowPrototypes)return;K.push(U[1])}if(U){if(l.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+l.depth+" and strictDepth is true");K.push("["+h.slice(U.index)+"]")}return j(K,g,l,p)}},v=function(m){if(!m)return n;if(typeof m.allowEmptyArrays<"u"&&typeof m.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof m.decodeDotInKeys<"u"&&typeof m.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(m.decoder!==null&&typeof m.decoder<"u"&&typeof m.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof m.charset<"u"&&m.charset!=="utf-8"&&m.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var g=typeof m.charset>"u"?n.charset:m.charset,l=typeof m.duplicates>"u"?n.duplicates:m.duplicates;if(l!=="combine"&&l!=="first"&&l!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var p=typeof m.allowDots>"u"?m.decodeDotInKeys===!0?!0:n.allowDots:!!m.allowDots;return{allowDots:p,allowEmptyArrays:typeof m.allowEmptyArrays=="boolean"?!!m.allowEmptyArrays:n.allowEmptyArrays,allowPrototypes:typeof m.allowPrototypes=="boolean"?m.allowPrototypes:n.allowPrototypes,allowSparse:typeof m.allowSparse=="boolean"?m.allowSparse:n.allowSparse,arrayLimit:typeof m.arrayLimit=="number"?m.arrayLimit:n.arrayLimit,charset:g,charsetSentinel:typeof m.charsetSentinel=="boolean"?m.charsetSentinel:n.charsetSentinel,comma:typeof m.comma=="boolean"?m.comma:n.comma,decodeDotInKeys:typeof m.decodeDotInKeys=="boolean"?m.decodeDotInKeys:n.decodeDotInKeys,decoder:typeof m.decoder=="function"?m.decoder:n.decoder,delimiter:typeof m.delimiter=="string"||o.isRegExp(m.delimiter)?m.delimiter:n.delimiter,depth:typeof m.depth=="number"||m.depth===!1?+m.depth:n.depth,duplicates:l,ignoreQueryPrefix:m.ignoreQueryPrefix===!0,interpretNumericEntities:typeof m.interpretNumericEntities=="boolean"?m.interpretNumericEntities:n.interpretNumericEntities,parameterLimit:typeof m.parameterLimit=="number"?m.parameterLimit:n.parameterLimit,parseArrays:m.parseArrays!==!1,plainObjects:typeof m.plainObjects=="boolean"?m.plainObjects:n.plainObjects,strictDepth:typeof m.strictDepth=="boolean"?!!m.strictDepth:n.strictDepth,strictNullHandling:typeof m.strictNullHandling=="boolean"?m.strictNullHandling:n.strictNullHandling}};return ua=function(d,m){var g=v(m);if(d===""||d===null||typeof d>"u")return g.plainObjects?Object.create(null):{};for(var l=typeof d=="string"?T(d,g):d,p=g.plainObjects?Object.create(null):{},h=Object.keys(l),b=0;b<h.length;++b){var F=h[b],U=x(F,l[F],g,typeof d=="string");p=o.merge(p,U,g)}return g.allowSparse===!0?p:o.compact(p)},ua}var la,Zi;function iu(){if(Zi)return la;Zi=1;var o=nu(),t=au(),a=ia();return la={formats:a,parse:t,stringify:o},la}var Ji;function ca(){if(Ji)return qt;Ji=1;var o=Ls();function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var a=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,s=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,f=["<",">",'"',"`"," ","\r",`
`,"	"],_=["{","}","|","\\","^","`"].concat(f),A=["'"].concat(_),T=["%","/","?",";","#"].concat(A),j=["/","?","#"],x=255,v=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},l={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},p=iu();function h(S,K,k){if(S&&typeof S=="object"&&S instanceof t)return S;var pe=new t;return pe.parse(S,K,k),pe}t.prototype.parse=function(S,K,k){if(typeof S!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof S);var pe=S.indexOf("?"),ve=pe!==-1&&pe<S.indexOf("#")?"?":"#",ye=S.split(ve),Ae=/\\/g;ye[0]=ye[0].replace(Ae,"/"),S=ye.join(ve);var Z=S;if(Z=Z.trim(),!k&&S.split("#").length===1){var _e=s.exec(Z);if(_e)return this.path=Z,this.href=Z,this.pathname=_e[1],_e[2]?(this.search=_e[2],K?this.query=p.parse(this.search.substr(1)):this.query=this.search.substr(1)):K&&(this.search="",this.query={}),this}var Se=a.exec(Z);if(Se){Se=Se[0];var ge=Se.toLowerCase();this.protocol=ge,Z=Z.substr(Se.length)}if(k||Se||Z.match(/^\/\/[^@/]+@[^@/]+/)){var Re=Z.substr(0,2)==="//";Re&&!(Se&&g[Se])&&(Z=Z.substr(2),this.slashes=!0)}if(!g[Se]&&(Re||Se&&!l[Se])){for(var fe=-1,H=0;H<j.length;H++){var re=Z.indexOf(j[H]);re!==-1&&(fe===-1||re<fe)&&(fe=re)}var L,Q;fe===-1?Q=Z.lastIndexOf("@"):Q=Z.lastIndexOf("@",fe),Q!==-1&&(L=Z.slice(0,Q),Z=Z.slice(Q+1),this.auth=decodeURIComponent(L)),fe=-1;for(var H=0;H<T.length;H++){var re=Z.indexOf(T[H]);re!==-1&&(fe===-1||re<fe)&&(fe=re)}fe===-1&&(fe=Z.length),this.host=Z.slice(0,fe),Z=Z.slice(fe),this.parseHost(),this.hostname=this.hostname||"";var se=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!se)for(var ee=this.hostname.split(/\./),H=0,X=ee.length;H<X;H++){var be=ee[H];if(be&&!be.match(v)){for(var we="",Pe=0,Oe=be.length;Pe<Oe;Pe++)be.charCodeAt(Pe)>127?we+="x":we+=be[Pe];if(!we.match(v)){var Y=ee.slice(0,H),Ee=ee.slice(H+1),xe=be.match(d);xe&&(Y.push(xe[1]),Ee.unshift(xe[2])),Ee.length&&(Z="/"+Ee.join(".")+Z),this.hostname=Y.join(".");break}}}this.hostname.length>x?this.hostname="":this.hostname=this.hostname.toLowerCase(),se||(this.hostname=o.toASCII(this.hostname));var me=this.port?":"+this.port:"",Ke=this.hostname||"";this.host=Ke+me,this.href+=this.host,se&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),Z[0]!=="/"&&(Z="/"+Z))}if(!m[ge])for(var H=0,X=A.length;H<X;H++){var Ne=A[H];if(Z.indexOf(Ne)!==-1){var De=encodeURIComponent(Ne);De===Ne&&(De=escape(Ne)),Z=Z.split(Ne).join(De)}}var ht=Z.indexOf("#");ht!==-1&&(this.hash=Z.substr(ht),Z=Z.slice(0,ht));var xt=Z.indexOf("?");if(xt!==-1?(this.search=Z.substr(xt),this.query=Z.substr(xt+1),K&&(this.query=p.parse(this.query)),Z=Z.slice(0,xt)):K&&(this.search="",this.query={}),Z&&(this.pathname=Z),l[ge]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var me=this.pathname||"",pr=this.search||"";this.path=me+pr}return this.href=this.format(),this};function b(S){return typeof S=="string"&&(S=h(S)),S instanceof t?S.format():t.prototype.format.call(S)}t.prototype.format=function(){var S=this.auth||"";S&&(S=encodeURIComponent(S),S=S.replace(/%3A/i,":"),S+="@");var K=this.protocol||"",k=this.pathname||"",pe=this.hash||"",ve=!1,ye="";this.host?ve=S+this.host:this.hostname&&(ve=S+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(ve+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(ye=p.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var Ae=this.search||ye&&"?"+ye||"";return K&&K.substr(-1)!==":"&&(K+=":"),this.slashes||(!K||l[K])&&ve!==!1?(ve="//"+(ve||""),k&&k.charAt(0)!=="/"&&(k="/"+k)):ve||(ve=""),pe&&pe.charAt(0)!=="#"&&(pe="#"+pe),Ae&&Ae.charAt(0)!=="?"&&(Ae="?"+Ae),k=k.replace(/[?#]/g,function(Z){return encodeURIComponent(Z)}),Ae=Ae.replace("#","%23"),K+ve+k+Ae+pe};function F(S,K){return h(S,!1,!0).resolve(K)}t.prototype.resolve=function(S){return this.resolveObject(h(S,!1,!0)).format()};function U(S,K){return S?h(S,!1,!0).resolveObject(K):K}return t.prototype.resolveObject=function(S){if(typeof S=="string"){var K=new t;K.parse(S,!1,!0),S=K}for(var k=new t,pe=Object.keys(this),ve=0;ve<pe.length;ve++){var ye=pe[ve];k[ye]=this[ye]}if(k.hash=S.hash,S.href==="")return k.href=k.format(),k;if(S.slashes&&!S.protocol){for(var Ae=Object.keys(S),Z=0;Z<Ae.length;Z++){var _e=Ae[Z];_e!=="protocol"&&(k[_e]=S[_e])}return l[k.protocol]&&k.hostname&&!k.pathname&&(k.pathname="/",k.path=k.pathname),k.href=k.format(),k}if(S.protocol&&S.protocol!==k.protocol){if(!l[S.protocol]){for(var Se=Object.keys(S),ge=0;ge<Se.length;ge++){var Re=Se[ge];k[Re]=S[Re]}return k.href=k.format(),k}if(k.protocol=S.protocol,!S.host&&!g[S.protocol]){for(var X=(S.pathname||"").split("/");X.length&&!(S.host=X.shift()););S.host||(S.host=""),S.hostname||(S.hostname=""),X[0]!==""&&X.unshift(""),X.length<2&&X.unshift(""),k.pathname=X.join("/")}else k.pathname=S.pathname;if(k.search=S.search,k.query=S.query,k.host=S.host||"",k.auth=S.auth,k.hostname=S.hostname||S.host,k.port=S.port,k.pathname||k.search){var fe=k.pathname||"",H=k.search||"";k.path=fe+H}return k.slashes=k.slashes||S.slashes,k.href=k.format(),k}var re=k.pathname&&k.pathname.charAt(0)==="/",L=S.host||S.pathname&&S.pathname.charAt(0)==="/",Q=L||re||k.host&&S.pathname,se=Q,ee=k.pathname&&k.pathname.split("/")||[],X=S.pathname&&S.pathname.split("/")||[],be=k.protocol&&!l[k.protocol];if(be&&(k.hostname="",k.port=null,k.host&&(ee[0]===""?ee[0]=k.host:ee.unshift(k.host)),k.host="",S.protocol&&(S.hostname=null,S.port=null,S.host&&(X[0]===""?X[0]=S.host:X.unshift(S.host)),S.host=null),Q=Q&&(X[0]===""||ee[0]==="")),L)k.host=S.host||S.host===""?S.host:k.host,k.hostname=S.hostname||S.hostname===""?S.hostname:k.hostname,k.search=S.search,k.query=S.query,ee=X;else if(X.length)ee||(ee=[]),ee.pop(),ee=ee.concat(X),k.search=S.search,k.query=S.query;else if(S.search!=null){if(be){k.host=ee.shift(),k.hostname=k.host;var we=k.host&&k.host.indexOf("@")>0?k.host.split("@"):!1;we&&(k.auth=we.shift(),k.hostname=we.shift(),k.host=k.hostname)}return k.search=S.search,k.query=S.query,(k.pathname!==null||k.search!==null)&&(k.path=(k.pathname?k.pathname:"")+(k.search?k.search:"")),k.href=k.format(),k}if(!ee.length)return k.pathname=null,k.search?k.path="/"+k.search:k.path=null,k.href=k.format(),k;for(var Pe=ee.slice(-1)[0],Oe=(k.host||S.host||ee.length>1)&&(Pe==="."||Pe==="..")||Pe==="",Y=0,Ee=ee.length;Ee>=0;Ee--)Pe=ee[Ee],Pe==="."?ee.splice(Ee,1):Pe===".."?(ee.splice(Ee,1),Y++):Y&&(ee.splice(Ee,1),Y--);if(!Q&&!se)for(;Y--;Y)ee.unshift("..");Q&&ee[0]!==""&&(!ee[0]||ee[0].charAt(0)!=="/")&&ee.unshift(""),Oe&&ee.join("/").substr(-1)!=="/"&&ee.push("");var xe=ee[0]===""||ee[0]&&ee[0].charAt(0)==="/";if(be){k.hostname=xe?"":ee.length?ee.shift():"",k.host=k.hostname;var we=k.host&&k.host.indexOf("@")>0?k.host.split("@"):!1;we&&(k.auth=we.shift(),k.hostname=we.shift(),k.host=k.hostname)}return Q=Q||k.host&&ee.length,Q&&!xe&&ee.unshift(""),ee.length>0?k.pathname=ee.join("/"):(k.pathname=null,k.path=null),(k.pathname!==null||k.search!==null)&&(k.path=(k.pathname?k.pathname:"")+(k.search?k.search:"")),k.auth=S.auth||k.auth,k.slashes=k.slashes||S.slashes,k.href=k.format(),k},t.prototype.parseHost=function(){var S=this.host,K=n.exec(S);K&&(K=K[0],K!==":"&&(this.port=K.substr(1)),S=S.substr(0,S.length-K.length)),S&&(this.hostname=S)},qt.parse=h,qt.resolve=F,qt.resolveObject=U,qt.format=b,qt.Url=t,qt}var Qe={},Qi;function Lt(){if(Qi)return Qe;Qi=1;var o=ca(),t=Qe.ValidationError=function(l,p,h,b,F,U){if(Array.isArray(b)?(this.path=b,this.property=b.reduce(function(K,k){return K+T(k)},"instance")):b!==void 0&&(this.property=b),l&&(this.message=l),h){var S=h.$id||h.id;this.schema=S||h}p!==void 0&&(this.instance=p),this.name=F,this.argument=U,this.stack=this.toString()};t.prototype.toString=function(){return this.property+" "+this.message};var a=Qe.ValidatorResult=function(l,p,h,b){this.instance=l,this.schema=p,this.options=h,this.path=b.path,this.propertyPath=b.propertyPath,this.errors=[],this.throwError=h&&h.throwError,this.throwFirst=h&&h.throwFirst,this.throwAll=h&&h.throwAll,this.disableFormat=h&&h.disableFormat===!0};a.prototype.addError=function(l){var p;if(typeof l=="string")p=new t(l,this.instance,this.schema,this.path);else{if(!l)throw new Error("Missing error detail");if(!l.message)throw new Error("Missing error message");if(!l.name)throw new Error("Missing validator type");p=new t(l.message,this.instance,this.schema,this.path,l.name,l.argument)}if(this.errors.push(p),this.throwFirst)throw new s(this);if(this.throwError)throw p;return p},a.prototype.importErrors=function(l){typeof l=="string"||l&&l.validatorType?this.addError(l):l&&l.errors&&(this.errors=this.errors.concat(l.errors))};function n(g,l){return l+": "+g.toString()+`
`}a.prototype.toString=function(l){return this.errors.map(n).join("")},Object.defineProperty(a.prototype,"valid",{get:function(){return!this.errors.length}}),Qe.ValidatorResultError=s;function s(g){Error.captureStackTrace&&Error.captureStackTrace(this,s),this.instance=g.instance,this.schema=g.schema,this.options=g.options,this.errors=g.errors}s.prototype=new Error,s.prototype.constructor=s,s.prototype.name="Validation Error";var f=Qe.SchemaError=function g(l,p){this.message=l,this.schema=p,Error.call(this,l),Error.captureStackTrace(this,g)};f.prototype=Object.create(Error.prototype,{constructor:{value:f,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var _=Qe.SchemaContext=function(l,p,h,b,F){this.schema=l,this.options=p,Array.isArray(h)?(this.path=h,this.propertyPath=h.reduce(function(U,S){return U+T(S)},"instance")):this.propertyPath=h,this.base=b,this.schemas=F};_.prototype.resolve=function(l){return o.resolve(this.base,l)},_.prototype.makeChild=function(l,p){var h=p===void 0?this.path:this.path.concat([p]),b=l.$id||l.id,F=o.resolve(this.base,b||""),U=new _(l,this.options,h,F,Object.create(this.schemas));return b&&!U.schemas[F]&&(U.schemas[F]=l),U};var A=Qe.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,duration:/P(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S)|\d+(D|M(\d+D)?|Y(\d+M(\d+D)?)?)(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S))?|\d+W)/i,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"idn-email":/^("(?:[!#-\[\]-\u{10FFFF}]|\\[\t -\u{10FFFF}])*"|[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*)@([!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*|\[[!-Z\^-\u{10FFFF}]*\])$/u,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"uri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/,iri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"iri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~-\u{10FFFF}]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~-\u{10FFFF}])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/u,uuid:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,"uri-template":/(%[0-9a-f]{2}|[!#$&(-;=?@\[\]_a-z~]|\{[!#&+,./;=?@|]?(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?(,(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?)*\})*/iu,"json-pointer":/^(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*$/iu,"relative-json-pointer":/^\d+(#|(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*)$/iu,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"utc-millisec":function(g){return typeof g=="string"&&parseFloat(g)===parseInt(g,10)&&!isNaN(g)},regex:function(g){var l=!0;try{new RegExp(g)}catch{l=!1}return l},style:/[\r\n\t ]*[^\r\n\t ][^:]*:[\r\n\t ]*[^\r\n\t ;]*[\r\n\t ]*;?/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/};A.regexp=A.regex,A.pattern=A.regex,A.ipv4=A["ip-address"],Qe.isFormat=function(l,p,h){if(typeof l=="string"&&A[p]!==void 0){if(A[p]instanceof RegExp)return A[p].test(l);if(typeof A[p]=="function")return A[p](l)}else if(h&&h.customFormats&&typeof h.customFormats[p]=="function")return h.customFormats[p](l);return!0};var T=Qe.makeSuffix=function(l){return l=l.toString(),!l.match(/[.\s\[\]]/)&&!l.match(/^[\d]/)?"."+l:l.match(/^\d+$/)?"["+l+"]":"["+JSON.stringify(l)+"]"};Qe.deepCompareStrict=function g(l,p){if(typeof l!=typeof p)return!1;if(Array.isArray(l))return!Array.isArray(p)||l.length!==p.length?!1:l.every(function(F,U){return g(l[U],p[U])});if(typeof l=="object"){if(!l||!p)return l===p;var h=Object.keys(l),b=Object.keys(p);return h.length!==b.length?!1:h.every(function(F){return g(l[F],p[F])})}return l===p};function j(g,l,p,h){typeof p=="object"?l[h]=d(g[h],p):g.indexOf(p)===-1&&l.push(p)}function x(g,l,p){l[p]=g[p]}function v(g,l,p,h){typeof l[h]!="object"||!l[h]?p[h]=l[h]:g[h]?p[h]=d(g[h],l[h]):p[h]=l[h]}function d(g,l){var p=Array.isArray(l),h=p&&[]||{};return p?(g=g||[],h=h.concat(g),l.forEach(j.bind(null,g,h))):(g&&typeof g=="object"&&Object.keys(g).forEach(x.bind(null,g,h)),Object.keys(l).forEach(v.bind(null,g,l,h))),h}Qe.deepMerge=d,Qe.objectGetPath=function(l,p){for(var h=p.split("/").slice(1),b;typeof(b=h.shift())=="string";){var F=decodeURIComponent(b.replace(/~0/,"~").replace(/~1/g,"/"));if(!(F in l))return;l=l[F]}return l};function m(g){return"/"+encodeURIComponent(g).replace(/~/g,"%7E")}return Qe.encodePath=function(l){return l.map(m).join("")},Qe.getDecimalPlaces=function(l){var p=0;if(isNaN(l))return p;typeof l!="number"&&(l=Number(l));var h=l.toString().split("e");if(h.length===2){if(h[1][0]!=="-")return p;p=Number(h[1].slice(1))}var b=h[0].split(".");return b.length===2&&(p+=b[1].length),p},Qe.isSchema=function(l){return typeof l=="object"&&l||typeof l=="boolean"},Qe}var fa,Yi;function ou(){if(Yi)return fa;Yi=1;var o=Lt(),t=o.ValidatorResult,a=o.SchemaError,n={};n.ignoreProperties={id:!0,default:!0,description:!0,title:!0,additionalItems:!0,then:!0,else:!0,$schema:!0,$ref:!0,extends:!0};var s=n.validators={};s.type=function(v,d,m,g){if(v===void 0)return null;var l=new t(v,d,m,g),p=Array.isArray(d.type)?d.type:[d.type];if(!p.some(this.testType.bind(this,v,d,m,g))){var h=p.map(function(b){if(b){var F=b.$id||b.id;return F?"<"+F+">":b+""}});l.addError({name:"type",argument:h,message:"is not of a type(s) "+h})}return l};function f(x,v,d,m,g){var l=v.throwError,p=v.throwAll;v.throwError=!1,v.throwAll=!1;var h=this.validateSchema(x,g,v,d);return v.throwError=l,v.throwAll=p,!h.valid&&m instanceof Function&&m(h),h.valid}s.anyOf=function(v,d,m,g){if(v===void 0)return null;var l=new t(v,d,m,g),p=new t(v,d,m,g);if(!Array.isArray(d.anyOf))throw new a("anyOf must be an array");if(!d.anyOf.some(f.bind(this,v,m,g,function(b){p.importErrors(b)}))){var h=d.anyOf.map(function(b,F){var U=b.$id||b.id;return U?"<"+U+">":b.title&&JSON.stringify(b.title)||b.$ref&&"<"+b.$ref+">"||"[subschema "+F+"]"});m.nestedErrors&&l.importErrors(p),l.addError({name:"anyOf",argument:h,message:"is not any of "+h.join(",")})}return l},s.allOf=function(v,d,m,g){if(v===void 0)return null;if(!Array.isArray(d.allOf))throw new a("allOf must be an array");var l=new t(v,d,m,g),p=this;return d.allOf.forEach(function(h,b){var F=p.validateSchema(v,h,m,g);if(!F.valid){var U=h.$id||h.id,S=U||h.title&&JSON.stringify(h.title)||h.$ref&&"<"+h.$ref+">"||"[subschema "+b+"]";l.addError({name:"allOf",argument:{id:S,length:F.errors.length,valid:F},message:"does not match allOf schema "+S+" with "+F.errors.length+" error[s]:"}),l.importErrors(F)}}),l},s.oneOf=function(v,d,m,g){if(v===void 0)return null;if(!Array.isArray(d.oneOf))throw new a("oneOf must be an array");var l=new t(v,d,m,g),p=new t(v,d,m,g),h=d.oneOf.filter(f.bind(this,v,m,g,function(F){p.importErrors(F)})).length,b=d.oneOf.map(function(F,U){var S=F.$id||F.id;return S||F.title&&JSON.stringify(F.title)||F.$ref&&"<"+F.$ref+">"||"[subschema "+U+"]"});return h!==1&&(m.nestedErrors&&l.importErrors(p),l.addError({name:"oneOf",argument:b,message:"is not exactly one from "+b.join(",")})),l},s.if=function(v,d,m,g){if(v===void 0)return null;if(!o.isSchema(d.if))throw new Error('Expected "if" keyword to be a schema');var l=f.call(this,v,m,g,null,d.if),p=new t(v,d,m,g),h;if(l){if(d.then===void 0)return;if(!o.isSchema(d.then))throw new Error('Expected "then" keyword to be a schema');h=this.validateSchema(v,d.then,m,g.makeChild(d.then)),p.importErrors(h)}else{if(d.else===void 0)return;if(!o.isSchema(d.else))throw new Error('Expected "else" keyword to be a schema');h=this.validateSchema(v,d.else,m,g.makeChild(d.else)),p.importErrors(h)}return p};function _(x,v){if(Object.hasOwnProperty.call(x,v))return x[v];if(v in x){for(;x=Object.getPrototypeOf(x);)if(Object.propertyIsEnumerable.call(x,v))return x[v]}}s.propertyNames=function(v,d,m,g){if(this.types.object(v)){var l=new t(v,d,m,g),p=d.propertyNames!==void 0?d.propertyNames:{};if(!o.isSchema(p))throw new a('Expected "propertyNames" to be a schema (object or boolean)');for(var h in v)if(_(v,h)!==void 0){var b=this.validateSchema(h,p,m,g.makeChild(p));l.importErrors(b)}return l}},s.properties=function(v,d,m,g){if(this.types.object(v)){var l=new t(v,d,m,g),p=d.properties||{};for(var h in p){var b=p[h];if(b!==void 0){if(b===null)throw new a('Unexpected null, expected schema in "properties"');typeof m.preValidateProperty=="function"&&m.preValidateProperty(v,h,b,m,g);var F=_(v,h),U=this.validateSchema(F,b,m,g.makeChild(b,h));U.instance!==l.instance[h]&&(l.instance[h]=U.instance),l.importErrors(U)}}return l}};function A(x,v,d,m,g,l){if(this.types.object(x)&&!(v.properties&&v.properties[g]!==void 0))if(v.additionalProperties===!1)l.addError({name:"additionalProperties",argument:g,message:"is not allowed to have the additional property "+JSON.stringify(g)});else{var p=v.additionalProperties||{};typeof d.preValidateProperty=="function"&&d.preValidateProperty(x,g,p,d,m);var h=this.validateSchema(x[g],p,d,m.makeChild(p,g));h.instance!==l.instance[g]&&(l.instance[g]=h.instance),l.importErrors(h)}}s.patternProperties=function(v,d,m,g){if(this.types.object(v)){var l=new t(v,d,m,g),p=d.patternProperties||{};for(var h in v){var b=!0;for(var F in p){var U=p[F];if(U!==void 0){if(U===null)throw new a('Unexpected null, expected schema in "patternProperties"');try{var S=new RegExp(F,"u")}catch{S=new RegExp(F)}if(S.test(h)){b=!1,typeof m.preValidateProperty=="function"&&m.preValidateProperty(v,h,U,m,g);var K=this.validateSchema(v[h],U,m,g.makeChild(U,h));K.instance!==l.instance[h]&&(l.instance[h]=K.instance),l.importErrors(K)}}}b&&A.call(this,v,d,m,g,h,l)}return l}},s.additionalProperties=function(v,d,m,g){if(this.types.object(v)){if(d.patternProperties)return null;var l=new t(v,d,m,g);for(var p in v)A.call(this,v,d,m,g,p,l);return l}},s.minProperties=function(v,d,m,g){if(this.types.object(v)){var l=new t(v,d,m,g),p=Object.keys(v);return p.length>=d.minProperties||l.addError({name:"minProperties",argument:d.minProperties,message:"does not meet minimum property length of "+d.minProperties}),l}},s.maxProperties=function(v,d,m,g){if(this.types.object(v)){var l=new t(v,d,m,g),p=Object.keys(v);return p.length<=d.maxProperties||l.addError({name:"maxProperties",argument:d.maxProperties,message:"does not meet maximum property length of "+d.maxProperties}),l}},s.items=function(v,d,m,g){var l=this;if(this.types.array(v)&&d.items!==void 0){var p=new t(v,d,m,g);return v.every(function(h,b){if(Array.isArray(d.items))var F=d.items[b]===void 0?d.additionalItems:d.items[b];else var F=d.items;if(F===void 0)return!0;if(F===!1)return p.addError({name:"items",message:"additionalItems not permitted"}),!1;var U=l.validateSchema(h,F,m,g.makeChild(F,b));return U.instance!==p.instance[b]&&(p.instance[b]=U.instance),p.importErrors(U),!0}),p}},s.contains=function(v,d,m,g){var l=this;if(this.types.array(v)&&d.contains!==void 0){if(!o.isSchema(d.contains))throw new Error('Expected "contains" keyword to be a schema');var p=new t(v,d,m,g),h=v.some(function(b,F){var U=l.validateSchema(b,d.contains,m,g.makeChild(d.contains,F));return U.errors.length===0});return h===!1&&p.addError({name:"contains",argument:d.contains,message:"must contain an item matching given schema"}),p}},s.minimum=function(v,d,m,g){if(this.types.number(v)){var l=new t(v,d,m,g);return d.exclusiveMinimum&&d.exclusiveMinimum===!0?v>d.minimum||l.addError({name:"minimum",argument:d.minimum,message:"must be greater than "+d.minimum}):v>=d.minimum||l.addError({name:"minimum",argument:d.minimum,message:"must be greater than or equal to "+d.minimum}),l}},s.maximum=function(v,d,m,g){if(this.types.number(v)){var l=new t(v,d,m,g);return d.exclusiveMaximum&&d.exclusiveMaximum===!0?v<d.maximum||l.addError({name:"maximum",argument:d.maximum,message:"must be less than "+d.maximum}):v<=d.maximum||l.addError({name:"maximum",argument:d.maximum,message:"must be less than or equal to "+d.maximum}),l}},s.exclusiveMinimum=function(v,d,m,g){if(typeof d.exclusiveMinimum!="boolean"&&this.types.number(v)){var l=new t(v,d,m,g),p=v>d.exclusiveMinimum;return p||l.addError({name:"exclusiveMinimum",argument:d.exclusiveMinimum,message:"must be strictly greater than "+d.exclusiveMinimum}),l}},s.exclusiveMaximum=function(v,d,m,g){if(typeof d.exclusiveMaximum!="boolean"&&this.types.number(v)){var l=new t(v,d,m,g),p=v<d.exclusiveMaximum;return p||l.addError({name:"exclusiveMaximum",argument:d.exclusiveMaximum,message:"must be strictly less than "+d.exclusiveMaximum}),l}};var T=function(v,d,m,g,l,p){if(this.types.number(v)){var h=d[l];if(h==0)throw new a(l+" cannot be zero");var b=new t(v,d,m,g),F=o.getDecimalPlaces(v),U=o.getDecimalPlaces(h),S=Math.max(F,U),K=Math.pow(10,S);return Math.round(v*K)%Math.round(h*K)!==0&&b.addError({name:l,argument:h,message:p+JSON.stringify(h)}),b}};s.multipleOf=function(v,d,m,g){return T.call(this,v,d,m,g,"multipleOf","is not a multiple of (divisible by) ")},s.divisibleBy=function(v,d,m,g){return T.call(this,v,d,m,g,"divisibleBy","is not divisible by (multiple of) ")},s.required=function(v,d,m,g){var l=new t(v,d,m,g);return v===void 0&&d.required===!0?l.addError({name:"required",message:"is required"}):this.types.object(v)&&Array.isArray(d.required)&&d.required.forEach(function(p){_(v,p)===void 0&&l.addError({name:"required",argument:p,message:"requires property "+JSON.stringify(p)})}),l},s.pattern=function(v,d,m,g){if(this.types.string(v)){var l=new t(v,d,m,g),p=d.pattern;try{var h=new RegExp(p,"u")}catch{h=new RegExp(p)}return v.match(h)||l.addError({name:"pattern",argument:d.pattern,message:"does not match pattern "+JSON.stringify(d.pattern.toString())}),l}},s.format=function(v,d,m,g){if(v!==void 0){var l=new t(v,d,m,g);return!l.disableFormat&&!o.isFormat(v,d.format,this)&&l.addError({name:"format",argument:d.format,message:"does not conform to the "+JSON.stringify(d.format)+" format"}),l}},s.minLength=function(v,d,m,g){if(this.types.string(v)){var l=new t(v,d,m,g),p=v.match(/[\uDC00-\uDFFF]/g),h=v.length-(p?p.length:0);return h>=d.minLength||l.addError({name:"minLength",argument:d.minLength,message:"does not meet minimum length of "+d.minLength}),l}},s.maxLength=function(v,d,m,g){if(this.types.string(v)){var l=new t(v,d,m,g),p=v.match(/[\uDC00-\uDFFF]/g),h=v.length-(p?p.length:0);return h<=d.maxLength||l.addError({name:"maxLength",argument:d.maxLength,message:"does not meet maximum length of "+d.maxLength}),l}},s.minItems=function(v,d,m,g){if(this.types.array(v)){var l=new t(v,d,m,g);return v.length>=d.minItems||l.addError({name:"minItems",argument:d.minItems,message:"does not meet minimum length of "+d.minItems}),l}},s.maxItems=function(v,d,m,g){if(this.types.array(v)){var l=new t(v,d,m,g);return v.length<=d.maxItems||l.addError({name:"maxItems",argument:d.maxItems,message:"does not meet maximum length of "+d.maxItems}),l}};function j(x,v,d){var m,g=d.length;for(m=v+1,g;m<g;m++)if(o.deepCompareStrict(x,d[m]))return!1;return!0}return s.uniqueItems=function(v,d,m,g){if(d.uniqueItems===!0&&this.types.array(v)){var l=new t(v,d,m,g);return v.every(j)||l.addError({name:"uniqueItems",message:"contains duplicate item"}),l}},s.dependencies=function(v,d,m,g){if(this.types.object(v)){var l=new t(v,d,m,g);for(var p in d.dependencies)if(v[p]!==void 0){var h=d.dependencies[p],b=g.makeChild(h,p);if(typeof h=="string"&&(h=[h]),Array.isArray(h))h.forEach(function(U){v[U]===void 0&&l.addError({name:"dependencies",argument:b.propertyPath,message:"property "+U+" not found, required by "+b.propertyPath})});else{var F=this.validateSchema(v,h,m,b);l.instance!==F.instance&&(l.instance=F.instance),F&&F.errors.length&&(l.addError({name:"dependencies",argument:b.propertyPath,message:"does not meet dependency required by "+b.propertyPath}),l.importErrors(F))}}return l}},s.enum=function(v,d,m,g){if(v===void 0)return null;if(!Array.isArray(d.enum))throw new a("enum expects an array",d);var l=new t(v,d,m,g);return d.enum.some(o.deepCompareStrict.bind(null,v))||l.addError({name:"enum",argument:d.enum,message:"is not one of enum values: "+d.enum.map(String).join(",")}),l},s.const=function(v,d,m,g){if(v===void 0)return null;var l=new t(v,d,m,g);return o.deepCompareStrict(d.const,v)||l.addError({name:"const",argument:d.const,message:"does not exactly match expected constant: "+d.const}),l},s.not=s.disallow=function(v,d,m,g){var l=this;if(v===void 0)return null;var p=new t(v,d,m,g),h=d.not||d.disallow;return h?(Array.isArray(h)||(h=[h]),h.forEach(function(b){if(l.testType(v,d,m,g,b)){var F=b&&(b.$id||b.id),U=F||b;p.addError({name:"not",argument:U,message:"is of prohibited type "+U})}}),p):null},fa=n,fa}var Nr={},Xi;function da(){if(Xi)return Nr;Xi=1;var o=ca(),t=Lt();Nr.SchemaScanResult=a;function a(n,s){this.id=n,this.ref=s}return Nr.scan=function(s,f){function _(v,d){if(!(!d||typeof d!="object")){if(d.$ref){var m=o.resolve(v,d.$ref);x[m]=x[m]?x[m]+1:0;return}var g=d.$id||d.id,l=g?o.resolve(v,g):v;if(l){if(l.indexOf("#")<0&&(l+="#"),j[l]){if(!t.deepCompareStrict(j[l],d))throw new Error("Schema <"+l+"> already exists with different definition");return j[l]}j[l]=d,l[l.length-1]=="#"&&(j[l.substring(0,l.length-1)]=d)}A(l+"/items",Array.isArray(d.items)?d.items:[d.items]),A(l+"/extends",Array.isArray(d.extends)?d.extends:[d.extends]),_(l+"/additionalItems",d.additionalItems),T(l+"/properties",d.properties),_(l+"/additionalProperties",d.additionalProperties),T(l+"/definitions",d.definitions),T(l+"/patternProperties",d.patternProperties),T(l+"/dependencies",d.dependencies),A(l+"/disallow",d.disallow),A(l+"/allOf",d.allOf),A(l+"/anyOf",d.anyOf),A(l+"/oneOf",d.oneOf),_(l+"/not",d.not)}}function A(v,d){if(Array.isArray(d))for(var m=0;m<d.length;m++)_(v+"/"+m,d[m])}function T(v,d){if(!(!d||typeof d!="object"))for(var m in d)_(v+"/"+m,d[m])}var j={},x={};return _(s,f),new a(j,x)},Nr}var pa,eo;function su(){if(eo)return pa;eo=1;var o=ca(),t=ou(),a=Lt(),n=da().scan,s=a.ValidatorResult,f=a.ValidatorResultError,_=a.SchemaError,A=a.SchemaContext,T="/",j=function d(){this.customFormats=Object.create(d.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(v),this.attributes=Object.create(t.validators)};j.prototype.customFormats={},j.prototype.schemas=null,j.prototype.types=null,j.prototype.attributes=null,j.prototype.unresolvedRefs=null,j.prototype.addSchema=function(m,g){var l=this;if(!m)return null;var p=n(g||T,m),h=g||m.$id||m.id;for(var b in p.id)this.schemas[b]=p.id[b];for(var b in p.ref)this.unresolvedRefs.push(b);return this.unresolvedRefs=this.unresolvedRefs.filter(function(F){return typeof l.schemas[F]>"u"}),this.schemas[h]},j.prototype.addSubSchemaArray=function(m,g){if(Array.isArray(g))for(var l=0;l<g.length;l++)this.addSubSchema(m,g[l])},j.prototype.addSubSchemaObject=function(m,g){if(!(!g||typeof g!="object"))for(var l in g)this.addSubSchema(m,g[l])},j.prototype.setSchemas=function(m){this.schemas=m},j.prototype.getSchema=function(m){return this.schemas[m]},j.prototype.validate=function(m,g,l,p){if(typeof g!="boolean"&&typeof g!="object"||g===null)throw new _("Expected `schema` to be an object or boolean");l||(l={});var h=g.$id||g.id,b=o.resolve(l.base||T,h||"");if(!p){p=new A(g,l,[],b,Object.create(this.schemas)),p.schemas[b]||(p.schemas[b]=g);var F=n(b,g);for(var U in F.id){var S=F.id[U];p.schemas[U]=S}}if(l.required&&m===void 0){var K=new s(m,g,l,p);return K.addError("is required, but is undefined"),K}var K=this.validateSchema(m,g,l,p);if(K){if(l.throwAll&&K.errors.length)throw new f(K)}else throw new Error("Result undefined");return K};function x(d){var m=typeof d=="string"?d:d.$ref;return typeof m=="string"?m:!1}j.prototype.validateSchema=function(m,g,l,p){var h=new s(m,g,l,p);if(typeof g=="boolean")g===!0?g={}:g===!1&&(g={type:[]});else if(!g)throw new Error("schema is undefined");if(g.extends)if(Array.isArray(g.extends)){var b={schema:g,ctx:p};g.extends.forEach(this.schemaTraverser.bind(this,b)),g=b.schema,b.schema=null,b.ctx=null,b=null}else g=a.deepMerge(g,this.superResolve(g.extends,p));var F=x(g);if(F){var U=this.resolve(g,F,p),S=new A(U.subschema,l,p.path,U.switchSchema,p.schemas);return this.validateSchema(m,U.subschema,l,S)}var K=l&&l.skipAttributes||[];for(var k in g)if(!t.ignoreProperties[k]&&K.indexOf(k)<0){var pe=null,ve=this.attributes[k];if(ve)pe=ve.call(this,m,g,l,p);else if(l.allowUnknownAttributes===!1)throw new _("Unsupported attribute: "+k,g);pe&&h.importErrors(pe)}if(typeof l.rewrite=="function"){var ye=l.rewrite.call(this,m,g,l,p);h.instance=ye}return h},j.prototype.schemaTraverser=function(m,g){m.schema=a.deepMerge(m.schema,this.superResolve(g,m.ctx))},j.prototype.superResolve=function(m,g){var l=x(m);return l?this.resolve(m,l,g).subschema:m},j.prototype.resolve=function(m,g,l){if(g=l.resolve(g),l.schemas[g])return{subschema:l.schemas[g],switchSchema:g};var p=o.parse(g),h=p&&p.hash,b=h&&h.length&&g.substr(0,g.length-h.length);if(!b||!l.schemas[b])throw new _("no such schema <"+g+">",m);var F=a.objectGetPath(l.schemas[b],h.substr(1));if(F===void 0)throw new _("no such schema "+h+" located in <"+b+">",m);return{subschema:F,switchSchema:g}},j.prototype.testType=function(m,g,l,p,h){if(h!==void 0){if(h===null)throw new _('Unexpected null in "type" keyword');if(typeof this.types[h]=="function")return this.types[h].call(this,m);if(h&&typeof h=="object"){var b=this.validateSchema(m,h,l,p);return b===void 0||!(b&&b.errors.length)}return!0}};var v=j.prototype.types={};return v.string=function(m){return typeof m=="string"},v.number=function(m){return typeof m=="number"&&isFinite(m)},v.integer=function(m){return typeof m=="number"&&m%1===0},v.boolean=function(m){return typeof m=="boolean"},v.array=function(m){return Array.isArray(m)},v.null=function(m){return m===null},v.date=function(m){return m instanceof Date},v.any=function(m){return!0},v.object=function(m){return m&&typeof m=="object"&&!Array.isArray(m)&&!(m instanceof Date)},pa=j,pa}var to;function uu(){if(to)return wt;to=1;var o=wt.Validator=su();return wt.ValidatorResult=Lt().ValidatorResult,wt.ValidatorResultError=Lt().ValidatorResultError,wt.ValidationError=Lt().ValidationError,wt.SchemaError=Lt().SchemaError,wt.SchemaScanResult=da().SchemaScanResult,wt.scan=da().scan,wt.validate=function(t,a,n){var s=new o;return s.validate(t,a,n)},wt}uu();const ro=o=>new Promise(async(t,a)=>{try{var n=new FileReader;n.readAsDataURL(o),n.onloadend=()=>{const s=n.result,f=s.substring(s.indexOf(",")+1);t(f)}}catch(s){a(s)}}),lu=o=>{const t=atob(o),a=new Uint8Array(t.length);for(let n=0;n<a.length;++n)a[n]=t.charCodeAt(n);return a},cu=(o,t)=>{const a=lu(o);return new Blob([a.buffer],{type:t})},fu=["en","es","de","ja","pl","pt_BR","zh_CN","ru","fi","fr","ko"],Ur="activeSettingsProfile",$r="settingsProfiles";class ya{constructor(t){G(this,"_storage");this._storage=t??te.storage.local}async get(t){const a=await this.activeProfile();return a===void 0?await this._storage.get(t):qs(await this._storage.get(Tr(t,a.name)),a.name)}async set(t){const a=await this.activeProfile();a===void 0?await this._storage.set(t):await this._storage.set(Tr(t,a.name))}async activeProfile(){const t=await this._storage.get(Ur),a=t&&t[Ur];return a===void 0?void 0:(await this.profiles()).find(s=>s.name===a)}async setActiveProfile(t){if(t===void 0)await this._storage.remove(Ur);else{if(!((await this.profiles()).find(s=>s.name===t)!==void 0))throw new Error(`Cannot set active profile to non-existant profile ${t}`);await this._storage.set({[Ur]:t})}}async profiles(){const t=await this._storage.get({[$r]:[]});return t?t[$r]??[]:[]}async addProfile(t){const a=await this.profiles();a.find(f=>f.name===t)===void 0&&a.push({name:t}),await this._storage.set({[$r]:a});const s=await this._storage.get(Object.keys(at));await this._storage.set(Tr(s,t))}async removeProfile(t){const a=await this.profiles(),n=await this.activeProfile();if(t===(n==null?void 0:n.name))throw new Error("Cannot remove active profile");const s=a.filter(_=>_.name!==t),f=Object.keys(Tr(at,t));await this._storage.remove(f),await this._storage.set({[$r]:s})}async clear(){await this._storage.clear()}}const du=!1,pu=new Pn(new ya),no=te.storage.session,Vl=3600*24*1e3,ha=async(o=!1)=>{if(!o){const t=await no.get(["config"]),a=t?t.config:void 0;if(a==="-")return;if(a!==void 0&&(typeof a.ttl!="number"||Date.now()<a.ttl))return a}try{const a=`${await pu.getSingle("streamingAppUrl")}/extension.json`,n=await(await fetch(a)).json();if(yu(n))return await no.set({config:n}),n}catch(t){console.error(t)}},yu=o=>o!==void 0&&hu(o.latest)&&mu(o.languages),hu=o=>typeof o.version=="string"&&typeof o.url=="string",mu=o=>{if(o===void 0||typeof o!="object"||!Array.isArray(o))return!1;for(const t of o)if(typeof t.code!="string"||typeof t.url!="string"||typeof t.version!="number")return!1;return!0},gu=o=>`locStrings-${o}`,ao=o=>`locVersion-${o}`,vu=new Pn(new ya),bu=async()=>{const o=await ha();return o===void 0?fu:o.languages.map(t=>t.code)},qr=async o=>{var t;try{let a=await ha();if(a===void 0)return;const n=a.languages.find(A=>A.code===o)??((t=await ha(!0))==null?void 0:t.languages.find(A=>A.code===o));if(n===void 0)return;const s=ao(o),f=await te.storage.local.get(s),_=f?f[s]:void 0;(_===void 0||_<n.version)&&await wu(n)}catch(a){console.error(a)}},wu=async({code:o,url:t,version:a})=>{const n=await vu.getSingle("streamingAppUrl"),s=t.startsWith("http://")||t.startsWith("https://")?t:`${n}/${t}`;try{const f=await(await fetch(s)).json();if(typeof f=="object"){const _=ao(o),A=gu(o);await te.storage.local.set({[A]:f,[_]:a})}}catch(f){console.error(f)}};class _u{constructor(){G(this,"_socket");G(this,"_pingInterval");G(this,"_lastPingTimestampMs");G(this,"_pongReceived",!1);G(this,"_pingPromises",[]);G(this,"_connectPromise");G(this,"onMineSubtitle");G(this,"onLoadSubtitles");G(this,"onSeekTimestamp")}get socket(){return this._socket}async bind(t){this._pingInterval&&clearInterval(this._pingInterval),this._pingInterval=setInterval(()=>{var a;if(this._lastPingTimestampMs!==void 0&&!this._pongReceived||this._socket&&this._socket.readyState!==((a=this._socket)==null?void 0:a.OPEN)){console.log("Did not receive pong - reconnecting");for(const n of this._pingPromises)n.reject("Timed out");this._pingPromises=[],this._connect(t)}else this.ping().catch(console.info)},1e4),await this._connect(t)}async _connect(t){if(this._disconnect(),!t)throw new Error("Invalid URL");return new Promise((a,n)=>{this._connectPromise={resolve:a,reject:n};const s=new WebSocket(t);s.onmessage=async f=>{var _,A,T,j,x,v;if(f.data==="PONG"){this._pongReceived=!0;for(const d of this._pingPromises)d.resolve(void 0);this._pingPromises=[]}else{const d=JSON.parse(f.data);if(d.command==="mine-subtitle"){const m=d.messageId,g=await((_=this.onMineSubtitle)==null?void 0:_.call(this,d))??!1,l={command:"response",messageId:m,body:{published:g}};(A=this._socket)==null||A.send(JSON.stringify(l))}else if(d.command==="load-subtitles"){const m=d.messageId;await((T=this.onLoadSubtitles)==null?void 0:T.call(this,d));const g={command:"response",messageId:m,body:{}};(j=this._socket)==null||j.send(JSON.stringify(g))}else if(d.command==="seek-timestamp"){const m=d.messageId;await((x=this.onSeekTimestamp)==null?void 0:x.call(this,d));const g={command:"response",messageId:m,body:{}};(v=this._socket)==null||v.send(JSON.stringify(g))}}},s.onclose=f=>{var _;console.log(`Socket closed - reason: ${f.reason}`),(_=this._connectPromise)==null||_.reject("Socket closed"),this._connectPromise=void 0},s.onerror=()=>{var f;console.log("Socket error"),(f=this._connectPromise)==null||f.reject("Socket error"),this._connectPromise=void 0},s.onopen=()=>{var f;this.ping().catch(console.error),(f=this._connectPromise)==null||f.resolve(void 0),this._connectPromise=void 0},this._socket=s})}async ping(){return new Promise((t,a)=>{if(!this._socket||this._socket.readyState!==this._socket.OPEN){a("Not connected");return}this._socket.send("PING"),this._lastPingTimestampMs=Date.now(),this._pongReceived=!1,this._pingPromises.push({resolve:t,reject:a})})}_disconnect(){this._socket&&(this._socket.readyState!==this._socket.CLOSED&&this._socket.readyState!==this._socket.CLOSING&&this._socket.close(),this._socket=void 0)}unbind(){var t;this._disconnect(),this._pingInterval!==void 0&&(clearInterval(this._pingInterval),this._pingInterval=void 0);for(const a of this._pingPromises)a.reject("Disconnecting");this._pingPromises=[],this._lastPingTimestampMs=void 0,this._pongReceived=!1,(t=this._connectPromise)==null||t.reject("Disconnecting"),this._connectPromise=void 0,this.onMineSubtitle=void 0,this.onSeekTimestamp=void 0,this.onLoadSubtitles=void 0}}let yt;const ma=async(o,t)=>{yt==null||yt.unbind();const a=await o.getSingle("webSocketServerUrl");a&&(yt=new _u,yt.bind(a),yt.onMineSubtitle=async({body:{fields:n,postMineAction:s}})=>new Promise((f,_)=>{te.tabs.query({active:!0,currentWindow:!0},async A=>{const T=await o.get(An),j=n??{},x=j[T.wordField]||void 0,v=j[T.definitionField]||void 0,d=j[T.sentenceField]||void 0,m=Object.fromEntries(Object.entries(T.customAnkiFields).map(([b,F])=>{const U=j[F];if(U!==void 0)return[b,U]}).filter(b=>b!==void 0)),g=s??tt.showAnkiDialog;let l=!1;const p=t.publishCommandToVideoElements(b=>!b.loadedSubtitles||A.find(U=>U.id===b.tab.id)===void 0?void 0:(l=!0,{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",word:x,definition:v,text:d,postMineAction:g,customFieldValues:m},src:b.src})),h=await t.publishCommandToAsbplayers({commandFactory:b=>b.sidePanel||!b.loadedSubtitles?void 0:(l=!0,{sender:"asbplayer-extension-to-player",message:{command:"copy-subtitle-with-additional-fields",word:x,definition:v,text:d,postMineAction:g,customFieldValues:m},asbplayerId:b.id})});await p,await h,f(l)})}),yt.onLoadSubtitles=async n=>{const{files:s}=n.body,f={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select",subtitleFiles:s}};t.publishCommandToVideoElementTabs(_=>f)},yt.onSeekTimestamp=async({body:{timestamp:n}})=>new Promise(s=>{t.publishCommandToVideoElements(f=>({sender:"asbplayer-extension-to-video",message:{command:"currentTime",value:n},src:f.src})),s()}))},ga=()=>{yt==null||yt.unbind()};class Au{constructor(t,a){G(this,"_tabRegistry");G(this,"_settingsProvider");this._tabRegistry=t,this._settingsProvider=a}get sender(){return["asbplayer-popup","asbplayer-settings","asbplayer-mobile-overlay","asbplayer-video","asbplayer-video-tab"]}get command(){return"settings-updated"}handle(t,a){return this._settingsProvider.get(["language","webSocketClientEnabled"]).then(({language:n,webSocketClientEnabled:s})=>{qr(n),s?ma(this._settingsProvider,this._tabRegistry):ga()}),this._tabRegistry.publishCommandToVideoElements(n=>({sender:"asbplayer-extension-to-video",message:{command:"settings-updated"},src:n.src})),this._tabRegistry.publishCommandToAsbplayers({commandFactory:()=>({sender:"asbplayer-extension-to-player",message:{command:"settings-updated"}})}),te.tabs.query({url:`${te.runtime.getURL("/options.html")}`}).then(n=>{for(const s of n)s.id!==void 0&&te.tabs.sendMessage(s.id,{message:{command:"settings-updated"}})}),!1}}class Su{constructor(t,a){G(this,"_imageCapturer");G(this,"_cardPublisher");this._imageCapturer=t,this._cardPublisher=a}get sender(){return"asbplayer-video"}get command(){return"take-screenshot"}async handle(t,a){const n=a.tab,s=t,{maxWidth:f,maxHeight:_,rect:A,frameId:T}=s.message;let j;try{j={base64:await this._imageCapturer.capture(a.tab.id,s.src,0,{maxWidth:f,maxHeight:_,rect:A,frameId:T}),extension:"jpeg"}}catch(d){console.error(d),j={base64:"",extension:"jpeg",error:nr.captureFailed}}let x;s.message.ankiUiState&&(x=s.message.ankiUiState,x.image=j,this._cardPublisher.publish({audio:x.audio,image:x.image,file:x.file,url:x.url,subtitle:x.subtitle,surroundingSubtitles:x.surroundingSubtitles,subtitleFileName:s.message.subtitleFileName,mediaTimestamp:s.message.mediaTimestamp},void 0,n.id,s.src));const v={sender:"asbplayer-extension-to-video",message:{command:"screenshot-taken",ankiUiState:x},src:s.src};te.tabs.sendMessage(n.id,v)}}class Pu{constructor(t){G(this,"_audioRecorder");this._audioRecorder=t}get sender(){return["asbplayer-offscreen-document","asbplayer-video"]}get command(){return"audio-base64"}handle(t,a){const n=t;return this._audioRecorder.onAudioBase64(n.message.base64,n.message.requestId),!1}}class xu{constructor(t){G(this,"tabRegistry");this.tabRegistry=t}get sender(){return"asbplayerv2"}get command(){return"ackTabs"}handle(t,a){const n=t.message;return this.tabRegistry.onAsbplayerAckTabs(a.tab,n),!1}}class Eu{get sender(){return"asbplayerv2"}get command(){return"open-extension-shortcuts"}handle(t,a){return te.tabs.create({active:!0,url:"chrome://extensions/shortcuts"}),!1}}class Fu{get sender(){return"asbplayerv2"}get command(){return"extension-commands"}handle(t,a,n){return te.commands===void 0?(n({}),!1):(te.commands.getAll(s=>{const f={};for(const _ of s)_.name&&_.shortcut&&(f[_.name]=_.shortcut);n(f)}),!0)}}class ku{get sender(){return["asbplayer-video","asbplayer-video-tab"]}get command(){return"open-asbplayer-settings"}async handle(t,a){t.message.tutorial?te.tabs.create({active:!0,url:te.runtime.getURL("/options.html?tutorial=true")}):te.runtime.openOptionsPage()}}class Ru{get sender(){return"asbplayer-foreground"}get command(){return"capture-visible-tab"}handle(t,a,n){if(!(a.tab===void 0||a.tab.id===void 0))return Xa(a.tab.id).then(s=>{n(s)}),!0}}class Ou{constructor(){}get sender(){return["asbplayer-video","asbplayer-video-tab"]}get command(){return"copy-to-clipboard"}handle(t,a,n){var _;const s=(_=a.tab)==null?void 0:_.id;if(s===void 0)return;const f={sender:"asbplayer-extension-to-video",message:t.message};return te.tabs.sendMessage(s,f),!1}}class Iu{constructor(t,a){G(this,"_tabRegistry");G(this,"_settingsProvider");this._tabRegistry=t,this._settingsProvider=a}get sender(){return"asbplayerv2"}get command(){return"settings-updated"}handle(t,a){const n=t;return this._settingsProvider.get(["language","webSocketClientEnabled"]).then(({language:s,webSocketClientEnabled:f})=>{qr(s),f?ma(this._settingsProvider,this._tabRegistry):ga()}),this._tabRegistry.publishCommandToVideoElements(s=>({sender:"asbplayer-extension-to-video",message:{command:"settings-updated"},src:s.src})),this._tabRegistry.publishCommandToAsbplayers({commandFactory:s=>n.asbplayerId!==void 0&&n.asbplayerId===s.id?void 0:{sender:"asbplayer-extension-to-player",message:{command:"settings-updated"}}}),!1}}class Cu{constructor(t){G(this,"_tabRegistry");this._tabRegistry=t}get sender(){return"asbplayer-video"}get command(){return"video-disappeared"}handle(t,a,n){if(a.tab===void 0)return;const s=t;return this._tabRegistry.onVideoElementDisappeared(a.tab,s.src),!1}}class Tu{constructor(t){G(this,"_tabRegistry");this._tabRegistry=t}get sender(){return"asbplayerv2"}get command(){return"load-subtitles"}handle(t,a){const n=t,s={sender:"asbplayer-extension-to-video",src:"src"in t?t.src:void 0,message:{command:"toggle-video-select",fromAsbplayerId:n.message.fromAsbplayerId}};let f=!1;return this._tabRegistry.publishCommandToVideoElementTabs(_=>{if(_.id===n.tabId)return f=!0,s}).then(()=>{f&&te.tabs.update(n.tabId,{active:!0})}),!1}}class Bu{constructor(t){G(this,"_tabRegistry");this._tabRegistry=t}get sender(){return["asbplayer-video-tab","asbplayerv2"]}get command(){return"toggle-side-panel"}handle(t,a){let n=!1;return this._tabRegistry.publishCommandToAsbplayers({commandFactory:s=>{if(s.sidePanel){const f={sender:"asbplayer-extension-to-player",message:{command:"close-side-panel"}};return n=!0,f}}}),n||te.windows.getLastFocused(s=>te.sidePanel.open({windowId:s.id})),!1}}class Mu{constructor(t){G(this,"_tabRegistry");this._tabRegistry=t}get sender(){return"asbplayerv2"}get command(){return"copy-subtitle"}handle(t,a){const n=t;return this._tabRegistry.publishCommandToVideoElements(s=>s.src!==n.src||s.tab.id!==n.tabId?void 0:{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",postMineAction:n.message.postMineAction,subtitle:n.message.subtitle,surroundingSubtitles:n.message.surroundingSubtitles},src:s.src}),!1}}const va="tabRequestingActiveTabPermission",Du=async(o,t,a)=>{if(a){const n=await ju(o);n===void 0?await te.storage.session.remove(va):await te.storage.session.set({[va]:{tabId:o,src:t,url:n.url}})}else await te.storage.session.remove(va)},ju=async o=>await te.tabs.get(o);class Nu{get sender(){return"asbplayer-video"}get command(){return"requesting-active-tab-permission"}handle(t,a){var s;const n=t;return((s=a.tab)==null?void 0:s.id)!==void 0&&Du(a.tab.id,n.src,n.message.requesting),!1}}class Uu{static async encode(t,a){return new Promise(async(n,s)=>{var f=new FileReader;f.onload=async _=>{try{const A=new AudioContext;if(_.target===null){s(new Error("Could not obtain buffer to encode"));return}const T=await A.decodeAudioData(_.target.result),j=[];for(let d=0;d<T.numberOfChannels;++d)j.push(T.getChannelData(d));const x=a(),v=x instanceof Worker?x:await x;v.postMessage({command:"encode",audioBuffer:{channels:j,numberOfChannels:T.numberOfChannels,length:T.length,sampleRate:T.sampleRate}}),v.onmessage=d=>{n(new Blob(d.data.buffer,{type:"audio/mp3"})),v.terminate()},v.onerror=d=>{const m=(d==null?void 0:d.error)??new Error("MP3 encoding failed: "+(d==null?void 0:d.message));s(m),v.terminate()}}catch(A){s(A)}},f.readAsArrayBuffer(t)})}}const $u=navigator.userAgent.toLowerCase().includes("firefox"),qu=24,io=(o,t)=>`${o.replaceAll(" ","_").substring(0,Math.min(o.length,qu))}_${Math.floor(t)}`,oo=(o,t)=>{for(let a=o.length-1;a>=0;--a)if(t===o[a]){o.splice(a,1);break}},We=(o,t)=>{for(const a of t[o])a()};function Ku(){const o={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"};return Object.keys(o).filter(MediaRecorder.isTypeSupported).map(t=>[t,o[t]])[0]}class Lu{constructor(t,a,n,s,f,_,A){G(this,"_name");G(this,"_start");G(this,"_end");G(this,"playbackRate");G(this,"_base64");G(this,"_extension");G(this,"_error");G(this,"_callbacks",{play:[],pause:[]});G(this,"playingAudio");G(this,"stopAudioTimeout");G(this,"cachedBlob");this._name=io(t,a),this._start=a,this._end=n,this.playbackRate=s,this._base64=f,this._extension=_,this._error=A}get name(){return this._name}get extension(){return this._extension}get start(){return this._start}get end(){return this._end}async base64(){return this._base64}async blob(){return await this._blob()}get playing(){return this.playingAudio!==void 0}onEvent(t,a){return this._callbacks[t].push(a),()=>{oo(this._callbacks[t],a)}}async play(){if(this.playingAudio){this.stop(),We("pause",this._callbacks);return}const t=await this._blob(),a=new Audio;a.src=URL.createObjectURL(t),a.preload="metadata",this.playingAudio=a,await a.play(),We("play",this._callbacks),this.stopAudioTimeout=setTimeout(()=>{this.stopAudio(a),this.playingAudio=void 0,this.stopAudioTimeout=void 0,We("pause",this._callbacks)},(this._end-this._start)/this.playbackRate+100)}stop(){this.playingAudio&&(this.stopAudio(this.playingAudio),clearTimeout(this.stopAudioTimeout),this.playingAudio=void 0,this.stopAudioTimeout=void 0,We("pause",this._callbacks))}stopAudio(t){t.pause();const a=t.src;t.removeAttribute("src"),t.load(),URL.revokeObjectURL(a)}async _blob(){return this.cachedBlob||(this.cachedBlob=cu(this._base64,`audio/${this.extension}`)),this.cachedBlob}slice(t,a){return this}isSliceable(){return!1}get error(){return this._error}}class so extends Error{}class uo{constructor(t,a,n,s,f,_,A){G(this,"_file");G(this,"_start");G(this,"_end");G(this,"_playbackRate");G(this,"_recorderMimeType");G(this,"_trackId");G(this,"_clippingAudioElement");G(this,"_clippingAudibly");G(this,"_clippingAudioReject");G(this,"_stopClippingTimeout");G(this,"_playingAudioElement");G(this,"_stopAudioTimeout");G(this,"_blob");G(this,"_blobPromise");G(this,"_callbacks");this._file=t,this._start=a,this._end=n,this._playbackRate=s,this._recorderMimeType=f,this._callbacks=_,this._trackId=A}latestBlobPromise(){return this._blobPromise}get isPlayingAudibly(){return!$u&&this._clippingAudioElement!==void 0&&this._clippingAudibly===!0||this._playingAudioElement!==void 0}get isRecordingSilently(){return this._clippingAudioElement!==void 0&&this._clippingAudibly===!1}get finishedRecording(){return this._blob!==void 0}async play(){if(this._playingAudioElement){this._stopPlayingAudio(),We("pause",this._callbacks);return}if(this._blob){const t=await this._audioElement(URL.createObjectURL(this._blob),!1);t.currentTime=0,await t.play(),We("play",this._callbacks),this._playingAudioElement=t}else{const t=await this._audioElement(this._file.blobUrl,!0);t.oncanplay=async a=>{t.play(),We("play",this._callbacks),t.oncanplay=null},this._playingAudioElement=t}this._stopAudioTimeout=setTimeout(()=>{this._playingAudioElement!==void 0&&(this._stopAudio(this._playingAudioElement,!0),We("pause",this._callbacks),this._playingAudioElement=void 0),this._stopAudioTimeout=void 0},(this._end-this._start)/this._playbackRate+100)}async clip(t){return this._stopClippingAudio(),this._clippingAudibly=t,this._blobPromise=new Promise(async(a,n)=>{try{const s=await this._audioElement(this._file.blobUrl,!0);s.oncanplay=async f=>{if(s.oncanplay=null,!t){const x=new AudioContext,v=x.createMediaStreamDestination();x.createMediaElementSource(s).connect(v)}await s.play(),t&&We("play",this._callbacks);const _=this._captureStream(s),A=new MediaRecorder(_,{mimeType:this._recorderMimeType}),T=[];A.ondataavailable=x=>{T.push(x.data)};let j=!1;A.onstop=x=>{j&&(this._blob=new Blob(T,{type:this._recorderMimeType}),a(this._blob))},A.start(),this._clippingAudioReject=n,this._clippingAudioElement=s,this._stopClippingTimeout=setTimeout(()=>{this._stopAudio(s,!1),this._clippingAudioElement=void 0,this._stopClippingTimeout=void 0,this._clippingAudioReject=void 0,j=!0,A.stop();for(const x of _.getAudioTracks())x.stop()},(this._end-this._start)/this._playbackRate+100)}}catch(s){n(s)}}),this._blobPromise}stop(){this._playingAudioElement&&(this._stopPlayingAudio(),We("pause",this._callbacks)),this._clippingAudioElement&&(this._stopClippingAudio(),We("pause",this._callbacks))}_stopClippingAudio(){var t;this._clippingAudioElement&&(this._stopAudio(this._clippingAudioElement,!1),clearTimeout(this._stopClippingTimeout),(t=this._clippingAudioReject)==null||t.call(this,new so),this._clippingAudioElement=void 0,this._stopClippingTimeout=void 0,this._clippingAudioReject=void 0,this._blobPromise=void 0)}_stopPlayingAudio(){this._playingAudioElement&&(this._stopAudio(this._playingAudioElement,!0),clearTimeout(this._stopAudioTimeout),this._playingAudioElement=void 0,this._stopAudioTimeout=void 0)}_audioElement(t,a){const n=new Audio;return n.preload="auto",n.src=t,new Promise((s,f)=>{const _=Date.now(),A=setInterval(()=>{if(n.seekable.length>0&&n.seekable.end(0)===n.duration||Date.now()-_>=5e3){if(a&&this._trackId&&n.audioTracks&&n.audioTracks.length>0)for(const T of n.audioTracks)T.enabled=this._trackId===T.id;n.onerror=()=>{var T;f(((T=n.error)==null?void 0:T.message)??"Could not load audio")},n.currentTime=this._start/1e3,n.playbackRate=this._playbackRate,clearInterval(A),s(n)}},100)})}_stopAudio(t,a){t.pause();const n=t.src;t.removeAttribute("src"),t.load(),a&&URL.revokeObjectURL(n)}_captureStream(t){let a;if(typeof t.captureStream=="function"&&(a=t.captureStream()),typeof t.mozCaptureStream=="function"&&(a=t.mozCaptureStream()),a===void 0)throw new Error("Unable to capture stream from audio");const n=new MediaStream;for(const s of a.getVideoTracks())s.stop();for(const s of a.getAudioTracks())s.enabled&&n.addTrack(s);return n}}class ba{constructor(t,a,n,s,f,_,A){G(this,"_file");G(this,"_name");G(this,"_start");G(this,"_end");G(this,"_playbackRate");G(this,"_recordAudibly");G(this,"_trackId");G(this,"_extension");G(this,"_recorderMimeType");G(this,"_callbacks");G(this,"_blobClipper");G(this,"_playClipper");const[T,j]=Ku();this._recorderMimeType=T,this._file=t,this._name=io(t.name,a),this._start=a,this._end=n,this._playbackRate=s,this._recordAudibly=f,this._trackId=_,this._callbacks=A??{play:[],pause:[]},this._extension=j,this._blobClipper=new uo(t,a,n,s,T,this._callbacks,_)}get name(){return this._name}get extension(){return this._extension}get start(){return this._start}get end(){return this._end}async base64(){return new Promise(async(t,a)=>{var n=new FileReader;const s=await this.blob();n.readAsDataURL(s),n.onloadend=()=>{const f=n.result,_=f.substring(f.indexOf(",")+1);t(_)}})}get playing(){var t;return((t=this._playClipper)==null?void 0:t.isPlayingAudibly)??!1}onEvent(t,a){return this._callbacks[t].push(a),()=>{oo(this._callbacks[t],a)}}async play(){var t;this._blobClipper.isPlayingAudibly?(this._blobClipper.stop(),We("pause",this._callbacks)):(t=this._playClipper)!=null&&t.isPlayingAudibly?(this._playClipper.stop(),We("pause",this._callbacks)):this._blobClipper.isRecordingSilently?(this._playClipper=this._playClipper??new uo(this._file,this._start,this._end,this._playbackRate,this._recorderMimeType,this._callbacks,this._trackId),this._playClipper.play(),We("play",this._callbacks)):this._blobClipper.finishedRecording?(this._blobClipper.play(),We("play",this._callbacks),this._playClipper=void 0):(this._blobClipper.clip(!0).then(()=>{We("pause",this._callbacks)}).catch(a=>{a instanceof so||console.error(a)}),We("play",this._callbacks))}stop(){var t;this._blobClipper.stop(),(t=this._playClipper)==null||t.stop(),We("pause",this._callbacks)}async blob(){return this._blobClipper.latestBlobPromise()??this._blobClipper.clip(this._recordAudibly)}slice(t,a){return new ba(this._file,t,a,this._playbackRate,this._recordAudibly,this._trackId)}isSliceable(){return!0}get error(){if(this._file.blobUrl)return fi(this._file.blobUrl)?void 0:Ut.fileLinkLost}}class Kr{constructor(t,a){G(this,"data");G(this,"workerFactory");G(this,"_blob");this.data=t,this.workerFactory=a}get name(){return this.data.name}get extension(){return"mp3"}get start(){return this.data.start}get end(){return this.data.end}async base64(){return ro(await this.blob())}async play(){await this.data.play()}get playing(){return this.data.playing}onEvent(t,a){return this.onEvent(t,a)}stop(){this.data.stop()}async blob(){return this._blob||(this._blob=await Uu.encode(await this.data.blob(),this.workerFactory)),this._blob}slice(t,a){return new Kr(this.data.slice(t,a),this.workerFactory)}isSliceable(){return this.data.isSliceable()}get error(){return this.data.error}}class wa{constructor(t,a,n){G(this,"_data");G(this,"_encoder");G(this,"_extension");G(this,"_blob");this._data=t,this._encoder=a,this._extension=n}get name(){return this._data.name}get extension(){return"mp3"}get start(){return this._data.start}get end(){return this._data.end}async base64(){return ro(await this.blob())}async play(){await this._data.play()}get playing(){return this._data.playing}onEvent(t,a){return this._data.onEvent(t,a)}stop(){this._data.stop()}async blob(){return this._blob===void 0&&(this._blob=await this._encoder(await this._data.blob(),this._data.extension)),this._blob}slice(t,a){return new wa(this._data.slice(t,a),this._encoder,this._extension)}isSliceable(){return this._data.isSliceable()}get error(){return this._data.error}}class Pt{constructor(t){G(this,"data");this.data=t}static fromCard(t,a,n,s){var f,_;if(t.audio){const A=t.audio.start??t.subtitle.start,T=t.audio.end??t.subtitle.end;return Pt.fromBase64(t.subtitleFileName,Math.max(0,A-(t.audio.paddingStart??0)),T+(t.audio.paddingEnd??0),t.audio.playbackRate??1,t.audio.base64,t.audio.extension,t.audio.error)}if(t.file)return Pt.fromFile(t.file,Math.max(0,t.subtitle.start-a),t.subtitle.end+n,((f=t.file)==null?void 0:f.playbackRate)??1,s,(_=t.file)==null?void 0:_.audioTrack)}static fromBase64(t,a,n,s,f,_,A){return new Pt(new Lu(t.substring(0,t.lastIndexOf(".")),a,n,s,f,_,A))}static fromFile(t,a,n,s,f,_){return new Pt(new ba(t,a,n,s,f,_))}get start(){return this.data.start}get end(){return this.data.end}get name(){return this.data.name+"."+this.data.extension}get extension(){return this.data.extension}async play(){await this.data.play()}get playing(){return this.data.playing}onEvent(t,a){return this.data.onEvent(t,a)}stop(){this.data.stop()}async base64(){return await this.data.base64()}async blob(){return await this.data.blob()}async download(){const t=await this.data.blob();ci(t,this.name)}toMp3(t){return this.data instanceof Kr?this:this.data.extension==="mp3"?this:new Pt(new Kr(this.data,t))}toEncoded(t,a){return new Pt(new wa(this.data,t,a))}slice(t,a){return new Pt(this.data.slice(t,a))}isSliceable(){return this.data.isSliceable()}get error(){return this.data.error}get errorLocKey(){if(this.data.error!==void 0)switch(this.data.error){case Ut.drmProtected:return"audioCaptureFailed.message";case Ut.fileLinkLost:return"ankiDialog.audioFileLinkLost"}}}const Vu=['"',"*","_","\\",":"],lo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",zu=()=>{let o="";for(let t=0;t<8;++t)o+=lo.charAt(Math.floor(Math.random()*lo.length));return o},Wu=o=>{const t=/(.*)\.(.*)/.exec(o);if(t===null||t.length<3)return o;const a=t[1],n=t[2];return`${a}_${zu()}.${n}`},co="<([^/ >])*[^>]*>(.*?)</\\1>",Hu=o=>{const t=new RegExp(co);let a=o,n=[o];for(;;){const s=t.exec(a);if(s===null||s.length<3)break;a=s[2],n.push(a)}return n},Gu=(o,t)=>{const a=new RegExp(co,"ig"),n=t.replaceAll("<br>","");let s=o;for(;;){const f=a.exec(n);if(f===null||f.length<3)break;let _=s;if(!s.includes(f[0])){const A=Hu(f[2]);for(const T of A)if(_=s.replace(T,f[0]),_!==s)break}s=_}return s};async function fo(o,t,a){const n=new Zu(t),s=fs(o.subtitleFileName,o.mediaTimestamp);let f=o.audio===void 0?void 0:Pt.fromBase64(s,o.subtitle.start,o.subtitle.end,o.audio.playbackRate??1,o.audio.base64,o.audio.extension,o.audio.error);return await n.export({text:o.text??Rr(o.subtitle,o.surroundingSubtitles),track1:Rr(o.subtitle,o.surroundingSubtitles,0),track2:Rr(o.subtitle,o.surroundingSubtitles,1),track3:Rr(o.subtitle,o.surroundingSubtitles,2),definition:o.definition,audioClip:f,image:o.image===void 0?void 0:$t.fromBase64(s,o.subtitle.start,o.image.base64,o.image.extension,o.image.error),word:o.word,source:s,url:o.url,customFieldValues:o.customFieldValues??{},tags:t.tags,mode:a})}class Zu{constructor(t,a=new ms){G(this,"settingsProvider");G(this,"fetcher");this.settingsProvider=t,this.fetcher=a}async deckNames(t){return(await this._executeAction("deckNames",null,t)).result}async modelNames(t){return(await this._executeAction("modelNames",null,t)).result}async modelFieldNames(t,a){return(await this._executeAction("modelFieldNames",{modelName:t},a)).result}async findNotesWithWord(t,a){return(await this._executeAction("findNotes",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},a)).result}async findNotesWithWordGui(t,a){return(await this._executeAction("guiBrowse",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},a)).result}async createDeck(t,a){return(await this._executeAction("createDeck",{deck:t},a)).result}async createModel(t,a){return(await this._executeAction("createModel",t,a)).result}_escapeQuery(t){let a="";for(let n=0;n<t.length;++n){const s=t[n];Vu.includes(s)?a+=`\\${s}`:a+=s}return`"${a}"`}async requestPermission(t){return(await this._executeAction("requestPermission",null,t)).result}async version(t){return(await this._executeAction("version",null,t)).result}async export({text:t,track1:a,track2:n,track3:s,definition:f,audioClip:_,image:A,word:T,source:j,url:x,customFieldValues:v,tags:d,mode:m,ankiConnectUrl:g}){const l={};if(this._appendField(l,this.settingsProvider.sentenceField,t,!0),this._appendField(l,this.settingsProvider.track1Field,a,!0),this._appendField(l,this.settingsProvider.track2Field,n,!0),this._appendField(l,this.settingsProvider.track3Field,s,!0),this._appendField(l,this.settingsProvider.definitionField,f,!0),this._appendField(l,this.settingsProvider.wordField,T,!1),this._appendField(l,this.settingsProvider.sourceField,j,!1),this._appendField(l,this.settingsProvider.urlField,x,!1),v)for(const F of Object.keys(v))this._appendField(l,this.settingsProvider.customAnkiFields[F],v[F],!0);const p={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,tags:d,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},h=m==="gui",b=m==="updateLast";if(this.settingsProvider.audioField&&_&&_.error===void 0){const F=this._sanitizeFileName(_.name),U=await _.base64();if(U)if(h||b){const S=(await this._storeMediaFile(F,U,g)).result;this._appendField(l,this.settingsProvider.audioField,`[sound:${S}]`,!1)}else p.note.audio={filename:F,data:U,fields:[this.settingsProvider.audioField]}}if(this.settingsProvider.imageField&&A&&A.error===void 0){const F=this._sanitizeFileName(A.name),U=await A.base64();if(U)if(h||b){const S=(await this._storeMediaFile(F,U,g)).result;this._appendField(l,this.settingsProvider.imageField,`<img src="${S}">`,!1)}else p.note.picture={filename:F,data:U,fields:[this.settingsProvider.imageField]}}switch(p.note.fields=l,m){case"gui":return(await this._executeAction("guiAddCards",p,g)).result;case"updateLast":const F=(await this._executeAction("findNotes",{query:"added:1"},g)).result.sort();if(F.length===0)throw new Error("Could not find note to update");const U=F[F.length-1];p.note.id=U;const S=await this._executeAction("notesInfo",{notes:[U]});if(S.result.length>0&&S.result[0].noteId===U){const K=S.result[0];if(this._inheritHtmlMarkupFromField("sentenceField",K,p),this._inheritHtmlMarkupFromField("track1Field",K,p),this._inheritHtmlMarkupFromField("track2Field",K,p),this._inheritHtmlMarkupFromField("track3Field",K,p),await this._executeAction("updateNoteFields",p,g),d.length>0&&await this._executeAction("addTags",{notes:[U],tags:d.join(" ")},g),!this.settingsProvider.wordField||!K.fields)return K.noteId;const k=K.fields[this.settingsProvider.wordField];return!k||!k.value?K.noteId:k.value}throw new Error("Could not update last card because the card info could not be fetched");case"default":return(await this._executeAction("addNote",p,g)).result;default:throw new Error("Unknown export mode: "+m)}}_appendField(t,a,n,s){if(!a||!n)return;let f=s?n.split(`
`).join("<br>"):n;const _=t[a];_&&(f=_+"<br>"+f),t[a]=f}_sanitizeFileName(t){return typeof t.toWellFormed=="function"&&(t=t.toWellFormed()),ui(t,{replacement:"_"})}async _storeMediaFile(t,a,n){return this._executeAction("storeMediaFile",{filename:Wu(t),data:a,deleteExisting:!1},n)}_inheritHtmlMarkupFromField(t,a,n){var f;const s=this.settingsProvider[t];s&&a.fields&&typeof((f=a.fields[s])==null?void 0:f.value)=="string"&&typeof n.note.fields[s]=="string"&&(n.note.fields[s]=Gu(n.note.fields[s],a.fields[s].value))}async _executeAction(t,a,n){const s={action:t,version:6};a&&(s.params=a);const f=await this.fetcher.fetch(n||this.settingsProvider.ankiConnectUrl,s);if(f.error)throw new Error(f.error);return f}}var Lr={exports:{}},Ju=Lr.exports,po;function Qu(){return po||(po=1,function(o,t){(function(a,n){o.exports=n()})(Ju,function(){var a=function(e,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,u){i.__proto__=u}||function(i,u){for(var c in u)Object.prototype.hasOwnProperty.call(u,c)&&(i[c]=u[c])})(e,r)},n=function(){return(n=Object.assign||function(e){for(var r,i=1,u=arguments.length;i<u;i++)for(var c in r=arguments[i])Object.prototype.hasOwnProperty.call(r,c)&&(e[c]=r[c]);return e}).apply(this,arguments)};function s(e,r,i){for(var u,c=0,y=r.length;c<y;c++)!u&&c in r||((u=u||Array.prototype.slice.call(r,0,c))[c]=r[c]);return e.concat(u||Array.prototype.slice.call(r))}var f=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:kr,_=Object.keys,A=Array.isArray;function T(e,r){return typeof r!="object"||_(r).forEach(function(i){e[i]=r[i]}),e}typeof Promise>"u"||f.Promise||(f.Promise=Promise);var j=Object.getPrototypeOf,x={}.hasOwnProperty;function v(e,r){return x.call(e,r)}function d(e,r){typeof r=="function"&&(r=r(j(e))),(typeof Reflect>"u"?_:Reflect.ownKeys)(r).forEach(function(i){g(e,i,r[i])})}var m=Object.defineProperty;function g(e,r,i,u){m(e,r,T(i&&v(i,"get")&&typeof i.get=="function"?{get:i.get,set:i.set,configurable:!0}:{value:i,configurable:!0,writable:!0},u))}function l(e){return{from:function(r){return e.prototype=Object.create(r.prototype),g(e.prototype,"constructor",e),{extend:d.bind(null,e.prototype)}}}}var p=Object.getOwnPropertyDescriptor,h=[].slice;function b(e,r,i){return h.call(e,r,i)}function F(e,r){return r(e)}function U(e){if(!e)throw new Error("Assertion Failed")}function S(e){f.setImmediate?setImmediate(e):setTimeout(e,0)}function K(e,r){if(typeof r=="string"&&v(e,r))return e[r];if(!r)return e;if(typeof r!="string"){for(var i=[],u=0,c=r.length;u<c;++u){var y=K(e,r[u]);i.push(y)}return i}var w=r.indexOf(".");if(w!==-1){var P=e[r.substr(0,w)];return P==null?void 0:K(P,r.substr(w+1))}}function k(e,r,i){if(e&&r!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof r!="string"&&"length"in r){U(typeof i!="string"&&"length"in i);for(var u=0,c=r.length;u<c;++u)k(e,r[u],i[u])}else{var y,w,P=r.indexOf(".");P!==-1?(y=r.substr(0,P),(w=r.substr(P+1))===""?i===void 0?A(e)&&!isNaN(parseInt(y))?e.splice(y,1):delete e[y]:e[y]=i:k(P=!(P=e[y])||!v(e,y)?e[y]={}:P,w,i)):i===void 0?A(e)&&!isNaN(parseInt(r))?e.splice(r,1):delete e[r]:e[r]=i}}function pe(e){var r,i={};for(r in e)v(e,r)&&(i[r]=e[r]);return i}var ve=[].concat;function ye(e){return ve.apply([],e)}var it="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ye([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(r){return r+e+"Array"})}))).filter(function(e){return f[e]}),Ae=new Set(it.map(function(e){return f[e]})),Z=null;function _e(e){return Z=new WeakMap,e=function r(i){if(!i||typeof i!="object")return i;var u=Z.get(i);if(u)return u;if(A(i)){u=[],Z.set(i,u);for(var c=0,y=i.length;c<y;++c)u.push(r(i[c]))}else if(Ae.has(i.constructor))u=i;else{var w,P=j(i);for(w in u=P===Object.prototype?{}:Object.create(P),Z.set(i,u),i)v(i,w)&&(u[w]=r(i[w]))}return u}(e),Z=null,e}var Se={}.toString;function ge(e){return Se.call(e).slice(8,-1)}var Re=typeof Symbol<"u"?Symbol.iterator:"@@iterator",fe=typeof Re=="symbol"?function(e){var r;return e!=null&&(r=e[Re])&&r.apply(e)}:function(){return null};function H(e,r){return r=e.indexOf(r),0<=r&&e.splice(r,1),0<=r}var re={};function L(e){var r,i,u,c;if(arguments.length===1){if(A(e))return e.slice();if(this===re&&typeof e=="string")return[e];if(c=fe(e)){for(i=[];!(u=c.next()).done;)i.push(u.value);return i}if(e==null)return[e];if(typeof(r=e.length)!="number")return[e];for(i=new Array(r);r--;)i[r]=e[r];return i}for(r=arguments.length,i=new Array(r);r--;)i[r]=arguments[r];return i}var Q=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},zt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],pt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(zt),se={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ee(e,r){this.name=e,this.message=r}function X(e,r){return e+". Errors: "+Object.keys(r).map(function(i){return r[i].toString()}).filter(function(i,u,c){return c.indexOf(i)===u}).join(`
`)}function be(e,r,i,u){this.failures=r,this.failedKeys=u,this.successCount=i,this.message=X(e,r)}function we(e,r){this.name="BulkError",this.failures=Object.keys(r).map(function(i){return r[i]}),this.failuresByPos=r,this.message=X(e,this.failures)}l(ee).from(Error).extend({toString:function(){return this.name+": "+this.message}}),l(be).from(ee),l(we).from(ee);var Pe=pt.reduce(function(e,r){return e[r]=r+"Error",e},{}),Oe=ee,Y=pt.reduce(function(e,r){var i=r+"Error";function u(c,y){this.name=i,c?typeof c=="string"?(this.message="".concat(c).concat(y?`
 `+y:""),this.inner=y||null):typeof c=="object"&&(this.message="".concat(c.name," ").concat(c.message),this.inner=c):(this.message=se[r]||i,this.inner=null)}return l(u).from(Oe),e[r]=u,e},{});Y.Syntax=SyntaxError,Y.Type=TypeError,Y.Range=RangeError;var Ee=zt.reduce(function(e,r){return e[r+"Error"]=Y[r],e},{}),xe=pt.reduce(function(e,r){return["Syntax","Type","Range"].indexOf(r)===-1&&(e[r+"Error"]=Y[r]),e},{});function me(){}function Ke(e){return e}function Ne(e,r){return e==null||e===Ke?r:function(i){return r(e(i))}}function De(e,r){return function(){e.apply(this,arguments),r.apply(this,arguments)}}function ht(e,r){return e===me?r:function(){var i=e.apply(this,arguments);i!==void 0&&(arguments[0]=i);var u=this.onsuccess,c=this.onerror;this.onsuccess=null,this.onerror=null;var y=r.apply(this,arguments);return u&&(this.onsuccess=this.onsuccess?De(u,this.onsuccess):u),c&&(this.onerror=this.onerror?De(c,this.onerror):c),y!==void 0?y:i}}function xt(e,r){return e===me?r:function(){e.apply(this,arguments);var i=this.onsuccess,u=this.onerror;this.onsuccess=this.onerror=null,r.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?De(i,this.onsuccess):i),u&&(this.onerror=this.onerror?De(u,this.onerror):u)}}function pr(e,r){return e===me?r:function(i){var u=e.apply(this,arguments);T(i,u);var c=this.onsuccess,y=this.onerror;return this.onsuccess=null,this.onerror=null,i=r.apply(this,arguments),c&&(this.onsuccess=this.onsuccess?De(c,this.onsuccess):c),y&&(this.onerror=this.onerror?De(y,this.onerror):y),u===void 0?i===void 0?void 0:i:T(u,i)}}function Pa(e,r){return e===me?r:function(){return r.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function yr(e,r){return e===me?r:function(){var i=e.apply(this,arguments);if(i&&typeof i.then=="function"){for(var u=this,c=arguments.length,y=new Array(c);c--;)y[c]=arguments[c];return i.then(function(){return r.apply(u,y)})}return r.apply(this,arguments)}}xe.ModifyError=be,xe.DexieError=ee,xe.BulkError=we;var lt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Wr(e){lt=e}var Vt={},hr=100,it=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,j(e),e];var r=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[r,j(r),e]}(),zt=it[0],pt=it[1],it=it[2],pt=pt&&pt.then,mt=zt&&zt.constructor,ir=!!it,Wt=function(e,r){$e.push([e,r]),Ct&&(queueMicrotask(Gr),Ct=!1)},mr=!0,Ct=!0,ct=[],$=[],V=Ke,Ce={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:me,pgp:!1,env:{},finalize:me},ie=Ce,$e=[],Fe=0,ot=[];function le(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var r=this._PSD=ie;if(typeof e!="function"){if(e!==Vt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ht(this,this._value))}this._state=null,this._value=null,++r.ref,function i(u,c){try{c(function(y){if(u._state===null){if(y===u)throw new TypeError("A promise cannot be resolved with itself.");var w=u._lib&&Ft();y&&typeof y.then=="function"?i(u,function(P,R){y instanceof le?y._then(P,R):y.then(P,R)}):(u._state=!0,u._value=y,Et(u)),w&&ft()}},Ht.bind(null,u))}catch(y){Ht(u,y)}}(this,e)}var Ze={get:function(){var e=ie,r=Jt;function i(u,c){var y=this,w=!e.global&&(e!==ie||r!==Jt),P=w&&!dt(),R=new le(function(I,M){rt(y,new gt(Po(u,e,w,P),Po(c,e,w,P),I,M,e))});return this._consoleTask&&(R._consoleTask=this._consoleTask),R}return i.prototype=Vt,i},set:function(e){g(this,"then",e&&e.prototype===Vt?Ze:{get:function(){return e},set:Ze.set})}};function gt(e,r,i,u,c){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof r=="function"?r:null,this.resolve=i,this.reject=u,this.psd=c}function Ht(e,r){var i,u;$.push(r),e._state===null&&(i=e._lib&&Ft(),r=V(r),e._state=!1,e._value=r,u=e,ct.some(function(c){return c._value===u._value})||ct.push(u),Et(e),i&&ft())}function Et(e){var r=e._listeners;e._listeners=[];for(var i=0,u=r.length;i<u;++i)rt(e,r[i]);var c=e._PSD;--c.ref||c.finalize(),Fe===0&&(++Fe,Wt(function(){--Fe==0&&Gt()},[]))}function rt(e,r){if(e._state!==null){var i=e._state?r.onFulfilled:r.onRejected;if(i===null)return(e._state?r.resolve:r.reject)(e._value);++r.psd.ref,++Fe,Wt(Hr,[i,e,r])}else e._listeners.push(r)}function Hr(e,r,i){try{var u,c=r._value;!r._state&&$.length&&($=[]),u=lt&&r._consoleTask?r._consoleTask.run(function(){return e(c)}):e(c),r._state||$.indexOf(c)!==-1||function(y){for(var w=ct.length;w;)if(ct[--w]._value===y._value)return ct.splice(w,1)}(r),i.resolve(u)}catch(y){i.reject(y)}finally{--Fe==0&&Gt(),--i.psd.ref||i.psd.finalize()}}function Gr(){Qt(Ce,function(){Ft()&&ft()})}function Ft(){var e=mr;return Ct=mr=!1,e}function ft(){var e,r,i;do for(;0<$e.length;)for(e=$e,$e=[],i=e.length,r=0;r<i;++r){var u=e[r];u[0].apply(null,u[1])}while(0<$e.length);Ct=mr=!0}function Gt(){var e=ct;ct=[],e.forEach(function(u){u._PSD.onunhandled.call(null,u._value,u)});for(var r=ot.slice(0),i=r.length;i;)r[--i]()}function kt(e){return new le(Vt,!1,e)}function Ue(e,r){var i=ie;return function(){var u=Ft(),c=ie;try{return _t(i,!0),e.apply(this,arguments)}catch(y){r&&r(y)}finally{_t(c,!1),u&&ft()}}}d(le.prototype,{then:Ze,_then:function(e,r){rt(this,new gt(null,null,e,r,ie))},catch:function(e){if(arguments.length===1)return this.then(null,e);var r=e,i=arguments[1];return typeof r=="function"?this.then(null,function(u){return(u instanceof r?i:kt)(u)}):this.then(null,function(u){return(u&&u.name===r?i:kt)(u)})},finally:function(e){return this.then(function(r){return le.resolve(e()).then(function(){return r})},function(r){return le.resolve(e()).then(function(){return kt(r)})})},timeout:function(e,r){var i=this;return e<1/0?new le(function(u,c){var y=setTimeout(function(){return c(new Y.Timeout(r))},e);i.then(u,c).finally(clearTimeout.bind(null,y))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&g(le.prototype,Symbol.toStringTag,"Dexie.Promise"),Ce.env=vr(),d(le,{all:function(){var e=L.apply(null,arguments).map(bt);return new le(function(r,i){e.length===0&&r([]);var u=e.length;e.forEach(function(c,y){return le.resolve(c).then(function(w){e[y]=w,--u||r(e)},i)})})},resolve:function(e){return e instanceof le?e:e&&typeof e.then=="function"?new le(function(r,i){e.then(r,i)}):new le(Vt,!0,e)},reject:kt,race:function(){var e=L.apply(null,arguments).map(bt);return new le(function(r,i){e.map(function(u){return le.resolve(u).then(r,i)})})},PSD:{get:function(){return ie},set:function(e){return ie=e}},totalEchoes:{get:function(){return Jt}},newPSD:vt,usePSD:Qt,scheduler:{get:function(){return Wt},set:function(e){Wt=e}},rejectionMapper:{get:function(){return V},set:function(e){V=e}},follow:function(e,r){return new le(function(i,u){return vt(function(c,y){var w=ie;w.unhandleds=[],w.onunhandled=y,w.finalize=De(function(){var P,R=this;P=function(){R.unhandleds.length===0?c():y(R.unhandleds[0])},ot.push(function I(){P(),ot.splice(ot.indexOf(I),1)}),++Fe,Wt(function(){--Fe==0&&Gt()},[])},w.finalize),e()},r,i,u)})}}),mt&&(mt.allSettled&&g(le,"allSettled",function(){var e=L.apply(null,arguments).map(bt);return new le(function(r){e.length===0&&r([]);var i=e.length,u=new Array(i);e.forEach(function(c,y){return le.resolve(c).then(function(w){return u[y]={status:"fulfilled",value:w}},function(w){return u[y]={status:"rejected",reason:w}}).then(function(){return--i||r(u)})})})}),mt.any&&typeof AggregateError<"u"&&g(le,"any",function(){var e=L.apply(null,arguments).map(bt);return new le(function(r,i){e.length===0&&i(new AggregateError([]));var u=e.length,c=new Array(u);e.forEach(function(y,w){return le.resolve(y).then(function(P){return r(P)},function(P){c[w]=P,--u||i(new AggregateError(c))})})})}),mt.withResolvers&&(le.withResolvers=mt.withResolvers));var Le={awaits:0,echoes:0,id:0},Zr=0,Zt=[],Tt=0,Jt=0,gr=0;function vt(e,r,i,u){var c=ie,y=Object.create(c);return y.parent=c,y.ref=0,y.global=!1,y.id=++gr,Ce.env,y.env=ir?{Promise:le,PromiseProp:{value:le,configurable:!0,writable:!0},all:le.all,race:le.race,allSettled:le.allSettled,any:le.any,resolve:le.resolve,reject:le.reject}:{},r&&T(y,r),++c.ref,y.finalize=function(){--this.parent.ref||this.parent.finalize()},u=Qt(y,e,i,u),y.ref===0&&y.finalize(),u}function Bt(){return Le.id||(Le.id=++Zr),++Le.awaits,Le.echoes+=hr,Le.id}function dt(){return!!Le.awaits&&(--Le.awaits==0&&(Le.id=0),Le.echoes=Le.awaits*hr,!0)}function bt(e){return Le.echoes&&e&&e.constructor===mt?(Bt(),e.then(function(r){return dt(),r},function(r){return dt(),Ve(r)})):e}function or(){var e=Zt[Zt.length-1];Zt.pop(),_t(e,!1)}function _t(e,r){var i,u=ie;(r?!Le.echoes||Tt++&&e===ie:!Tt||--Tt&&e===ie)||queueMicrotask(r?(function(c){++Jt,Le.echoes&&--Le.echoes!=0||(Le.echoes=Le.awaits=Le.id=0),Zt.push(ie),_t(c,!0)}).bind(null,e):or),e!==ie&&(ie=e,u===Ce&&(Ce.env=vr()),ir&&(i=Ce.env.Promise,r=e.env,(u.global||e.global)&&(Object.defineProperty(f,"Promise",r.PromiseProp),i.all=r.all,i.race=r.race,i.resolve=r.resolve,i.reject=r.reject,r.allSettled&&(i.allSettled=r.allSettled),r.any&&(i.any=r.any))))}function vr(){var e=f.Promise;return ir?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(f,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function Qt(e,r,i,u,c){var y=ie;try{return _t(e,!0),r(i,u,c)}finally{_t(y,!1)}}function Po(e,r,i,u){return typeof e!="function"?e:function(){var c=ie;i&&Bt(),_t(r,!0);try{return e.apply(this,arguments)}finally{_t(c,!1),u&&queueMicrotask(dt)}}}function xa(e){Promise===mt&&Le.echoes===0?Tt===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+pt).indexOf("[native code]")===-1&&(Bt=dt=me);var Ve=le.reject,Yt="￿",Rt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",xo="String expected.",sr=[],Jr="__dbnames",Ea="readonly",Fa="readwrite";function Xt(e,r){return e?r?function(){return e.apply(this,arguments)&&r.apply(this,arguments)}:e:r}var Eo={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Qr(e){return typeof e!="string"||/\./.test(e)?function(r){return r}:function(r){return r[e]===void 0&&e in r&&delete(r=_e(r))[e],r}}function Fo(){throw Y.Type()}function Me(e,r){try{var i=ko(e),u=ko(r);if(i!==u)return i==="Array"?1:u==="Array"?-1:i==="binary"?1:u==="binary"?-1:i==="string"?1:u==="string"?-1:i==="Date"?1:u!=="Date"?NaN:-1;switch(i){case"number":case"Date":case"string":return r<e?1:e<r?-1:0;case"binary":return function(c,y){for(var w=c.length,P=y.length,R=w<P?w:P,I=0;I<R;++I)if(c[I]!==y[I])return c[I]<y[I]?-1:1;return w===P?0:w<P?-1:1}(Ro(e),Ro(r));case"Array":return function(c,y){for(var w=c.length,P=y.length,R=w<P?w:P,I=0;I<R;++I){var M=Me(c[I],y[I]);if(M!==0)return M}return w===P?0:w<P?-1:1}(e,r)}}catch{}return NaN}function ko(e){var r=typeof e;return r!="object"?r:ArrayBuffer.isView(e)?"binary":(e=ge(e),e==="ArrayBuffer"?"binary":e)}function Ro(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Oo=(qe.prototype._trans=function(e,r,i){var u=this._tx||ie.trans,c=this.name,y=lt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function w(I,M,E){if(!E.schema[c])throw new Y.NotFound("Table "+c+" not part of transaction");return r(E.idbtrans,E)}var P=Ft();try{var R=u&&u.db._novip===this.db._novip?u===ie.trans?u._promise(e,w,i):vt(function(){return u._promise(e,w,i)},{trans:u,transless:ie.transless||ie}):function I(M,E,N,O){if(M.idbdb&&(M._state.openComplete||ie.letThrough||M._vip)){var B=M._createTransaction(E,N,M._dbSchema);try{B.create(),M._state.PR1398_maxLoop=3}catch(D){return D.name===Pe.InvalidState&&M.isOpen()&&0<--M._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),M.close({disableAutoOpen:!1}),M.open().then(function(){return I(M,E,N,O)})):Ve(D)}return B._promise(E,function(D,C){return vt(function(){return ie.trans=B,O(D,C,B)})}).then(function(D){if(E==="readwrite")try{B.idbtrans.commit()}catch{}return E==="readonly"?D:B._completion.then(function(){return D})})}if(M._state.openComplete)return Ve(new Y.DatabaseClosed(M._state.dbOpenError));if(!M._state.isBeingOpened){if(!M._state.autoOpen)return Ve(new Y.DatabaseClosed);M.open().catch(me)}return M._state.dbReadyPromise.then(function(){return I(M,E,N,O)})}(this.db,e,[this.name],w);return y&&(R._consoleTask=y,R=R.catch(function(I){return console.trace(I),Ve(I)})),R}finally{P&&ft()}},qe.prototype.get=function(e,r){var i=this;return e&&e.constructor===Object?this.where(e).first(r):e==null?Ve(new Y.Type("Invalid argument to Table.get()")):this._trans("readonly",function(u){return i.core.get({trans:u,key:e}).then(function(c){return i.hook.reading.fire(c)})}).then(r)},qe.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(A(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var r=_(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);var i=this.schema.indexes.concat(this.schema.primKey).filter(function(P){if(P.compound&&r.every(function(I){return 0<=P.keyPath.indexOf(I)})){for(var R=0;R<r.length;++R)if(r.indexOf(P.keyPath[R])===-1)return!1;return!0}return!1}).sort(function(P,R){return P.keyPath.length-R.keyPath.length})[0];if(i&&this.db._maxKey!==Yt){var y=i.keyPath.slice(0,r.length);return this.where(y).equals(y.map(function(R){return e[R]}))}!i&&lt&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(r.join("+"),"]"));var u=this.schema.idxByName;function c(P,R){return Me(P,R)===0}var w=r.reduce(function(E,R){var I=E[0],M=E[1],E=u[R],N=e[R];return[I||E,I||!E?Xt(M,E&&E.multi?function(O){return O=K(O,R),A(O)&&O.some(function(B){return c(N,B)})}:function(O){return c(N,K(O,R))}):M]},[null,null]),y=w[0],w=w[1];return y?this.where(y.name).equals(e[y.keyPath]).filter(w):i?this.filter(w):this.where(r).equals("")},qe.prototype.filter=function(e){return this.toCollection().and(e)},qe.prototype.count=function(e){return this.toCollection().count(e)},qe.prototype.offset=function(e){return this.toCollection().offset(e)},qe.prototype.limit=function(e){return this.toCollection().limit(e)},qe.prototype.each=function(e){return this.toCollection().each(e)},qe.prototype.toArray=function(e){return this.toCollection().toArray(e)},qe.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},qe.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,A(e)?"[".concat(e.join("+"),"]"):e))},qe.prototype.reverse=function(){return this.toCollection().reverse()},qe.prototype.mapToClass=function(e){var r,i=this.db,u=this.name;function c(){return r!==null&&r.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof Fo&&(function(R,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function M(){this.constructor=R}a(R,I),R.prototype=I===null?Object.create(I):(M.prototype=I.prototype,new M)}(c,r=e),Object.defineProperty(c.prototype,"db",{get:function(){return i},enumerable:!1,configurable:!0}),c.prototype.table=function(){return u},e=c);for(var y=new Set,w=e.prototype;w;w=j(w))Object.getOwnPropertyNames(w).forEach(function(R){return y.add(R)});function P(R){if(!R)return R;var I,M=Object.create(e.prototype);for(I in R)if(!y.has(I))try{M[I]=R[I]}catch{}return M}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=P,this.hook("reading",P),e},qe.prototype.defineClass=function(){return this.mapToClass(function(e){T(this,e)})},qe.prototype.add=function(e,r){var i=this,u=this.schema.primKey,c=u.auto,y=u.keyPath,w=e;return y&&c&&(w=Qr(y)(e)),this._trans("readwrite",function(P){return i.core.mutate({trans:P,type:"add",keys:r!=null?[r]:null,values:[w]})}).then(function(P){return P.numFailures?le.reject(P.failures[0]):P.lastResult}).then(function(P){if(y)try{k(e,y,P)}catch{}return P})},qe.prototype.update=function(e,r){return typeof e!="object"||A(e)?this.where(":id").equals(e).modify(r):(e=K(e,this.schema.primKey.keyPath),e===void 0?Ve(new Y.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(r))},qe.prototype.put=function(e,r){var i=this,u=this.schema.primKey,c=u.auto,y=u.keyPath,w=e;return y&&c&&(w=Qr(y)(e)),this._trans("readwrite",function(P){return i.core.mutate({trans:P,type:"put",values:[w],keys:r!=null?[r]:null})}).then(function(P){return P.numFailures?le.reject(P.failures[0]):P.lastResult}).then(function(P){if(y)try{k(e,y,P)}catch{}return P})},qe.prototype.delete=function(e){var r=this;return this._trans("readwrite",function(i){return r.core.mutate({trans:i,type:"delete",keys:[e]})}).then(function(i){return i.numFailures?le.reject(i.failures[0]):void 0})},qe.prototype.clear=function(){var e=this;return this._trans("readwrite",function(r){return e.core.mutate({trans:r,type:"deleteRange",range:Eo})}).then(function(r){return r.numFailures?le.reject(r.failures[0]):void 0})},qe.prototype.bulkGet=function(e){var r=this;return this._trans("readonly",function(i){return r.core.getMany({keys:e,trans:i}).then(function(u){return u.map(function(c){return r.hook.reading.fire(c)})})})},qe.prototype.bulkAdd=function(e,r,i){var u=this,c=Array.isArray(r)?r:void 0,y=(i=i||(c?void 0:r))?i.allKeys:void 0;return this._trans("readwrite",function(w){var I=u.schema.primKey,P=I.auto,I=I.keyPath;if(I&&c)throw new Y.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(c&&c.length!==e.length)throw new Y.InvalidArgument("Arguments objects and keys must have the same length");var R=e.length,I=I&&P?e.map(Qr(I)):e;return u.core.mutate({trans:w,type:"add",keys:c,values:I,wantResults:y}).then(function(B){var E=B.numFailures,N=B.results,O=B.lastResult,B=B.failures;if(E===0)return y?N:O;throw new we("".concat(u.name,".bulkAdd(): ").concat(E," of ").concat(R," operations failed"),B)})})},qe.prototype.bulkPut=function(e,r,i){var u=this,c=Array.isArray(r)?r:void 0,y=(i=i||(c?void 0:r))?i.allKeys:void 0;return this._trans("readwrite",function(w){var I=u.schema.primKey,P=I.auto,I=I.keyPath;if(I&&c)throw new Y.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(c&&c.length!==e.length)throw new Y.InvalidArgument("Arguments objects and keys must have the same length");var R=e.length,I=I&&P?e.map(Qr(I)):e;return u.core.mutate({trans:w,type:"put",keys:c,values:I,wantResults:y}).then(function(B){var E=B.numFailures,N=B.results,O=B.lastResult,B=B.failures;if(E===0)return y?N:O;throw new we("".concat(u.name,".bulkPut(): ").concat(E," of ").concat(R," operations failed"),B)})})},qe.prototype.bulkUpdate=function(e){var r=this,i=this.core,u=e.map(function(w){return w.key}),c=e.map(function(w){return w.changes}),y=[];return this._trans("readwrite",function(w){return i.getMany({trans:w,keys:u,cache:"clone"}).then(function(P){var R=[],I=[];e.forEach(function(E,N){var O=E.key,B=E.changes,D=P[N];if(D){for(var C=0,q=Object.keys(B);C<q.length;C++){var z=q[C],W=B[z];if(z===r.schema.primKey.keyPath){if(Me(W,O)!==0)throw new Y.Constraint("Cannot update primary key in bulkUpdate()")}else k(D,z,W)}y.push(N),R.push(O),I.push(D)}});var M=R.length;return i.mutate({trans:w,type:"put",keys:R,values:I,updates:{keys:u,changeSpecs:c}}).then(function(E){var N=E.numFailures,O=E.failures;if(N===0)return M;for(var B=0,D=Object.keys(O);B<D.length;B++){var C,q=D[B],z=y[Number(q)];z!=null&&(C=O[q],delete O[q],O[z]=C)}throw new we("".concat(r.name,".bulkUpdate(): ").concat(N," of ").concat(M," operations failed"),O)})})})},qe.prototype.bulkDelete=function(e){var r=this,i=e.length;return this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"delete",keys:e})}).then(function(w){var c=w.numFailures,y=w.lastResult,w=w.failures;if(c===0)return y;throw new we("".concat(r.name,".bulkDelete(): ").concat(c," of ").concat(i," operations failed"),w)})},qe);function qe(){}function br(e){function r(w,P){if(P){for(var R=arguments.length,I=new Array(R-1);--R;)I[R-1]=arguments[R];return i[w].subscribe.apply(null,I),e}if(typeof w=="string")return i[w]}var i={};r.addEventType=y;for(var u=1,c=arguments.length;u<c;++u)y(arguments[u]);return r;function y(w,P,R){if(typeof w!="object"){var I;P=P||Pa;var M={subscribers:[],fire:R=R||me,subscribe:function(E){M.subscribers.indexOf(E)===-1&&(M.subscribers.push(E),M.fire=P(M.fire,E))},unsubscribe:function(E){M.subscribers=M.subscribers.filter(function(N){return N!==E}),M.fire=M.subscribers.reduce(P,R)}};return i[w]=r[w]=M}_(I=w).forEach(function(E){var N=I[E];if(A(N))y(E,I[E][0],I[E][1]);else{if(N!=="asap")throw new Y.InvalidArgument("Invalid event config");var O=y(E,Ke,function(){for(var B=arguments.length,D=new Array(B);B--;)D[B]=arguments[B];O.subscribers.forEach(function(C){S(function(){C.apply(null,D)})})})}})}}function wr(e,r){return l(r).from({prototype:e}),r}function ur(e,r){return!(e.filter||e.algorithm||e.or)&&(r?e.justLimit:!e.replayFilter)}function ka(e,r){e.filter=Xt(e.filter,r)}function Ra(e,r,i){var u=e.replayFilter;e.replayFilter=u?function(){return Xt(u(),r())}:r,e.justLimit=i&&!u}function Yr(e,r){if(e.isPrimKey)return r.primaryKey;var i=r.getIndexByKeyPath(e.index);if(!i)throw new Y.Schema("KeyPath "+e.index+" on object store "+r.name+" is not indexed");return i}function Io(e,r,i){var u=Yr(e,r.schema);return r.openCursor({trans:i,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:u,range:e.range}})}function Xr(e,r,i,u){var c=e.replayFilter?Xt(e.filter,e.replayFilter()):e.filter;if(e.or){var y={},w=function(P,R,I){var M,E;c&&!c(R,I,function(N){return R.stop(N)},function(N){return R.fail(N)})||((E=""+(M=R.primaryKey))=="[object ArrayBuffer]"&&(E=""+new Uint8Array(M)),v(y,E)||(y[E]=!0,r(P,R,I)))};return Promise.all([e.or._iterate(w,i),Co(Io(e,u,i),e.algorithm,w,!e.keysOnly&&e.valueMapper)])}return Co(Io(e,u,i),Xt(e.algorithm,c),r,!e.keysOnly&&e.valueMapper)}function Co(e,r,i,u){var c=Ue(u?function(y,w,P){return i(u(y),w,P)}:i);return e.then(function(y){if(y)return y.start(function(){var w=function(){return y.continue()};r&&!r(y,function(P){return w=P},function(P){y.stop(P),w=me},function(P){y.fail(P),w=me})||c(y.value,y,function(P){return w=P}),w()})})}var _r=(To.prototype.execute=function(e){var r=this["@@propmod"];if(r.add!==void 0){var i=r.add;if(A(i))return s(s([],A(e)?e:[],!0),i).sort();if(typeof i=="number")return(Number(e)||0)+i;if(typeof i=="bigint")try{return BigInt(e)+i}catch{return BigInt(0)+i}throw new TypeError("Invalid term ".concat(i))}if(r.remove!==void 0){var u=r.remove;if(A(u))return A(e)?e.filter(function(c){return!u.includes(c)}).sort():[];if(typeof u=="number")return Number(e)-u;if(typeof u=="bigint")try{return BigInt(e)-u}catch{return BigInt(0)-u}throw new TypeError("Invalid subtrahend ".concat(u))}return i=(i=r.replacePrefix)===null||i===void 0?void 0:i[0],i&&typeof e=="string"&&e.startsWith(i)?r.replacePrefix[1]+e.substring(i.length):e},To);function To(e){this["@@propmod"]=e}var vl=(je.prototype._read=function(e,r){var i=this._ctx;return i.error?i.table._trans(null,Ve.bind(null,i.error)):i.table._trans("readonly",e).then(r)},je.prototype._write=function(e){var r=this._ctx;return r.error?r.table._trans(null,Ve.bind(null,r.error)):r.table._trans("readwrite",e,"locked")},je.prototype._addAlgorithm=function(e){var r=this._ctx;r.algorithm=Xt(r.algorithm,e)},je.prototype._iterate=function(e,r){return Xr(this._ctx,e,r,this._ctx.table.core)},je.prototype.clone=function(e){var r=Object.create(this.constructor.prototype),i=Object.create(this._ctx);return e&&T(i,e),r._ctx=i,r},je.prototype.raw=function(){return this._ctx.valueMapper=null,this},je.prototype.each=function(e){var r=this._ctx;return this._read(function(i){return Xr(r,e,i,r.table.core)})},je.prototype.count=function(e){var r=this;return this._read(function(i){var u=r._ctx,c=u.table.core;if(ur(u,!0))return c.count({trans:i,query:{index:Yr(u,c.schema),range:u.range}}).then(function(w){return Math.min(w,u.limit)});var y=0;return Xr(u,function(){return++y,!1},i,c).then(function(){return y})}).then(e)},je.prototype.sortBy=function(e,r){var i=e.split(".").reverse(),u=i[0],c=i.length-1;function y(R,I){return I?y(R[i[I]],I-1):R[u]}var w=this._ctx.dir==="next"?1:-1;function P(R,I){return Me(y(R,c),y(I,c))*w}return this.toArray(function(R){return R.sort(P)}).then(r)},je.prototype.toArray=function(e){var r=this;return this._read(function(i){var u=r._ctx;if(u.dir==="next"&&ur(u,!0)&&0<u.limit){var c=u.valueMapper,y=Yr(u,u.table.core.schema);return u.table.core.query({trans:i,limit:u.limit,values:!0,query:{index:y,range:u.range}}).then(function(P){return P=P.result,c?P.map(c):P})}var w=[];return Xr(u,function(P){return w.push(P)},i,u.table.core).then(function(){return w})},e)},je.prototype.offset=function(e){var r=this._ctx;return e<=0||(r.offset+=e,ur(r)?Ra(r,function(){var i=e;return function(u,c){return i===0||(i===1?--i:c(function(){u.advance(i),i=0}),!1)}}):Ra(r,function(){var i=e;return function(){return--i<0}})),this},je.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Ra(this._ctx,function(){var r=e;return function(i,u,c){return--r<=0&&u(c),0<=r}},!0),this},je.prototype.until=function(e,r){return ka(this._ctx,function(i,u,c){return!e(i.value)||(u(c),r)}),this},je.prototype.first=function(e){return this.limit(1).toArray(function(r){return r[0]}).then(e)},je.prototype.last=function(e){return this.reverse().first(e)},je.prototype.filter=function(e){var r;return ka(this._ctx,function(i){return e(i.value)}),(r=this._ctx).isMatch=Xt(r.isMatch,e),this},je.prototype.and=function(e){return this.filter(e)},je.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},je.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},je.prototype.desc=function(){return this.reverse()},je.prototype.eachKey=function(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(i,u){e(u.key,u)})},je.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},je.prototype.eachPrimaryKey=function(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(i,u){e(u.primaryKey,u)})},je.prototype.keys=function(e){var r=this._ctx;r.keysOnly=!r.isMatch;var i=[];return this.each(function(u,c){i.push(c.key)}).then(function(){return i}).then(e)},je.prototype.primaryKeys=function(e){var r=this._ctx;if(r.dir==="next"&&ur(r,!0)&&0<r.limit)return this._read(function(u){var c=Yr(r,r.table.core.schema);return r.table.core.query({trans:u,values:!1,limit:r.limit,query:{index:c,range:r.range}})}).then(function(u){return u.result}).then(e);r.keysOnly=!r.isMatch;var i=[];return this.each(function(u,c){i.push(c.primaryKey)}).then(function(){return i}).then(e)},je.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},je.prototype.firstKey=function(e){return this.limit(1).keys(function(r){return r[0]}).then(e)},je.prototype.lastKey=function(e){return this.reverse().firstKey(e)},je.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var r={};return ka(this._ctx,function(c){var u=c.primaryKey.toString(),c=v(r,u);return r[u]=!0,!c}),this},je.prototype.modify=function(e){var r=this,i=this._ctx;return this._write(function(u){var c,y,w;w=typeof e=="function"?e:(c=_(e),y=c.length,function(C){for(var q=!1,z=0;z<y;++z){var W=c[z],J=e[W],ne=K(C,W);J instanceof _r?(k(C,W,J.execute(ne)),q=!0):ne!==J&&(k(C,W,J),q=!0)}return q});var P=i.table.core,E=P.schema.primaryKey,R=E.outbound,I=E.extractKey,M=200,E=r.db._options.modifyChunkSize;E&&(M=typeof E=="object"?E[P.name]||E["*"]||200:E);function N(C,W){var z=W.failures,W=W.numFailures;B+=C-W;for(var J=0,ne=_(z);J<ne.length;J++){var ce=ne[J];O.push(z[ce])}}var O=[],B=0,D=[];return r.clone().primaryKeys().then(function(C){function q(W){var J=Math.min(M,C.length-W);return P.getMany({trans:u,keys:C.slice(W,W+J),cache:"immutable"}).then(function(ne){for(var ce=[],ae=[],oe=R?[]:null,de=[],ue=0;ue<J;++ue){var he=ne[ue],Ie={value:_e(he),primKey:C[W+ue]};w.call(Ie,Ie.value,Ie)!==!1&&(Ie.value==null?de.push(C[W+ue]):R||Me(I(he),I(Ie.value))===0?(ae.push(Ie.value),R&&oe.push(C[W+ue])):(de.push(C[W+ue]),ce.push(Ie.value)))}return Promise.resolve(0<ce.length&&P.mutate({trans:u,type:"add",values:ce}).then(function(Te){for(var Be in Te.failures)de.splice(parseInt(Be),1);N(ce.length,Te)})).then(function(){return(0<ae.length||z&&typeof e=="object")&&P.mutate({trans:u,type:"put",keys:oe,values:ae,criteria:z,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<W}).then(function(Te){return N(ae.length,Te)})}).then(function(){return(0<de.length||z&&e===Oa)&&P.mutate({trans:u,type:"delete",keys:de,criteria:z,isAdditionalChunk:0<W}).then(function(Te){return N(de.length,Te)})}).then(function(){return C.length>W+J&&q(W+M)})})}var z=ur(i)&&i.limit===1/0&&(typeof e!="function"||e===Oa)&&{index:i.index,range:i.range};return q(0).then(function(){if(0<O.length)throw new be("Error modifying one or more objects",O,B,D);return C.length})})})},je.prototype.delete=function(){var e=this._ctx,r=e.range;return ur(e)&&(e.isPrimKey||r.type===3)?this._write(function(i){var u=e.table.core.schema.primaryKey,c=r;return e.table.core.count({trans:i,query:{index:u,range:c}}).then(function(y){return e.table.core.mutate({trans:i,type:"deleteRange",range:c}).then(function(w){var P=w.failures;if(w.lastResult,w.results,w=w.numFailures,w)throw new be("Could not delete some values",Object.keys(P).map(function(R){return P[R]}),y-w);return y-w})})}):this.modify(Oa)},je);function je(){}var Oa=function(e,r){return r.value=null};function bl(e,r){return e<r?-1:e===r?0:1}function wl(e,r){return r<e?-1:e===r?0:1}function st(e,r,i){return e=e instanceof Mo?new e.Collection(e):e,e._ctx.error=new(i||TypeError)(r),e}function lr(e){return new e.Collection(e,function(){return Bo("")}).limit(0)}function en(e,r,i,u){var c,y,w,P,R,I,M,E=i.length;if(!i.every(function(B){return typeof B=="string"}))return st(e,xo);function N(B){c=B==="next"?function(C){return C.toUpperCase()}:function(C){return C.toLowerCase()},y=B==="next"?function(C){return C.toLowerCase()}:function(C){return C.toUpperCase()},w=B==="next"?bl:wl;var D=i.map(function(C){return{lower:y(C),upper:c(C)}}).sort(function(C,q){return w(C.lower,q.lower)});P=D.map(function(C){return C.upper}),R=D.map(function(C){return C.lower}),M=(I=B)==="next"?"":u}N("next"),e=new e.Collection(e,function(){return Mt(P[0],R[E-1]+u)}),e._ondirectionchange=function(B){N(B)};var O=0;return e._addAlgorithm(function(B,D,C){var q=B.key;if(typeof q!="string")return!1;var z=y(q);if(r(z,R,O))return!0;for(var W=null,J=O;J<E;++J){var ne=function(ce,ae,oe,de,ue,he){for(var Ie=Math.min(ce.length,de.length),Te=-1,Be=0;Be<Ie;++Be){var ut=ae[Be];if(ut!==de[Be])return ue(ce[Be],oe[Be])<0?ce.substr(0,Be)+oe[Be]+oe.substr(Be+1):ue(ce[Be],de[Be])<0?ce.substr(0,Be)+de[Be]+oe.substr(Be+1):0<=Te?ce.substr(0,Te)+ae[Te]+oe.substr(Te+1):null;ue(ce[Be],ut)<0&&(Te=Be)}return Ie<de.length&&he==="next"?ce+oe.substr(ce.length):Ie<ce.length&&he==="prev"?ce.substr(0,oe.length):Te<0?null:ce.substr(0,Te)+de[Te]+oe.substr(Te+1)}(q,z,P[J],R[J],w,I);ne===null&&W===null?O=J+1:(W===null||0<w(W,ne))&&(W=ne)}return D(W!==null?function(){B.continue(W+M)}:C),!1}),e}function Mt(e,r,i,u){return{type:2,lower:e,upper:r,lowerOpen:i,upperOpen:u}}function Bo(e){return{type:1,lower:e,upper:e}}var Mo=(Object.defineProperty(He.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),He.prototype.between=function(e,r,i,u){i=i!==!1,u=u===!0;try{return 0<this._cmp(e,r)||this._cmp(e,r)===0&&(i||u)&&(!i||!u)?lr(this):new this.Collection(this,function(){return Mt(e,r,!i,!u)})}catch{return st(this,Rt)}},He.prototype.equals=function(e){return e==null?st(this,Rt):new this.Collection(this,function(){return Bo(e)})},He.prototype.above=function(e){return e==null?st(this,Rt):new this.Collection(this,function(){return Mt(e,void 0,!0)})},He.prototype.aboveOrEqual=function(e){return e==null?st(this,Rt):new this.Collection(this,function(){return Mt(e,void 0,!1)})},He.prototype.below=function(e){return e==null?st(this,Rt):new this.Collection(this,function(){return Mt(void 0,e,!1,!0)})},He.prototype.belowOrEqual=function(e){return e==null?st(this,Rt):new this.Collection(this,function(){return Mt(void 0,e)})},He.prototype.startsWith=function(e){return typeof e!="string"?st(this,xo):this.between(e,e+Yt,!0,!0)},He.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):en(this,function(r,i){return r.indexOf(i[0])===0},[e],Yt)},He.prototype.equalsIgnoreCase=function(e){return en(this,function(r,i){return r===i[0]},[e],"")},He.prototype.anyOfIgnoreCase=function(){var e=L.apply(re,arguments);return e.length===0?lr(this):en(this,function(r,i){return i.indexOf(r)!==-1},e,"")},He.prototype.startsWithAnyOfIgnoreCase=function(){var e=L.apply(re,arguments);return e.length===0?lr(this):en(this,function(r,i){return i.some(function(u){return r.indexOf(u)===0})},e,Yt)},He.prototype.anyOf=function(){var e=this,r=L.apply(re,arguments),i=this._cmp;try{r.sort(i)}catch{return st(this,Rt)}if(r.length===0)return lr(this);var u=new this.Collection(this,function(){return Mt(r[0],r[r.length-1])});u._ondirectionchange=function(y){i=y==="next"?e._ascending:e._descending,r.sort(i)};var c=0;return u._addAlgorithm(function(y,w,P){for(var R=y.key;0<i(R,r[c]);)if(++c===r.length)return w(P),!1;return i(R,r[c])===0||(w(function(){y.continue(r[c])}),!1)}),u},He.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},He.prototype.noneOf=function(){var e=L.apply(re,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return st(this,Rt)}var r=e.reduce(function(i,u){return i?i.concat([[i[i.length-1][1],u]]):[[-1/0,u]]},null);return r.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})},He.prototype.inAnyRange=function(q,r){var i=this,u=this._cmp,c=this._ascending,y=this._descending,w=this._min,P=this._max;if(q.length===0)return lr(this);if(!q.every(function(z){return z[0]!==void 0&&z[1]!==void 0&&c(z[0],z[1])<=0}))return st(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Y.InvalidArgument);var R=!r||r.includeLowers!==!1,I=r&&r.includeUppers===!0,M,E=c;function N(z,W){return E(z[0],W[0])}try{(M=q.reduce(function(z,W){for(var J=0,ne=z.length;J<ne;++J){var ce=z[J];if(u(W[0],ce[1])<0&&0<u(W[1],ce[0])){ce[0]=w(ce[0],W[0]),ce[1]=P(ce[1],W[1]);break}}return J===ne&&z.push(W),z},[])).sort(N)}catch{return st(this,Rt)}var O=0,B=I?function(z){return 0<c(z,M[O][1])}:function(z){return 0<=c(z,M[O][1])},D=R?function(z){return 0<y(z,M[O][0])}:function(z){return 0<=y(z,M[O][0])},C=B,q=new this.Collection(this,function(){return Mt(M[0][0],M[M.length-1][1],!R,!I)});return q._ondirectionchange=function(z){E=z==="next"?(C=B,c):(C=D,y),M.sort(N)},q._addAlgorithm(function(z,W,J){for(var ne,ce=z.key;C(ce);)if(++O===M.length)return W(J),!1;return!B(ne=ce)&&!D(ne)||(i._cmp(ce,M[O][1])===0||i._cmp(ce,M[O][0])===0||W(function(){E===c?z.continue(M[O][0]):z.continue(M[O][1])}),!1)}),q},He.prototype.startsWithAnyOf=function(){var e=L.apply(re,arguments);return e.every(function(r){return typeof r=="string"})?e.length===0?lr(this):this.inAnyRange(e.map(function(r){return[r,r+Yt]})):st(this,"startsWithAnyOf() only works with strings")},He);function He(){}function At(e){return Ue(function(r){return Ar(r),e(r.target.error),!1})}function Ar(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Sr="storagemutated",Ia="x-storagemutated-1",Dt=br(null,Sr),_l=(St.prototype._lock=function(){return U(!ie.global),++this._reculock,this._reculock!==1||ie.global||(ie.lockOwnerFor=this),this},St.prototype._unlock=function(){if(U(!ie.global),--this._reculock==0)for(ie.global||(ie.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{Qt(e[1],e[0])}catch{}}return this},St.prototype._locked=function(){return this._reculock&&ie.lockOwnerFor!==this},St.prototype.create=function(e){var r=this;if(!this.mode)return this;var i=this.db.idbdb,u=this.db._state.dbOpenError;if(U(!this.idbtrans),!e&&!i)switch(u&&u.name){case"DatabaseClosedError":throw new Y.DatabaseClosed(u);case"MissingAPIError":throw new Y.MissingAPI(u.message,u);default:throw new Y.OpenFailed(u)}if(!this.active)throw new Y.TransactionInactive;return U(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||i).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ue(function(c){Ar(c),r._reject(e.error)}),e.onabort=Ue(function(c){Ar(c),r.active&&r._reject(new Y.Abort(e.error)),r.active=!1,r.on("abort").fire(c)}),e.oncomplete=Ue(function(){r.active=!1,r._resolve(),"mutatedParts"in e&&Dt.storagemutated.fire(e.mutatedParts)}),this},St.prototype._promise=function(e,r,i){var u=this;if(e==="readwrite"&&this.mode!=="readwrite")return Ve(new Y.ReadOnly("Transaction is readonly"));if(!this.active)return Ve(new Y.TransactionInactive);if(this._locked())return new le(function(y,w){u._blockedFuncs.push([function(){u._promise(e,r,i).then(y,w)},ie])});if(i)return vt(function(){var y=new le(function(w,P){u._lock();var R=r(w,P,u);R&&R.then&&R.then(w,P)});return y.finally(function(){return u._unlock()}),y._lib=!0,y});var c=new le(function(y,w){var P=r(y,w,u);P&&P.then&&P.then(y,w)});return c._lib=!0,c},St.prototype._root=function(){return this.parent?this.parent._root():this},St.prototype.waitFor=function(e){var r,i=this._root(),u=le.resolve(e);i._waitingFor?i._waitingFor=i._waitingFor.then(function(){return u}):(i._waitingFor=u,i._waitingQueue=[],r=i.idbtrans.objectStore(i.storeNames[0]),function y(){for(++i._spinCount;i._waitingQueue.length;)i._waitingQueue.shift()();i._waitingFor&&(r.get(-1/0).onsuccess=y)}());var c=i._waitingFor;return new le(function(y,w){u.then(function(P){return i._waitingQueue.push(Ue(y.bind(null,P)))},function(P){return i._waitingQueue.push(Ue(w.bind(null,P)))}).finally(function(){i._waitingFor===c&&(i._waitingFor=null)})})},St.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Y.Abort))},St.prototype.table=function(e){var r=this._memoizedTables||(this._memoizedTables={});if(v(r,e))return r[e];var i=this.schema[e];if(!i)throw new Y.NotFound("Table "+e+" not part of transaction");return i=new this.db.Table(e,i,this),i.core=this.db.core.table(e),r[e]=i},St);function St(){}function Ca(e,r,i,u,c,y,w){return{name:e,keyPath:r,unique:i,multi:u,auto:c,compound:y,src:(i&&!w?"&":"")+(u?"*":"")+(c?"++":"")+Do(r)}}function Do(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Ta(e,r,i){return{name:e,primKey:r,indexes:i,mappedClass:null,idxByName:(u=function(c){return[c.name,c]},i.reduce(function(c,y,w){return w=u(y,w),w&&(c[w[0]]=w[1]),c},{}))};var u}var Pr=function(e){try{return e.only([[]]),Pr=function(){return[[]]},[[]]}catch{return Pr=function(){return Yt},Yt}};function Ba(e){return e==null?function(){}:typeof e=="string"?(r=e).split(".").length===1?function(i){return i[r]}:function(i){return K(i,r)}:function(i){return K(i,e)};var r}function jo(e){return[].slice.call(e)}var Al=0;function xr(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Sl(e,r,R){function u(C){if(C.type===3)return null;if(C.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var O=C.lower,B=C.upper,D=C.lowerOpen,C=C.upperOpen;return O===void 0?B===void 0?null:r.upperBound(B,!!C):B===void 0?r.lowerBound(O,!!D):r.bound(O,B,!!D,!!C)}function c(N){var O,B=N.name;return{name:B,schema:N,mutate:function(D){var C=D.trans,q=D.type,z=D.keys,W=D.values,J=D.range;return new Promise(function(ne,ce){ne=Ue(ne);var ae=C.objectStore(B),oe=ae.keyPath==null,de=q==="put"||q==="add";if(!de&&q!=="delete"&&q!=="deleteRange")throw new Error("Invalid operation type: "+q);var ue,he=(z||W||{length:1}).length;if(z&&W&&z.length!==W.length)throw new Error("Given keys array must have same length as given values array.");if(he===0)return ne({numFailures:0,failures:{},results:[],lastResult:void 0});function Ie(nt){++ut,Ar(nt)}var Te=[],Be=[],ut=0;if(q==="deleteRange"){if(J.type===4)return ne({numFailures:ut,failures:Be,results:[],lastResult:void 0});J.type===3?Te.push(ue=ae.clear()):Te.push(ue=ae.delete(u(J)))}else{var oe=de?oe?[W,z]:[W,null]:[z,null],ke=oe[0],Xe=oe[1];if(de)for(var et=0;et<he;++et)Te.push(ue=Xe&&Xe[et]!==void 0?ae[q](ke[et],Xe[et]):ae[q](ke[et])),ue.onerror=Ie;else for(et=0;et<he;++et)Te.push(ue=ae[q](ke[et])),ue.onerror=Ie}function yn(nt){nt=nt.target.result,Te.forEach(function(rr,Ya){return rr.error!=null&&(Be[Ya]=rr.error)}),ne({numFailures:ut,failures:Be,results:q==="delete"?z:Te.map(function(rr){return rr.result}),lastResult:nt})}ue.onerror=function(nt){Ie(nt),yn(nt)},ue.onsuccess=yn})},getMany:function(D){var C=D.trans,q=D.keys;return new Promise(function(z,W){z=Ue(z);for(var J,ne=C.objectStore(B),ce=q.length,ae=new Array(ce),oe=0,de=0,ue=function(Te){Te=Te.target,ae[Te._pos]=Te.result,++de===oe&&z(ae)},he=At(W),Ie=0;Ie<ce;++Ie)q[Ie]!=null&&((J=ne.get(q[Ie]))._pos=Ie,J.onsuccess=ue,J.onerror=he,++oe);oe===0&&z(ae)})},get:function(D){var C=D.trans,q=D.key;return new Promise(function(z,W){z=Ue(z);var J=C.objectStore(B).get(q);J.onsuccess=function(ne){return z(ne.target.result)},J.onerror=At(W)})},query:(O=I,function(D){return new Promise(function(C,q){C=Ue(C);var z,W,J,oe=D.trans,ne=D.values,ce=D.limit,ue=D.query,ae=ce===1/0?void 0:ce,de=ue.index,ue=ue.range,oe=oe.objectStore(B),de=de.isPrimaryKey?oe:oe.index(de.name),ue=u(ue);if(ce===0)return C({result:[]});O?((ae=ne?de.getAll(ue,ae):de.getAllKeys(ue,ae)).onsuccess=function(he){return C({result:he.target.result})},ae.onerror=At(q)):(z=0,W=!ne&&"openKeyCursor"in de?de.openKeyCursor(ue):de.openCursor(ue),J=[],W.onsuccess=function(he){var Ie=W.result;return Ie?(J.push(ne?Ie.value:Ie.primaryKey),++z===ce?C({result:J}):void Ie.continue()):C({result:J})},W.onerror=At(q))})}),openCursor:function(D){var C=D.trans,q=D.values,z=D.query,W=D.reverse,J=D.unique;return new Promise(function(ne,ce){ne=Ue(ne);var de=z.index,ae=z.range,oe=C.objectStore(B),oe=de.isPrimaryKey?oe:oe.index(de.name),de=W?J?"prevunique":"prev":J?"nextunique":"next",ue=!q&&"openKeyCursor"in oe?oe.openKeyCursor(u(ae),de):oe.openCursor(u(ae),de);ue.onerror=At(ce),ue.onsuccess=Ue(function(he){var Ie,Te,Be,ut,ke=ue.result;ke?(ke.___id=++Al,ke.done=!1,Ie=ke.continue.bind(ke),Te=(Te=ke.continuePrimaryKey)&&Te.bind(ke),Be=ke.advance.bind(ke),ut=function(){throw new Error("Cursor not stopped")},ke.trans=C,ke.stop=ke.continue=ke.continuePrimaryKey=ke.advance=function(){throw new Error("Cursor not started")},ke.fail=Ue(ce),ke.next=function(){var Xe=this,et=1;return this.start(function(){return et--?Xe.continue():Xe.stop()}).then(function(){return Xe})},ke.start=function(Xe){function et(){if(ue.result)try{Xe()}catch(nt){ke.fail(nt)}else ke.done=!0,ke.start=function(){throw new Error("Cursor behind last entry")},ke.stop()}var yn=new Promise(function(nt,rr){nt=Ue(nt),ue.onerror=At(rr),ke.fail=rr,ke.stop=function(Ya){ke.stop=ke.continue=ke.continuePrimaryKey=ke.advance=ut,nt(Ya)}});return ue.onsuccess=Ue(function(nt){ue.onsuccess=et,et()}),ke.continue=Ie,ke.continuePrimaryKey=Te,ke.advance=Be,et(),yn},ne(ke)):ne(null)},ce)})},count:function(D){var C=D.query,q=D.trans,z=C.index,W=C.range;return new Promise(function(J,ne){var ce=q.objectStore(B),ae=z.isPrimaryKey?ce:ce.index(z.name),ce=u(W),ae=ce?ae.count(ce):ae.count();ae.onsuccess=Ue(function(oe){return J(oe.target.result)}),ae.onerror=At(ne)})}}}var y,w,P,M=(w=R,P=jo((y=e).objectStoreNames),{schema:{name:y.name,tables:P.map(function(N){return w.objectStore(N)}).map(function(N){var O=N.keyPath,C=N.autoIncrement,B=A(O),D={},C={name:N.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:O==null,compound:B,keyPath:O,autoIncrement:C,unique:!0,extractKey:Ba(O)},indexes:jo(N.indexNames).map(function(q){return N.index(q)}).map(function(J){var z=J.name,W=J.unique,ne=J.multiEntry,J=J.keyPath,ne={name:z,compound:A(J),keyPath:J,unique:W,multiEntry:ne,extractKey:Ba(J)};return D[xr(J)]=ne}),getIndexByKeyPath:function(q){return D[xr(q)]}};return D[":id"]=C.primaryKey,O!=null&&(D[xr(O)]=C.primaryKey),C})},hasGetAll:0<P.length&&"getAll"in w.objectStore(P[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),R=M.schema,I=M.hasGetAll,M=R.tables.map(c),E={};return M.forEach(function(N){return E[N.name]=N}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(N){if(!E[N])throw new Error("Table '".concat(N,"' not found"));return E[N]},MIN_KEY:-1/0,MAX_KEY:Pr(r),schema:R}}function Pl(e,r,i,u){var c=i.IDBKeyRange;return i.indexedDB,{dbcore:(u=Sl(r,c,u),e.dbcore.reduce(function(y,w){return w=w.create,n(n({},y),w(y))},u))}}function tn(e,u){var i=u.db,u=Pl(e._middlewares,i,e._deps,u);e.core=u.dbcore,e.tables.forEach(function(c){var y=c.name;e.core.schema.tables.some(function(w){return w.name===y})&&(c.core=e.core.table(y),e[y]instanceof e.Table&&(e[y].core=c.core))})}function rn(e,r,i,u){i.forEach(function(c){var y=u[c];r.forEach(function(w){var P=function R(I,M){return p(I,M)||(I=j(I))&&R(I,M)}(w,c);(!P||"value"in P&&P.value===void 0)&&(w===e.Transaction.prototype||w instanceof e.Transaction?g(w,c,{get:function(){return this.table(c)},set:function(R){m(this,c,{value:R,writable:!0,configurable:!0,enumerable:!0})}}):w[c]=new e.Table(c,y))})})}function Ma(e,r){r.forEach(function(i){for(var u in i)i[u]instanceof e.Table&&delete i[u]})}function xl(e,r){return e._cfg.version-r._cfg.version}function El(e,r,i,u){var c=e._dbSchema;i.objectStoreNames.contains("$meta")&&!c.$meta&&(c.$meta=Ta("$meta",Uo("")[0],[]),e._storeNames.push("$meta"));var y=e._createTransaction("readwrite",e._storeNames,c);y.create(i),y._completion.catch(u);var w=y._reject.bind(y),P=ie.transless||ie;vt(function(){return ie.trans=y,ie.transless=P,r!==0?(tn(e,i),I=r,((R=y).storeNames.includes("$meta")?R.table("$meta").get("version").then(function(M){return M??I}):le.resolve(I)).then(function(M){return N=M,O=y,B=i,D=[],M=(E=e)._versions,C=E._dbSchema=an(0,E.idbdb,B),(M=M.filter(function(q){return q._cfg.version>=N})).length!==0?(M.forEach(function(q){D.push(function(){var z=C,W=q._cfg.dbschema;on(E,z,B),on(E,W,B),C=E._dbSchema=W;var J=Da(z,W);J.add.forEach(function(de){ja(B,de[0],de[1].primKey,de[1].indexes)}),J.change.forEach(function(de){if(de.recreate)throw new Y.Upgrade("Not yet support for changing primary key");var ue=B.objectStore(de.name);de.add.forEach(function(he){return nn(ue,he)}),de.change.forEach(function(he){ue.deleteIndex(he.name),nn(ue,he)}),de.del.forEach(function(he){return ue.deleteIndex(he)})});var ne=q._cfg.contentUpgrade;if(ne&&q._cfg.version>N){tn(E,B),O._memoizedTables={};var ce=pe(W);J.del.forEach(function(de){ce[de]=z[de]}),Ma(E,[E.Transaction.prototype]),rn(E,[E.Transaction.prototype],_(ce),ce),O.schema=ce;var ae,oe=Q(ne);return oe&&Bt(),J=le.follow(function(){var de;(ae=ne(O))&&oe&&(de=dt.bind(null,null),ae.then(de,de))}),ae&&typeof ae.then=="function"?le.resolve(ae):J.then(function(){return ae})}}),D.push(function(z){var W,J,ne=q._cfg.dbschema;W=ne,J=z,[].slice.call(J.db.objectStoreNames).forEach(function(ce){return W[ce]==null&&J.db.deleteObjectStore(ce)}),Ma(E,[E.Transaction.prototype]),rn(E,[E.Transaction.prototype],E._storeNames,E._dbSchema),O.schema=E._dbSchema}),D.push(function(z){E.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(E.idbdb.version/10)===q._cfg.version?(E.idbdb.deleteObjectStore("$meta"),delete E._dbSchema.$meta,E._storeNames=E._storeNames.filter(function(W){return W!=="$meta"})):z.objectStore("$meta").put(q._cfg.version,"version"))})}),function q(){return D.length?le.resolve(D.shift()(O.idbtrans)).then(q):le.resolve()}().then(function(){No(C,B)})):le.resolve();var E,N,O,B,D,C}).catch(w)):(_(c).forEach(function(M){ja(i,M,c[M].primKey,c[M].indexes)}),tn(e,i),void le.follow(function(){return e.on.populate.fire(y)}).catch(w));var R,I})}function Fl(e,r){No(e._dbSchema,r),r.db.version%10!=0||r.objectStoreNames.contains("$meta")||r.db.createObjectStore("$meta").add(Math.ceil(r.db.version/10-1),"version");var i=an(0,e.idbdb,r);on(e,e._dbSchema,r);for(var u=0,c=Da(i,e._dbSchema).change;u<c.length;u++){var y=function(w){if(w.change.length||w.recreate)return console.warn("Unable to patch indexes of table ".concat(w.name," because it has changes on the type of index or primary key.")),{value:void 0};var P=r.objectStore(w.name);w.add.forEach(function(R){lt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(w.name,".").concat(R.src)),nn(P,R)})}(c[u]);if(typeof y=="object")return y.value}}function Da(e,r){var i,u={del:[],add:[],change:[]};for(i in e)r[i]||u.del.push(i);for(i in r){var c=e[i],y=r[i];if(c){var w={name:i,def:y,recreate:!1,del:[],add:[],change:[]};if(""+(c.primKey.keyPath||"")!=""+(y.primKey.keyPath||"")||c.primKey.auto!==y.primKey.auto)w.recreate=!0,u.change.push(w);else{var P=c.idxByName,R=y.idxByName,I=void 0;for(I in P)R[I]||w.del.push(I);for(I in R){var M=P[I],E=R[I];M?M.src!==E.src&&w.change.push(E):w.add.push(E)}(0<w.del.length||0<w.add.length||0<w.change.length)&&u.change.push(w)}}else u.add.push([i,y])}return u}function ja(e,r,i,u){var c=e.db.createObjectStore(r,i.keyPath?{keyPath:i.keyPath,autoIncrement:i.auto}:{autoIncrement:i.auto});return u.forEach(function(y){return nn(c,y)}),c}function No(e,r){_(e).forEach(function(i){r.db.objectStoreNames.contains(i)||(lt&&console.debug("Dexie: Creating missing table",i),ja(r,i,e[i].primKey,e[i].indexes))})}function nn(e,r){e.createIndex(r.name,r.keyPath,{unique:r.unique,multiEntry:r.multi})}function an(e,r,i){var u={};return b(r.objectStoreNames,0).forEach(function(c){for(var y=i.objectStore(c),w=Ca(Do(I=y.keyPath),I||"",!0,!1,!!y.autoIncrement,I&&typeof I!="string",!0),P=[],R=0;R<y.indexNames.length;++R){var M=y.index(y.indexNames[R]),I=M.keyPath,M=Ca(M.name,I,!!M.unique,!!M.multiEntry,!1,I&&typeof I!="string",!1);P.push(M)}u[c]=Ta(c,w,P)}),u}function on(e,r,i){for(var u=i.db.objectStoreNames,c=0;c<u.length;++c){var y=u[c],w=i.objectStore(y);e._hasGetAll="getAll"in w;for(var P=0;P<w.indexNames.length;++P){var R=w.indexNames[P],I=w.index(R).keyPath,M=typeof I=="string"?I:"["+b(I).join("+")+"]";!r[y]||(I=r[y].idxByName[M])&&(I.name=R,delete r[y].idxByName[M],r[y].idxByName[R]=I)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&f.WorkerGlobalScope&&f instanceof f.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Uo(e){return e.split(",").map(function(r,i){var u=(r=r.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Ca(u,c||null,/\&/.test(r),/\*/.test(r),/\+\+/.test(r),A(c),i===0)})}var kl=(sn.prototype._parseStoresSpec=function(e,r){_(e).forEach(function(i){if(e[i]!==null){var u=Uo(e[i]),c=u.shift();if(c.unique=!0,c.multi)throw new Y.Schema("Primary key cannot be multi-valued");u.forEach(function(y){if(y.auto)throw new Y.Schema("Only primary key can be marked as autoIncrement (++)");if(!y.keyPath)throw new Y.Schema("Index must have a name and cannot be an empty string")}),r[i]=Ta(i,c,u)}})},sn.prototype.stores=function(i){var r=this.db;this._cfg.storesSource=this._cfg.storesSource?T(this._cfg.storesSource,i):i;var i=r._versions,u={},c={};return i.forEach(function(y){T(u,y._cfg.storesSource),c=y._cfg.dbschema={},y._parseStoresSpec(u,c)}),r._dbSchema=c,Ma(r,[r._allTables,r,r.Transaction.prototype]),rn(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],_(c),c),r._storeNames=_(c),this},sn.prototype.upgrade=function(e){return this._cfg.contentUpgrade=yr(this._cfg.contentUpgrade||me,e),this},sn);function sn(){}function Na(e,r){var i=e._dbNamesDB;return i||(i=e._dbNamesDB=new Ot(Jr,{addons:[],indexedDB:e,IDBKeyRange:r})).version(1).stores({dbnames:"name"}),i.table("dbnames")}function Ua(e){return e&&typeof e.databases=="function"}function $a(e){return vt(function(){return ie.letThrough=!0,e()})}function qa(e){return!("from"in e)}var Ye=function(e,r){if(!this){var i=new Ye;return e&&"d"in e&&T(i,e),i}T(this,arguments.length?{d:1,from:e,to:1<arguments.length?r:e}:{d:0})};function Er(e,r,i){var u=Me(r,i);if(!isNaN(u)){if(0<u)throw RangeError();if(qa(e))return T(e,{from:r,to:i,d:1});var c=e.l,u=e.r;if(Me(i,e.from)<0)return c?Er(c,r,i):e.l={from:r,to:i,d:1,l:null,r:null},qo(e);if(0<Me(r,e.to))return u?Er(u,r,i):e.r={from:r,to:i,d:1,l:null,r:null},qo(e);Me(r,e.from)<0&&(e.from=r,e.l=null,e.d=u?u.d+1:1),0<Me(i,e.to)&&(e.to=i,e.r=null,e.d=e.l?e.l.d+1:1),i=!e.r,c&&!e.l&&Fr(e,c),u&&i&&Fr(e,u)}}function Fr(e,r){qa(r)||function i(u,R){var y=R.from,w=R.to,P=R.l,R=R.r;Er(u,y,w),P&&i(u,P),R&&i(u,R)}(e,r)}function $o(e,r){var i=un(r),u=i.next();if(u.done)return!1;for(var c=u.value,y=un(e),w=y.next(c.from),P=w.value;!u.done&&!w.done;){if(Me(P.from,c.to)<=0&&0<=Me(P.to,c.from))return!0;Me(c.from,P.from)<0?c=(u=i.next(P.from)).value:P=(w=y.next(c.from)).value}return!1}function un(e){var r=qa(e)?null:{s:0,n:e};return{next:function(i){for(var u=0<arguments.length;r;)switch(r.s){case 0:if(r.s=1,u)for(;r.n.l&&Me(i,r.n.from)<0;)r={up:r,n:r.n.l,s:1};else for(;r.n.l;)r={up:r,n:r.n.l,s:1};case 1:if(r.s=2,!u||Me(i,r.n.to)<=0)return{value:r.n,done:!1};case 2:if(r.n.r){r.s=3,r={up:r,n:r.n.r,s:0};continue}case 3:r=r.up}return{done:!0}}}}function qo(e){var r,i,u=(((r=e.r)===null||r===void 0?void 0:r.d)||0)-(((i=e.l)===null||i===void 0?void 0:i.d)||0),c=1<u?"r":u<-1?"l":"";c&&(r=c=="r"?"l":"r",i=n({},e),u=e[c],e.from=u.from,e.to=u.to,e[c]=u[c],i[c]=u[r],(e[r]=i).d=Ko(i)),e.d=Ko(e)}function Ko(i){var r=i.r,i=i.l;return(r?i?Math.max(r.d,i.d):r.d:i?i.d:0)+1}function ln(e,r){return _(r).forEach(function(i){e[i]?Fr(e[i],r[i]):e[i]=function u(c){var y,w,P={};for(y in c)v(c,y)&&(w=c[y],P[y]=!w||typeof w!="object"||Ae.has(w.constructor)?w:u(w));return P}(r[i])}),e}function Ka(e,r){return e.all||r.all||Object.keys(e).some(function(i){return r[i]&&$o(r[i],e[i])})}d(Ye.prototype,((pt={add:function(e){return Fr(this,e),this},addKey:function(e){return Er(this,e,e),this},addKeys:function(e){var r=this;return e.forEach(function(i){return Er(r,i,i)}),this},hasKey:function(e){var r=un(this).next(e).value;return r&&Me(r.from,e)<=0&&0<=Me(r.to,e)}})[Re]=function(){return un(this)},pt));var er={},La={},Va=!1;function cn(e){ln(La,e),Va||(Va=!0,setTimeout(function(){Va=!1,za(La,!(La={}))},0))}function za(e,r){r===void 0&&(r=!1);var i=new Set;if(e.all)for(var u=0,c=Object.values(er);u<c.length;u++)Lo(w=c[u],e,i,r);else for(var y in e){var w,P=/^idb\:\/\/(.*)\/(.*)\//.exec(y);P&&(y=P[1],P=P[2],(w=er["idb://".concat(y,"/").concat(P)])&&Lo(w,e,i,r))}i.forEach(function(R){return R()})}function Lo(e,r,i,u){for(var c=[],y=0,w=Object.entries(e.queries.query);y<w.length;y++){for(var P=w[y],R=P[0],I=[],M=0,E=P[1];M<E.length;M++){var N=E[M];Ka(r,N.obsSet)?N.subscribers.forEach(function(C){return i.add(C)}):u&&I.push(N)}u&&c.push([R,I])}if(u)for(var O=0,B=c;O<B.length;O++){var D=B[O],R=D[0],I=D[1];e.queries.query[R]=I}}function Rl(e){var r=e._state,i=e._deps.indexedDB;if(r.isBeingOpened||e.idbdb)return r.dbReadyPromise.then(function(){return r.dbOpenError?Ve(r.dbOpenError):e});r.isBeingOpened=!0,r.dbOpenError=null,r.openComplete=!1;var u=r.openCanceller,c=Math.round(10*e.verno),y=!1;function w(){if(r.openCanceller!==u)throw new Y.DatabaseClosed("db.open() was cancelled")}function P(){return new le(function(N,O){if(w(),!i)throw new Y.MissingAPI;var B=e.name,D=r.autoSchema||!c?i.open(B):i.open(B,c);if(!D)throw new Y.MissingAPI;D.onerror=At(O),D.onblocked=Ue(e._fireOnBlocked),D.onupgradeneeded=Ue(function(C){var q;M=D.transaction,r.autoSchema&&!e._options.allowEmptyDB?(D.onerror=Ar,M.abort(),D.result.close(),(q=i.deleteDatabase(B)).onsuccess=q.onerror=Ue(function(){O(new Y.NoSuchDatabase("Database ".concat(B," doesnt exist")))})):(M.onerror=At(O),C=C.oldVersion>Math.pow(2,62)?0:C.oldVersion,E=C<1,e.idbdb=D.result,y&&Fl(e,M),El(e,C/10,M,O))},O),D.onsuccess=Ue(function(){M=null;var C,q,z,W,J,ne=e.idbdb=D.result,ce=b(ne.objectStoreNames);if(0<ce.length)try{var ae=ne.transaction((W=ce).length===1?W[0]:W,"readonly");if(r.autoSchema)q=ne,z=ae,(C=e).verno=q.version/10,z=C._dbSchema=an(0,q,z),C._storeNames=b(q.objectStoreNames,0),rn(C,[C._allTables],_(z),z);else if(on(e,e._dbSchema,ae),((J=Da(an(0,(J=e).idbdb,ae),J._dbSchema)).add.length||J.change.some(function(oe){return oe.add.length||oe.change.length}))&&!y)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),ne.close(),c=ne.version+1,y=!0,N(P());tn(e,ae)}catch{}sr.push(e),ne.onversionchange=Ue(function(oe){r.vcFired=!0,e.on("versionchange").fire(oe)}),ne.onclose=Ue(function(oe){e.on("close").fire(oe)}),E&&(J=e._deps,ae=B,ne=J.indexedDB,J=J.IDBKeyRange,Ua(ne)||ae===Jr||Na(ne,J).put({name:ae}).catch(me)),N()},O)}).catch(function(N){switch(N==null?void 0:N.name){case"UnknownError":if(0<r.PR1398_maxLoop)return r.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),P();break;case"VersionError":if(0<c)return c=0,P()}return le.reject(N)})}var R,I=r.dbReadyResolve,M=null,E=!1;return le.race([u,(typeof navigator>"u"?le.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(N){function O(){return indexedDB.databases().finally(N)}R=setInterval(O,100),O()}).finally(function(){return clearInterval(R)}):Promise.resolve()).then(P)]).then(function(){return w(),r.onReadyBeingFired=[],le.resolve($a(function(){return e.on.ready.fire(e.vip)})).then(function N(){if(0<r.onReadyBeingFired.length){var O=r.onReadyBeingFired.reduce(yr,me);return r.onReadyBeingFired=[],le.resolve($a(function(){return O(e.vip)})).then(N)}})}).finally(function(){r.openCanceller===u&&(r.onReadyBeingFired=null,r.isBeingOpened=!1)}).catch(function(N){r.dbOpenError=N;try{M&&M.abort()}catch{}return u===r.openCanceller&&e._close(),Ve(N)}).finally(function(){r.openComplete=!0,I()}).then(function(){var N;return E&&(N={},e.tables.forEach(function(O){O.schema.indexes.forEach(function(B){B.name&&(N["idb://".concat(e.name,"/").concat(O.name,"/").concat(B.name)]=new Ye(-1/0,[[[]]]))}),N["idb://".concat(e.name,"/").concat(O.name,"/")]=N["idb://".concat(e.name,"/").concat(O.name,"/:dels")]=new Ye(-1/0,[[[]]])}),Dt(Sr).fire(N),za(N,!0)),e})}function Wa(e){function r(y){return e.next(y)}var i=c(r),u=c(function(y){return e.throw(y)});function c(y){return function(R){var P=y(R),R=P.value;return P.done?R:R&&typeof R.then=="function"?R.then(i,u):A(R)?Promise.all(R).then(i,u):i(R)}}return c(r)()}function fn(e,r,i){for(var u=A(e)?e.slice():[e],c=0;c<i;++c)u.push(r);return u}var Ol={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return n(n({},e),{table:function(r){var i=e.table(r),u=i.schema,c={},y=[];function w(E,N,O){var B=xr(E),D=c[B]=c[B]||[],C=E==null?0:typeof E=="string"?1:E.length,q=0<N,q=n(n({},O),{name:q?"".concat(B,"(virtual-from:").concat(O.name,")"):O.name,lowLevelIndex:O,isVirtual:q,keyTail:N,keyLength:C,extractKey:Ba(E),unique:!q&&O.unique});return D.push(q),q.isPrimaryKey||y.push(q),1<C&&w(C===2?E[0]:E.slice(0,C-1),N+1,O),D.sort(function(z,W){return z.keyTail-W.keyTail}),q}r=w(u.primaryKey.keyPath,0,u.primaryKey),c[":id"]=[r];for(var P=0,R=u.indexes;P<R.length;P++){var I=R[P];w(I.keyPath,0,I)}function M(E){var N,O=E.query.index;return O.isVirtual?n(n({},E),{query:{index:O.lowLevelIndex,range:(N=E.query.range,O=O.keyTail,{type:N.type===1?2:N.type,lower:fn(N.lower,N.lowerOpen?e.MAX_KEY:e.MIN_KEY,O),lowerOpen:!0,upper:fn(N.upper,N.upperOpen?e.MIN_KEY:e.MAX_KEY,O),upperOpen:!0})}}):E}return n(n({},i),{schema:n(n({},u),{primaryKey:r,indexes:y,getIndexByKeyPath:function(E){return(E=c[xr(E)])&&E[0]}}),count:function(E){return i.count(M(E))},query:function(E){return i.query(M(E))},openCursor:function(E){var N=E.query.index,O=N.keyTail,B=N.isVirtual,D=N.keyLength;return B?i.openCursor(M(E)).then(function(q){return q&&C(q)}):i.openCursor(E);function C(q){return Object.create(q,{continue:{value:function(z){z!=null?q.continue(fn(z,E.reverse?e.MAX_KEY:e.MIN_KEY,O)):E.unique?q.continue(q.key.slice(0,D).concat(E.reverse?e.MIN_KEY:e.MAX_KEY,O)):q.continue()}},continuePrimaryKey:{value:function(z,W){q.continuePrimaryKey(fn(z,e.MAX_KEY,O),W)}},primaryKey:{get:function(){return q.primaryKey}},key:{get:function(){var z=q.key;return D===1?z[0]:z.slice(0,D)}},value:{get:function(){return q.value}}})}}})}})}};function Ha(e,r,i,u){return i=i||{},u=u||"",_(e).forEach(function(c){var y,w,P;v(r,c)?(y=e[c],w=r[c],typeof y=="object"&&typeof w=="object"&&y&&w?(P=ge(y))!==ge(w)?i[u+c]=r[c]:P==="Object"?Ha(y,w,i,u+c+"."):y!==w&&(i[u+c]=r[c]):y!==w&&(i[u+c]=r[c])):i[u+c]=void 0}),_(r).forEach(function(c){v(e,c)||(i[u+c]=r[c])}),i}function Ga(e,r){return r.type==="delete"?r.keys:r.keys||r.values.map(e.extractKey)}var Il={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return n(n({},e),{table:function(r){var i=e.table(r),u=i.schema.primaryKey;return n(n({},i),{mutate:function(c){var y=ie.trans,w=y.table(r).hook,P=w.deleting,R=w.creating,I=w.updating;switch(c.type){case"add":if(R.fire===me)break;return y._promise("readwrite",function(){return M(c)},!0);case"put":if(R.fire===me&&I.fire===me)break;return y._promise("readwrite",function(){return M(c)},!0);case"delete":if(P.fire===me)break;return y._promise("readwrite",function(){return M(c)},!0);case"deleteRange":if(P.fire===me)break;return y._promise("readwrite",function(){return function E(N,O,B){return i.query({trans:N,values:!1,query:{index:u,range:O},limit:B}).then(function(D){var C=D.result;return M({type:"delete",keys:C,trans:N}).then(function(q){return 0<q.numFailures?Promise.reject(q.failures[0]):C.length<B?{failures:[],numFailures:0,lastResult:void 0}:E(N,n(n({},O),{lower:C[C.length-1],lowerOpen:!0}),B)})})}(c.trans,c.range,1e4)},!0)}return i.mutate(c);function M(E){var N,O,B,D=ie.trans,C=E.keys||Ga(u,E);if(!C)throw new Error("Keys missing");return(E=E.type==="add"||E.type==="put"?n(n({},E),{keys:C}):n({},E)).type!=="delete"&&(E.values=s([],E.values)),E.keys&&(E.keys=s([],E.keys)),N=i,B=C,((O=E).type==="add"?Promise.resolve([]):N.getMany({trans:O.trans,keys:B,cache:"immutable"})).then(function(q){var z=C.map(function(W,J){var ne,ce,ae,oe=q[J],de={onerror:null,onsuccess:null};return E.type==="delete"?P.fire.call(de,W,oe,D):E.type==="add"||oe===void 0?(ne=R.fire.call(de,W,E.values[J],D),W==null&&ne!=null&&(E.keys[J]=W=ne,u.outbound||k(E.values[J],u.keyPath,W))):(ne=Ha(oe,E.values[J]),(ce=I.fire.call(de,ne,W,oe,D))&&(ae=E.values[J],Object.keys(ce).forEach(function(ue){v(ae,ue)?ae[ue]=ce[ue]:k(ae,ue,ce[ue])}))),de});return i.mutate(E).then(function(W){for(var J=W.failures,ne=W.results,ce=W.numFailures,W=W.lastResult,ae=0;ae<C.length;++ae){var oe=(ne||C)[ae],de=z[ae];oe==null?de.onerror&&de.onerror(J[ae]):de.onsuccess&&de.onsuccess(E.type==="put"&&q[ae]?E.values[ae]:oe)}return{failures:J,results:ne,numFailures:ce,lastResult:W}}).catch(function(W){return z.forEach(function(J){return J.onerror&&J.onerror(W)}),Promise.reject(W)})})}}})}})}};function Vo(e,r,i){try{if(!r||r.keys.length<e.length)return null;for(var u=[],c=0,y=0;c<r.keys.length&&y<e.length;++c)Me(r.keys[c],e[y])===0&&(u.push(i?_e(r.values[c]):r.values[c]),++y);return u.length===e.length?u:null}catch{return null}}var Cl={stack:"dbcore",level:-1,create:function(e){return{table:function(r){var i=e.table(r);return n(n({},i),{getMany:function(u){if(!u.cache)return i.getMany(u);var c=Vo(u.keys,u.trans._cache,u.cache==="clone");return c?le.resolve(c):i.getMany(u).then(function(y){return u.trans._cache={keys:u.keys,values:u.cache==="clone"?_e(y):y},y})},mutate:function(u){return u.type!=="add"&&(u.trans._cache=null),i.mutate(u)}})}}}};function zo(e,r){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!r.schema.primaryKey.outbound}function Wo(e,r){switch(e){case"query":return r.values&&!r.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Tl={stack:"dbcore",level:0,name:"Observability",create:function(e){var r=e.schema.name,i=new Ye(e.MIN_KEY,e.MAX_KEY);return n(n({},e),{transaction:function(u,c,y){if(ie.subscr&&c!=="readonly")throw new Y.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ie.querier));return e.transaction(u,c,y)},table:function(u){var c=e.table(u),y=c.schema,w=y.primaryKey,E=y.indexes,P=w.extractKey,R=w.outbound,I=w.autoIncrement&&E.filter(function(O){return O.compound&&O.keyPath.includes(w.keyPath)}),M=n(n({},c),{mutate:function(O){function B(ue){return ue="idb://".concat(r,"/").concat(u,"/").concat(ue),W[ue]||(W[ue]=new Ye)}var D,C,q,z=O.trans,W=O.mutatedParts||(O.mutatedParts={}),J=B(""),ne=B(":dels"),ce=O.type,de=O.type==="deleteRange"?[O.range]:O.type==="delete"?[O.keys]:O.values.length<50?[Ga(w,O).filter(function(ue){return ue}),O.values]:[],ae=de[0],oe=de[1],de=O.trans._cache;return A(ae)?(J.addKeys(ae),(de=ce==="delete"||ae.length===oe.length?Vo(ae,de):null)||ne.addKeys(ae),(de||oe)&&(D=B,C=de,q=oe,y.indexes.forEach(function(ue){var he=D(ue.name||"");function Ie(Be){return Be!=null?ue.extractKey(Be):null}function Te(Be){return ue.multiEntry&&A(Be)?Be.forEach(function(ut){return he.addKey(ut)}):he.addKey(Be)}(C||q).forEach(function(Be,Xe){var ke=C&&Ie(C[Xe]),Xe=q&&Ie(q[Xe]);Me(ke,Xe)!==0&&(ke!=null&&Te(ke),Xe!=null&&Te(Xe))})}))):ae?(oe={from:(oe=ae.lower)!==null&&oe!==void 0?oe:e.MIN_KEY,to:(oe=ae.upper)!==null&&oe!==void 0?oe:e.MAX_KEY},ne.add(oe),J.add(oe)):(J.add(i),ne.add(i),y.indexes.forEach(function(ue){return B(ue.name).add(i)})),c.mutate(O).then(function(ue){return!ae||O.type!=="add"&&O.type!=="put"||(J.addKeys(ue.results),I&&I.forEach(function(he){for(var Ie=O.values.map(function(ke){return he.extractKey(ke)}),Te=he.keyPath.findIndex(function(ke){return ke===w.keyPath}),Be=0,ut=ue.results.length;Be<ut;++Be)Ie[Be][Te]=ue.results[Be];B(he.name).addKeys(Ie)})),z.mutatedParts=ln(z.mutatedParts||{},W),ue})}}),E=function(B){var D=B.query,B=D.index,D=D.range;return[B,new Ye((B=D.lower)!==null&&B!==void 0?B:e.MIN_KEY,(D=D.upper)!==null&&D!==void 0?D:e.MAX_KEY)]},N={get:function(O){return[w,new Ye(O.key)]},getMany:function(O){return[w,new Ye().addKeys(O.keys)]},count:E,query:E,openCursor:E};return _(N).forEach(function(O){M[O]=function(B){var D=ie.subscr,C=!!D,q=zo(ie,c)&&Wo(O,B)?B.obsSet={}:D;if(C){var z=function(oe){return oe="idb://".concat(r,"/").concat(u,"/").concat(oe),q[oe]||(q[oe]=new Ye)},W=z(""),J=z(":dels"),D=N[O](B),C=D[0],D=D[1];if((O==="query"&&C.isPrimaryKey&&!B.values?J:z(C.name||"")).add(D),!C.isPrimaryKey){if(O!=="count"){var ne=O==="query"&&R&&B.values&&c.query(n(n({},B),{values:!1}));return c[O].apply(this,arguments).then(function(oe){if(O==="query"){if(R&&B.values)return ne.then(function(Ie){return Ie=Ie.result,W.addKeys(Ie),oe});var de=B.values?oe.result.map(P):oe.result;(B.values?W:J).addKeys(de)}else if(O==="openCursor"){var ue=oe,he=B.values;return ue&&Object.create(ue,{key:{get:function(){return J.addKey(ue.primaryKey),ue.key}},primaryKey:{get:function(){var Ie=ue.primaryKey;return J.addKey(Ie),Ie}},value:{get:function(){return he&&W.addKey(ue.primaryKey),ue.value}}})}return oe})}J.add(i)}}return c[O].apply(this,arguments)}}),M}})}};function Ho(e,r,i){if(i.numFailures===0)return r;if(r.type==="deleteRange")return null;var u=r.keys?r.keys.length:"values"in r&&r.values?r.values.length:1;return i.numFailures===u?null:(r=n({},r),A(r.keys)&&(r.keys=r.keys.filter(function(c,y){return!(y in i.failures)})),"values"in r&&A(r.values)&&(r.values=r.values.filter(function(c,y){return!(y in i.failures)})),r)}function Za(e,r){return i=e,((u=r).lower===void 0||(u.lowerOpen?0<Me(i,u.lower):0<=Me(i,u.lower)))&&(e=e,(r=r).upper===void 0||(r.upperOpen?Me(e,r.upper)<0:Me(e,r.upper)<=0));var i,u}function Go(e,r,N,u,c,y){if(!N||N.length===0)return e;var w=r.query.index,P=w.multiEntry,R=r.query.range,I=u.schema.primaryKey.extractKey,M=w.extractKey,E=(w.lowLevelIndex||w).extractKey,N=N.reduce(function(O,B){var D=O,C=[];if(B.type==="add"||B.type==="put")for(var q=new Ye,z=B.values.length-1;0<=z;--z){var W,J=B.values[z],ne=I(J);q.hasKey(ne)||(W=M(J),(P&&A(W)?W.some(function(ue){return Za(ue,R)}):Za(W,R))&&(q.addKey(ne),C.push(J)))}switch(B.type){case"add":var ce=new Ye().addKeys(r.values?O.map(function(he){return I(he)}):O),D=O.concat(r.values?C.filter(function(he){return he=I(he),!ce.hasKey(he)&&(ce.addKey(he),!0)}):C.map(function(he){return I(he)}).filter(function(he){return!ce.hasKey(he)&&(ce.addKey(he),!0)}));break;case"put":var ae=new Ye().addKeys(B.values.map(function(he){return I(he)}));D=O.filter(function(he){return!ae.hasKey(r.values?I(he):he)}).concat(r.values?C:C.map(function(he){return I(he)}));break;case"delete":var oe=new Ye().addKeys(B.keys);D=O.filter(function(he){return!oe.hasKey(r.values?I(he):he)});break;case"deleteRange":var de=B.range;D=O.filter(function(he){return!Za(I(he),de)})}return D},e);return N===e?e:(N.sort(function(O,B){return Me(E(O),E(B))||Me(I(O),I(B))}),r.limit&&r.limit<1/0&&(N.length>r.limit?N.length=r.limit:e.length===r.limit&&N.length<r.limit&&(c.dirty=!0)),y?Object.freeze(N):N)}function Zo(e,r){return Me(e.lower,r.lower)===0&&Me(e.upper,r.upper)===0&&!!e.lowerOpen==!!r.lowerOpen&&!!e.upperOpen==!!r.upperOpen}function Bl(e,r){return function(i,u,c,y){if(i===void 0)return u!==void 0?-1:0;if(u===void 0)return 1;if((u=Me(i,u))===0){if(c&&y)return 0;if(c)return 1;if(y)return-1}return u}(e.lower,r.lower,e.lowerOpen,r.lowerOpen)<=0&&0<=function(i,u,c,y){if(i===void 0)return u!==void 0?1:0;if(u===void 0)return-1;if((u=Me(i,u))===0){if(c&&y)return 0;if(c)return-1;if(y)return 1}return u}(e.upper,r.upper,e.upperOpen,r.upperOpen)}function Ml(e,r,i,u){e.subscribers.add(i),u.addEventListener("abort",function(){var c,y;e.subscribers.delete(i),e.subscribers.size===0&&(c=e,y=r,setTimeout(function(){c.subscribers.size===0&&H(y,c)},3e3))})}var Dl={stack:"dbcore",level:0,name:"Cache",create:function(e){var r=e.schema.name;return n(n({},e),{transaction:function(i,u,c){var y,w,P=e.transaction(i,u,c);return u==="readwrite"&&(w=(y=new AbortController).signal,c=function(R){return function(){if(y.abort(),u==="readwrite"){for(var I=new Set,M=0,E=i;M<E.length;M++){var N=E[M],O=er["idb://".concat(r,"/").concat(N)];if(O){var B=e.table(N),D=O.optimisticOps.filter(function(he){return he.trans===P});if(P._explicit&&R&&P.mutatedParts)for(var C=0,q=Object.values(O.queries.query);C<q.length;C++)for(var z=0,W=(ce=q[C]).slice();z<W.length;z++)Ka((ae=W[z]).obsSet,P.mutatedParts)&&(H(ce,ae),ae.subscribers.forEach(function(he){return I.add(he)}));else if(0<D.length){O.optimisticOps=O.optimisticOps.filter(function(he){return he.trans!==P});for(var J=0,ne=Object.values(O.queries.query);J<ne.length;J++)for(var ce,ae,oe,de=0,ue=(ce=ne[J]).slice();de<ue.length;de++)(ae=ue[de]).res!=null&&P.mutatedParts&&(R&&!ae.dirty?(oe=Object.isFrozen(ae.res),oe=Go(ae.res,ae.req,D,B,ae,oe),ae.dirty?(H(ce,ae),ae.subscribers.forEach(function(he){return I.add(he)})):oe!==ae.res&&(ae.res=oe,ae.promise=le.resolve({result:oe}))):(ae.dirty&&H(ce,ae),ae.subscribers.forEach(function(he){return I.add(he)})))}}}I.forEach(function(he){return he()})}}},P.addEventListener("abort",c(!1),{signal:w}),P.addEventListener("error",c(!1),{signal:w}),P.addEventListener("complete",c(!0),{signal:w})),P},table:function(i){var u=e.table(i),c=u.schema.primaryKey;return n(n({},u),{mutate:function(y){var w=ie.trans;if(c.outbound||w.db._options.cache==="disabled"||w.explicit||w.idbtrans.mode!=="readwrite")return u.mutate(y);var P=er["idb://".concat(r,"/").concat(i)];return P?(w=u.mutate(y),y.type!=="add"&&y.type!=="put"||!(50<=y.values.length||Ga(c,y).some(function(R){return R==null}))?(P.optimisticOps.push(y),y.mutatedParts&&cn(y.mutatedParts),w.then(function(R){0<R.numFailures&&(H(P.optimisticOps,y),(R=Ho(0,y,R))&&P.optimisticOps.push(R),y.mutatedParts&&cn(y.mutatedParts))}),w.catch(function(){H(P.optimisticOps,y),y.mutatedParts&&cn(y.mutatedParts)})):w.then(function(R){var I=Ho(0,n(n({},y),{values:y.values.map(function(M,E){var N;return R.failures[E]?M:(M=(N=c.keyPath)!==null&&N!==void 0&&N.includes(".")?_e(M):n({},M),k(M,c.keyPath,R.results[E]),M)})}),R);P.optimisticOps.push(I),queueMicrotask(function(){return y.mutatedParts&&cn(y.mutatedParts)})}),w):u.mutate(y)},query:function(y){if(!zo(ie,u)||!Wo("query",y))return u.query(y);var w=((I=ie.trans)===null||I===void 0?void 0:I.db._options.cache)==="immutable",E=ie,P=E.requery,R=E.signal,I=function(B,D,C,q){var z=er["idb://".concat(B,"/").concat(D)];if(!z)return[];if(!(D=z.queries[C]))return[null,!1,z,null];var W=D[(q.query?q.query.index.name:null)||""];if(!W)return[null,!1,z,null];switch(C){case"query":var J=W.find(function(ne){return ne.req.limit===q.limit&&ne.req.values===q.values&&Zo(ne.req.query.range,q.query.range)});return J?[J,!0,z,W]:[W.find(function(ne){return("limit"in ne.req?ne.req.limit:1/0)>=q.limit&&(!q.values||ne.req.values)&&Bl(ne.req.query.range,q.query.range)}),!1,z,W];case"count":return J=W.find(function(ne){return Zo(ne.req.query.range,q.query.range)}),[J,!!J,z,W]}}(r,i,"query",y),M=I[0],E=I[1],N=I[2],O=I[3];return M&&E?M.obsSet=y.obsSet:(E=u.query(y).then(function(B){var D=B.result;if(M&&(M.res=D),w){for(var C=0,q=D.length;C<q;++C)Object.freeze(D[C]);Object.freeze(D)}else B.result=_e(D);return B}).catch(function(B){return O&&M&&H(O,M),Promise.reject(B)}),M={obsSet:y.obsSet,promise:E,subscribers:new Set,type:"query",req:y,dirty:!1},O?O.push(M):(O=[M],(N=N||(er["idb://".concat(r,"/").concat(i)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[y.query.index.name||""]=O)),Ml(M,O,P,R),M.promise.then(function(B){return{result:Go(B.result,y,N==null?void 0:N.optimisticOps,u,M,w)}})}})}})}};function dn(e,r){return new Proxy(e,{get:function(i,u,c){return u==="db"?r:Reflect.get(i,u,c)}})}var Ot=(ze.prototype.version=function(e){if(isNaN(e)||e<.1)throw new Y.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Y.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var r=this._versions,i=r.filter(function(u){return u._cfg.version===e})[0];return i||(i=new this.Version(e),r.push(i),r.sort(xl),i.stores({}),this._state.autoSchema=!1,i)},ze.prototype._whenReady=function(e){var r=this;return this.idbdb&&(this._state.openComplete||ie.letThrough||this._vip)?e():new le(function(i,u){if(r._state.openComplete)return u(new Y.DatabaseClosed(r._state.dbOpenError));if(!r._state.isBeingOpened){if(!r._state.autoOpen)return void u(new Y.DatabaseClosed);r.open().catch(me)}r._state.dbReadyPromise.then(i,u)}).then(e)},ze.prototype.use=function(e){var r=e.stack,i=e.create,u=e.level,c=e.name;return c&&this.unuse({stack:r,name:c}),e=this._middlewares[r]||(this._middlewares[r]=[]),e.push({stack:r,create:i,level:u??10,name:c}),e.sort(function(y,w){return y.level-w.level}),this},ze.prototype.unuse=function(e){var r=e.stack,i=e.name,u=e.create;return r&&this._middlewares[r]&&(this._middlewares[r]=this._middlewares[r].filter(function(c){return u?c.create!==u:!!i&&c.name!==i})),this},ze.prototype.open=function(){var e=this;return Qt(Ce,function(){return Rl(e)})},ze.prototype._close=function(){var e=this._state,r=sr.indexOf(this);if(0<=r&&sr.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new le(function(i){e.dbReadyResolve=i}),e.openCanceller=new le(function(i,u){e.cancelOpen=u}))},ze.prototype.close=function(i){var r=(i===void 0?{disableAutoOpen:!0}:i).disableAutoOpen,i=this._state;r?(i.isBeingOpened&&i.cancelOpen(new Y.DatabaseClosed),this._close(),i.autoOpen=!1,i.dbOpenError=new Y.DatabaseClosed):(this._close(),i.autoOpen=this._options.autoOpen||i.isBeingOpened,i.openComplete=!1,i.dbOpenError=null)},ze.prototype.delete=function(e){var r=this;e===void 0&&(e={disableAutoOpen:!0});var i=0<arguments.length&&typeof arguments[0]!="object",u=this._state;return new le(function(c,y){function w(){r.close(e);var P=r._deps.indexedDB.deleteDatabase(r.name);P.onsuccess=Ue(function(){var R,I,M;R=r._deps,I=r.name,M=R.indexedDB,R=R.IDBKeyRange,Ua(M)||I===Jr||Na(M,R).delete(I).catch(me),c()}),P.onerror=At(y),P.onblocked=r._fireOnBlocked}if(i)throw new Y.InvalidArgument("Invalid closeOptions argument to db.delete()");u.isBeingOpened?u.dbReadyPromise.then(w):w()})},ze.prototype.backendDB=function(){return this.idbdb},ze.prototype.isOpen=function(){return this.idbdb!==null},ze.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},ze.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ze.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ze.prototype,"tables",{get:function(){var e=this;return _(this._allTables).map(function(r){return e._allTables[r]})},enumerable:!1,configurable:!0}),ze.prototype.transaction=function(){var e=(function(r,i,u){var c=arguments.length;if(c<2)throw new Y.InvalidArgument("Too few arguments");for(var y=new Array(c-1);--c;)y[c-1]=arguments[c];return u=y.pop(),[r,ye(y),u]}).apply(this,arguments);return this._transaction.apply(this,e)},ze.prototype._transaction=function(e,r,i){var u=this,c=ie.trans;c&&c.db===this&&e.indexOf("!")===-1||(c=null);var y,w,P=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(w=r.map(function(I){if(I=I instanceof u.Table?I.name:I,typeof I!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return I}),e=="r"||e===Ea)y=Ea;else{if(e!="rw"&&e!=Fa)throw new Y.InvalidArgument("Invalid transaction mode: "+e);y=Fa}if(c){if(c.mode===Ea&&y===Fa){if(!P)throw new Y.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");c=null}c&&w.forEach(function(I){if(c&&c.storeNames.indexOf(I)===-1){if(!P)throw new Y.SubTransaction("Table "+I+" not included in parent transaction.");c=null}}),P&&c&&!c.active&&(c=null)}}catch(I){return c?c._promise(null,function(M,E){E(I)}):Ve(I)}var R=(function I(M,E,N,O,B){return le.resolve().then(function(){var D=ie.transless||ie,C=M._createTransaction(E,N,M._dbSchema,O);if(C.explicit=!0,D={trans:C,transless:D},O)C.idbtrans=O.idbtrans;else try{C.create(),C.idbtrans._explicit=!0,M._state.PR1398_maxLoop=3}catch(W){return W.name===Pe.InvalidState&&M.isOpen()&&0<--M._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),M.close({disableAutoOpen:!1}),M.open().then(function(){return I(M,E,N,null,B)})):Ve(W)}var q,z=Q(B);return z&&Bt(),D=le.follow(function(){var W;(q=B.call(C,C))&&(z?(W=dt.bind(null,null),q.then(W,W)):typeof q.next=="function"&&typeof q.throw=="function"&&(q=Wa(q)))},D),(q&&typeof q.then=="function"?le.resolve(q).then(function(W){return C.active?W:Ve(new Y.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):D.then(function(){return q})).then(function(W){return O&&C._resolve(),C._completion.then(function(){return W})}).catch(function(W){return C._reject(W),Ve(W)})})}).bind(null,this,y,w,c,i);return c?c._promise(y,R,"lock"):ie.trans?Qt(ie.transless,function(){return u._whenReady(R)}):this._whenReady(R)},ze.prototype.table=function(e){if(!v(this._allTables,e))throw new Y.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},ze);function ze(e,r){var i=this;this._middlewares={},this.verno=0;var u=ze.dependencies;this._options=r=n({addons:ze.addons,autoOpen:!0,indexedDB:u.indexedDB,IDBKeyRange:u.IDBKeyRange,cache:"cloned"},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange},u=r.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var c,y,w,P,R,I={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:me,dbReadyPromise:null,cancelOpen:me,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:r.autoOpen};I.dbReadyPromise=new le(function(E){I.dbReadyResolve=E}),I.openCanceller=new le(function(E,N){I.cancelOpen=N}),this._state=I,this.name=e,this.on=br(this,"populate","blocked","versionchange","close",{ready:[yr,me]}),this.on.ready.subscribe=F(this.on.ready.subscribe,function(E){return function(N,O){ze.vip(function(){var B,D=i._state;D.openComplete?(D.dbOpenError||le.resolve().then(N),O&&E(N)):D.onReadyBeingFired?(D.onReadyBeingFired.push(N),O&&E(N)):(E(N),B=i,O||E(function C(){B.on.ready.unsubscribe(N),B.on.ready.unsubscribe(C)}))})}}),this.Collection=(c=this,wr(vl.prototype,function(q,C){this.db=c;var O=Eo,B=null;if(C)try{O=C()}catch(z){B=z}var D=q._ctx,C=D.table,q=C.hook.reading.fire;this._ctx={table:C,index:D.index,isPrimKey:!D.index||C.schema.primKey.keyPath&&D.index===C.schema.primKey.name,range:O,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:B,or:D.or,valueMapper:q!==Ke?q:null}})),this.Table=(y=this,wr(Oo.prototype,function(E,N,O){this.db=y,this._tx=O,this.name=E,this.schema=N,this.hook=y._allTables[E]?y._allTables[E].hook:br(null,{creating:[ht,me],reading:[Ne,Ke],updating:[pr,me],deleting:[xt,me]})})),this.Transaction=(w=this,wr(_l.prototype,function(E,N,O,B,D){var C=this;this.db=w,this.mode=E,this.storeNames=N,this.schema=O,this.chromeTransactionDurability=B,this.idbtrans=null,this.on=br(this,"complete","error","abort"),this.parent=D||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new le(function(q,z){C._resolve=q,C._reject=z}),this._completion.then(function(){C.active=!1,C.on.complete.fire()},function(q){var z=C.active;return C.active=!1,C.on.error.fire(q),C.parent?C.parent._reject(q):z&&C.idbtrans&&C.idbtrans.abort(),Ve(q)})})),this.Version=(P=this,wr(kl.prototype,function(E){this.db=P,this._cfg={version:E,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(R=this,wr(Mo.prototype,function(E,N,O){if(this.db=R,this._ctx={table:E,index:N===":id"?null:N,or:O},this._cmp=this._ascending=Me,this._descending=function(B,D){return Me(D,B)},this._max=function(B,D){return 0<Me(B,D)?B:D},this._min=function(B,D){return Me(B,D)<0?B:D},this._IDBKeyRange=R._deps.IDBKeyRange,!this._IDBKeyRange)throw new Y.MissingAPI})),this.on("versionchange",function(E){0<E.newVersion?console.warn("Another connection wants to upgrade database '".concat(i.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(i.name,"'. Closing db now to resume the delete request.")),i.close({disableAutoOpen:!1})}),this.on("blocked",function(E){!E.newVersion||E.newVersion<E.oldVersion?console.warn("Dexie.delete('".concat(i.name,"') was blocked")):console.warn("Upgrade '".concat(i.name,"' blocked by other connection holding version ").concat(E.oldVersion/10))}),this._maxKey=Pr(r.IDBKeyRange),this._createTransaction=function(E,N,O,B){return new i.Transaction(E,N,O,i._options.chromeTransactionDurability,B)},this._fireOnBlocked=function(E){i.on("blocked").fire(E),sr.filter(function(N){return N.name===i.name&&N!==i&&!N._state.vcFired}).map(function(N){return N.on("versionchange").fire(E)})},this.use(Cl),this.use(Dl),this.use(Tl),this.use(Ol),this.use(Il);var M=new Proxy(this,{get:function(E,N,O){if(N==="_vip")return!0;if(N==="table")return function(D){return dn(i.table(D),M)};var B=Reflect.get(E,N,O);return B instanceof Oo?dn(B,M):N==="tables"?B.map(function(D){return dn(D,M)}):N==="_createTransaction"?function(){return dn(B.apply(this,arguments),M)}:B}});this.vip=M,u.forEach(function(E){return E(i)})}var pn,pt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",jl=(Ja.prototype.subscribe=function(e,r,i){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:r,complete:i})},Ja.prototype[pt]=function(){return this},Ja);function Ja(e){this._subscribe=e}try{pn={indexedDB:f.indexedDB||f.mozIndexedDB||f.webkitIndexedDB||f.msIndexedDB,IDBKeyRange:f.IDBKeyRange||f.webkitIDBKeyRange}}catch{pn={indexedDB:null,IDBKeyRange:null}}function Jo(e){var r,i=!1,u=new jl(function(c){var y=Q(e),w,P=!1,R={},I={},M={get closed(){return P},unsubscribe:function(){P||(P=!0,w&&w.abort(),E&&Dt.storagemutated.unsubscribe(O))}};c.start&&c.start(M);var E=!1,N=function(){return xa(B)},O=function(D){ln(R,D),Ka(I,R)&&N()},B=function(){var D,C,q;!P&&pn.indexedDB&&(R={},D={},w&&w.abort(),w=new AbortController,q=function(z){var W=Ft();try{y&&Bt();var J=vt(e,z);return J=y?J.finally(dt):J}finally{W&&ft()}}(C={subscr:D,signal:w.signal,requery:N,querier:e,trans:null}),Promise.resolve(q).then(function(z){i=!0,r=z,P||C.signal.aborted||(R={},function(W){for(var J in W)if(v(W,J))return;return 1}(I=D)||E||(Dt(Sr,O),E=!0),xa(function(){return!P&&c.next&&c.next(z)}))},function(z){i=!1,["DatabaseClosedError","AbortError"].includes(z==null?void 0:z.name)||P||xa(function(){P||c.error&&c.error(z)})}))};return setTimeout(N,0),M});return u.hasValue=function(){return i},u.getValue=function(){return r},u}var tr=Ot;function Qa(e){var r=jt;try{jt=!0,Dt.storagemutated.fire(e),za(e,!0)}finally{jt=r}}d(tr,n(n({},xe),{delete:function(e){return new tr(e,{addons:[]}).delete()},exists:function(e){return new tr(e,{addons:[]}).open().then(function(r){return r.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return r=tr.dependencies,i=r.indexedDB,r=r.IDBKeyRange,(Ua(i)?Promise.resolve(i.databases()).then(function(u){return u.map(function(c){return c.name}).filter(function(c){return c!==Jr})}):Na(i,r).toCollection().primaryKeys()).then(e)}catch{return Ve(new Y.MissingAPI)}var r,i},defineClass:function(){return function(e){T(this,e)}},ignoreTransaction:function(e){return ie.trans?Qt(ie.transless,e):e()},vip:$a,async:function(e){return function(){try{var r=Wa(e.apply(this,arguments));return r&&typeof r.then=="function"?r:le.resolve(r)}catch(i){return Ve(i)}}},spawn:function(e,r,i){try{var u=Wa(e.apply(i,r||[]));return u&&typeof u.then=="function"?u:le.resolve(u)}catch(c){return Ve(c)}},currentTransaction:{get:function(){return ie.trans||null}},waitFor:function(e,r){return r=le.resolve(typeof e=="function"?tr.ignoreTransaction(e):e).timeout(r||6e4),ie.trans?ie.trans.waitFor(r):r},Promise:le,debug:{get:function(){return lt},set:function(e){Wr(e)}},derive:l,extend:T,props:d,override:F,Events:br,on:Dt,liveQuery:Jo,extendObservabilitySet:ln,getByKeyPath:K,setByKeyPath:k,delByKeyPath:function(e,r){typeof r=="string"?k(e,r,void 0):"length"in r&&[].map.call(r,function(i){k(e,i,void 0)})},shallowClone:pe,deepClone:_e,getObjectDiff:Ha,cmp:Me,asap:S,minKey:-1/0,addons:[],connections:sr,errnames:Pe,dependencies:pn,cache:er,semVer:"4.0.11",version:"4.0.11".split(".").map(function(e){return parseInt(e)}).reduce(function(e,r,i){return e+r/Math.pow(10,2*i)})})),tr.maxKey=Pr(tr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Dt(Sr,function(e){jt||(e=new CustomEvent(Ia,{detail:e}),jt=!0,dispatchEvent(e),jt=!1)}),addEventListener(Ia,function(e){e=e.detail,jt||Qa(e)}));var cr,jt=!1,Qo=function(){};return typeof BroadcastChannel<"u"&&((Qo=function(){(cr=new BroadcastChannel(Ia)).onmessage=function(e){return e.data&&Qa(e.data)}})(),typeof cr.unref=="function"&&cr.unref(),Dt(Sr,function(e){jt||cr.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Ot.disableBfCache&&e.persisted){lt&&console.debug("Dexie: handling persisted pagehide"),cr!=null&&cr.close();for(var r=0,i=sr;r<i.length;r++)i[r].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Ot.disableBfCache&&e.persisted&&(lt&&console.debug("Dexie: handling persisted pageshow"),Qo(),Qa({all:new Ye(-1/0,[[]])}))})),le.rejectionMapper=function(e,r){return!e||e instanceof ee||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Ee[e.name]?e:(r=new Ee[e.name](r||e.message,e),"stack"in e&&g(r,"stack",{get:function(){return this.inner.stack}}),r)},Wr(lt),n(Ot,Object.freeze({__proto__:null,Dexie:Ot,liveQuery:Jo,Entity:Fo,cmp:Me,PropModification:_r,replacePrefix:function(e,r){return new _r({replacePrefix:[e,r]})},add:function(e){return new _r({add:e})},remove:function(e){return new _r({remove:e})},default:Ot,RangeSet:Ye,mergeRanges:Fr,rangesOverlap:$o}),{default:Ot}),Ot})}(Lr)),Lr.exports}var Yu=Qu();const _a=ni(Yu),yo=Symbol.for("Dexie"),Vr=globalThis[yo]||(globalThis[yo]=_a);if(_a.semVer!==Vr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${_a.semVer} and ${Vr.semVer}`);const{liveQuery:Xu,mergeRanges:zl,rangesOverlap:Wl,RangeSet:Hl,cmp:Gl,Entity:Zl,PropModification:Jl,replacePrefix:Ql,add:Yl,remove:Xl}=Vr;class el extends Vr{constructor(){super("CopyHistoryDatabase");G(this,"copyHistoryItems");this.version(1).stores({copyHistoryItems:"++index,id,timestamp"}),this.version(2).stores({copyHistoryItems:"++index,id,timestamp"}).upgrade(a=>a.table("copyHistoryItems").toCollection().modify(n=>{const s={text:n.text,textImage:n.textImage,start:n.start,end:n.end,originalStart:n.originalStart,originalEnd:n.originalEnd,track:n.track};if(n.subtitle=s,delete n.text,delete n.textImage,delete n.start,delete n.end,delete n.originalStart,delete n.originalEnd,delete n.track,n.videoFileName||n.audioFileName){const f={name:n.videoFileName||n.audioFileName,blobUrl:"",playbackRate:n.filePlaybackRate,audioTrack:n.audioTrack};n.file=f,delete n.videoFileName,delete n.audioFileName,delete n.filePlaybackRate,delete n.audioTrack}}))}}class dr{constructor(t){G(this,"_db",new el);G(this,"_limit");this._limit=t}set limit(t){this._limit=t}async clear(){await this._db.copyHistoryItems.clear()}async fetch(t){if(t<=0)return[];const a=await await this._db.copyHistoryItems.reverse().limit(t).toArray();return a.reverse(),a}liveFetch(t,a){const s=Xu(()=>this.fetch(t)).subscribe(a);return()=>s.unsubscribe()}async save(t){if(this._limit<=0)return;const a={id:t.id,timestamp:t.timestamp,subtitle:t.subtitle,surroundingSubtitles:t.surroundingSubtitles,subtitleFileName:t.subtitleFileName,url:t.url,image:t.image,audio:t.audio,file:t.file,mediaTimestamp:t.mediaTimestamp},n=await this._db.copyHistoryItems.where("id").equals(t.id).primaryKeys();n.length>0&&(a.index=n[0]);const s=await this._db.copyHistoryItems.put(a);await this._prune(s)}async _prune(t){if(await this._db.copyHistoryItems.count()>this._limit){const n=await this._db.copyHistoryItems.where("index").belowOrEqual(t-this._limit).primaryKeys();n.length>0&&await this._db.copyHistoryItems.bulkDelete(n)}}async delete(t){const a=await this._db.copyHistoryItems.where("id").equals(t).primaryKeys();await this._db.copyHistoryItems.bulkDelete(a)}}class tl{constructor(t){G(this,"_settingsProvider");this._settingsProvider=t}async publish(t,a,n,s){const f=_n(),_=this._saveCardToRepository(f,t);if(!(n===void 0||s===void 0))try{a==tt.showAnkiDialog?this._showAnkiDialog(t,f,s,n):a==tt.updateLastCard?await this._updateLastCard(t,s,n):a===tt.exportCard?await this._exportCard(t,s,n):a===tt.none&&this._notifySaved(_,t,s,n)}catch(A){throw this._notifyError(A,s,n),A}}_notifySaved(t,a,n,s){t.then(f=>{if(f){const _={sender:"asbplayer-extension-to-video",message:{...a,command:"card-saved",cardName:a.subtitle.text||li(a.mediaTimestamp)},src:n};te.tabs.sendMessage(s,_)}})}async _exportCard(t,a,n){const s=await this._settingsProvider.get(An),f=await fo(t,s,"default"),_={sender:"asbplayer-extension-to-video",message:{...t,command:"card-exported",cardName:`${f}`},src:a};te.tabs.sendMessage(n,_)}async _updateLastCard(t,a,n){const s=await this._settingsProvider.get(An),f=await fo(t,s,"updateLast"),_={sender:"asbplayer-extension-to-video",message:{...t,command:"card-updated",cardName:`${f}`},src:a};te.tabs.sendMessage(n,_)}_showAnkiDialog(t,a,n,s){const f={sender:"asbplayer-extension-to-video",message:{...t,id:a,command:"show-anki-ui"},src:n};te.tabs.sendMessage(s,f)}async _saveCardToRepository(t,a){try{const n=await this._settingsProvider.getSingle("miningHistoryStorageLimit");return new dr(n).save({...a,id:a.id??t,timestamp:Date.now()}),!0}catch(n){return console.error(n),!1}}_notifyError(t,a,n){let s;t instanceof Error?s=t.message:typeof t=="string"?s=t:s=String(t);const f={sender:"asbplayer-extension-to-video",message:{command:"notify-error",message:s},src:a};te.tabs.sendMessage(n,f)}}class rl{constructor(t){G(this,"_tabRegistry");this._tabRegistry=t}get sender(){return"asbplayer-video"}get command(){return"ack-message"}handle(t,a,n){const f={sender:"asbplayer-extension-to-player",message:t.message};return this._tabRegistry.publishCommandToAsbplayers({commandFactory:()=>f}),!1}}class nl{constructor(t){G(this,"_cardPublisher");this._cardPublisher=t}get sender(){return"asbplayerv2"}get command(){return"publish-card"}handle(t,a){const n=t.message;return this._cardPublisher.publish(n),!1}}class al{async _ensureOffscreenDocument(){(await te.runtime.getContexts({contextTypes:[te.runtime.ContextType.OFFSCREEN_DOCUMENT]})).length===0&&await te.offscreen.createDocument({url:"offscreen-audio-recorder.html",reasons:[te.offscreen.Reason.USER_MEDIA],justification:"Audio recording"})}_mediaStreamId(t){return new Promise((a,n)=>{te.tabCapture.getMediaStreamId({targetTabId:t},s=>a(s))})}async startWithTimeout(t,a,n,{tabId:s,src:f}){await this._ensureOffscreenDocument();const _=await this._mediaStreamId(s),A={sender:"asbplayer-extension-to-offscreen-document",message:{command:"start-recording-audio-with-timeout",timeout:t,encodeAsMp3:a,streamId:_,requestId:n}};return await te.runtime.sendMessage(A)}async start(t,{tabId:a,src:n}){await this._ensureOffscreenDocument();const f={sender:"asbplayer-extension-to-offscreen-document",message:{command:"start-recording-audio",streamId:await this._mediaStreamId(a),requestId:t}};return await te.runtime.sendMessage(f)}async stop(t){const a={sender:"asbplayer-extension-to-offscreen-document",message:{command:"stop-recording-audio",encodeAsMp3:t}};return await te.runtime.sendMessage(a)}}class il{get sender(){return"asbplayer-mobile-overlay-to-video"}get command(){return"request-mobile-overlay-model"}handle(t,a,n){var s;if(((s=a.tab)==null?void 0:s.id)!==void 0)return te.tabs.sendMessage(a.tab.id,t).then(f=>n(f)),!0}}class ol{get sender(){return"asbplayer-mobile-overlay"}get command(){return"current-tab"}handle(t,a,n){var s;return n((s=a.tab)==null?void 0:s.id),!1}}class sl{get sender(){return"asbplayer-video"}get command(){return"update-mobile-overlay-model"}async handle(t,a){var n;((n=a.tab)==null?void 0:n.id)!==void 0&&te.tabs.sendMessage(a.tab.id,{...t,sender:"asbplayer-video-to-mobile-overlay"})}}const Aa=navigator.userAgent.toLowerCase().includes("android")??((So=navigator.userAgentData)==null?void 0:So.mobile)??!1,ul="shouldShowUpdateAlert",ho="lastUpdateAlertVersion",ll=async()=>{const o=await te.storage.local.get(ho);(o&&o[ho])!==te.runtime.getManifest().version&&await te.storage.local.set({[ul]:!0})};class cl{get sender(){return"asbplayerv2"}get command(){return"request-subtitles"}handle(t,a,n){const{tabId:s,src:f}=t,_={sender:"asbplayer-extension-to-video",src:f,message:{command:"request-subtitles"}};return te.tabs.sendMessage(s,_).then(A=>{n(A)}),!0}}class fl{get sender(){return"asbplayer-mobile-overlay-to-video"}get command(){return null}handle(t,a,n){var s;if(((s=a.tab)==null?void 0:s.id)!==void 0)return te.tabs.sendMessage(a.tab.id,t),!1}}class dl{get sender(){return"asbplayerv2"}get command(){return"request-copy-history"}handle(t,a,n){const s=t.message;return new dr(s.count).fetch(s.count).then(f=>{n({copyHistoryItems:f})}),!0}}class pl{constructor(t){G(this,"_settings");this._settings=t}get sender(){return"asbplayerv2"}get command(){return"delete-copy-history"}handle(t,a,n){const s=t.message;return this._settings.getSingle("miningHistoryStorageLimit").then(f=>new dr(f)).then(f=>Promise.all(s.ids.map(_=>f.delete(_))).then(()=>{n({})})),!0}}class yl{constructor(t){G(this,"_settings");this._settings=t}get sender(){return"asbplayerv2"}get command(){return"clear-copy-history"}handle(t,a,n){return this._settings.getSingle("miningHistoryStorageLimit").then(s=>new dr(s)).then(s=>{s.clear().then(()=>{n({})})}),!0}}class hl{constructor(t){G(this,"_settings");this._settings=t}get sender(){return"asbplayerv2"}get command(){return"save-copy-history"}handle(t,a,n){const s=t.message;return this._settings.getSingle("miningHistoryStorageLimit").then(f=>new dr(f)).then(f=>Promise.all(s.copyHistoryItems.map(_=>f.save(_))).then(()=>{n({})})),!0}}const ml=Nt(()=>{var m,g;te.storage.session.setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"});const o=new Pn(new ya),t=async()=>{qr(await o.getSingle("language"))},a=async l=>{if(l.reason!==te.runtime.OnInstalledReason.INSTALL)return;const p=te.i18n.getUILanguage();(await bu()).includes(p)&&(await o.set({language:p}),qr(p)),Aa&&await o.set({streamingTakeScreenshot:!1,subtitleSize:18,subtitlePositionOffset:25,topSubtitlePositionOffset:25,subtitlesWidth:100}),te.tabs.create({url:te.runtime.getURL("/ftue-ui.html"),active:!0})},n=async l=>{l.reason===te.runtime.OnInstalledReason.UPDATE&&ll()};te.runtime.onInstalled.addListener(a),te.runtime.onInstalled.addListener(n),te.runtime.onStartup.addListener(t);const s=new Yo(o),f=new As(s,new al),_=new Xo(o),A=new tl(o),T=[new es(s),new Ss(f,_,A,o),new Ps(o,f,A),new xs(f,_,A,o),new Es(f,_,A,o),new Su(_,A),new Fs(o,s),new ks(s),new Is,new Bu(s),new ku,new Ou,new Cu(s),new Nu,new Mu(s),new Tu(s),new cl,new dl,new hl(o),new pl(o),new yl(o),new nl(A),new rl(s),new Pu(f),new sl,new Au(s,o),new Cs(s),new Ts,new Ms(s),new xu(s),new Iu(s,o),new Eu,new Fu,new Bs,new Ru,new il,new ol,new fl];te.runtime.onMessage.addListener((l,p,h)=>{for(const b of T)if((typeof b.sender=="string"&&b.sender===l.sender||typeof b.sender=="object"&&b.sender.includes(l.sender))&&(b.command===null||b.command===l.message.command)){if(b.handle(l,p,h)===!0)return!0;break}}),te.runtime.onInstalled.addListener(()=>{var l,p;(l=te.contextMenus)==null||l.create({id:"load-subtitles",title:te.i18n.getMessage("contextMenuLoadSubtitles"),contexts:["page","video"]}),(p=te.contextMenus)==null||p.create({id:"mine-subtitle",title:te.i18n.getMessage("contextMenuMineSubtitle"),contexts:["page","video"]})}),(m=te.contextMenus)==null||m.onClicked.addListener(l=>{if(l.menuItemId==="load-subtitles"){const p={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select"}};s.publishCommandToVideoElementTabs(h=>{if(l.pageUrl===h.url)return p})}else l.menuItemId==="mine-subtitle"&&s.publishCommandToVideoElements(p=>l.srcUrl!==void 0&&p.src!==l.srcUrl||l.srcUrl===void 0&&l.pageUrl!==p.tab.url?void 0:{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",postMineAction:tt.showAnkiDialog},src:p.src})}),(g=te.commands)==null||g.onCommand.addListener(l=>{te.tabs.query({active:!0,currentWindow:!0},p=>{const h=b=>{if(b.sidePanel)return!1;const F=b.tab;return!(F&&p.find(U=>U.id===F.id)===void 0)};switch(l){case"copy-subtitle":case"update-last-card":case"export-card":case"copy-subtitle-with-dialog":const b=j(l);s.publishCommandToVideoElements(F=>p.find(S=>S.id===F.tab.id)===void 0?void 0:{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",postMineAction:b},src:F.src}),s.publishCommandToAsbplayers({commandFactory:F=>h(F)?{sender:"asbplayer-extension-to-player",message:{command:"copy-subtitle",postMineAction:b},asbplayerId:F.id}:void 0});break;case"toggle-video-select":for(const F of p)if(typeof F.id<"u"){const U={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select"}};te.tabs.sendMessage(F.id,U)}break;case"take-screenshot":s.publishCommandToVideoElements(F=>p.find(S=>S.id===F.tab.id)===void 0?void 0:{sender:"asbplayer-extension-to-video",message:{command:"take-screenshot"},src:F.src}),s.publishCommandToAsbplayers({commandFactory:F=>h(F)?{sender:"asbplayer-extension-to-player",message:{command:"take-screenshot"},asbplayerId:F.id}:void 0});break;case"toggle-recording":s.publishCommandToVideoElements(F=>p.find(S=>S.id===F.tab.id)===void 0?void 0:{sender:"asbplayer-extension-to-video",message:{command:"toggle-recording"},src:F.src}),s.publishCommandToAsbplayers({commandFactory:F=>h(F)?{sender:"asbplayer-extension-to-player",message:{command:"toggle-recording"},asbplayerId:F.id}:void 0});break;default:throw new Error("Unknown command "+l)}})});function j(l){switch(l){case"copy-subtitle":return tt.none;case"copy-subtitle-with-dialog":return tt.showAnkiDialog;case"update-last-card":return tt.updateLastCard;case"export-card":return tt.exportCard;default:throw new Error("Cannot determine post mine action for unknown command "+l)}}const x=()=>{o.getSingle("webSocketClientEnabled").then(l=>{l?ma(o,s):ga()})};x(),s.onAsbplayerInstance(x),s.onSyncedElement(x);const v=te.action||te.browserAction,d=l=>{if(Aa){if(l.id!==void 0){const p={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select"}};te.tabs.sendMessage(l.id,p)}}else v.openPopup()};Aa||v.setPopup({popup:"popup-ui.html"}),v.onClicked.addListener(d)});function ec(){}function zr(o,...t){}const gl={debug:(...o)=>zr(console.debug,...o),log:(...o)=>zr(console.log,...o),warn:(...o)=>zr(console.warn,...o),error:(...o)=>zr(console.error,...o)};let Sa;try{Sa=ml.main(),Sa instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(o){throw gl.error("The background crashed on startup!"),o}return Sa}();
background;
