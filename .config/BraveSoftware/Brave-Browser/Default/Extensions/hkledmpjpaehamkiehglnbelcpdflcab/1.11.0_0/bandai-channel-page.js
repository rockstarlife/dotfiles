var bandaiChannelPage=function(){"use strict";function g(t){return t==null||typeof t=="function"?{main:t}:t}function y(t,e){const i=t.lastIndexOf(".");let r=e;if(i!==-1){r=t.substring(i+1);const n=r.indexOf("?");n!==-1&&(r=r.substring(0,n))}return r}function b(t,e=1e4){return new Promise(async(i,r)=>{t()&&i(!0);const n=Date.now();let o=!1;for(;!o&&Date.now()<n+e;)await new Promise(d=>{setTimeout(()=>{o=t(),d()},1e3)});i(o)})}const h=t=>`${t.language}:${t.label}:${t.url}`;function x({onJson:t,onRequest:e,waitForBasename:i},r){setTimeout(()=>{const n={};let o="",d=!1;if(t!==void 0){const c=JSON.parse;JSON.parse=function(){const a=c.apply(this,arguments);let l=!1,f=!1;return t==null||t(a,u=>{const m=window.location.pathname;typeof n[m]>"u"&&(n[m]=[]);const w=h(u);n[m].find(I=>I.id===w)===void 0&&(n[m].push({id:w,...u}),l=!0)},u=>{o=u,f=!0}),d&&(l||f)&&document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:{error:"",basename:o,subtitles:n[window.location.pathname]}})),a}}function s(){for(const c of Object.keys(n))c!==window.location.pathname&&delete n[c]}document.addEventListener("asbplayer-get-synced-data",async()=>{e==null||e(a=>{const l=window.location.pathname;typeof n[l]>"u"&&(n[l]=[]);const f=h(a);n[l].find(u=>u.id===f)===void 0&&n[l].push({id:f,...a})},a=>{o=a,d||document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:{error:"",basename:o,subtitles:void 0}}))});const c=()=>o!==""&&window.location.pathname in n;c()||await b(c,r),document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:{error:"",basename:o,subtitles:n[window.location.pathname]??[]}})),s(),d=!0},!1)},0)}const E=g(()=>{function t(){const e=document.getElementById("bch-series-title"),i=document.getElementById("bch-story-title");if(!(!e||!i)&&e.textContent&&!(!i.childNodes||i.childNodes.length===0))return`${e.textContent} ${i.childNodes[0].nodeValue}`}x({onJson:(e,i,r)=>{var o,d;let n;if(((o=e==null?void 0:e.bc)==null?void 0:o.text_tracks)instanceof Array){for(const s of e.bc.text_tracks)if(s.kind==="subtitles"&&s.mime_type==="text/webvtt"&&s.sources instanceof Array&&s.sources.length>0&&typeof s.sources[0].src=="string"&&typeof s.srclang=="string"){const c=typeof s.label=="string"?`${s.srclang} - ${s==null?void 0:s.label}`:s.srclang,a=s.sources[0].src.replace(/^http:\/\//,"https://");i({label:c,language:s.srclang.toLowerCase(),url:a,extension:y(a,"vtt")})}typeof e.bc.name=="string"&&(n=e.bc.name,r(e.bc.name))}n===void 0&&typeof((d=e==null?void 0:e.bch)==null?void 0:d.episode_title)=="string"&&(n=e.bch.episode_title,r(e.bch.episode_title))},onRequest:async(e,i)=>{await b(()=>{const n=t();return n?(i(n),!0):!1})||i(document.title)},waitForBasename:!0})});function $(){}function p(t,...e){}const C={debug:(...t)=>p(console.debug,...t),log:(...t)=>p(console.log,...t),warn:(...t)=>p(console.warn,...t),error:(...t)=>p(console.error,...t)};return(async()=>{try{return await E.main()}catch(t){throw C.error('The unlisted script "bandai-channel-page" crashed on startup!',t),t}})()}();
bandaiChannelPage;
