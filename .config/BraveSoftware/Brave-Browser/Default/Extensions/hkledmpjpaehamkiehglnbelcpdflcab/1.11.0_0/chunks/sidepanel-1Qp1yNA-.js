var ya=Object.defineProperty;var va=(s,e,n)=>e in s?ya(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var ce=(s,e,n)=>va(s,typeof e!="symbol"?e+"":e,n);import{g as Wi,b as Ut,c as xa}from"./index-BNzDLOmD.js";import{r as y,u as Br,j as v,s as fn,c as Nn,b as Fr,z as Hn,Q as Ro,t as qt,l as Gi,v as wa,ae as Sa,n as ft,d as or,m as bn,h as hn,R as Dn,F as Hi,G as rt,q as kt,I as dt,i as rr,P as On,aC as Ft,af as Ss,ac as fi,a as Yi,g as Ji,x as Fn,y as gt,$ as Es,_ as ks,J as tr,aD as Ea,o as ka,aE as Ta,V as Ca,Z as _a,a4 as Io,aF as Ts,aG as Ra,a5 as Ia,N as Pa,M as Aa,f as Na,aH as Oa,S as Ma,E as ja,e as La,T as Ba,C as Fa,k as $a}from"./Tooltip-CHkWPQyT.js";import{m as Ha,w as Da,S as Va,i as Po,M as qa,a as Ka,g as za,b as kr,n as Ua,o as Xa,e as Wa,p as Ga,d as Ya,f as Ja,h as Qa,q as Cs,C as Za,L as _s,D as el,I as Ao,A as No,l as Rs,k as tl}from"./TableContainer-CRv4wqnM.js";import{i as nl}from"./index-DGAt_zbA.js";import{P as rl,C as Oo,a as Di}from"./PlayArrow-C9tdK3Bw.js";import{T as il,S as sl,P as ol,a as al,b as ll,c as ul,N as Qi,F as cl}from"./TimeDisplay-DmNO05HN.js";import{u as Mo,b as dl,c as fl,a as Mr,B as $r}from"./index-BSUPl2ka.js";import{l as mn,m as Pn,P as Zi,L as Hr,n as An,k as hl,o as pl,S as gl}from"./Input-CyGuovd8.js";import{m as ml}from"./mp3-worker-factory-DcCHG1pn.js";import"./mp3-encoder-CoEoOaGq.js";function bl(s){return y.Children.toArray(s).filter(e=>y.isValidElement(e))}class yl{constructor(){ce(this,"lastStartedShowing");ce(this,"lastWillStopShowing");ce(this,"onStartedShowing");ce(this,"onWillStopShowing");ce(this,"onNextToShow")}willStopShowing(e){var n,r;e.end!==((n=this.lastWillStopShowing)==null?void 0:n.end)&&((r=this.onWillStopShowing)==null||r.call(this,e),this.lastWillStopShowing=e)}startedShowing(e){var n,r;e.start!==((n=this.lastStartedShowing)==null?void 0:n.start)&&((r=this.onStartedShowing)==null||r.call(this),this.lastStartedShowing=e)}clear(){this.lastStartedShowing=void 0,this.lastWillStopShowing=void 0}}const vl=s=>{const{absolute:e,children:n,classes:r,flexItem:a,light:u,orientation:d,textAlign:f,variant:h}=s;return Fr({root:["root",e&&"absolute",h,u&&"light",d==="vertical"&&"vertical",a&&"flexItem",n&&"withChildren",n&&d==="vertical"&&"withChildrenVertical",f==="right"&&d!=="vertical"&&"textAlignRight",f==="left"&&d!=="vertical"&&"textAlignLeft"],wrapper:["wrapper",d==="vertical"&&"wrapperVertical"]},Ha,r)},xl=fn("div",{name:"MuiDivider",slot:"Root",overridesResolver:(s,e)=>{const{ownerState:n}=s;return[e.root,n.absolute&&e.absolute,e[n.variant],n.light&&e.light,n.orientation==="vertical"&&e.vertical,n.flexItem&&e.flexItem,n.children&&e.withChildren,n.children&&n.orientation==="vertical"&&e.withChildrenVertical,n.textAlign==="right"&&n.orientation!=="vertical"&&e.textAlignRight,n.textAlign==="left"&&n.orientation!=="vertical"&&e.textAlignLeft]}})(Hn(({theme:s})=>({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(s.vars||s).palette.divider,borderBottomWidth:"thin",variants:[{props:{absolute:!0},style:{position:"absolute",bottom:0,left:0,width:"100%"}},{props:{light:!0},style:{borderColor:s.vars?`rgba(${s.vars.palette.dividerChannel} / 0.08)`:Ro(s.palette.divider,.08)}},{props:{variant:"inset"},style:{marginLeft:72}},{props:{variant:"middle",orientation:"horizontal"},style:{marginLeft:s.spacing(2),marginRight:s.spacing(2)}},{props:{variant:"middle",orientation:"vertical"},style:{marginTop:s.spacing(1),marginBottom:s.spacing(1)}},{props:{orientation:"vertical"},style:{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"}},{props:{flexItem:!0},style:{alignSelf:"stretch",height:"auto"}},{props:({ownerState:e})=>!!e.children,style:{display:"flex",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}},{props:({ownerState:e})=>e.children&&e.orientation!=="vertical",style:{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(s.vars||s).palette.divider}`,borderTopStyle:"inherit"}}},{props:({ownerState:e})=>e.orientation==="vertical"&&e.children,style:{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(s.vars||s).palette.divider}`,borderLeftStyle:"inherit"}}},{props:({ownerState:e})=>e.textAlign==="right"&&e.orientation!=="vertical",style:{"&::before":{width:"90%"},"&::after":{width:"10%"}}},{props:({ownerState:e})=>e.textAlign==="left"&&e.orientation!=="vertical",style:{"&::before":{width:"10%"},"&::after":{width:"90%"}}}]}))),wl=fn("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(s,e)=>{const{ownerState:n}=s;return[e.wrapper,n.orientation==="vertical"&&e.wrapperVertical]}})(Hn(({theme:s})=>({display:"inline-block",paddingLeft:`calc(${s.spacing(1)} * 1.2)`,paddingRight:`calc(${s.spacing(1)} * 1.2)`,whiteSpace:"nowrap",variants:[{props:{orientation:"vertical"},style:{paddingTop:`calc(${s.spacing(1)} * 1.2)`,paddingBottom:`calc(${s.spacing(1)} * 1.2)`}}]}))),Vi=y.forwardRef(function(e,n){const r=Br({props:e,name:"MuiDivider"}),{absolute:a=!1,children:u,className:d,orientation:f="horizontal",component:h=u||f==="vertical"?"div":"hr",flexItem:p=!1,light:m=!1,role:S=h!=="hr"?"separator":void 0,textAlign:b="center",variant:R="fullWidth",...C}=r,j={...r,absolute:a,component:h,flexItem:p,light:m,orientation:f,role:S,textAlign:b,variant:R},U=vl(j);return v.jsx(xl,{as:h,className:Nn(U.root,d),role:S,ref:n,ownerState:j,"aria-orientation":S==="separator"&&(h!=="hr"||f==="vertical")?f:void 0,...C,children:u?v.jsx(wl,{className:U.wrapper,ownerState:j,children:u}):null})});Vi&&(Vi.muiSkipListHighlight=!0);class Is{constructor(e,n){ce(this,"defaultKeyBinder");ce(this,"extension");ce(this,"copyHandlers",[]);ce(this,"ankiExportHandlers",[]);ce(this,"updateLastCardHandlers",[]);ce(this,"exportCardHandlers",[]);ce(this,"takeScreenshotHandlers",[]);ce(this,"toggleRecordingHandlers",[]);ce(this,"_unsubscribeExtension");if(this.defaultKeyBinder=e,this.extension=n,this.extension.installed){const r=a=>{let u;if(a.data.command==="copy-subtitle"){const d=a.data;switch(d.postMineAction){case qt.none:u=this.copyHandlers;break;case qt.showAnkiDialog:u=this.ankiExportHandlers;break;case qt.updateLastCard:u=this.updateLastCardHandlers;break;case qt.exportCard:u=this.exportCardHandlers;break;default:console.error("Unknown post mine action "+d.postMineAction)}}else a.data.command==="take-screenshot"?u=this.takeScreenshotHandlers:a.data.command==="toggle-recording"&&(u=this.toggleRecordingHandlers);if(u!==void 0)for(const d of u)d(new KeyboardEvent("mock"))};this._unsubscribeExtension=n.subscribe(r)}}bindCopy(e,n,r,a){if(this.extension.installed){const u=this.defaultKeyBinder.copyHandler(e,n,r);return this.copyHandlers.push(u),()=>{this._remove(u,this.copyHandlers)}}return this.defaultKeyBinder.bindCopy(e,n,r,a)}bindAnkiExport(e,n,r){if(this.extension.installed){const a=this.defaultKeyBinder.ankiExportHandler(e,n);return this.ankiExportHandlers.push(a),()=>{this._remove(a,this.ankiExportHandlers)}}return this.defaultKeyBinder.bindAnkiExport(e,n,r)}bindUpdateLastCard(e,n,r){if(this.extension.installed){const a=this.defaultKeyBinder.updateLastCardHandler(e,n);return this.updateLastCardHandlers.push(a),()=>{this._remove(a,this.updateLastCardHandlers)}}return this.defaultKeyBinder.bindUpdateLastCard(e,n,r)}bindExportCard(e,n,r){if(this.extension.installed){const a=this.defaultKeyBinder.exportCardHandler(e,n);return this.exportCardHandlers.push(a),()=>{this._remove(a,this.exportCardHandlers)}}return this.defaultKeyBinder.bindExportCard(e,n,r)}bindTakeScreenshot(e,n,r){if(this.extension.installed){const a=this.defaultKeyBinder.takeScreenshotHandler(e,n);return this.takeScreenshotHandlers.push(a),()=>{this._remove(a,this.takeScreenshotHandlers)}}return this.defaultKeyBinder.bindTakeScreenshot(e,n,r)}bindToggleRecording(e,n,r){if(this.extension.installed){const a=this.defaultKeyBinder.toggleRecordingHandler(e,n);return this.toggleRecordingHandlers.push(a),()=>{this._remove(a,this.toggleRecordingHandlers)}}return this.defaultKeyBinder.bindToggleRecording(e,n,r)}_remove(e,n){for(let r=n.length-1;r>=0;--r)if(e===n[r]){n.splice(r,1);break}}bindSeekToSubtitle(e,n,r,a,u){return this.defaultKeyBinder.bindSeekToSubtitle(e,n,r,a,u)}bindSeekToBeginningOfCurrentSubtitle(e,n,r,a,u){return this.defaultKeyBinder.bindSeekToBeginningOfCurrentSubtitle(e,n,r,a,u)}bindSeekBackwardOrForward(e,n,r){return this.defaultKeyBinder.bindSeekBackwardOrForward(e,n,r)}bindOffsetToSubtitle(e,n,r,a,u){return this.defaultKeyBinder.bindOffsetToSubtitle(e,n,r,a,u)}bindAdjustOffset(e,n,r,a){return this.defaultKeyBinder.bindAdjustOffset(e,n,r,a)}bindResetOffet(e,n,r){return this.defaultKeyBinder.bindResetOffet(e,n,r)}bindAdjustPlaybackRate(e,n,r=!1){return this.defaultKeyBinder.bindAdjustPlaybackRate(e,n,r)}bindToggleSubtitles(e,n,r){return this.defaultKeyBinder.bindToggleSubtitles(e,n,r)}bindToggleSubtitleTrackInVideo(e,n,r){return this.defaultKeyBinder.bindToggleSubtitleTrackInVideo(e,n,r)}bindToggleSubtitleTrackInList(e,n,r){return this.defaultKeyBinder.bindToggleSubtitleTrackInList(e,n,r)}bindUnblurTrack(e,n,r){return this.defaultKeyBinder.bindUnblurTrack(e,n,r)}bindPlay(e,n,r){return this.defaultKeyBinder.bindPlay(e,n,r)}bindAutoPause(e,n,r){return this.defaultKeyBinder.bindAutoPause(e,n,r)}bindCondensedPlayback(e,n,r){return this.defaultKeyBinder.bindCondensedPlayback(e,n,r)}bindFastForwardPlayback(e,n,r){return this.defaultKeyBinder.bindFastForwardPlayback(e,n,r)}bindToggleSidePanel(e,n,r){return this.defaultKeyBinder.bindToggleSidePanel(e,n,r)}bindToggleRepeat(e,n,r){return this.defaultKeyBinder.bindToggleRepeat(e,n,r)}unsubscribeExtension(){var e;(e=this._unsubscribeExtension)==null||e.call(this)}}var Tr,Sl=new Uint8Array(16);function El(){if(!Tr&&(Tr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Tr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Tr(Sl)}const kl=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Tl(s){return typeof s=="string"&&kl.test(s)}var It=[];for(var hi=0;hi<256;++hi)It.push((hi+256).toString(16).substr(1));function Cl(s){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(It[s[e+0]]+It[s[e+1]]+It[s[e+2]]+It[s[e+3]]+"-"+It[s[e+4]]+It[s[e+5]]+"-"+It[s[e+6]]+It[s[e+7]]+"-"+It[s[e+8]]+It[s[e+9]]+"-"+It[s[e+10]]+It[s[e+11]]+It[s[e+12]]+It[s[e+13]]+It[s[e+14]]+It[s[e+15]]).toLowerCase();if(!Tl(n))throw TypeError("Stringified UUID is invalid");return n}function Et(s,e,n){s=s||{};var r=s.random||(s.rng||El)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Cl(r)}var pi,Ps;function jo(){if(Ps)return pi;Ps=1;var s={};return pi=typeof process=="object"&&s&&s.NODE_DEBUG&&/\bsemver\b/i.test(s.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{},pi}var gi,As;function Lo(){if(As)return gi;As=1;const s="2.0.0",e=256,n=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,a=e-6;return gi={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:n,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:s,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},gi}var Cr={exports:{}},Ns;function _l(){return Ns||(Ns=1,function(s,e){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:a}=Lo(),u=jo();e=s.exports={};const d=e.re=[],f=e.safeRe=[],h=e.src=[],p=e.t={};let m=0;const S="[a-zA-Z0-9-]",b=[["\\s",1],["\\d",a],[S,r]],R=j=>{for(const[U,_]of b)j=j.split(`${U}*`).join(`${U}{0,${_}}`).split(`${U}+`).join(`${U}{1,${_}}`);return j},C=(j,U,_)=>{const H=R(U),E=m++;u(j,E,U),p[j]=E,h[E]=U,d[E]=new RegExp(U,_?"g":void 0),f[E]=new RegExp(H,_?"g":void 0)};C("NUMERICIDENTIFIER","0|[1-9]\\d*"),C("NUMERICIDENTIFIERLOOSE","\\d+"),C("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${S}*`),C("MAINVERSION",`(${h[p.NUMERICIDENTIFIER]})\\.(${h[p.NUMERICIDENTIFIER]})\\.(${h[p.NUMERICIDENTIFIER]})`),C("MAINVERSIONLOOSE",`(${h[p.NUMERICIDENTIFIERLOOSE]})\\.(${h[p.NUMERICIDENTIFIERLOOSE]})\\.(${h[p.NUMERICIDENTIFIERLOOSE]})`),C("PRERELEASEIDENTIFIER",`(?:${h[p.NUMERICIDENTIFIER]}|${h[p.NONNUMERICIDENTIFIER]})`),C("PRERELEASEIDENTIFIERLOOSE",`(?:${h[p.NUMERICIDENTIFIERLOOSE]}|${h[p.NONNUMERICIDENTIFIER]})`),C("PRERELEASE",`(?:-(${h[p.PRERELEASEIDENTIFIER]}(?:\\.${h[p.PRERELEASEIDENTIFIER]})*))`),C("PRERELEASELOOSE",`(?:-?(${h[p.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${h[p.PRERELEASEIDENTIFIERLOOSE]})*))`),C("BUILDIDENTIFIER",`${S}+`),C("BUILD",`(?:\\+(${h[p.BUILDIDENTIFIER]}(?:\\.${h[p.BUILDIDENTIFIER]})*))`),C("FULLPLAIN",`v?${h[p.MAINVERSION]}${h[p.PRERELEASE]}?${h[p.BUILD]}?`),C("FULL",`^${h[p.FULLPLAIN]}$`),C("LOOSEPLAIN",`[v=\\s]*${h[p.MAINVERSIONLOOSE]}${h[p.PRERELEASELOOSE]}?${h[p.BUILD]}?`),C("LOOSE",`^${h[p.LOOSEPLAIN]}$`),C("GTLT","((?:<|>)?=?)"),C("XRANGEIDENTIFIERLOOSE",`${h[p.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),C("XRANGEIDENTIFIER",`${h[p.NUMERICIDENTIFIER]}|x|X|\\*`),C("XRANGEPLAIN",`[v=\\s]*(${h[p.XRANGEIDENTIFIER]})(?:\\.(${h[p.XRANGEIDENTIFIER]})(?:\\.(${h[p.XRANGEIDENTIFIER]})(?:${h[p.PRERELEASE]})?${h[p.BUILD]}?)?)?`),C("XRANGEPLAINLOOSE",`[v=\\s]*(${h[p.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[p.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[p.XRANGEIDENTIFIERLOOSE]})(?:${h[p.PRERELEASELOOSE]})?${h[p.BUILD]}?)?)?`),C("XRANGE",`^${h[p.GTLT]}\\s*${h[p.XRANGEPLAIN]}$`),C("XRANGELOOSE",`^${h[p.GTLT]}\\s*${h[p.XRANGEPLAINLOOSE]}$`),C("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),C("COERCERTL",h[p.COERCE],!0),C("LONETILDE","(?:~>?)"),C("TILDETRIM",`(\\s*)${h[p.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",C("TILDE",`^${h[p.LONETILDE]}${h[p.XRANGEPLAIN]}$`),C("TILDELOOSE",`^${h[p.LONETILDE]}${h[p.XRANGEPLAINLOOSE]}$`),C("LONECARET","(?:\\^)"),C("CARETTRIM",`(\\s*)${h[p.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",C("CARET",`^${h[p.LONECARET]}${h[p.XRANGEPLAIN]}$`),C("CARETLOOSE",`^${h[p.LONECARET]}${h[p.XRANGEPLAINLOOSE]}$`),C("COMPARATORLOOSE",`^${h[p.GTLT]}\\s*(${h[p.LOOSEPLAIN]})$|^$`),C("COMPARATOR",`^${h[p.GTLT]}\\s*(${h[p.FULLPLAIN]})$|^$`),C("COMPARATORTRIM",`(\\s*)${h[p.GTLT]}\\s*(${h[p.LOOSEPLAIN]}|${h[p.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",C("HYPHENRANGE",`^\\s*(${h[p.XRANGEPLAIN]})\\s+-\\s+(${h[p.XRANGEPLAIN]})\\s*$`),C("HYPHENRANGELOOSE",`^\\s*(${h[p.XRANGEPLAINLOOSE]})\\s+-\\s+(${h[p.XRANGEPLAINLOOSE]})\\s*$`),C("STAR","(<|>)?=?\\s*\\*"),C("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),C("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Cr,Cr.exports)),Cr.exports}var mi,Os;function Rl(){if(Os)return mi;Os=1;const s=Object.freeze({loose:!0}),e=Object.freeze({});return mi=r=>r?typeof r!="object"?s:r:e,mi}var bi,Ms;function Il(){if(Ms)return bi;Ms=1;const s=/^[0-9]+$/,e=(r,a)=>{const u=s.test(r),d=s.test(a);return u&&d&&(r=+r,a=+a),r===a?0:u&&!d?-1:d&&!u?1:r<a?-1:1};return bi={compareIdentifiers:e,rcompareIdentifiers:(r,a)=>e(a,r)},bi}var yi,js;function Pl(){if(js)return yi;js=1;const s=jo(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:n}=Lo(),{safeRe:r,t:a}=_l(),u=Rl(),{compareIdentifiers:d}=Il();class f{constructor(p,m){if(m=u(m),p instanceof f){if(p.loose===!!m.loose&&p.includePrerelease===!!m.includePrerelease)return p;p=p.version}else if(typeof p!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof p}".`);if(p.length>e)throw new TypeError(`version is longer than ${e} characters`);s("SemVer",p,m),this.options=m,this.loose=!!m.loose,this.includePrerelease=!!m.includePrerelease;const S=p.trim().match(m.loose?r[a.LOOSE]:r[a.FULL]);if(!S)throw new TypeError(`Invalid Version: ${p}`);if(this.raw=p,this.major=+S[1],this.minor=+S[2],this.patch=+S[3],this.major>n||this.major<0)throw new TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw new TypeError("Invalid patch version");S[4]?this.prerelease=S[4].split(".").map(b=>{if(/^[0-9]+$/.test(b)){const R=+b;if(R>=0&&R<n)return R}return b}):this.prerelease=[],this.build=S[5]?S[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(p){if(s("SemVer.compare",this.version,this.options,p),!(p instanceof f)){if(typeof p=="string"&&p===this.version)return 0;p=new f(p,this.options)}return p.version===this.version?0:this.compareMain(p)||this.comparePre(p)}compareMain(p){return p instanceof f||(p=new f(p,this.options)),d(this.major,p.major)||d(this.minor,p.minor)||d(this.patch,p.patch)}comparePre(p){if(p instanceof f||(p=new f(p,this.options)),this.prerelease.length&&!p.prerelease.length)return-1;if(!this.prerelease.length&&p.prerelease.length)return 1;if(!this.prerelease.length&&!p.prerelease.length)return 0;let m=0;do{const S=this.prerelease[m],b=p.prerelease[m];if(s("prerelease compare",m,S,b),S===void 0&&b===void 0)return 0;if(b===void 0)return 1;if(S===void 0)return-1;if(S===b)continue;return d(S,b)}while(++m)}compareBuild(p){p instanceof f||(p=new f(p,this.options));let m=0;do{const S=this.build[m],b=p.build[m];if(s("prerelease compare",m,S,b),S===void 0&&b===void 0)return 0;if(b===void 0)return 1;if(S===void 0)return-1;if(S===b)continue;return d(S,b)}while(++m)}inc(p,m,S){switch(p){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",m,S);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",m,S);break;case"prepatch":this.prerelease.length=0,this.inc("patch",m,S),this.inc("pre",m,S);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",m,S),this.inc("pre",m,S);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const b=Number(S)?1:0;if(!m&&S===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[b];else{let R=this.prerelease.length;for(;--R>=0;)typeof this.prerelease[R]=="number"&&(this.prerelease[R]++,R=-2);if(R===-1){if(m===this.prerelease.join(".")&&S===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(b)}}if(m){let R=[m,b];S===!1&&(R=[m]),d(this.prerelease[0],m)===0?isNaN(this.prerelease[1])&&(this.prerelease=R):this.prerelease=R}break}default:throw new Error(`invalid increment argument: ${p}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return yi=f,yi}var vi,Ls;function Bo(){if(Ls)return vi;Ls=1;const s=Pl();return vi=(n,r,a)=>new s(n,a).compare(new s(r,a)),vi}var xi,Bs;function Al(){if(Bs)return xi;Bs=1;const s=Bo();return xi=(n,r,a)=>s(n,r,a)>=0,xi}var Nl=Al();const _t=Wi(Nl);var wi,Fs;function Ol(){if(Fs)return wi;Fs=1;const s=Bo();return wi=(n,r,a)=>s(n,r,a)>0,wi}var Ml=Ol();const jl=Wi(Ml),er=Et();class Fo{constructor(e,n){ce(this,"version");ce(this,"extensionCommands");ce(this,"tabs");ce(this,"asbplayers");ce(this,"installed");ce(this,"sidePanel");ce(this,"videoPlayer");ce(this,"syncedVideoElement");ce(this,"loadedSubtitles",!1);ce(this,"windowEventListener");ce(this,"_responseResolves",{});ce(this,"onMessageCallbacks");ce(this,"onTabsCallbacks");ce(this,"heartbeatInterval");this.onMessageCallbacks=[],this.onTabsCallbacks=[],this.installed=e!==void 0,this.version=e??"",this.extensionCommands=n??{},this.sidePanel=!1,this.windowEventListener=r=>{var a,u;if(r.source===window&&!(r.data.sender!=="asbplayer-extension-to-player"||!r.data.message)&&!(r.data.asbplayerId&&r.data.asbplayerId!==er)){if(typeof r.data.message.messageId=="string"){const d=r.data.message.messageId;d in this._responseResolves&&((u=(a=this._responseResolves)[d])==null||u.call(a,r.data.message.response),delete this._responseResolves[d])}if(r.data.message.command==="tabs"){const d=r.data;this.tabs=d.message.tabs,this.asbplayers=d.message.asbplayers;for(let f of this.onTabsCallbacks)f(this.tabs);d.message.ackRequested&&window.postMessage({sender:"asbplayerv2",message:{command:"ackTabs",id:er,receivedTabs:this.tabs,sidePanel:this.sidePanel}})}else{const d=r.data;for(let f of this.onMessageCallbacks)f({data:d.message,tabId:d.tabId,src:d.src})}}},window.addEventListener("message",this.windowEventListener)}get supportsExportCardBind(){return this.installed&&_t(this.version,"1.10.0")}get supportsGlobalState(){return this.installed&&_t(this.version,"1.9.0")}get supportsLastSelectedAnkiExportModeSetting(){return this.installed&&_t(this.version,"1.9.0")}get supportsCopyHistoryRequest(){return this.installed&&_t(this.version,"1.7.0")}get supportsLandingPageStreamingVideoElementSelector(){return this.installed&&_t(this.version,"1.6.0")}get supportsPauseOnHover(){return this.installed&&_t(this.version,"1.4.0")}get supportsSubtitlesWidthSetting(){return this.installed&&_t(this.version,"1.4.0")}get supportsOrderableAnkiFields(){return this.installed&&_t(this.version,"1.3.0")}get supportsTrackSpecificSettings(){return this.installed&&_t(this.version,"1.3.0")}get supportsSettingsProfiles(){return this.installed&&_t(this.version,"1.3.0")}get supportsStreamingVideoOverlay(){return this.installed&&_t(this.version,"1.1.0")}get supportsSidePanel(){return this.installed&&!nl&&!Gi.isMobile&&_t(this.version,"1.0.0")}get supportsAppIntegration(){return this.installed&&_t(this.version,"1.0.0")}get supportsWebSocketClient(){return this.installed&&_t(this.version,"1.1.0")}get supportsVideoPlayerMiningCommands(){return this.installed&&_t(this.version,"1.0.0")}get supportsPlaybackRateMessage(){return this.installed&&_t(this.version,"0.24.0")}get supportsOffsetMessage(){return this.installed&&_t(this.version,"0.23.0")}startHeartbeat(){this.installed&&(this.heartbeatInterval!==void 0&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=void 0),this.videoPlayer?jl(this.version,"0.23.0")&&(this._sendHeartbeat(!0,this.loadedSubtitles,void 0),this.heartbeatInterval=setInterval(()=>this._sendHeartbeat(!0,this.loadedSubtitles,this.syncedVideoElement),1e3)):(this._sendHeartbeat(!1,this.loadedSubtitles,this.syncedVideoElement),this.heartbeatInterval=setInterval(()=>this._sendHeartbeat(!1,this.loadedSubtitles,this.syncedVideoElement),1e3)))}_sendHeartbeat(e,n,r){const a={command:"heartbeat",id:er,receivedTabs:e?[]:this.tabs,videoPlayer:e,sidePanel:this.sidePanel,loadedSubtitles:n,syncedVideoElement:r};window.postMessage({sender:"asbplayerv2",message:a})}openShortcuts(){window.postMessage({sender:"asbplayerv2",message:{command:"open-extension-shortcuts"}})}sendMessageToVideoElement(e,n,r,a){let u;if(a===void 0)u={sender:"asbplayerv2",message:e,tabId:n,src:r},window.postMessage(u);else{const d=Et();u={sender:"asbplayerv2",message:{...e,messageId:d},tabId:n,src:r},window.postMessage(u),this._createResponsePromise(d).then(a)}}notifySettingsUpdated(){const e={sender:"asbplayerv2",message:{command:"settings-updated"},asbplayerId:er};window.postMessage(e)}toggleSidePanel(){const e={sender:"asbplayerv2",message:{command:"toggle-side-panel"}};window.postMessage(e)}publishCard(e){const n={sender:"asbplayerv2",message:{command:"publish-card",...e}};window.postMessage(n)}requestSubtitles(e,n){const r=Et(),a={sender:"asbplayerv2",tabId:e,src:n,message:{command:"request-subtitles",messageId:r}};return window.postMessage(a),this._createResponsePromise(r)}requestCopyHistory(e){const n=Et(),r={sender:"asbplayerv2",message:{command:"request-copy-history",count:e,messageId:n}};return window.postMessage(r),this._createResponsePromise(n)}deleteCopyHistory(e){const n=Et(),r={sender:"asbplayerv2",message:{command:"delete-copy-history",ids:[e],messageId:n}};return window.postMessage(r),this._createResponsePromise(n)}saveCopyHistory(e){const n=Et(),r={sender:"asbplayerv2",message:{command:"save-copy-history",copyHistoryItems:[e],messageId:n}};return window.postMessage(r),this._createResponsePromise(n)}clearCopyHistory(){const e=Et(),n={sender:"asbplayerv2",message:{command:"clear-copy-history",messageId:e}};return window.postMessage(n),this._createResponsePromise(e)}loadSubtitles(e,n){const r={sender:"asbplayerv2",tabId:e,src:n,message:{command:"load-subtitles",fromAsbplayerId:er}};window.postMessage(r)}getSettings(e){const n=Et(),r={sender:"asbplayerv2",message:{command:"get-settings",keysAndDefaults:e,messageId:n}};return window.postMessage(r),this._createResponsePromise(n)}setSettings(e){const n=Et(),r={sender:"asbplayerv2",message:{command:"set-settings",settings:e,messageId:n}};return window.postMessage(r),this._createResponsePromise(n).then(()=>this.notifySettingsUpdated())}getGlobalState(){const e=Et(),n={sender:"asbplayerv2",message:{command:"get-global-state",messageId:e}};return window.postMessage(n),this._createResponsePromise(e)}getSomeGlobalState(e){const n=Et(),r={sender:"asbplayerv2",message:{command:"get-global-state",keys:e,messageId:n}};return window.postMessage(r),this._createResponsePromise(n)}setGlobalState(e){const n=Et(),r={sender:"asbplayerv2",message:{command:"set-global-state",state:e,messageId:n}};return window.postMessage(r),this._createResponsePromise(n)}activeSettingsProfile(){const e=Et(),n={sender:"asbplayerv2",message:{command:"get-active-profile",messageId:e}};return window.postMessage(n),this._createResponsePromise(e)}setActiveSettingsProfile(e){const n=Et(),r={sender:"asbplayerv2",message:{command:"set-active-profile",name:e,messageId:n}};return window.postMessage(r),this._createResponsePromise(n).then(()=>this.notifySettingsUpdated())}settingsProfiles(){const e=Et(),n={sender:"asbplayerv2",message:{command:"get-profiles",messageId:e}};return window.postMessage(n),this._createResponsePromise(e)}addSettingsProfile(e){const n=Et(),r={sender:"asbplayerv2",message:{command:"add-profile",name:e,messageId:n}};return window.postMessage(r),this._createResponsePromise(n)}removeSettingsProfile(e){const n=Et(),r={sender:"asbplayerv2",message:{command:"remove-profile",name:e,messageId:n}};return window.postMessage(r),this._createResponsePromise(n)}_createResponsePromise(e){return new Promise((n,r)=>{this._responseResolves[e]=n,setTimeout(()=>{e in this._responseResolves&&(delete this._responseResolves[e],r("Request timed out"))},5e3)})}subscribeTabs(e){return this.tabs!==void 0&&e(this.tabs),this.onTabsCallbacks.push(e),()=>this._remove(e,this.onTabsCallbacks)}subscribe(e){return this.onMessageCallbacks.push(e),()=>this._remove(e,this.onMessageCallbacks)}_remove(e,n){for(let r=n.length-1;r>=0;--r)if(e===n[r]){n.splice(r,1);break}}unbind(){window.removeEventListener("message",this.windowEventListener),this.onMessageCallbacks=[],this.onTabsCallbacks=[]}}class Ll{constructor(){ce(this,"_cache",{})}get(e){let n=this._cache[e];if(n===void 0){const r=localStorage.getItem(e);return this._cache[e]=r,r}return n}set(e,n){localStorage.setItem(e,n),this._cache[e]=n}delete(e){delete this._cache[e],localStorage.removeItem(e)}bustCache(){this._cache={}}}const $s="volume",Hs="theaterMode",Ds="offset",Vs="displaySubtitles",qs="hideSubtitleList",Bl=100;class Fl{constructor(e,n){ce(this,"_settings");ce(this,"_storage",new Ll);ce(this,"_extension");this._settings=e,this._extension=n}get hideSubtitleList(){return this._storage.get(qs)==="true"}set hideSubtitleList(e){this._storage.set(qs,String(e))}get volume(){const e=this._storage.get($s);return e===null?Bl:Number(e)}set volume(e){this._storage.set($s,String(e))}get theaterMode(){return this._storage.get(Hs)==="true"||!1}set theaterMode(e){this._storage.set(Hs,String(e))}get offset(){if(!this._settings.rememberSubtitleOffset)return 0;if(this._extension.supportsAppIntegration)return this._settings.lastSubtitleOffset;const e=this._storage.get(Ds);return e===null?0:Number(e)}set offset(e){this._extension.supportsAppIntegration?this._extension.setSettings({lastSubtitleOffset:e}):this._storage.set(Ds,String(e))}get displaySubtitles(){const e=this._storage.get(Vs);return e===null?!0:e==="true"}set displaySubtitles(e){this._storage.set(Vs,String(e))}}const Si=new Fo;let qi;const $o=s=>{const e=n=>{if(n.source===window&&n.data.sender==="asbplayer-extension-to-player"&&n.data.message.command==="version"){const r=n.data.message,a=r.extensionCommands??{};s(new Fo(r.version,wa(a)))}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},$l=$o(s=>qi=s),Hl=({component:s})=>{const[e,n]=y.useState(Si);return e.sidePanel=s==="sidePanel",e.videoPlayer=s==="videoPlayer",y.useEffect(()=>{if($l(),qi)Si.unbind(),n(qi);else{const r=$o(a=>{Si.unbind(),n(a),r()})}},[]),e},Dl=(s,e)=>{const[n,r]=y.useState([]),a=y.useCallback(p=>{r(m=>{const S=[...m];for(const b of p)m.find(R=>R.id===b.id)===void 0&&S.push(b);return S})},[]),u=y.useCallback(async()=>{a(await e.fetch(s))},[s,a,e]);y.useEffect(()=>e.liveFetch(s,a),[e,s,a]);const d=y.useCallback(async p=>{const m=[];for(const S of n)p.id!==S.id&&m.push(S);r(m),await e.delete(p.id)},[n,e]),f=y.useCallback(async p=>{r(m=>[...m,p]),await e.save(p)},[e]),h=y.useCallback(async()=>{r([]),await e.clear()},[e]);return{copyHistoryItems:n,refreshCopyHistory:u,deleteCopyHistoryItem:d,deleteAllCopyHistoryItems:h,saveCopyHistoryItem:f}};class Vl extends Error{constructor(n,r={}){super(n);ce(this,"key");ce(this,"params");this.key=n,this.params=r}get locKey(){return this.key}get locParams(){return this.params}}function ql(s){const e=s.toLowerCase().trim().split(/\s*;\s*/);return e[0]==="banner"?{name:e[0],delay:e[1]*1||0,leftToRight:e[2]*1||0,fadeAwayWidth:e[3]*1||0}:/^scroll\s/.test(e[0])?{name:e[0],y1:Math.min(e[1]*1,e[2]*1),y2:Math.max(e[1]*1,e[2]*1),delay:e[3]*1||0,fadeAwayHeight:e[4]*1||0}:null}function Ki(s){return s?s.toLowerCase().replace(/([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?)/g," $1 ").replace(/([mnlbspc])/g," $1 ").trim().replace(/\s+/g," ").split(/\s(?=[mnlbspc])/).map(e=>e.split(" ").filter((n,r)=>!(r&&Number.isNaN(n*1)))):[]}const Kl=["b","i","u","s","fsp","k","K","kf","ko","kt","fe","q","p","pbo","a","an","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"],Ks=Kl.map(s=>({name:s,regex:new RegExp(`^${s}-?\\d`)}));function Ho(s){const e={};for(let n=0;n<Ks.length;n++){const{name:r,regex:a}=Ks[n];if(a.test(s))return e[r]=s.slice(r.length)*1,e}if(/^fn/.test(s))e.fn=s.slice(2);else if(/^r/.test(s))e.r=s.slice(1);else if(/^fs[\d+-]/.test(s))e.fs=s.slice(2);else if(/^\d?c&?H?[0-9a-f]+|^\d?c$/i.test(s)){const[,n,r]=s.match(/^(\d?)c&?H?(\w*)/);e[`c${n||1}`]=r&&`000000${r}`.slice(-6)}else if(/^\da&?H?[0-9a-f]+/i.test(s)){const[,n,r]=s.match(/^(\d)a&?H?(\w\w)/);e[`a${n}`]=r}else if(/^alpha&?H?[0-9a-f]+/i.test(s))[,e.alpha]=s.match(/^alpha&?H?([0-9a-f]+)/i),e.alpha=`00${e.alpha}`.slice(-2);else if(/^(?:pos|org|move|fad|fade)\(/.test(s)){const[,n,r]=s.match(/^(\w+)\((.*?)\)?$/);e[n]=r.trim().split(/\s*,\s*/).map(Number)}else if(/^i?clip/.test(s)){const n=s.match(/^i?clip\((.*?)\)?$/)[1].trim().split(/\s*,\s*/);e.clip={inverse:/iclip/.test(s),scale:1,drawing:null,dots:null},n.length===1&&(e.clip.drawing=Ki(n[0])),n.length===2&&(e.clip.scale=n[0]*1,e.clip.drawing=Ki(n[1])),n.length===4&&(e.clip.dots=n.map(Number))}else if(/^t\(/.test(s)){const n=s.match(/^t\((.*?)\)?$/)[1].trim().replace(/\\.*/,r=>r.replace(/,/g,`
`)).split(/\s*,\s*/);if(!n[0])return e;e.t={t1:0,t2:0,accel:1,tags:n[n.length-1].replace(/\n/g,",").split("\\").slice(1).map(Ho)},n.length===2&&(e.t.accel=n[0]*1),n.length===3&&(e.t.t1=n[0]*1,e.t.t2=n[1]*1),n.length===4&&(e.t.t1=n[0]*1,e.t.t2=n[1]*1,e.t.accel=n[2]*1)}return e}function zl(s){const e=[];let n=0,r="";for(let a=0;a<s.length;a++){const u=s[a];u==="("&&n++,u===")"&&n--,n<0&&(n=0),!n&&u==="\\"?(r&&e.push(r),r=""):r+=u}return e.push(r),e.map(Ho)}function Ul(s){const e=s.split(/{([^{}]*?)}/),n=[];e[0].length&&n.push({tags:[],text:e[0],drawing:[]});for(let r=1;r<e.length;r+=2){const a=zl(e[r]),u=a.reduce((d,f)=>f.p===void 0?d:!!f.p,!1);n.push({tags:a,text:u?"":e[r+1],drawing:u?Ki(e[r+1]):[]})}return{raw:s,combined:n.map(r=>r.text).join(""),parsed:n}}function Xl(s){const e=s.split(":");return e[0]*3600+e[1]*60+e[2]*1}function Wl(s,e){let n=s.split(",");if(n.length>e.length){const a=n.slice(e.length-1).join();n=n.slice(0,e.length-1),n.push(a)}const r={};for(let a=0;a<n.length;a++){const u=e[a],d=n[a].trim();switch(u){case"Layer":case"MarginL":case"MarginR":case"MarginV":r[u]=d*1;break;case"Start":case"End":r[u]=Xl(d);break;case"Effect":r[u]=ql(d);break;case"Text":r[u]=Ul(d);break;default:r[u]=d}}return r}function zs(s){return s.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/)}const Tn=Object.assign||function(e,...n){for(let r=0;r<n.length;r++){if(!n[r])continue;const a=Object.keys(n[r]);for(let u=0;u<a.length;u++)e[a[u]]=n[r][a[u]]}return e};function Gl(s,e){const n=s.match(/Style\s*:\s*(.*)/i)[1].split(/\s*,\s*/);return Tn({},...e.map((r,a)=>({[r]:n[a]})))}function Yl(s){const e={info:{},styles:{format:[],style:[]},events:{format:[],comment:[],dialogue:[]}},n=s.split(/\r?\n/);let r=0;for(let a=0;a<n.length;a++){const u=n[a].trim();if(!/^;/.test(u)&&(/^\[Script Info\]/i.test(u)?r=1:/^\[V4\+? Styles\]/i.test(u)?r=2:/^\[Events\]/i.test(u)?r=3:/^\[.*\]/.test(u)&&(r=0),r!==0)){if(r===1&&/:/.test(u)){const[,d,f]=u.match(/(.*?)\s*:\s*(.*)/);e.info[d]=f}if(r===2&&(/^Format\s*:/i.test(u)&&(e.styles.format=zs(u)),/^Style\s*:/i.test(u)&&e.styles.style.push(Gl(u,e.styles.format))),r===3&&(/^Format\s*:/i.test(u)&&(e.events.format=zs(u)),/^(?:Comment|Dialogue)\s*:/i.test(u))){const[,d,f]=u.match(/^(\w+?)\s*:\s*(.*)/i);e.events[d.toLowerCase()].push(Wl(f,e.events.format))}}}return e}function Jl(s){const e={type:null,prev:null,next:null,points:[]};/[mnlbs]/.test(s[0])&&(e.type=s[0].toUpperCase().replace("N","L").replace("B","C"));for(let n=s.length-!(s.length&1),r=1;r<n;r+=2)e.points.push({x:s[r]*1,y:s[r+1]*1});return e}function Ql(s){return!(!s.points.length||!s.type||/C|S/.test(s.type)&&s.points.length<3)}function Zl(s){let e=1/0,n=1/0,r=-1/0,a=-1/0;return[].concat(...s.map(({points:u})=>u)).forEach(({x:u,y:d})=>{e=Math.min(e,u),n=Math.min(n,d),r=Math.max(r,u),a=Math.max(a,d)}),{minX:e,minY:n,width:r-e,height:a-n}}function eu(s,e,n){const r=[],a=[0,.6666666666666666,.3333333333333333,0],u=[0,1/3,2/3,0],d=[0,1/6,2/3,1/6],f=(m,S)=>m[0]*S[0]+m[1]*S[1]+m[2]*S[2]+m[3]*S[3];let h=[s[s.length-1].x,s[0].x,s[1].x,s[2].x],p=[s[s.length-1].y,s[0].y,s[1].y,s[2].y];r.push({type:e==="M"?"M":"L",points:[{x:f(d,h),y:f(d,p)}]});for(let m=3;m<s.length;m++)h=[s[m-3].x,s[m-2].x,s[m-1].x,s[m].x],p=[s[m-3].y,s[m-2].y,s[m-1].y,s[m].y],r.push({type:"C",points:[{x:f(a,h),y:f(a,p)},{x:f(u,h),y:f(u,p)},{x:f(d,h),y:f(d,p)}]});if(n==="L"||n==="C"){const m=s[s.length-1];r.push({type:"L",points:[{x:m.x,y:m.y}]})}return r}function tu(s){return s.map(({type:e,points:n})=>e+n.map(({x:r,y:a})=>`${r},${a}`).join(",")).join("")}function Do(s){const e=[];let n=0;for(;n<s.length;){const a=s[n],u=Jl(a);if(Ql(u)){if(u.type==="S"){const{x:d,y:f}=(e[n-1]||{points:[{x:0,y:0}]}).points.slice(-1)[0];u.points.unshift({x:d,y:f})}n&&(u.prev=e[n-1].type,e[n-1].next=u.type),e.push(u),n++}else{if(n&&e[n-1].type==="S"){const d={p:u.points,c:e[n-1].points.slice(0,3)};e[n-1].points=e[n-1].points.concat((d[a[0]]||[]).map(({x:f,y:h})=>({x:f,y:h})))}s.splice(n,1)}}const r=[].concat(...e.map(({type:a,points:u,prev:d,next:f})=>a==="S"?eu(u,d,f):{type:a,points:u}));return Tn({instructions:r,d:tu(r)},Zl(e))}const nu=["fs","clip","c1","c2","c3","c4","a1","a2","a3","a4","alpha","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"];function kn(s,e,n={}){let r=s[e];if(r===void 0)return null;if(e==="pos"||e==="org")return r.length===2?{[e]:{x:r[0],y:r[1]}}:null;if(e==="move"){const[a,u,d,f,h=0,p=0]=r;return r.length===4||r.length===6?{move:{x1:a,y1:u,x2:d,y2:f,t1:h,t2:p}}:null}if(e==="fad"||e==="fade"){if(r.length===2){const[a,u]=r;return{fade:{type:"fad",t1:a,t2:u}}}if(r.length===7){const[a,u,d,f,h,p,m]=r;return{fade:{type:"fade",a1:a,a2:u,a3:d,t1:f,t2:h,t3:p,t4:m}}}return null}if(e==="clip"){const{inverse:a,scale:u,drawing:d,dots:f}=r;if(d)return{clip:{inverse:a,scale:u,drawing:Do(d),dots:f}};if(f){const[h,p,m,S]=f;return{clip:{inverse:a,scale:u,drawing:d,dots:{x1:h,y1:p,x2:m,y2:S}}}}return null}if(/^[xy]?(bord|shad)$/.test(e)&&(r=Math.max(r,0)),e==="bord")return{xbord:r,ybord:r};if(e==="shad")return{xshad:r,yshad:r};if(/^c\d$/.test(e))return{[e]:r||n[e]};if(e==="alpha")return{a1:r,a2:r,a3:r,a4:r};if(e==="fr")return{frz:r};if(e==="fs")return{fs:/^\+|-/.test(r)?(r*1>-10?1+r/10:1)*n.fs:r*1};if(e==="K")return{kf:r};if(e==="t"){const{t1:a,accel:u,tags:d}=r,f=r.t2||(n.end-n.start)*1e3,h={};return d.forEach(p=>{const m=Object.keys(p)[0];~nu.indexOf(m)&&!(m==="clip"&&!p[m].dots)&&Tn(h,kn(p,m,n))}),{t:{t1:a,t2:f,accel:u,tag:h}}}return{[e]:r}}const ru=[null,1,2,3,null,7,8,9,null,4,5,6],iu=["r","a","an","pos","org","move","fade","fad","clip"];function su(s){return JSON.parse(JSON.stringify(Tn({},s,{k:void 0,kf:void 0,ko:void 0,kt:void 0})))}function ou({styles:s,style:e,parsed:n,start:r,end:a}){let u,d,f,h,p,m;const S=[];let b={style:e,fragments:[]},R={};for(let C=0;C<n.length;C++){const{tags:j,text:U,drawing:_}=n[C];let H;for(let G=0;G<j.length;G++){const D=j[G];H=D.r===void 0?H:D.r}const E={tag:H===void 0?su(R):{},text:U,drawing:_.length?Do(_):null};for(let G=0;G<j.length;G++){const D=j[G];u=u||ru[D.a||0]||D.an,d=d||kn(D,"pos"),f=f||kn(D,"org"),h=h||kn(D,"move"),p=p||kn(D,"fade")||kn(D,"fad"),m=kn(D,"clip")||m;const L=Object.keys(D)[0];if(L&&!~iu.indexOf(L)){const z=s[e].tag,{c1:ie,c2:ge,c3:Y,c4:Z}=z,ee=R.fs||z.fs,w=kn(D,L,{start:r,end:a,c1:ie,c2:ge,c3:Y,c4:Z,fs:ee});L==="t"?(E.tag.t=E.tag.t||[],E.tag.t.push(w.t)):Tn(E.tag,w)}}if(R=E.tag,H!==void 0&&(S.push(b),b={style:s[H]?H:e,fragments:[]}),E.text||E.drawing){const G=b.fragments[b.fragments.length-1]||{};G.text&&E.text&&!Object.keys(E.tag).length?G.text+=E.text:b.fragments.push(E)}}return S.push(b),Tn({alignment:u,slices:S},d,f,h,p,m)}function au({styles:s,dialogues:e}){let n=1/0;const r=[];for(let a=0;a<e.length;a++){const u=e[a];if(u.Start>=u.End)continue;s[u.Style]||(u.Style="Default");const d=s[u.Style].style,f=ou({styles:s,style:u.Style,parsed:u.Text.parsed,start:u.Start,end:u.End}),h=f.alignment||d.Alignment;n=Math.min(n,u.Layer),r.push(Tn({layer:u.Layer,start:u.Start,end:u.End,style:u.Style,name:u.Name,margin:{left:u.MarginL||d.MarginL,right:u.MarginR||d.MarginR,vertical:u.MarginV||d.MarginV},effect:u.Effect},f,{alignment:h}))}for(let a=0;a<r.length;a++)r[a].layer-=n;return r.sort((a,u)=>a.start-u.start||a.end-u.end)}const lu={Name:"Default",Fontname:"Arial",Fontsize:"20",PrimaryColour:"&H00FFFFFF&",SecondaryColour:"&H000000FF&",OutlineColour:"&H00000000&",BackColour:"&H00000000&",Bold:"0",Italic:"0",Underline:"0",StrikeOut:"0",ScaleX:"100",ScaleY:"100",Spacing:"0",Angle:"0",BorderStyle:"1",Outline:"2",Shadow:"2",Alignment:"2",MarginL:"10",MarginR:"10",MarginV:"10",Encoding:"1"};function _r(s){if(/^(&|H|&H)[0-9a-f]{6,}/i.test(s)){const[,n,r]=s.match(/&?H?([0-9a-f]{2})?([0-9a-f]{6})/i);return[n||"00",r]}const e=parseInt(s,10);if(!Number.isNaN(e)){if(e<-2147483648)return["00","000000"];const a=-2147483648<=e&&e<=2147483647?`00000000${(e<0?e+4294967296:e).toString(16)}`.slice(-8):String(e).slice(0,8);return[a.slice(0,2),a.slice(2)]}return["00","000000"]}function uu({info:s,style:e,defaultStyle:n}){const r={},a=[Tn({},lu,n,{Name:"Default"})].concat(e);for(let u=0;u<a.length;u++){const d=a[u];/^(\*+)Default$/.test(d.Name)&&(d.Name="Default"),Object.keys(d).forEach(U=>{U!=="Name"&&U!=="Fontname"&&!/Colour/.test(U)&&(d[U]*=1)});const[f,h]=_r(d.PrimaryColour),[p,m]=_r(d.SecondaryColour),[S,b]=_r(d.OutlineColour),[R,C]=_r(d.BackColour),j={fn:d.Fontname,fs:d.Fontsize,c1:h,a1:f,c2:m,a2:p,c3:b,a3:S,c4:C,a4:R,b:Math.abs(d.Bold),i:Math.abs(d.Italic),u:Math.abs(d.Underline),s:Math.abs(d.StrikeOut),fscx:d.ScaleX,fscy:d.ScaleY,fsp:d.Spacing,frz:d.Angle,xbord:d.Outline,ybord:d.Outline,xshad:d.Shadow,yshad:d.Shadow,fe:d.Encoding,q:/^[0-3]$/.test(s.WrapStyle)?s.WrapStyle*1:2};r[d.Name]={style:d,tag:j}}return r}function cu(s,e={}){const n=Yl(s),r=uu({info:n.info,style:n.styles.style,defaultStyle:e.defaultStyle||{}});return{info:n.info,width:n.info.PlayResX*1||null,height:n.info.PlayResY*1||null,collisions:n.info.Collisions||"Normal",styles:r,dialogues:au({styles:r,dialogues:n.events.dialogue})}}class Us{constructor(e){ce(this,"endOfLine",`\r
`);ce(this,"numericTimestamps",!1);e!=null&&(this.endOfLine=e.endOfLine??`\r
`,this.numericTimestamps=e.numericTimestamps??!1)}timestampToSeconds(e){const[n,r]=e.split(","),a=parseInt(r),[u,d,f]=n.split(":").map(p=>parseInt(p)),h=a*.001+f+60*d+3600*u;return Math.round(h*1e3)/1e3}secondsToTimestamp(e){const n=new Date(0,0,0,0,0,0,e),r=n.getHours(),a=n.getMinutes(),u=n.getSeconds(),d=Math.floor(e-(r*36e5+a*6e4+u*1e3));function f(h,p=2){return h.toString().padStart(p,"0")}return`${f(r)}:${f(a)}:${f(u)},${f(d,3)}`}correctFormat(e){const n=e.replace(".",","),[r,a]=n.split(","),u=this.fixedStrDigit(3,a),[d,f,h]=r.split(":"),p=this.fixedStrDigit(2,d,!1),m=this.fixedStrDigit(2,f,!1),S=this.fixedStrDigit(2,h,!1);return`${p}:${m}:${S},${u}`}fixedStrDigit(e,n,r=!0){return n.length===e?n:n.length>e?n.slice(0,e):r?n.padEnd(e,"0"):n.padStart(e,"0")}tryComma(e){e=e.replace(/\r/g,"");const n=/(\d+)\n(\d{1,2}:\d{2}:\d{2},\d{1,3}) --> (\d{1,2}:\d{2}:\d{2},\d{1,3})/g,r=e.split(n);return r.shift(),r}tryDot(e){e=e.replace(/\r/g,"");const n=/(\d+)\n(\d{1,2}:\d{2}:\d{2}\.\d{1,3}) --> (\d{1,2}:\d{2}:\d{2}\.\d{1,3})/g,r=e.split(n);return r.shift(),r}fromSrt(e){const n=e;let r=this.tryComma(n);r.length===0&&(r=this.tryDot(n));const a=[];for(let u=0;u<r.length;u+=4){let d=this.correctFormat(r[u+1].trim()),f=this.correctFormat(r[u+2].trim());this.numericTimestamps&&(d=this.timestampToSeconds(d),f=this.timestampToSeconds(f));const h={id:r[u].trim(),startTime:d,endTime:f,text:r[u+3].trim()};a.push(h)}return a}toSrt(e){const n=this.endOfLine;let r="";for(let a=0;a<e.length;a++){const u=e[a];let d=u.startTime,f=u.endTime;typeof d=="number"&&(d=this.secondsToTimestamp(d)),typeof f=="number"&&(f=this.secondsToTimestamp(f)),r+=u.id+n+d+" --> "+f+n+u.text.replace(`
`,n)+n+n}return r}}var Ei={},Xs;function du(){return Xs||(Xs=1,function(s){function e(w,P){return P===void 0&&(P=1),"rgba("+[parseInt(w.substring(0,2),16),parseInt(w.substring(2,4),16),parseInt(w.substring(4,6),16),P].join(",")+")"}var n=["webvtt.font.color","webvtt.font.opacity","webvtt.font.scale","webvtt.bg.color","webvtt.bg.opacity","webvtt.edge.color","webvtt.edge.type"],r=1;function a(w,P,re){switch(re){case"webvtt.font.color":case"webvtt.font.opacity":var ae=Services.prefs.getCharPref("webvtt.font.color"),Te=Services.prefs.getIntPref("webvtt.font.opacity")/100;u.fontSet=e(ae,Te);break;case"webvtt.font.scale":r=Services.prefs.getIntPref("webvtt.font.scale")/100;break;case"webvtt.bg.color":case"webvtt.bg.opacity":var te=Services.prefs.getCharPref("webvtt.bg.color"),ye=Services.prefs.getIntPref("webvtt.bg.opacity")/100;u.backgroundSet=e(te,ye);break;case"webvtt.edge.color":case"webvtt.edge.type":var xe=["","0px 0px ","4px 4px 4px ","-2px -2px ","2px 2px "],we=Services.prefs.getIntPref("webvtt.edge.type"),se=Services.prefs.getCharPref("webvtt.edge.color");u.edgeSet=xe[we]+e(se);break}}if(typeof Services<"u"){var u={};n.forEach(function(w){a(void 0,void 0,w),Services.prefs.addObserver(w,a,!1)})}var d=Object.create||function(){function w(){}return function(P){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return w.prototype=P,new w}}();function f(w,P){this.name="ParsingError",this.code=w.code,this.message=P||w.message}f.prototype=d(Error.prototype),f.prototype.constructor=f,f.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function h(w){function P(ae,Te,te,ye){return(ae|0)*3600+(Te|0)*60+(te|0)+(ye|0)/1e3}var re=w.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return re?re[3]?P(re[1],re[2],re[3].replace(":",""),re[4]):re[1]>59?P(re[1],re[2],0,re[4]):P(0,re[1],re[2],re[4]):null}function p(){this.values=d(null)}p.prototype={set:function(w,P){!this.get(w)&&P!==""&&(this.values[w]=P)},get:function(w,P,re){return re?this.has(w)?this.values[w]:P[re]:this.has(w)?this.values[w]:P},has:function(w){return w in this.values},alt:function(w,P,re){for(var ae=0;ae<re.length;++ae)if(P===re[ae]){this.set(w,P);break}},integer:function(w,P){/^-?\d+$/.test(P)&&this.set(w,parseInt(P,10))},percent:function(w,P){return P.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(P=parseFloat(P),P>=0&&P<=100)?(this.set(w,P),!0):!1}};function m(w,P,re,ae){var Te=ae?w.split(ae):[w];for(var te in Te)if(typeof Te[te]=="string"){var ye=Te[te].split(re);if(ye.length===2){var xe=ye[0],we=ye[1];P(xe,we)}}}function S(w,P,re){var ae=w;function Te(){var xe=h(w);if(xe===null)throw new f(f.Errors.BadTimeStamp,"Malformed timestamp: "+ae);return w=w.replace(/^[^\sa-zA-Z-]+/,""),xe}function te(xe,we){var se=new p;m(xe,function(pe,_e){switch(pe){case"region":for(var Pe=re.length-1;Pe>=0;Pe--)if(re[Pe].id===_e){se.set(pe,re[Pe].region);break}break;case"vertical":se.alt(pe,_e,["rl","lr"]);break;case"line":var je=_e.split(","),Ae=je[0];se.integer(pe,Ae),se.percent(pe,Ae)&&se.set("snapToLines",!1),se.alt(pe,Ae,["auto"]),je.length===2&&se.alt("lineAlign",je[1],["start","middle","end"]);break;case"position":je=_e.split(","),se.percent(pe,je[0]),je.length===2&&se.alt("positionAlign",je[1],["start","middle","end"]);break;case"size":se.percent(pe,_e);break;case"align":se.alt(pe,_e,["start","middle","end","left","right"]);break}},/:/,/\s/),we.region=se.get("region",null),we.vertical=se.get("vertical",""),we.line=se.get("line","auto"),we.lineAlign=se.get("lineAlign","start"),we.snapToLines=se.get("snapToLines",!0),we.size=se.get("size",100),we.align=se.get("align","middle"),we.position=se.get("position","auto"),we.positionAlign=se.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},we.align)}function ye(){w=w.replace(/^\s+/,"")}if(ye(),P.startTime=Te(),ye(),w.substr(0,3)!=="-->")throw new f(f.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+ae);w=w.substr(3),ye(),P.endTime=Te(),ye(),te(w,P)}var b={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},R={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},C={v:"title",lang:"lang"},j={rt:"ruby"};function U(w,P){function re(){if(!P)return null;function Ae(fe){return P=P.substr(fe.length),fe}var Re=P.match(/^([^<]*)(<[^>]+>?)?/);return Ae(Re[1]?Re[1]:Re[2])}function ae(Ae){return b[Ae]}function Te(Ae){for(;je=Ae.match(/&(amp|lt|gt|lrm|rlm|nbsp);/);)Ae=Ae.replace(je[0],ae);return Ae}function te(Ae,Re){return!j[Re.localName]||j[Re.localName]===Ae.localName}function ye(Ae,Re){var fe=R[Ae];if(!fe)return null;var Fe=w.document.createElement(fe);Fe.localName=fe;var Le=C[Ae];return Le&&Re&&(Fe[Le]=Re.trim()),Fe}for(var xe=w.document.createElement("div"),we=xe,se,pe=[];(se=re())!==null;){if(se[0]==="<"){if(se[1]==="/"){pe.length&&pe[pe.length-1]===se.substr(2).replace(">","")&&(pe.pop(),we=we.parentNode);continue}var _e=h(se.substr(1,se.length-2)),Pe;if(_e){Pe=w.document.createProcessingInstruction("timestamp",_e),we.appendChild(Pe);continue}var je=se.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!je||(Pe=ye(je[1],je[3]),!Pe)||!te(we,Pe))continue;je[2]&&(Pe.className=je[2].substr(1).replace("."," ")),pe.push(je[1]),we.appendChild(Pe),we=Pe;continue}we.appendChild(w.document.createTextNode(Te(se)))}return xe}var _=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function H(w){for(var P=0;P<_.length;P++){var re=_[P];if(w>=re[0]&&w<=re[1])return!0}return!1}function E(w){var P=[],re="",ae;if(!w||!w.childNodes)return"ltr";function Te(xe,we){for(var se=we.childNodes.length-1;se>=0;se--)xe.push(we.childNodes[se])}function te(xe){if(!xe||!xe.length)return null;var we=xe.pop(),se=we.textContent||we.innerText;if(se){var pe=se.match(/^.*(\n|\r)/);return pe?(xe.length=0,pe[0]):se}if(we.tagName==="ruby")return te(xe);if(we.childNodes)return Te(xe,we),te(xe)}for(Te(P,w);re=te(P);)for(var ye=0;ye<re.length;ye++)if(ae=re.charCodeAt(ye),H(ae))return"rtl";return"ltr"}function G(w){if(typeof w.line=="number"&&(w.snapToLines||w.line>=0&&w.line<=100))return w.line;if(!w.track||!w.track.textTrackList||!w.track.textTrackList.mediaElement)return-1;for(var P=w.track,re=P.textTrackList,ae=0,Te=0;Te<re.length&&re[Te]!==P;Te++)re[Te].mode==="showing"&&ae++;return++ae*-1}function D(){}D.prototype.applyStyles=function(w,P){P=P||this.div;for(var re in w)w.hasOwnProperty(re)&&(P.style[re]=w[re])},D.prototype.formatStyle=function(w,P){return w===0?0:w+P};function L(w,P,re){var ae=typeof navigator<"u"&&/MSIE\s8\.0/.test(navigator.userAgent),Te="rgba(255, 255, 255, 1)",te="rgba(0, 0, 0, 0.8)",ye="";typeof u<"u"&&(Te=u.fontSet,te=u.backgroundSet,ye=u.edgeSet),ae&&(Te="rgb(255, 255, 255)",te="rgb(0, 0, 0)"),D.call(this),this.cue=P,this.cueDiv=U(w,P.text);var xe={color:Te,backgroundColor:te,textShadow:ye,position:"relative",left:0,right:0,top:0,bottom:0,display:"inline"};ae||(xe.writingMode=P.vertical===""?"horizontal-tb":P.vertical==="lr"?"vertical-lr":"vertical-rl",xe.unicodeBidi="plaintext"),this.applyStyles(xe,this.cueDiv),this.div=w.document.createElement("div"),xe={textAlign:P.align==="middle"?"center":P.align,font:re.font,whiteSpace:"pre-line",position:"absolute"},ae||(xe.direction=E(this.cueDiv),xe.writingMode=P.vertical===""?"horizontal-tb":P.vertical==="lr"?"vertical-lr":"vertical-rl".stylesunicodeBidi="plaintext"),this.applyStyles(xe),this.div.appendChild(this.cueDiv);var we=0;switch(P.positionAlign){case"start":we=P.position;break;case"middle":we=P.position-P.size/2;break;case"end":we=P.position-P.size;break}P.vertical===""?this.applyStyles({left:this.formatStyle(we,"%"),width:this.formatStyle(P.size,"%")}):this.applyStyles({top:this.formatStyle(we,"%"),height:this.formatStyle(P.size,"%")}),this.move=function(se){this.applyStyles({top:this.formatStyle(se.top,"px"),bottom:this.formatStyle(se.bottom,"px"),left:this.formatStyle(se.left,"px"),right:this.formatStyle(se.right,"px"),height:this.formatStyle(se.height,"px"),width:this.formatStyle(se.width,"px")})}}L.prototype=d(D.prototype),L.prototype.constructor=L;function z(w){var P=typeof navigator<"u"&&/MSIE\s8\.0/.test(navigator.userAgent),re,ae,Te,te;if(w.div){ae=w.div.offsetHeight,Te=w.div.offsetWidth,te=w.div.offsetTop;var ye=(ye=w.div.childNodes)&&(ye=ye[0])&&ye.getClientRects&&ye.getClientRects();w=w.div.getBoundingClientRect(),re=ye?Math.max(ye[0]&&ye[0].height||0,w.height/ye.length):0}this.left=w.left,this.right=w.right,this.top=w.top||te,this.height=w.height||ae,this.bottom=w.bottom||te+(w.height||ae),this.width=w.width||Te,this.lineHeight=re!==void 0?re:w.lineHeight,P&&!this.lineHeight&&(this.lineHeight=13)}z.prototype.move=function(w,P){switch(P=P!==void 0?P:this.lineHeight,w){case"+x":this.left+=P,this.right+=P;break;case"-x":this.left-=P,this.right-=P;break;case"+y":this.top+=P,this.bottom+=P;break;case"-y":this.top-=P,this.bottom-=P;break}},z.prototype.overlaps=function(w){return this.left<w.right&&this.right>w.left&&this.top<w.bottom&&this.bottom>w.top},z.prototype.overlapsAny=function(w){for(var P=0;P<w.length;P++)if(this.overlaps(w[P]))return!0;return!1},z.prototype.within=function(w){return this.top>=w.top&&this.bottom<=w.bottom&&this.left>=w.left&&this.right<=w.right},z.prototype.overlapsOppositeAxis=function(w,P){switch(P){case"+x":return this.left<w.left;case"-x":return this.right>w.right;case"+y":return this.top<w.top;case"-y":return this.bottom>w.bottom}},z.prototype.intersectPercentage=function(w){var P=Math.max(0,Math.min(this.right,w.right)-Math.max(this.left,w.left)),re=Math.max(0,Math.min(this.bottom,w.bottom)-Math.max(this.top,w.top)),ae=P*re;return ae/(this.height*this.width)},z.prototype.toCSSCompatValues=function(w){return{top:this.top-w.top,bottom:w.bottom-this.bottom,left:this.left-w.left,right:w.right-this.right,height:this.height,width:this.width}},z.getSimpleBoxPosition=function(w){var P=w.div?w.div.offsetHeight:w.tagName?w.offsetHeight:0,re=w.div?w.div.offsetWidth:w.tagName?w.offsetWidth:0,ae=w.div?w.div.offsetTop:w.tagName?w.offsetTop:0;w=w.div?w.div.getBoundingClientRect():w.tagName?w.getBoundingClientRect():w;var Te={left:w.left,right:w.right,top:w.top||ae,height:w.height||P,bottom:w.bottom||ae+(w.height||P),width:w.width||re};return Te};function ie(w,P,re,ae){function Te(fe,Fe){for(var Le,Ie=new z(fe),yt=1,mt=0;mt<Fe.length;mt++){for(;fe.overlapsOppositeAxis(re,Fe[mt])||fe.within(re)&&fe.overlapsAny(ae);)fe.move(Fe[mt]);if(fe.within(re))return fe;var Me=fe.intersectPercentage(re);yt>Me&&(Le=new z(fe),yt=Me),fe=new z(Ie)}return Le||Ie}var te=new z(P),ye=P.cue,xe=G(ye),we=[];if(ye.snapToLines){var se;switch(ye.vertical){case"":we=["+y","-y"],se="height";break;case"rl":we=["+x","-x"],se="width";break;case"lr":we=["-x","+x"],se="width";break}var pe=te.lineHeight,_e=pe*Math.round(xe),Pe=re[se]+pe,je=we[0];Math.abs(_e)>Pe&&(_e=_e<0?-1:1,_e*=Math.ceil(Pe/pe)*pe),xe<0&&(_e+=ye.vertical===""?re.height:re.width,we=we.reverse()),te.move(je,_e)}else{var Ae=te.lineHeight/re.height*100;switch(ye.lineAlign){case"middle":xe-=Ae/2;break;case"end":xe-=Ae;break}switch(ye.vertical){case"":P.applyStyles({top:P.formatStyle(xe,"%")});break;case"rl":P.applyStyles({left:P.formatStyle(xe,"%")});break;case"lr":P.applyStyles({right:P.formatStyle(xe,"%")});break}we=["+y","-x","+x","-y"],te=new z(P)}var Re=Te(te,we);P.move(Re.toCSSCompatValues(re))}function ge(){}ge.StringDecoder=function(){return{decode:function(w){if(!w)return"";if(typeof w!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(w))}}},ge.convertCueToDOMTree=function(w,P){return!w||!P?null:U(w,P)};var Y=.05,Z="sans-serif",ee="1.5%";ge.processCues=function(w,P,re){if(!w||!P||!re)return null;for(;re.firstChild;)re.removeChild(re.firstChild);var ae=w.document.createElement("div");ae.style.position="absolute",ae.style.left="0",ae.style.right="0",ae.style.top="0",ae.style.bottom="0",ae.style.margin=ee,re.appendChild(ae);function Te(pe){for(var _e=0;_e<pe.length;_e++)if(pe[_e].hasBeenReset||!pe[_e].displayState)return!0;return!1}if(!Te(P)){for(var te=0;te<P.length;te++)ae.appendChild(P[te].displayState);return}var ye=[],xe=z.getSimpleBoxPosition(ae),we=Math.round(xe.height*Y*100)/100,se={font:we*r+"px "+Z};(function(){for(var pe,_e,Pe=0;Pe<P.length;Pe++)_e=P[Pe],pe=new L(w,_e,se),ae.appendChild(pe.div),ie(w,pe,xe,ye),_e.displayState=pe.div,ye.push(z.getSimpleBoxPosition(pe))})()},ge.Parser=function(w,P){this.window=w,this.state="INITIAL",this.buffer="",this.decoder=P||new TextDecoder("utf8"),this.regionList=[]},ge.Parser.prototype={reportOrThrowError:function(w){if(w instanceof f)this.onparsingerror&&this.onparsingerror(w);else throw w},parse:function(w){var P=this;w&&(P.buffer+=P.decoder.decode(w,{stream:!0}));function re(){for(var se=P.buffer,pe=0;pe<se.length&&se[pe]!=="\r"&&se[pe]!==`
`;)++pe;var _e=se.substr(0,pe);return se[pe]==="\r"&&++pe,se[pe]===`
`&&++pe,P.buffer=se.substr(pe),_e}function ae(se){var pe=new p;if(m(se,function(Pe,je){switch(Pe){case"id":pe.set(Pe,je);break;case"width":pe.percent(Pe,je);break;case"lines":pe.integer(Pe,je);break;case"regionanchor":case"viewportanchor":var Ae=je.split(",");if(Ae.length!==2)break;var Re=new p;if(Re.percent("x",Ae[0]),Re.percent("y",Ae[1]),!Re.has("x")||!Re.has("y"))break;pe.set(Pe+"X",Re.get("x")),pe.set(Pe+"Y",Re.get("y"));break;case"scroll":pe.alt(Pe,je,["up"]);break}},/=/,/\s/),pe.has("id")){var _e=new P.window.VTTRegion;_e.width=pe.get("width",100),_e.lines=pe.get("lines",3),_e.regionAnchorX=pe.get("regionanchorX",0),_e.regionAnchorY=pe.get("regionanchorY",100),_e.viewportAnchorX=pe.get("viewportanchorX",0),_e.viewportAnchorY=pe.get("viewportanchorY",100),_e.scroll=pe.get("scroll",""),P.onregion&&P.onregion(_e),P.regionList.push({id:pe.get("id"),region:_e})}}function Te(se){m(se,function(pe,_e){switch(pe){case"Region":ae(_e);break}},/:/)}try{var te;if(P.state==="INITIAL"){if(!/\r\n|\n/.test(P.buffer))return this;te=re();var ye=te.match(/^WEBVTT([ \t].*)?$/);if(!ye||!ye[0])throw new f(f.Errors.BadSignature);P.state="HEADER"}for(var xe=!1;P.buffer;){if(!/\r\n|\n/.test(P.buffer))return this;switch(xe?xe=!1:te=re(),P.state){case"HEADER":/:/.test(te)?Te(te):te||(P.state="ID");continue;case"NOTE":te||(P.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(te)){P.state="NOTE";break}if(!te)continue;if(P.cue=new P.window.VTTCue(0,0,""),P.state="CUE",te.indexOf("-->")===-1){P.cue.id=te;continue}case"CUE":try{S(te,P.cue,P.regionList)}catch(se){P.reportOrThrowError(se),P.cue=null,P.state="BADCUE";continue}P.state="CUETEXT";continue;case"CUETEXT":var we=te.indexOf("-->")!==-1;if(!te||we&&(xe=!0)){P.oncue&&P.oncue(P.cue),P.cue=null,P.state="ID";continue}P.cue.text&&(P.cue.text+=`
`),P.cue.text+=te;continue;case"BADCUE":te||(P.state="ID");continue}}}catch(se){P.reportOrThrowError(se),P.state==="CUETEXT"&&P.cue&&P.oncue&&P.oncue(P.cue),P.cue=null,P.state=P.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var w=this;try{if(w.buffer+=w.decoder.decode(),(w.cue||w.state==="HEADER")&&(w.buffer+=`

`,w.parse()),w.state==="INITIAL")throw new f(f.Errors.BadSignature)}catch(P){w.reportOrThrowError(P)}return w.onflush&&w.onflush(),this}},s.WebVTT=ge}(Ei)),Ei}var Ar={exports:{}},ki={},Ws;function fu(){return Ws||(Ws=1,function(s){var e="auto",n={"":!0,lr:!0,rl:!0},r={start:!0,middle:!0,end:!0,left:!0,right:!0};function a(h){if(typeof h!="string")return!1;var p=n[h.toLowerCase()];return p?h.toLowerCase():!1}function u(h){if(typeof h!="string")return!1;var p=r[h.toLowerCase()];return p?h.toLowerCase():!1}function d(h){for(var p=1;p<arguments.length;p++){var m=arguments[p];for(var S in m)h[S]=m[S]}return h}function f(h,p,m){var S=this,b=/MSIE\s8\.0/.test(navigator.userAgent),R={};b?S=document.createElement("custom"):R.enumerable=!0,S.hasBeenReset=!1;var C="",j=!1,U=h,_=p,H=m,E=null,G="",D=!0,L="auto",z="start",ie=50,ge="middle",Y=50,Z="middle";if(Object.defineProperty(S,"id",d({},R,{get:function(){return C},set:function(ee){C=""+ee}})),Object.defineProperty(S,"pauseOnExit",d({},R,{get:function(){return j},set:function(ee){j=!!ee}})),Object.defineProperty(S,"startTime",d({},R,{get:function(){return U},set:function(ee){if(typeof ee!="number")throw new TypeError("Start time must be set to a number.");U=ee,this.hasBeenReset=!0}})),Object.defineProperty(S,"endTime",d({},R,{get:function(){return _},set:function(ee){if(typeof ee!="number")throw new TypeError("End time must be set to a number.");_=ee,this.hasBeenReset=!0}})),Object.defineProperty(S,"text",d({},R,{get:function(){return H},set:function(ee){H=""+ee,this.hasBeenReset=!0}})),Object.defineProperty(S,"region",d({},R,{get:function(){return E},set:function(ee){E=ee,this.hasBeenReset=!0}})),Object.defineProperty(S,"vertical",d({},R,{get:function(){return G},set:function(ee){var w=a(ee);if(w===!1)throw new SyntaxError("An invalid or illegal string was specified.");G=w,this.hasBeenReset=!0}})),Object.defineProperty(S,"snapToLines",d({},R,{get:function(){return D},set:function(ee){D=!!ee,this.hasBeenReset=!0}})),Object.defineProperty(S,"line",d({},R,{get:function(){return L},set:function(ee){if(typeof ee!="number"&&ee!==e)throw new SyntaxError("An invalid number or illegal string was specified.");L=ee,this.hasBeenReset=!0}})),Object.defineProperty(S,"lineAlign",d({},R,{get:function(){return z},set:function(ee){var w=u(ee);if(!w)throw new SyntaxError("An invalid or illegal string was specified.");z=w,this.hasBeenReset=!0}})),Object.defineProperty(S,"position",d({},R,{get:function(){return ie},set:function(ee){if(ee<0||ee>100)throw new Error("Position must be between 0 and 100.");ie=ee,this.hasBeenReset=!0}})),Object.defineProperty(S,"positionAlign",d({},R,{get:function(){return ge},set:function(ee){var w=u(ee);if(!w)throw new SyntaxError("An invalid or illegal string was specified.");ge=w,this.hasBeenReset=!0}})),Object.defineProperty(S,"size",d({},R,{get:function(){return Y},set:function(ee){if(ee<0||ee>100)throw new Error("Size must be between 0 and 100.");Y=ee,this.hasBeenReset=!0}})),Object.defineProperty(S,"align",d({},R,{get:function(){return Z},set:function(ee){var w=u(ee);if(!w)throw new SyntaxError("An invalid or illegal string was specified.");Z=w,this.hasBeenReset=!0}})),S.displayState=void 0,b)return S}f.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},s.VTTCue=s.VTTCue||f}(ki)),ki}var Ti=Ar.exports,Gs;function hu(){return Gs||(Gs=1,function(s){s.exports&&(Ti.VTTCue=Ti.VTTCue||fu().VTTCue),function(e){e.VTTCue.prototype.toJSON=function(){var n={},r=this;return Object.keys(this).forEach(function(a){a!=="getCueAsHTML"&&a!=="hasBeenReset"&&a!=="displayState"&&(n[a]=r[a])}),n},e.VTTCue.create=function(n){if(!n.hasOwnProperty("startTime")||!n.hasOwnProperty("endTime")||!n.hasOwnProperty("text"))throw new Error("You must at least have start time, end time, and text.");var r=new e.VTTCue(n.startTime,n.endTime,n.text);for(var a in n)r.hasOwnProperty(a)&&(r[a]=n[a]);return r},e.VTTCue.fromJSON=function(n){return this.create(JSON.parse(n))}}(Ti)}(Ar)),Ar.exports}var Nr={exports:{}},Ci={},Ys;function pu(){return Ys||(Ys=1,function(s){var e={"":!0,up:!0};function n(u){if(typeof u!="string")return!1;var d=e[u.toLowerCase()];return d?u.toLowerCase():!1}function r(u){return typeof u=="number"&&u>=0&&u<=100}function a(){var u=100,d=3,f=0,h=100,p=0,m=100,S="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return u},set:function(b){if(!r(b))throw new Error("Width must be between 0 and 100.");u=b}},lines:{enumerable:!0,get:function(){return d},set:function(b){if(typeof b!="number")throw new TypeError("Lines must be set to a number.");d=b}},regionAnchorY:{enumerable:!0,get:function(){return h},set:function(b){if(!r(b))throw new Error("RegionAnchorX must be between 0 and 100.");h=b}},regionAnchorX:{enumerable:!0,get:function(){return f},set:function(b){if(!r(b))throw new Error("RegionAnchorY must be between 0 and 100.");f=b}},viewportAnchorY:{enumerable:!0,get:function(){return m},set:function(b){if(!r(b))throw new Error("ViewportAnchorY must be between 0 and 100.");m=b}},viewportAnchorX:{enumerable:!0,get:function(){return p},set:function(b){if(!r(b))throw new Error("ViewportAnchorX must be between 0 and 100.");p=b}},scroll:{enumerable:!0,get:function(){return S},set:function(b){var R=n(b);if(R===!1)throw new SyntaxError("An invalid or illegal string was specified.");S=R}}})}s.VTTRegion=s.VTTRegion||a}(Ci)),Ci}var Js=Nr.exports,Qs;function gu(){return Qs||(Qs=1,function(s){s.exports&&(Js.VTTRegion=pu().VTTRegion),function(e){e.VTTRegion.create=function(n){var r=new e.VTTRegion;for(var a in n)r.hasOwnProperty(a)&&(r[a]=n[a]);return r},e.VTTRegion.fromJSON=function(n){return this.create(JSON.parse(n))}}(Js)}(Nr)),Nr.exports}var _i,Zs;function mu(){return Zs||(Zs=1,_i={WebVTT:du().WebVTT,VTTCue:hu().VTTCue,VTTRegion:gu().VTTRegion}),_i}var eo=mu(),Ri={},Ii={},to;function Vo(){return to||(to=1,function(s){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",r="["+e+"]["+n+"]*",a=new RegExp("^"+r+"$"),u=function(f,h){const p=[];let m=h.exec(f);for(;m;){const S=[];S.startIndex=h.lastIndex-m[0].length;const b=m.length;for(let R=0;R<b;R++)S.push(m[R]);p.push(S),m=h.exec(f)}return p},d=function(f){const h=a.exec(f);return!(h===null||typeof h>"u")};s.isExist=function(f){return typeof f<"u"},s.isEmptyObject=function(f){return Object.keys(f).length===0},s.merge=function(f,h,p){if(h){const m=Object.keys(h),S=m.length;for(let b=0;b<S;b++)p==="strict"?f[m[b]]=[h[m[b]]]:f[m[b]]=h[m[b]]}},s.getValue=function(f){return s.isExist(f)?f:""},s.isName=d,s.getAllMatches=u,s.nameRegexp=r}(Ii)),Ii}var no;function qo(){if(no)return Ri;no=1;const s=Vo(),e={allowBooleanAttributes:!1,unpairedTags:[]};Ri.validate=function(_,H){H=Object.assign({},e,H);const E=[];let G=!1,D=!1;_[0]==="\uFEFF"&&(_=_.substr(1));for(let L=0;L<_.length;L++)if(_[L]==="<"&&_[L+1]==="?"){if(L+=2,L=r(_,L),L.err)return L}else if(_[L]==="<"){let z=L;if(L++,_[L]==="!"){L=a(_,L);continue}else{let ie=!1;_[L]==="/"&&(ie=!0,L++);let ge="";for(;L<_.length&&_[L]!==">"&&_[L]!==" "&&_[L]!=="	"&&_[L]!==`
`&&_[L]!=="\r";L++)ge+=_[L];if(ge=ge.trim(),ge[ge.length-1]==="/"&&(ge=ge.substring(0,ge.length-1),L--),!C(ge)){let ee;return ge.trim().length===0?ee="Invalid space after '<'.":ee="Tag '"+ge+"' is an invalid name.",b("InvalidTag",ee,j(_,L))}const Y=f(_,L);if(Y===!1)return b("InvalidAttr","Attributes for '"+ge+"' have open quote.",j(_,L));let Z=Y.value;if(L=Y.index,Z[Z.length-1]==="/"){const ee=L-Z.length;Z=Z.substring(0,Z.length-1);const w=p(Z,H);if(w===!0)G=!0;else return b(w.err.code,w.err.msg,j(_,ee+w.err.line))}else if(ie)if(Y.tagClosed){if(Z.trim().length>0)return b("InvalidTag","Closing tag '"+ge+"' can't have attributes or invalid starting.",j(_,z));{const ee=E.pop();if(ge!==ee.tagName){let w=j(_,ee.tagStartPos);return b("InvalidTag","Expected closing tag '"+ee.tagName+"' (opened in line "+w.line+", col "+w.col+") instead of closing tag '"+ge+"'.",j(_,z))}E.length==0&&(D=!0)}}else return b("InvalidTag","Closing tag '"+ge+"' doesn't have proper closing.",j(_,L));else{const ee=p(Z,H);if(ee!==!0)return b(ee.err.code,ee.err.msg,j(_,L-Z.length+ee.err.line));if(D===!0)return b("InvalidXml","Multiple possible root nodes found.",j(_,L));H.unpairedTags.indexOf(ge)!==-1||E.push({tagName:ge,tagStartPos:z}),G=!0}for(L++;L<_.length;L++)if(_[L]==="<")if(_[L+1]==="!"){L++,L=a(_,L);continue}else if(_[L+1]==="?"){if(L=r(_,++L),L.err)return L}else break;else if(_[L]==="&"){const ee=S(_,L);if(ee==-1)return b("InvalidChar","char '&' is not expected.",j(_,L));L=ee}else if(D===!0&&!n(_[L]))return b("InvalidXml","Extra text at the end",j(_,L));_[L]==="<"&&L--}}else{if(n(_[L]))continue;return b("InvalidChar","char '"+_[L]+"' is not expected.",j(_,L))}if(G){if(E.length==1)return b("InvalidTag","Unclosed tag '"+E[0].tagName+"'.",j(_,E[0].tagStartPos));if(E.length>0)return b("InvalidXml","Invalid '"+JSON.stringify(E.map(L=>L.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return b("InvalidXml","Start tag expected.",1);return!0};function n(_){return _===" "||_==="	"||_===`
`||_==="\r"}function r(_,H){const E=H;for(;H<_.length;H++)if(_[H]=="?"||_[H]==" "){const G=_.substr(E,H-E);if(H>5&&G==="xml")return b("InvalidXml","XML declaration allowed only at the start of the document.",j(_,H));if(_[H]=="?"&&_[H+1]==">"){H++;break}else continue}return H}function a(_,H){if(_.length>H+5&&_[H+1]==="-"&&_[H+2]==="-"){for(H+=3;H<_.length;H++)if(_[H]==="-"&&_[H+1]==="-"&&_[H+2]===">"){H+=2;break}}else if(_.length>H+8&&_[H+1]==="D"&&_[H+2]==="O"&&_[H+3]==="C"&&_[H+4]==="T"&&_[H+5]==="Y"&&_[H+6]==="P"&&_[H+7]==="E"){let E=1;for(H+=8;H<_.length;H++)if(_[H]==="<")E++;else if(_[H]===">"&&(E--,E===0))break}else if(_.length>H+9&&_[H+1]==="["&&_[H+2]==="C"&&_[H+3]==="D"&&_[H+4]==="A"&&_[H+5]==="T"&&_[H+6]==="A"&&_[H+7]==="["){for(H+=8;H<_.length;H++)if(_[H]==="]"&&_[H+1]==="]"&&_[H+2]===">"){H+=2;break}}return H}const u='"',d="'";function f(_,H){let E="",G="",D=!1;for(;H<_.length;H++){if(_[H]===u||_[H]===d)G===""?G=_[H]:G!==_[H]||(G="");else if(_[H]===">"&&G===""){D=!0;break}E+=_[H]}return G!==""?!1:{value:E,index:H,tagClosed:D}}const h=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function p(_,H){const E=s.getAllMatches(_,h),G={};for(let D=0;D<E.length;D++){if(E[D][1].length===0)return b("InvalidAttr","Attribute '"+E[D][2]+"' has no space in starting.",U(E[D]));if(E[D][3]!==void 0&&E[D][4]===void 0)return b("InvalidAttr","Attribute '"+E[D][2]+"' is without value.",U(E[D]));if(E[D][3]===void 0&&!H.allowBooleanAttributes)return b("InvalidAttr","boolean attribute '"+E[D][2]+"' is not allowed.",U(E[D]));const L=E[D][2];if(!R(L))return b("InvalidAttr","Attribute '"+L+"' is an invalid name.",U(E[D]));if(!G.hasOwnProperty(L))G[L]=1;else return b("InvalidAttr","Attribute '"+L+"' is repeated.",U(E[D]))}return!0}function m(_,H){let E=/\d/;for(_[H]==="x"&&(H++,E=/[\da-fA-F]/);H<_.length;H++){if(_[H]===";")return H;if(!_[H].match(E))break}return-1}function S(_,H){if(H++,_[H]===";")return-1;if(_[H]==="#")return H++,m(_,H);let E=0;for(;H<_.length;H++,E++)if(!(_[H].match(/\w/)&&E<20)){if(_[H]===";")break;return-1}return H}function b(_,H,E){return{err:{code:_,msg:H,line:E.line||E,col:E.col}}}function R(_){return s.isName(_)}function C(_){return s.isName(_)}function j(_,H){const E=_.substring(0,H).split(/\r?\n/);return{line:E.length,col:E[E.length-1].length+1}}function U(_){return _.startIndex+_[1].length}return Ri}var Rr={},ro;function bu(){if(ro)return Rr;ro=1;const s={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0},tagValueProcessor:function(n,r){return r},attributeValueProcessor:function(n,r){return r},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1},e=function(n){return Object.assign({},s,n)};return Rr.buildOptions=e,Rr.defaultOptions=s,Rr}var Pi,io;function yu(){if(io)return Pi;io=1;class s{constructor(n){this.tagname=n,this.child=[],this[":@"]={}}add(n,r){this.child.push({[n]:r})}addChild(n){n[":@"]&&Object.keys(n[":@"]).length>0?this.child.push({[n.tagname]:n.child,":@":n[":@"]}):this.child.push({[n.tagname]:n.child})}}return Pi=s,Pi}var Ai,so;function vu(){if(so)return Ai;so=1;function s(r,a){const u={};if(r[a+3]==="O"&&r[a+4]==="C"&&r[a+5]==="T"&&r[a+6]==="Y"&&r[a+7]==="P"&&r[a+8]==="E"){a=a+9;let d=1,f=!1,h=!1,p=!1,m="";for(;a<r.length;a++)if(r[a]==="<"){if(f&&r[a+1]==="!"&&r[a+2]==="E"&&r[a+3]==="N"&&r[a+4]==="T"&&r[a+5]==="I"&&r[a+6]==="T"&&r[a+7]==="Y")a+=7,h=!0;else if(f&&r[a+1]==="!"&&r[a+2]==="E"&&r[a+3]==="L"&&r[a+4]==="E"&&r[a+5]==="M"&&r[a+6]==="E"&&r[a+7]==="N"&&r[a+8]==="T")a+=8;else if(r[a+1]==="!"&&r[a+2]==="-"&&r[a+3]==="-")p=!0;else throw new Error("Invalid DOCTYPE");d++,m=""}else if(r[a]===">"){if(p)if(r[a-1]==="-"&&r[a-2]==="-")p=!1;else throw new Error("Invalid XML comment in DOCTYPE");else h&&(n(m,u),h=!1);if(d--,d===0)break}else r[a]==="["?f=!0:m+=r[a];if(d!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:u,i:a}}const e=RegExp(`^\\s([a-zA-z0-0]+)[ 	](['"])([^&]+)\\2`);function n(r,a){const u=e.exec(r);u&&(a[u[1]]={regx:RegExp(`&${u[1]};`,"g"),val:u[3]})}return Ai=s,Ai}var Ni,oo;function xu(){if(oo)return Ni;oo=1;const s=/^[-+]?0x[a-fA-F0-9]+$/,e=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const n={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function r(u,d={}){if(d=Object.assign({},n,d),!u||typeof u!="string")return u;let f=u.trim();if(d.skipLike!==void 0&&d.skipLike.test(f))return u;if(d.hex&&s.test(f))return Number.parseInt(f,16);{const h=e.exec(f);if(h){const p=h[1],m=h[2];let S=a(h[3]);const b=h[4]||h[6];if(!d.leadingZeros&&m.length>0&&p&&f[2]!==".")return u;if(!d.leadingZeros&&m.length>0&&!p&&f[1]!==".")return u;{const R=Number(f),C=""+R;return C.search(/[eE]/)!==-1||b?d.eNotation?R:u:f.indexOf(".")!==-1?C==="0"&&S===""||C===S||p&&C==="-"+S?R:u:m?S===C||p+S===C?R:u:f===C||f===p+C?R:u}}else return u}}function a(u){return u&&u.indexOf(".")!==-1&&(u=u.replace(/0+$/,""),u==="."?u="0":u[0]==="."?u="0"+u:u[u.length-1]==="."&&(u=u.substr(0,u.length-1))),u}return Ni=r,Ni}var Oi,ao;function wu(){if(ao)return Oi;ao=1;const s=Vo(),e=yu(),n=vu(),r=xu();"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,s.nameRegexp);class a{constructor(G){this.options=G,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={amp:{regex:/&(amp|#38|#x26);/g,val:"&"},apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=u,this.parseXml=m,this.parseTextData=d,this.resolveNameSpace=f,this.buildAttributesMap=p,this.isItStopNode=R,this.replaceEntitiesValue=S,this.readStopNodeData=_,this.saveTextToParentTag=b}}function u(E){const G=Object.keys(E);for(let D=0;D<G.length;D++){const L=G[D];this.lastEntities[L]={regex:new RegExp("&"+L+";","g"),val:E[L]}}}function d(E,G,D,L,z,ie,ge){if(E!==void 0&&(this.options.trimValues&&!L&&(E=E.trim()),E.length>0)){ge||(E=this.replaceEntitiesValue(E));const Y=this.options.tagValueProcessor(G,E,D,z,ie);return Y==null?E:typeof Y!=typeof E||Y!==E?Y:this.options.trimValues?H(E,this.options.parseTagValue,this.options.numberParseOptions):E.trim()===E?H(E,this.options.parseTagValue,this.options.numberParseOptions):E}}function f(E){if(this.options.removeNSPrefix){const G=E.split(":"),D=E.charAt(0)==="/"?"/":"";if(G[0]==="xmlns")return"";G.length===2&&(E=D+G[1])}return E}const h=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function p(E,G){if(!this.options.ignoreAttributes&&typeof E=="string"){const D=s.getAllMatches(E,h),L=D.length,z={};for(let ie=0;ie<L;ie++){const ge=this.resolveNameSpace(D[ie][1]);let Y=D[ie][4];const Z=this.options.attributeNamePrefix+ge;if(ge.length)if(Y!==void 0){this.options.trimValues&&(Y=Y.trim()),Y=this.replaceEntitiesValue(Y);const ee=this.options.attributeValueProcessor(ge,Y,G);ee==null?z[Z]=Y:typeof ee!=typeof Y||ee!==Y?z[Z]=ee:z[Z]=H(Y,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(z[Z]=!0)}if(!Object.keys(z).length)return;if(this.options.attributesGroupName){const ie={};return ie[this.options.attributesGroupName]=z,ie}return z}}const m=function(E){E=E.replace(/\r\n?/g,`
`);const G=new e("!xml");let D=G,L="",z="";for(let ie=0;ie<E.length;ie++)if(E[ie]==="<")if(E[ie+1]==="/"){const Y=j(E,">",ie,"Closing Tag is not closed.");let Z=E.substring(ie+2,Y).trim();if(this.options.removeNSPrefix){const ee=Z.indexOf(":");ee!==-1&&(Z=Z.substr(ee+1))}D&&(L=this.saveTextToParentTag(L,D,z)),z=z.substr(0,z.lastIndexOf(".")),D=this.tagsNodeStack.pop(),L="",ie=Y}else if(E[ie+1]==="?"){let Y=U(E,ie,!1,"?>");if(!Y)throw new Error("Pi Tag is not closed.");if(L=this.saveTextToParentTag(L,D,z),!(this.options.ignoreDeclaration&&Y.tagName==="?xml"||this.options.ignorePiTags)){const Z=new e(Y.tagName);Z.add(this.options.textNodeName,""),Y.tagName!==Y.tagExp&&Y.attrExpPresent&&(Z[":@"]=this.buildAttributesMap(Y.tagExp,z)),D.addChild(Z)}ie=Y.closeIndex+1}else if(E.substr(ie+1,3)==="!--"){const Y=j(E,"-->",ie+4,"Comment is not closed.");if(this.options.commentPropName){const Z=E.substring(ie+4,Y-2);L=this.saveTextToParentTag(L,D,z),D.add(this.options.commentPropName,[{[this.options.textNodeName]:Z}])}ie=Y}else if(E.substr(ie+1,2)==="!D"){const Y=n(E,ie);this.docTypeEntities=Y.entities,ie=Y.i}else if(E.substr(ie+1,2)==="!["){const Y=j(E,"]]>",ie,"CDATA is not closed.")-2,Z=E.substring(ie+9,Y);if(L=this.saveTextToParentTag(L,D,z),this.options.cdataPropName)D.add(this.options.cdataPropName,[{[this.options.textNodeName]:Z}]);else{let ee=this.parseTextData(Z,D.tagname,z,!0,!1,!0);ee||(ee=""),D.add(this.options.textNodeName,ee)}ie=Y+2}else{let Y=U(E,ie,this.options.removeNSPrefix),Z=Y.tagName,ee=Y.tagExp,w=Y.attrExpPresent,P=Y.closeIndex;D&&L&&D.tagname!=="!xml"&&(L=this.saveTextToParentTag(L,D,z,!1)),Z!==G.tagname&&(z+=z?"."+Z:Z);const re=D;if(re&&this.options.unpairedTags.indexOf(re.tagname)!==-1&&(D=this.tagsNodeStack.pop()),this.isItStopNode(this.options.stopNodes,z,Z)){let ae="";if(ee.length>0&&ee.lastIndexOf("/")===ee.length-1)ie=Y.closeIndex;else if(this.options.unpairedTags.indexOf(Z)!==-1)ie=Y.closeIndex;else{const te=this.readStopNodeData(E,Z,P+1);if(!te)throw new Error(`Unexpected end of ${Z}`);ie=te.i,ae=te.tagContent}const Te=new e(Z);Z!==ee&&w&&(Te[":@"]=this.buildAttributesMap(ee,z)),ae&&(ae=this.parseTextData(ae,Z,z,!0,w,!0,!0)),z=z.substr(0,z.lastIndexOf(".")),Te.add(this.options.textNodeName,ae),D.addChild(Te)}else{if(ee.length>0&&ee.lastIndexOf("/")===ee.length-1){Z[Z.length-1]==="/"?(Z=Z.substr(0,Z.length-1),ee=Z):ee=ee.substr(0,ee.length-1);const ae=new e(Z);Z!==ee&&w&&(ae[":@"]=this.buildAttributesMap(ee,z)),z=z.substr(0,z.lastIndexOf(".")),D.addChild(ae)}else{const ae=new e(Z);this.tagsNodeStack.push(D),Z!==ee&&w&&(ae[":@"]=this.buildAttributesMap(ee,z)),D.addChild(ae),D=ae}L="",ie=P}}else L+=E[ie];return G.child},S=function(E){if(this.options.processEntities){for(let G in this.docTypeEntities){const D=this.docTypeEntities[G];E=E.replace(D.regx,D.val)}for(let G in this.lastEntities){const D=this.lastEntities[G];E=E.replace(D.regex,D.val)}if(this.options.htmlEntities)for(let G in this.htmlEntities){const D=this.htmlEntities[G];E=E.replace(D.regex,D.val)}}return E};function b(E,G,D,L){return E&&(L===void 0&&(L=Object.keys(G.child).length===0),E=this.parseTextData(E,G.tagname,D,!1,G[":@"]?Object.keys(G[":@"]).length!==0:!1,L),E!==void 0&&E!==""&&G.add(this.options.textNodeName,E),E=""),E}function R(E,G,D){const L="*."+D;for(const z in E){const ie=E[z];if(L===ie||G===ie)return!0}return!1}function C(E,G,D=">"){let L,z="";for(let ie=G;ie<E.length;ie++){let ge=E[ie];if(L)ge===L&&(L="");else if(ge==='"'||ge==="'")L=ge;else if(ge===D[0])if(D[1]){if(E[ie+1]===D[1])return{data:z,index:ie}}else return{data:z,index:ie};else ge==="	"&&(ge=" ");z+=ge}}function j(E,G,D,L){const z=E.indexOf(G,D);if(z===-1)throw new Error(L);return z+G.length-1}function U(E,G,D,L=">"){const z=C(E,G+1,L);if(!z)return;let ie=z.data;const ge=z.index,Y=ie.search(/\s/);let Z=ie,ee=!0;if(Y!==-1&&(Z=ie.substr(0,Y).replace(/\s\s*$/,""),ie=ie.substr(Y+1)),D){const w=Z.indexOf(":");w!==-1&&(Z=Z.substr(w+1),ee=Z!==z.data.substr(w+1))}return{tagName:Z,tagExp:ie,closeIndex:ge,attrExpPresent:ee}}function _(E,G,D){const L=D;for(;D<E.length;D++)if(E[D]==="<"&&E[D+1]==="/"){const z=j(E,">",D,`${G} is not closed`);if(E.substring(D+2,z).trim()===G)return{tagContent:E.substring(L,D),i:z};D=z}}function H(E,G,D){if(G&&typeof E=="string"){const L=E.trim();return L==="true"?!0:L==="false"?!1:r(E,D)}else return s.isExist(E)?E:""}return Oi=a,Oi}var Mi={},lo;function Su(){if(lo)return Mi;lo=1;function s(u,d){return e(u,d)}function e(u,d,f){let h;const p={};for(let m=0;m<u.length;m++){const S=u[m],b=n(S);let R="";if(f===void 0?R=b:R=f+"."+b,b===d.textNodeName)h===void 0?h=S[b]:h+=""+S[b];else{if(b===void 0)continue;if(S[b]){let C=e(S[b],d,R);const j=a(C,d);S[":@"]?r(C,S[":@"],R,d):Object.keys(C).length===1&&C[d.textNodeName]!==void 0&&!d.alwaysCreateTextNode?C=C[d.textNodeName]:Object.keys(C).length===0&&(d.alwaysCreateTextNode?C[d.textNodeName]="":C=""),p[b]!==void 0?(Array.isArray(p[b])||(p[b]=[p[b]]),p[b].push(C)):d.isArray(b,R,j)?p[b]=[C]:p[b]=C}}}return typeof h=="string"?h.length>0&&(p[d.textNodeName]=h):h!==void 0&&(p[d.textNodeName]=h),p}function n(u){const d=Object.keys(u);for(let f=0;f<d.length;f++){const h=d[f];if(h!==":@")return h}}function r(u,d,f,h){if(d){const p=Object.keys(d),m=p.length;for(let S=0;S<m;S++){const b=p[S];h.isArray(b,f+"."+b,!0,!0)?u[b]=[d[b]]:u[b]=d[b]}}}function a(u,d){const f=Object.keys(u).length;return!!(f===0||f===1&&u[d.textNodeName])}return Mi.prettify=s,Mi}var ji,uo;function Eu(){if(uo)return ji;uo=1;const{buildOptions:s}=bu(),e=wu(),{prettify:n}=Su(),r=qo();class a{constructor(d){this.externalEntities={},this.options=s(d)}parse(d,f){if(typeof d!="string")if(d.toString)d=d.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(f){f===!0&&(f={});const m=r.validate(d,f);if(m!==!0)throw Error(`${m.err.msg}:${m.err.line}:${m.err.col}`)}const h=new e(this.options);h.addExternalEntities(this.externalEntities);const p=h.parseXml(d);return this.options.preserveOrder||p===void 0?p:n(p,this.options)}addEntity(d,f){if(f.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(d.indexOf("&")!==-1||d.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");this.externalEntities[d]=f}}return ji=a,ji}var Li,co;function ku(){if(co)return Li;co=1;const s=`
`;function e(f,h){return n(f,h,"",0)}function n(f,h,p,m){let S="",b="";h.format&&h.indentBy.length>0&&(b=s+""+h.indentBy.repeat(m));for(let R=0;R<f.length;R++){const C=f[R],j=r(C);let U="";if(p.length===0?U=j:U=`${p}.${j}`,j===h.textNodeName){let G=C[j];u(U,h)||(G=h.tagValueProcessor(j,G),G=d(G,h)),S+=b+G;continue}else if(j===h.cdataPropName){S+=b+`<![CDATA[${C[j][0][h.textNodeName]}]]>`;continue}else if(j===h.commentPropName){S+=b+`<!--${C[j][0][h.textNodeName]}-->`;continue}else if(j[0]==="?"){const G=a(C[":@"],h),D=j==="?xml"?"":b;let L=C[j][0][h.textNodeName];L=L.length!==0?" "+L:"",S+=D+`<${j}${L}${G}?>`;continue}const _=a(C[":@"],h);let H=b+`<${j}${_}`,E=n(C[j],h,U,m+1);h.unpairedTags.indexOf(j)!==-1?h.suppressUnpairedNode?S+=H+">":S+=H+"/>":(!E||E.length===0)&&h.suppressEmptyNode?S+=H+"/>":S+=H+`>${E}${b}</${j}>`}return S}function r(f){const h=Object.keys(f);for(let p=0;p<h.length;p++){const m=h[p];if(m!==":@")return m}}function a(f,h){let p="";if(f&&!h.ignoreAttributes)for(let m in f){let S=h.attributeValueProcessor(m,f[m]);S=d(S,h),S===!0&&h.suppressBooleanAttributes?p+=` ${m.substr(h.attributeNamePrefix.length)}`:p+=` ${m.substr(h.attributeNamePrefix.length)}="${S}"`}return p}function u(f,h){f=f.substr(0,f.length-h.textNodeName.length-1);let p=f.substr(f.lastIndexOf(".")+1);for(let m in h.stopNodes)if(h.stopNodes[m]===f||h.stopNodes[m]==="*."+p)return!0;return!1}function d(f,h){if(f&&f.length>0&&h.processEntities)for(let p=0;p<h.entities.length;p++){const m=h.entities[p];f=f.replace(m.regex,m.val)}return f}return Li=e,Li}var Bi,fo;function Tu(){if(fo)return Bi;fo=1;const s=ku(),e={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(b,R){return R},attributeValueProcessor:function(b,R){return R},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[]};function n(b){this.options=Object.assign({},e,b),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=S),this.processTextOrObjNode=a,this.options.format?(this.indentate=m,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.suppressEmptyNode?(this.buildTextNode=p,this.buildObjNode=d):(this.buildTextNode=f,this.buildObjNode=u),this.buildTextValNode=f,this.buildObjectNode=u,this.replaceEntitiesValue=h,this.buildAttrPairStr=r}n.prototype.build=function(b){return this.options.preserveOrder?s(b,this.options):(Array.isArray(b)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(b={[this.options.arrayNodeName]:b}),this.j2x(b,0).val)},n.prototype.j2x=function(b,R){let C="",j="";for(let U in b)if(!(typeof b[U]>"u"))if(b[U]===null)U[0]==="?"?j+=this.indentate(R)+"<"+U+"?"+this.tagEndChar:j+=this.indentate(R)+"<"+U+"/"+this.tagEndChar;else if(b[U]instanceof Date)j+=this.buildTextNode(b[U],U,"",R);else if(typeof b[U]!="object"){const _=this.isAttribute(U);if(_)C+=this.buildAttrPairStr(_,""+b[U]);else if(U===this.options.textNodeName){let H=this.options.tagValueProcessor(U,""+b[U]);j+=this.replaceEntitiesValue(H)}else j+=this.buildTextNode(b[U],U,"",R)}else if(Array.isArray(b[U])){const _=b[U].length;for(let H=0;H<_;H++){const E=b[U][H];typeof E>"u"||(E===null?U[0]==="?"?j+=this.indentate(R)+"<"+U+"?"+this.tagEndChar:j+=this.indentate(R)+"<"+U+"/"+this.tagEndChar:typeof E=="object"?j+=this.processTextOrObjNode(E,U,R):j+=this.buildTextNode(E,U,"",R))}}else if(this.options.attributesGroupName&&U===this.options.attributesGroupName){const _=Object.keys(b[U]),H=_.length;for(let E=0;E<H;E++)C+=this.buildAttrPairStr(_[E],""+b[U][_[E]])}else j+=this.processTextOrObjNode(b[U],U,R);return{attrStr:C,val:j}};function r(b,R){return R=this.options.attributeValueProcessor(b,""+R),R=this.replaceEntitiesValue(R),this.options.suppressBooleanAttributes&&R==="true"?" "+b:" "+b+'="'+R+'"'}function a(b,R,C){const j=this.j2x(b,C+1);return b[this.options.textNodeName]!==void 0&&Object.keys(b).length===1?this.buildTextNode(b[this.options.textNodeName],R,j.attrStr,C):this.buildObjNode(j.val,R,j.attrStr,C)}function u(b,R,C,j){let U="</"+R+this.tagEndChar,_="";return R[0]==="?"&&(_="?",U=""),C&&b.indexOf("<")===-1?this.indentate(j)+"<"+R+C+_+">"+b+U:this.options.commentPropName!==!1&&R===this.options.commentPropName&&_.length===0?this.indentate(j)+`<!--${b}-->`+this.newLine:this.indentate(j)+"<"+R+C+_+this.tagEndChar+b+this.indentate(j)+U}function d(b,R,C,j){return b!==""?this.buildObjectNode(b,R,C,j):R[0]==="?"?this.indentate(j)+"<"+R+C+"?"+this.tagEndChar:this.indentate(j)+"<"+R+C+"/"+this.tagEndChar}function f(b,R,C,j){if(this.options.cdataPropName!==!1&&R===this.options.cdataPropName)return this.indentate(j)+`<![CDATA[${b}]]>`+this.newLine;if(this.options.commentPropName!==!1&&R===this.options.commentPropName)return this.indentate(j)+`<!--${b}-->`+this.newLine;{let U=this.options.tagValueProcessor(R,b);return U=this.replaceEntitiesValue(U),U===""&&this.options.unpairedTags.indexOf(R)!==-1?this.options.suppressUnpairedNode?this.indentate(j)+"<"+R+this.tagEndChar:this.indentate(j)+"<"+R+"/"+this.tagEndChar:this.indentate(j)+"<"+R+C+">"+U+"</"+R+this.tagEndChar}}function h(b){if(b&&b.length>0&&this.options.processEntities)for(let R=0;R<this.options.entities.length;R++){const C=this.options.entities[R];b=b.replace(C.regex,C.val)}return b}function p(b,R,C,j){return b===""&&this.options.unpairedTags.indexOf(R)!==-1?this.options.suppressUnpairedNode?this.indentate(j)+"<"+R+this.tagEndChar:this.indentate(j)+"<"+R+"/"+this.tagEndChar:b!==""?this.buildTextValNode(b,R,C,j):R[0]==="?"?this.indentate(j)+"<"+R+C+"?"+this.tagEndChar:this.indentate(j)+"<"+R+C+"/"+this.tagEndChar}function m(b){return this.options.indentBy.repeat(b)}function S(b){return b.startsWith(this.options.attributeNamePrefix)?b.substr(this.attrPrefixLen):!1}return Bi=n,Bi}var Fi,ho;function Cu(){if(ho)return Fi;ho=1;const s=qo(),e=Eu(),n=Tu();return Fi={XMLParser:e,XMLValidator:s,XMLBuilder:n},Fi}var _u=Cu();const Ru=/<(\/)?c(\.[^>]*)?>/g,Iu=RegExp(/\\[nN]/,"ig"),Ir=document.createElement("div"),Pu=(s,e)=>{if(typeof s.line=="number"&&typeof e.line=="number"){if(s.line<e.line)return-1;if(s.line>e.line)return 1;if(typeof s.position=="number"&&typeof e.position=="number")return s.position<e.position?-1:s.position>e.position?1:0}return 0},po=s=>s.length<=1?s:s.sort(Pu);class Au{constructor({regexFilter:e,regexFilterTextReplacement:n,subtitleHtml:r,pgsParserWorkerFactory:a}){ce(this,"_textFilter");ce(this,"_removeXml");ce(this,"_pgsWorkerFactory");ce(this,"xmlParser");let u;try{u=e.trim()===""?void 0:new RegExp(e,"gv")}catch{u=void 0}u===void 0?this._textFilter=void 0:this._textFilter={regex:u,replacement:n},this._removeXml=r===Sa.remove,this._pgsWorkerFactory=a}async subtitles(e,n){const r=(await Promise.all(e.map((a,u)=>this._subtitles(a,n===!0?0:u)))).flatMap(a=>a).filter(a=>a.textImage!==void 0||a.text!=="").sort((a,u)=>a.start-u.start);return n?this._deduplicate(r):r}_deduplicate(e){const n=[];for(const r of e)(n.length==0||!this._isSame(r,n[n.length-1]))&&n.push(r);return n}_isSame(e,n){return e.textImage||n.textImage?!1:e.start===n.start&&e.end===n.end&&e.text===n.text}async _subtitles(e,n){if(e.name.endsWith(".srt")||e.name.endsWith(".subrip"))return new Us({numericTimestamps:!0}).fromSrt(await e.text()).map(u=>({start:Math.floor(u.startTime*1e3),end:Math.floor(u.endTime*1e3),text:this._filterText(u.text),track:n}));if(e.name.endsWith(".vtt")||e.name.endsWith(".nfvtt"))return new Promise(async(r,a)=>{const u=e.name.endsWith(".nfvtt"),d=new eo.WebVTT.Parser(window,eo.WebVTT.StringDecoder()),f=[];let h,p=[];d.oncue=m=>{if(m.text=this._filterText(m.text.replaceAll(Ru,"")),u){const b=m.text.split(`
`),R=[];for(const C of b)R.push(this._fixRTL(C));m.text=R.join(`
`)}const S=Math.floor(m.startTime*1e3);h===void 0||h===S?p.push(m):(p=po(p),f.push(p),p=[m]),h=S},d.onflush=()=>{p=po(p),f.push(p);const m=[];for(const S of f)for(const b of S)m.push({start:Math.floor(b.startTime*1e3),end:Math.floor(b.endTime*1e3),text:b.text,track:n});r(m)},d.parse(await e.text()),d.flush()});if(e.name.endsWith(".ass"))return cu(await e.text(),{}).dialogues.map(a=>({start:Math.round(a.start*1e3),end:Math.round(a.end*1e3),text:this._filterText(a.slices.flatMap(u=>u.fragments.map(d=>d.text)).join("")).replace(Iu,`
`),track:n}));if(e.name.endsWith(".ytsrv3")){const r=await e.text(),u=this._xmlParser().parse(r).timedtext.body.p,d=[];for(let f=0;f<u.length;f++){const h=u[f];if(typeof h["@_t"]!="string"||typeof h["@_d"]!="string")continue;const p=Number(h["@_t"]);let m=Number(h["@_d"]);if(Number.isNaN(p)||Number.isNaN(m))continue;let S=[];typeof h["#text"]=="string"&&S.push(h["#text"]);const b=h.s;if(b!==void 0)if(typeof b=="object"&&Array.isArray(b))for(const C of h.s)typeof C=="string"?S.push(C):typeof C["#text"]=="string"&&S.push(C["#text"]);else typeof b["#text"]=="string"&&S.push(b["#text"]);const R=S.join("").trim();if(R){let C=u[f+1];if((C==null?void 0:C["#text"])===`
`&&typeof C["@_t"]=="string"){const j=Number(C["@_t"]);Number.isNaN(j)||(m=Math.min(m,j-p))}d.push({start:p,end:p+m,text:this._filterText(R),track:n})}}return d}if(e.name.endsWith(".ytxml")){const r=await e.text(),a=this._xmlParser().parse(r);if(Object.keys(a).length===0)return[];const u=a.transcript.text,d=[];let f=0,h;for(let m=0,S=u.length;m<S;m++){const b=u[m];if(!("#text"in b)||!("@_dur"in b)||!("@_start"in b))continue;const R=parseFloat(b["@_start"]),C={start:Math.floor(R*1e3),end:Math.floor((R+parseFloat(b["@_dur"]))*1e3),text:this._filterText(this._decodeHTML(String(b["#text"]))),track:n};h!==void 0&&h.end>C.start&&++f,d.push(C),h=C}return d.length>0&&f/d.length>.5?d.map((m,S)=>S<d.length-1?{...m,end:Math.max(m.start,Math.min(d[S+1].start-1,m.end))}:m):d}if(e.name.endsWith(".sup"))return await this._parsePgs(e,n);if(e.name.endsWith(".dfxp")||e.name.endsWith("ttml2")){const r=await e.text(),u=new DOMParser().parseFromString(r,"application/xml"),d=this._xmlNodePath(u.documentElement,["body","div"]),f=[];for(let h=0,p=d.length;h<p;h++){const m=d[h],S=m.getAttribute("begin"),b=m.getAttribute("end");if(S===null||b===null)continue;const R=this._decodeHTML(m.innerHTML.replaceAll(/<br(\s[^\s]+)?(\/)?>/g,`
`));f.push({text:this._filterText(R),start:this._parseTtmlTimestamp(S),end:this._parseTtmlTimestamp(b),track:n})}return f}if(e.name.endsWith(".bbjson"))return JSON.parse(await e.text()).body.map(a=>({text:a.content,start:a.from*1e3,end:a.to*1e3,track:n}));throw new Error("Unsupported subtitle file format")}_parsePgs(e,n){const r=[];return new Promise(async(a,u)=>{const d=await this._pgsWorkerFactory();d.onmessage=async m=>{switch(m.data.command){case"subtitle":const S={...m.data.subtitle,track:n},b=m.data.imageBlob;S.textImage.dataUrl=await this._blobToDataUrl(b),r.push(S);break;case"finished":d.terminate(),a(r);break;case"error":d.terminate(),u(m.data.error);break}},d.onerror=m=>{const S=(m==null?void 0:m.error)??new Error("PGS decoding failed: "+(m==null?void 0:m.message));u(S),d.terminate()};const h=document.createElement("canvas").transferControlToOffscreen(),p=await e.stream();d.postMessage({fileStream:p,canvas:h},[p,h])})}_blobToDataUrl(e){return new Promise((n,r)=>{var a=new FileReader;a.readAsDataURL(e),a.onloadend=()=>{n(a.result)}})}_parseTtmlTimestamp(e){const n=e.split(":"),r=Math.floor(parseFloat(n[n.length-1])*1e3),a=n.length<2?0:Number(n[n.length-2]),u=n.length<3?0:Number(n[n.length-3]);return r+a*6e4+u*36e5}_xmlNodePath(e,n){if(n.length===0){const r=[];for(let a=0;a<e.children.length;++a){const u=e.children[a];r.push(u)}return r}for(let r=0;r<e.children.length;++r){const a=e.children[r];if(this._dropTagNamespace(a.tagName)===n[0])return this._xmlNodePath(a,n.slice(1))}throw new Error("Failied to parse XML path")}_dropTagNamespace(e){const n=e.lastIndexOf(":");return n!==-1?e.substring(n+1):e}_fixRTL(e){const n=e.indexOf("&lrm;"),r=e.indexOf("&rlm;");let a="";return n>-1?(a=e.substring(0,n)+"‪"+e.substring(n+5)+"‬",this._fixRTL(a)):r>-1?(a=e.substring(0,r)+"‫"+e.substring(r+5)+"‬",this._fixRTL(a)):e}_decodeHTML(e){Ir.innerHTML=e;const n=[...Ir.getElementsByTagName("rt")];for(const r of n)r.remove();return Ir.textContent??Ir.innerText}_xmlParser(){return this.xmlParser===void 0&&(this.xmlParser=new _u.XMLParser({ignoreAttributes:!1,trimValues:!1})),this.xmlParser}_filterText(e){return e=this._textFilter===void 0?e:e.replace(this._textFilter.regex,this._textFilter.replacement).trim(),this._removeXml&&(e=this._decodeHTML(e)),e}subtitlesToSrt(e){const n=new Us({numericTimestamps:!0}),r=e.map((a,u)=>({id:String(u),startTime:a.start,endTime:a.end,text:a.text}));return n.toSrt(r)}async filesToSrt(e){return this.subtitlesToSrt(await this.subtitles(e))}}const Nu=class zi{constructor(e,n){this.low=e,this.high=n}clone(){return new zi(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low==e.low&&this.high<e.high}equal_to(e){return this.low==e.low&&this.high==e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(e){return new zi(this.low===void 0?e.low:Math.min(this.low,e.low),this.high===void 0?e.high:Math.max(this.high,e.high))}output(){return[this.low,this.high]}static comparable_max(e,n){return e.merge(n)}static comparable_less_than(e,n){return e<n}},Rt=0,tt=1;class $n{constructor(e=void 0,n=void 0,r=null,a=null,u=null,d=tt){this.left=r,this.right=a,this.parent=u,this.color=d,this.item={key:e,value:n},e&&e instanceof Array&&e.length==2&&!Number.isNaN(e[0])&&!Number.isNaN(e[1])&&(this.item.key=new Nu(Math.min(e[0],e[1]),Math.max(e[0],e[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===tt}less_than(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.less_than(e.item.key);{let n=this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value;return this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&n}}equal_to(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.equal_to(e.item.key);{let n=this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value==e.item.value;return this.item.key.equal_to(e.item.key)&&n}}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key,this.item.value=e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){const e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){const e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){const n=this.item.key.constructor.comparable_less_than;let r=this.left.max.high!==void 0?this.left.max.high:this.left.max;return n(r,e.item.key.low)}not_intersect_right_subtree(e){const n=this.item.key.constructor.comparable_less_than;let r=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return n(e.item.key.high,r)}}class jr{constructor(){this.root=null,this.nil_node=new $n}get size(){let e=0;return this.tree_walk(this.root,()=>e++),e}get keys(){let e=[];return this.tree_walk(this.root,n=>e.push(n.item.key.output?n.item.key.output():n.item.key)),e}get values(){let e=[];return this.tree_walk(this.root,n=>e.push(n.item.value)),e}get items(){let e=[];return this.tree_walk(this.root,n=>e.push({key:n.item.key.output?n.item.key.output():n.item.key,value:n.item.value})),e}isEmpty(){return this.root==null||this.root==this.nil_node}clear(){this.root=null}insert(e,n=e){if(e===void 0)return;let r=new $n(e,n,this.nil_node,this.nil_node,null,Rt);return this.tree_insert(r),this.recalc_max(r),r}exist(e,n=e){let r=new $n(e,n);return!!this.tree_search(this.root,r)}remove(e,n=e){let r=new $n(e,n),a=this.tree_search(this.root,r);return a&&this.tree_delete(a),a}search(e,n=(r,a)=>r===a?a.output():r){let r=new $n(e),a=[];return this.tree_search_interval(this.root,r,a),a.map(u=>n(u.item.value,u.item.key))}intersect_any(e){let n=new $n(e);return this.tree_find_any_interval(this.root,n)}forEach(e){this.tree_walk(this.root,n=>e(n.item.key,n.item.value))}map(e){const n=new jr;return this.tree_walk(this.root,r=>n.insert(r.item.key,e(r.item.value,r.item.key))),n}recalc_max(e){let n=e;for(;n.parent!=null;)n.parent.update_max(),n=n.parent}tree_insert(e){let n=this.root,r=null;if(this.root==null||this.root==this.nil_node)this.root=e;else{for(;n!=this.nil_node;)r=n,e.less_than(n)?n=n.left:n=n.right;e.parent=r,e.less_than(r)?r.left=e:r.right=e}this.insert_fixup(e)}insert_fixup(e){let n,r;for(n=e;n!=this.root&&n.parent.color==Rt;)n.parent==n.parent.parent.left?(r=n.parent.parent.right,r.color==Rt?(n.parent.color=tt,r.color=tt,n.parent.parent.color=Rt,n=n.parent.parent):(n==n.parent.right&&(n=n.parent,this.rotate_left(n)),n.parent.color=tt,n.parent.parent.color=Rt,this.rotate_right(n.parent.parent))):(r=n.parent.parent.left,r.color==Rt?(n.parent.color=tt,r.color=tt,n.parent.parent.color=Rt,n=n.parent.parent):(n==n.parent.left&&(n=n.parent,this.rotate_right(n)),n.parent.color=tt,n.parent.parent.color=Rt,this.rotate_left(n.parent.parent)));this.root.color=tt}tree_delete(e){let n,r;e.left==this.nil_node||e.right==this.nil_node?n=e:n=this.tree_successor(e),n.left!=this.nil_node?r=n.left:r=n.right,r.parent=n.parent,n==this.root?this.root=r:(n==n.parent.left?n.parent.left=r:n.parent.right=r,n.parent.update_max()),this.recalc_max(r),n!=e&&(e.copy_data(n),e.update_max(),this.recalc_max(e)),n.color==tt&&this.delete_fixup(r)}delete_fixup(e){let n=e,r;for(;n!=this.root&&n.parent!=null&&n.color==tt;)n==n.parent.left?(r=n.parent.right,r.color==Rt&&(r.color=tt,n.parent.color=Rt,this.rotate_left(n.parent),r=n.parent.right),r.left.color==tt&&r.right.color==tt?(r.color=Rt,n=n.parent):(r.right.color==tt&&(r.color=Rt,r.left.color=tt,this.rotate_right(r),r=n.parent.right),r.color=n.parent.color,n.parent.color=tt,r.right.color=tt,this.rotate_left(n.parent),n=this.root)):(r=n.parent.left,r.color==Rt&&(r.color=tt,n.parent.color=Rt,this.rotate_right(n.parent),r=n.parent.left),r.left.color==tt&&r.right.color==tt?(r.color=Rt,n=n.parent):(r.left.color==tt&&(r.color=Rt,r.right.color=tt,this.rotate_left(r),r=n.parent.left),r.color=n.parent.color,n.parent.color=tt,r.left.color=tt,this.rotate_right(n.parent),n=this.root));n.color=tt}tree_search(e,n){if(!(e==null||e==this.nil_node))return n.equal_to(e)?e:n.less_than(e)?this.tree_search(e.left,n):this.tree_search(e.right,n)}tree_search_interval(e,n,r){e!=null&&e!=this.nil_node&&(e.left!=this.nil_node&&!e.not_intersect_left_subtree(n)&&this.tree_search_interval(e.left,n,r),e.intersect(n)&&r.push(e),e.right!=this.nil_node&&!e.not_intersect_right_subtree(n)&&this.tree_search_interval(e.right,n,r))}tree_find_any_interval(e,n){let r=!1;return e!=null&&e!=this.nil_node&&(e.left!=this.nil_node&&!e.not_intersect_left_subtree(n)&&(r=this.tree_find_any_interval(e.left,n)),r||(r=e.intersect(n)),!r&&e.right!=this.nil_node&&!e.not_intersect_right_subtree(n)&&(r=this.tree_find_any_interval(e.right,n))),r}local_minimum(e){let n=e;for(;n.left!=null&&n.left!=this.nil_node;)n=n.left;return n}local_maximum(e){let n=e;for(;n.right!=null&&n.right!=this.nil_node;)n=n.right;return n}tree_successor(e){let n,r,a;if(e.right!=this.nil_node)n=this.local_minimum(e.right);else{for(r=e,a=e.parent;a!=null&&a.right==r;)r=a,a=a.parent;n=a}return n}rotate_left(e){let n=e.right;e.right=n.left,n.left!=this.nil_node&&(n.left.parent=e),n.parent=e.parent,e==this.root?this.root=n:e==e.parent.left?e.parent.left=n:e.parent.right=n,n.left=e,e.parent=n,e!=null&&e!=this.nil_node&&e.update_max(),n=e.parent,n!=null&&n!=this.nil_node&&n.update_max()}rotate_right(e){let n=e.left;e.left=n.right,n.right!=this.nil_node&&(n.right.parent=e),n.parent=e.parent,e==this.root?this.root=n:e==e.parent.left?e.parent.left=n:e.parent.right=n,n.right=e,e.parent=n,e!=null&&e!=this.nil_node&&e.update_max(),n=e.parent,n!=null&&n!=this.nil_node&&n.update_max()}tree_walk(e,n){e!=null&&e!=this.nil_node&&(this.tree_walk(e.left,n),n(e),this.tree_walk(e.right,n))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,function(n){n.color==Rt&&(n.left.color==tt&&n.right.color==tt||(e=!1))}),e}testBlackHeightProperty(e){let n=0,r=0,a=0;if(e.color==tt&&n++,e.left!=this.nil_node?r=this.testBlackHeightProperty(e.left):r=1,e.right!=this.nil_node?a=this.testBlackHeightProperty(e.right):a=1,r!=a)throw new Error("Red-black height property violated");return n+=r,n}}const nr=class nr{constructor(e,n={}){ce(this,"tree");ce(this,"gapsTree");ce(this,"options");if(this.tree=new jr,this.options=n,n.returnLastShown||n.returnNextToShow){let r;this.gapsTree=new jr,e.length>0&&e[0].start>0&&this.gapsTree.insert([0,e[0].start-1],e[0]);for(const a of e)a.start<a.end&&this.tree.insert([a.start,a.end-1],a),r!==void 0&&r.end<a.start&&this.gapsTree.insert([r.end,a.start-1],r),r=a}else for(const r of e)this.tree.insert([r.start,r.end-1],r)}static empty(){return nr.emptySubtitleCollection}subtitlesAt(e){const n=[e,e],r=this.tree.search(n);let a,u,d,f;if(r.length===0){if(this.gapsTree!==void 0){const h=[];if(a=this.gapsTree.search(n,(p,m)=>(h.push(m),p)),a.length>0&&this.options.returnNextToShow){const p=h[0].high+1;u=this.tree.search([p,p])}}}else if(this.options.showingCheckRadiusMs!==void 0){for(const h of r)if(f===void 0&&h.end<=e+this.options.showingCheckRadiusMs&&(f=h),d===void 0&&e-this.options.showingCheckRadiusMs<h.start&&(d=h),d!==void 0&&f!==void 0)break}return{showing:r,lastShown:a,nextToShow:u,startedShowing:d,willStopShowing:f}}};ce(nr,"emptySubtitleCollection",new nr([]));let ir=nr;function Ou(s,e){for(let n in s)if(!(n in e))return!1;for(let n in e)if(!(n in s))return!1;return!0}function sr(s,e,n=!0){if(s<0)return sr(0,e);s=Math.round(s);const r=s%1e3;s=(s-r)/1e3;const a=s%60;s=(s-a)/60;const u=s%60;if(e>=36e5){const d=(s-u)/60;return n?an(d)+":"+an(u)+":"+an(a)+"."+an(r,3):an(d)+":"+an(u)+":"+an(a)}return n?an(u)+":"+an(a)+"."+an(r,3):an(u)+":"+an(a)}function an(s,e=2){return String(s).padStart(e,"0")}class Mu{constructor(e){ce(this,"channel");ce(this,"onMessage");this.channel=new BroadcastChannel(e);const n=this;this.channel.onmessage=r=>{var a;(a=n.onMessage)==null||a.call(n,r)}}postMessage(e){var n;(n=this.channel)==null||n.postMessage(e)}close(){var e;(e=this.channel)==null||e.close(),this.channel=void 0}}class ju{constructor(e,n,r){ce(this,"tabId");ce(this,"src");ce(this,"extension");ce(this,"listener");ce(this,"unsubscribeFromExtension");ce(this,"onMessage");this.tabId=e,this.src=n,this.listener=a=>{var u;a.tabId===e&&a.src===n&&((u=this.onMessage)==null||u.call(this,{data:a.data}))},this.unsubscribeFromExtension=r.subscribe(this.listener),this.extension=r}postMessage(e){this.extension.sendMessageToVideoElement(e,this.tabId,this.src)}close(){this.unsubscribeFromExtension()}}class Lu{constructor(){ce(this,"_accumulated");ce(this,"_started");ce(this,"_startTime");ce(this,"_rate",1);ce(this,"_callbacks",{stop:[],start:[],settime:[]});this._accumulated=0,this._started=!1}get running(){return this._started}get rate(){return this._rate}set rate(e){this._started&&(this._accumulated+=this._elapsed(),this._startTime=Date.now()),this._rate=e}time(e){return this._started?Math.min(e,this._accumulated+this._elapsed()):Math.min(e,this._accumulated)}stop(){if(!this._started){this._fireEvent("stop");return}this._started=!1,this._accumulated+=this._elapsed(),this._fireEvent("stop")}_elapsed(){return(Date.now()-this._startTime)*this._rate}start(){this._startTime=Date.now(),this._started=!0,this._fireEvent("start")}setTime(e){this._started?(this._startTime=Date.now(),this._accumulated=e):this._accumulated=e,this._fireEvent("settime")}progress(e){return e===0?0:Math.min(1,this.time(e)/e)}onEvent(e,n){return this._callbacks[e].push(n),()=>this._remove(n,this._callbacks[e])}_fireEvent(e){for(const n of this._callbacks[e])n()}_remove(e,n){for(let r=n.length-1;r>=0;--r)if(e===n[r]){n.splice(r,1);break}}}const Bu=ft(v.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),Fu=ft(v.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),$u=ft(v.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Hu=ft(v.jsx("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"}),"Folder"),Du=ft(v.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"OpenInNew"),Vu=ft(v.jsx("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),qu=ft(v.jsx("path",{d:"M19 12h-2v3h-3v2h5zM7 9h3V7H5v5h2zm14-6H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16.01H3V4.99h18z"}),"AspectRatio"),Ku=ft(v.jsx("path",{d:"M5 16h3v3h2v-5H5zm3-8H5v2h5V5H8zm6 11h2v-3h3v-2h-5zm2-11V5h-2v5h5V8z"}),"FullscreenExit"),zu=ft(v.jsx("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause"),Uu=ft(v.jsx("path",{d:"M15 6H3v2h12zm0 4H3v2h12zM3 16h8v-2H3zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6z"}),"QueueMusic"),Xu=ft(v.jsx("path",{d:"M8 11h3v10h2V11h3l-4-4zM4 3v2h16V3z"}),"VerticalAlignTop"),Wu=ft(v.jsx("path",{d:"M16 13h-3V3h-2v10H8l4 4zM4 19v2h16v-2z"}),"VerticalAlignBottom"),Gu=ft(v.jsx("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11z"}),"Videocam"),Yu=ft(v.jsx("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63m2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71M4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9zM12 4 9.91 6.09 12 8.18z"}),"VolumeOff"),Ju=ft(v.jsx("path",{d:"M3 9v6h4l5 5V4L7 9zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77"}),"VolumeUp"),Qu=({videoElement:s})=>{const e=or();return v.jsx(v.Fragment,{children:s.faviconUrl&&v.jsx("img",{src:s.faviconUrl,style:{width:24,marginRight:e.spacing(1)}})})},Zu=bn(s=>({container:{position:"absolute",left:"50%",width:"50%",bottom:0,pointerEvents:"none",color:"#fff"},buttonContainer:{flexDirection:"row"},numberInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:100,color:"#fff",pointerEvents:"auto"},volumeInputContainerShown:{transition:s.transitions.create("margin",{easing:s.transitions.easing.sharp,duration:s.transitions.duration.short}),marginRight:5,pointerEvents:"auto"},volumeInputContainerHidden:{transition:s.transitions.create("margin",{easing:s.transitions.easing.sharp,duration:s.transitions.duration.short}),marginRight:0,pointerEvents:"auto"},volumeInputHidden:{transition:s.transitions.create("width",{easing:s.transitions.easing.sharp,duration:s.transitions.duration.short}),width:0,opacity:0,pointerEvents:"auto"},volumeInputShown:{transition:s.transitions.create("width",{easing:s.transitions.easing.easeOut,duration:s.transitions.duration.short}),width:100,opacity:1,pointerEvents:"auto"},volumeInputThumbHidden:{transition:s.transitions.create("visibility",{easing:s.transitions.easing.sharp,duration:s.transitions.duration.short}),opacity:0,pointerEvents:"auto"},volumeInputThumbShown:{transition:s.transitions.create("visibility",{easing:s.transitions.easing.easeOut,duration:s.transitions.duration.short}),opacity:1,pointerEvents:"auto"},volumeInputRailHidden:{transition:s.transitions.create("visibility",{easing:s.transitions.easing.sharp,duration:s.transitions.duration.short}),opacity:0,pointerEvents:"auto"},volumeInputRailShown:{transition:s.transitions.create("visibility",{easing:s.transitions.easing.easeOut,duration:s.transitions.duration.short}),opacity:1,pointerEvents:"auto"},subContainer:{background:"linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, .4) 40%, rgba(0, 0, 0, 0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10},button:{pointerEvents:"auto"},inactiveButton:{color:"rgba(120, 120, 120, 0.7)",pointerEvents:"auto"},inactiveTopButton:{color:"rgba(255, 255, 255, 0.5)",pointerEvents:"auto"},progress:{margin:5},topButton:{pointerEvents:"auto",color:"#fff"},gridContainer:{pointerEvents:"auto",padding:2}})),ec=bn(s=>({root:{height:10},container:{height:10,pointerEvents:"auto",display:"flex",justifyContent:"center",flexDirection:"column",position:"absolute",width:"calc(100% - 20px)",marginLeft:10},mouseEventListener:{zIndex:1,height:10,cursor:"pointer",pointerEvents:"auto",position:"absolute",width:"100%"},fillContainer:{background:"rgba(30,30,30,0.7)",width:"100%",height:5,position:"relative"},fillContainerThick:{transition:s.transitions.create("height",{easing:s.transitions.easing.easeInOut,duration:50}),height:8},fill:{background:"linear-gradient(to left, #ff1f62, #49007a)",height:"100%"},handleContainer:{position:"absolute",display:"flex",justifyContent:"center",flexDirection:"column",height:"100%",bottom:0},handle:{borderRadius:"50%",width:16,height:16,opacity:0,left:-8,background:"white",position:"absolute"},handleOn:{opacity:1,transition:s.transitions.create("opacity",{easing:s.transitions.easing.easeInOut,duration:s.transitions.duration.shortest})}})),tc=Da(s=>({root:{color:"white",verticalAlign:"middle"},thumb:{backgroundColor:"white",color:"white","&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:"white"}}))(Va);function nc(s){const e=s.getBoundingClientRect();return e.right-e.left}function rc({onSeek:s,value:e}){const n=ec(),[r,a]=y.useState(!1),u=y.useRef(null),d=y.useCallback(C=>{const j=C.currentTarget.getBoundingClientRect(),U=j.right-j.left-20,_=Math.min(1,Math.max(0,(C.pageX-j.left-10)/U));s(_)},[s]),f=y.useCallback(()=>a(!0),[]),h=y.useCallback(()=>a(!1),[]),p=Number.isFinite(e)&&u.current?nc(u.current)*e/100:0,m={width:p},S={marginLeft:p},b=r?n.fillContainer+" "+n.fillContainerThick:n.fillContainer,R=r?n.handle+" "+n.handleOn:n.handle;return v.jsxs("div",{className:n.root,children:[v.jsx("div",{ref:u,className:n.container,children:v.jsxs("div",{className:b,children:[v.jsx("div",{className:n.fill,style:m}),v.jsx("div",{className:n.handleContainer,children:v.jsx("div",{className:R,style:S})})]})}),v.jsx("div",{className:n.mouseEventListener,onClick:d,onMouseOver:f,onMouseOut:h})]})}function ic({open:s,anchorEl:e,audioTracks:n,selectedAudioTrack:r,onAudioTrackSelected:a,onClose:u}){if(!n||n.length===0)return null;const d=n.map(f=>v.jsx(mn,{disablePadding:!0,onClick:()=>a(f.id),children:v.jsx(Pn,{selected:f.id===r,children:v.jsxs(An,{children:[f.language," ",f.label]})})},f.id));return v.jsx("div",{children:v.jsx(Zi,{disableEnforceFocus:!0,open:s,anchorEl:e,onClose:u,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:v.jsx(Hr,{children:d})})})}function sc({open:s,anchorEl:e,onClose:n,tabs:r,selectedTab:a,onTabSelected:u}){if(!r||r.length===0)return null;const d=r.map(f=>v.jsx(mn,{disablePadding:!0,onClick:()=>u(f),children:v.jsxs(Pn,{selected:a&&f.id===a.id&&f.src===a.src,children:[v.jsx(Qu,{videoElement:f})," ",f.title]})},`${f.id}:${f.src}`));return v.jsx("div",{children:v.jsx(Zi,{disableEnforceFocus:!0,open:s,anchorEl:e,onClose:n,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:v.jsx(Hr,{children:d})})})}const oc=({children:s})=>{const e=or(),n=Mo(e.breakpoints.down(600)),[r,a]=Dn.useState(),u=()=>{a(void 0)},d=p=>{a(p.currentTarget)},f=r!==void 0&&document.body.contains(r),h=s.filter(p=>p!==void 0&&p!==!1);return n&&h.length>1?v.jsxs(v.Fragment,{children:[v.jsx(rt,{item:!0,children:v.jsx(dt,{color:"inherit",onClick:d,children:v.jsx(Po,{})})}),v.jsx(qa,{anchorEl:f?r:void 0,open:f,onClose:u,children:h.map((p,m)=>v.jsx(Ka,{children:p},m))})]}):v.jsx(v.Fragment,{children:s.map((p,m)=>v.jsx(rt,{item:!0,children:p},m))})};function ac({clock:s,length:e,offsetEnabled:n,displayLength:r,offset:a,playbackRate:u,playbackRateEnabled:d,onAudioTrackSelected:f,onSeek:h,mousePositionRef:p,onShow:m,onPause:S,onPlay:b,onTabSelected:R,onUnloadVideo:C,onOffsetChange:j,onPlaybackRateChange:U,onVolumeChange:_,disableKeyEvents:H,playbackPreferences:E,closeEnabled:G,onClose:D,volumeEnabled:L,playMode:z,playModeEnabled:ie,onPlayMode:ge,subtitlesEnabled:Y,subtitlesToggle:Z,onSubtitlesToggle:ee,audioTracks:w,selectedAudioTrack:P,tabs:re,selectedTab:ae,popOutEnabled:Te,popOut:te,onPopOutToggle:ye,fullscreenEnabled:xe,fullscreen:we,onFullscreenToggle:se,hideSubtitlePlayerToggleEnabled:pe,subtitlePlayerHidden:_e,onHideSubtitlePlayerToggle:Pe,showOnMouseMovement:je,theaterModeToggleEnabled:Ae,theaterModeEnabled:Re,onTheaterModeToggle:fe,subtitleAlignment:Fe,subtitleAlignmentEnabled:Le,onSubtitleAlignment:Ie,hideToolbar:yt,onLoadFiles:mt}){const Me=Zu(),{t:Ye}=hn(),[vt,Ce]=y.useState(!0),[Ne,He]=y.useState(!1),[We,lt]=y.useState(),[Pt,Kt]=y.useState(!1),[Tt,bt]=y.useState(),[At,Jt]=y.useState(!1),[$,Qt]=y.useState(),[Nt,xt]=y.useState(!1),[Ot,zt]=y.useState(100),[Ct,Se]=y.useState(100),ne=or(),de=Mo(ne.breakpoints.down(380)),oe=y.useRef(void 0),O=y.useRef(Date.now()),ot=y.useRef(Date.now()),Ge=y.useRef(!0),nt=y.useRef(!1),qe=y.useRef(),ht=y.useRef(),Zt=y.useRef(null),[,en]=y.useState(),ut=y.useCallback(()=>en({}),[]),Xt=y.useCallback(Xe=>{h(Xe)},[h]);function tn(){nt.current=!0}function ct(){nt.current=!1}y.useEffect(()=>{const Xe=Number(E.volume);zt(Xe),_==null||_(Xe/100),Xe>0&&Se(Xe)},[E,_]);const[Ue,Qe]=y.useState(s.running);y.useEffect(()=>{s.onEvent("start",()=>Qe(!0)),Qe(s.running)},[s]),y.useEffect(()=>{s.onEvent("stop",()=>Qe(!1)),Qe(s.running)},[s]),y.useEffect(()=>{const Xe=setInterval(()=>{var Q,Ee;let Ze;je?Ze=Date.now()-O.current<2e3||p.current!==void 0&&oe.current!==void 0&&Math.pow(p.current.x-oe.current.x,2)+Math.pow(p.current.y-oe.current.y,2)>100:Ze=p.current!==void 0&&(Zt.current!==null&&p.current.y>Zt.current.offsetTop-20||p.current.y<70),Ze=Ze||nt.current||qe.current===document.activeElement||ht.current===document.activeElement||!Ue&&Gi.isMobile||Date.now()-ot.current<2e3,Ze&&!Ge.current?(O.current=Date.now(),Ce(Ze)):!Ze&&Ge.current&&Ce(Ze),Ge.current=Ze,oe.current={x:((Q=p.current)==null?void 0:Q.x)??0,y:((Ee=p.current)==null?void 0:Ee.y)??0}},100);return()=>clearInterval(Xe)},[p,je,Ue]),y.useEffect(()=>m==null?void 0:m(vt),[m,vt]);const $t=y.useCallback(Xe=>{ot.current=Date.now(),j(Xe)},[j]),yn=y.useCallback(Xe=>{ot.current=Date.now(),U(Xe)},[U]);y.useEffect(()=>{s.onEvent("settime",()=>ut())},[s,ut]),y.useEffect(()=>{if(!vt||!Ue)return;const Xe=setInterval(()=>ut(),100);return()=>clearInterval(Xe)},[vt,Ue,ut]);const vn=y.useCallback(()=>{lt(void 0),He(!1)},[]),xn=y.useCallback(Xe=>{lt(Xe.currentTarget),He(!0)},[]),Vn=y.useCallback(Xe=>{f(Xe),lt(void 0),He(!1)},[f]),nn=y.useCallback(()=>{bt(void 0),Kt(!1)},[]),un=y.useCallback(Xe=>{bt(Xe.currentTarget),Kt(!0)},[]),rn=y.useCallback(Xe=>{R==null||R(Xe),bt(void 0),Kt(!1)},[R]),pn=y.useCallback(()=>{Qt(void 0),Jt(!1)},[]),qn=y.useCallback(Xe=>{Qt(Xe.currentTarget),Jt(!0)},[]),sn=y.useCallback(Xe=>{ge==null||ge(Xe),Qt(void 0),Jt(!1)},[ge]),Mn=y.useCallback(()=>xt(!1),[]),ln=y.useCallback(()=>xt(!0),[]),Wt=y.useCallback((Xe,Ze)=>{typeof Ze=="number"&&(zt(Ze),_==null||_(Ze/100))},[_]),Cn=y.useCallback((Xe,Ze)=>{typeof Ze=="number"&&(Ze>0&&Se(Ze),E.volume=Ze)},[E]),it=y.useCallback(()=>{zt(Xe=>{const Ze=Xe>0?0:Ct;return _==null||_(Ze/100),Ze})},[_,Ct]),Ht=y.useCallback(()=>{if(!Le||Fe===void 0||Ie===void 0)return;Ie(Fe==="top"?"bottom":"top")},[Fe,Le,Ie]),Dt=s.progress(e);return v.jsxs(Dn.Fragment,{children:[v.jsx(Hi,{in:vt,timeout:200,children:v.jsxs(rt,{container:!0,style:{position:"absolute",top:0},children:[v.jsx(rt,{item:!0,children:G&&v.jsx(kt,{title:Ye("controls.unloadVideo"),children:v.jsx(dt,{color:"inherit",className:Me.topButton,onClick:D,onMouseOver:tn,onMouseOut:ct,children:v.jsx($u,{})})})}),mt&&v.jsx(rt,{item:!0,children:v.jsx(dt,{color:"inherit",className:Me.topButton,onClick:mt,onMouseOver:tn,onMouseOut:ct,children:v.jsx(Hu,{})})}),v.jsx(rt,{item:!0,style:{flexGrow:1}}),v.jsxs(rt,{item:!0,children:[Ae&&v.jsx(kt,{title:Ye("controls.toggleTheaterMode"),children:v.jsx(dt,{color:"inherit",className:Re?Me.topButton:Me.inactiveTopButton,onClick:fe,onMouseOver:tn,onMouseOut:ct,children:v.jsx(qu,{})})}),xe&&v.jsx(kt,{title:Ye("controls.toggleFullscreen"),children:v.jsx(dt,{color:"inherit",onClick:se,children:we?v.jsx(Ku,{className:Me.topButton}):v.jsx(Vu,{className:Me.topButton})})}),pe&&v.jsx(kt,{title:Ye(_e?"controls.showSubtitlePlayer":"controls.hideSubtitlePlayer"),children:v.jsx(dt,{color:"inherit",className:Me.topButton,onClick:Pe,onMouseOver:tn,onMouseOut:ct,children:_e?v.jsx(Bu,{}):v.jsx(Fu,{})})})]})]})}),v.jsxs("div",{ref:Zt,className:Me.container,onMouseOver:tn,onMouseOut:ct,children:[v.jsx(Hi,{in:vt,timeout:200,children:v.jsxs("div",{className:Me.subContainer,children:[v.jsx(rc,{onSeek:Xt,value:Dt*100}),!yt&&v.jsxs(rt,{container:!0,className:Me.gridContainer,direction:"row",wrap:"nowrap",children:[v.jsx(rt,{item:!0,children:v.jsx(dt,{color:"inherit",onClick:()=>Ue?S():b(),children:Ue?v.jsx(zu,{className:Me.button}):v.jsx(rl,{className:Me.button})})}),L&&v.jsx(rt,{item:!0,onMouseOver:ln,onMouseOut:Mn,className:Nt?Me.volumeInputContainerShown:Me.volumeInputContainerHidden,children:v.jsxs(rt,{container:!0,spacing:0,direction:"row",wrap:"nowrap",children:[v.jsx(rt,{item:!0,children:v.jsx(dt,{color:"inherit",onClick:it,children:Ot===0?v.jsx(Yu,{}):v.jsx(Ju,{})})}),v.jsx(rt,{item:!0,style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:v.jsx(tc,{onChange:Wt,onChangeCommitted:Cn,value:Ot,defaultValue:100,classes:{root:Nt?Me.volumeInputShown:Me.volumeInputHidden,thumb:Nt?Me.volumeInputThumbShown:Me.volumeInputThumbHidden}})})]})}),Number.isFinite(e)&&v.jsx(rt,{item:!0,style:{marginLeft:10},children:v.jsx(il,{currentMilliseconds:Dt*e,totalMilliseconds:r||e})}),n&&!Nt&&!de&&v.jsx(kt,{title:Ye("controls.subtitleOffset"),children:v.jsx(rt,{item:!0,style:{marginLeft:10},children:v.jsx(sl,{inputRef:qe,offset:a,onOffset:$t,disableKeyEvents:H})})}),d&&!Nt&&!de&&v.jsx(rt,{item:!0,style:{marginLeft:10},children:v.jsx(kt,{title:Ye("controls.playbackRate"),children:v.jsx(ol,{inputRef:ht,playbackRate:u,onPlaybackRate:yn})})}),v.jsx(rt,{item:!0,style:{flexGrow:1}}),v.jsxs(oc,{children:[Le&&Fe!==void 0&&v.jsx(kt,{title:Ye("controls.subtitleAlignment"),children:v.jsx(dt,{color:"inherit",onClick:Ht,children:Fe==="top"?v.jsx(Xu,{}):v.jsx(Wu,{})})}),Z&&v.jsx(kt,{title:Ye("controls.toggleSubtitles"),children:v.jsx(dt,{color:"inherit",onClick:ee,children:v.jsx(al,{className:Y?Me.button:Me.inactiveButton})})}),w&&w.length>1&&v.jsx(kt,{title:Ye("controls.selectAudioTrack"),children:v.jsx(dt,{color:"inherit",onClick:xn,children:v.jsx(Uu,{className:Me.button})})}),re&&re.length>0&&v.jsx(kt,{title:Ye("controls.selectVideoElement"),children:v.jsx(dt,{color:"inherit",onClick:un,children:v.jsx(Gu,{className:ae?Me.button:Me.inactiveButton})})}),ie&&v.jsx(kt,{title:Ye("controls.playbackMode"),children:v.jsx(dt,{color:"inherit",onClick:qn,children:v.jsx(ll,{className:ie?Me.button:Me.inactiveButton})})}),Te&&v.jsx(kt,{title:Ye(te?"controls.popIn":"controls.popOut"),children:v.jsx(dt,{color:"inherit",onClick:ye,children:v.jsx(Du,{className:Me.button,style:te?{transform:"rotateX(180deg)"}:{}})})})]})]})]})}),v.jsx(sc,{open:Pt&&vt,anchorEl:Tt,tabs:re,selectedTab:ae,onClose:nn,onTabSelected:rn}),v.jsx(ic,{open:Ne&&vt,anchorEl:We,audioTracks:w,selectedAudioTrack:P,onClose:vn,onAudioTrackSelected:Vn}),v.jsx(ul,{open:At&&vt,anchorEl:$,selectedPlayMode:z,onClose:pn,onPlayMode:sn})]})]})}class go{constructor(e){ce(this,"ref");ce(this,"readyResolves");this.ref=e,this.readyResolves=[]}async seek(e){return new Promise((n,r)=>{this.ref.current?(this.ref.current.currentTime=e,this._onMediaCanPlay(()=>n(void 0))):n(void 0)})}async onReady(){return new Promise((e,n)=>{this.ref.current?this._onMediaCanPlay(()=>e(void 0)):e(void 0)})}_onMediaCanPlay(e){var n;if(((n=this.ref.current)==null?void 0:n.readyState)===4){e();return}this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=r=>{for(const a of this.readyResolves)a();this.readyResolves.length=0,this.ref.current&&(this.ref.current.oncanplay=null)}),this.readyResolves.push(e)}play(){var e;(e=this.ref.current)==null||e.play()}pause(){var e;(e=this.ref.current)==null||e.pause()}playbackRate(e){this.ref.current&&(this.ref.current.playbackRate=e)}}const lc=({initialWidth:s,minWidth:e,maxWidth:n,onResizeStart:r,onResizeEnd:a})=>{const[u,d]=y.useState(!1),[f,h]=y.useState(s),[p,m]=y.useState(0),S=y.useCallback(()=>{d(!0),r==null||r()},[d,r]),b=y.useCallback(()=>{d(!1),a==null||a()},[d,a]),R=y.useCallback(_=>{m(_.clientX)},[]),C=y.useCallback(_=>{_.touches.length!==0&&m(_.touches[0].clientX)},[]),j=y.useCallback(_=>{if(u){const H=p-_.clientX,E=f+H;m(_.clientX),E>=e&&E<=n&&h(E)}},[e,n,p,f,u]),U=y.useCallback(_=>{if(_.touches.length!==0&&u){const H=p-_.touches[0].clientX,E=f+H;m(_.touches[0].clientX),E>=e&&E<=n&&h(E)}},[e,n,p,f,u]);return y.useEffect(()=>{f<e?h(e):n!==0&&f>Math.max(e,n)&&h(n)},[n,e,f]),y.useEffect(()=>(document.addEventListener("mouseleave",b),document.addEventListener("mousemove",j),document.addEventListener("mouseup",b),document.addEventListener("mousedown",R),document.addEventListener("touchcancel",b),document.addEventListener("touchmove",U),document.addEventListener("touchend",b),document.addEventListener("touchstart",C),()=>{document.removeEventListener("mouseleave",b),document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",b),document.removeEventListener("mousedown",R),document.removeEventListener("touchcancel",b),document.removeEventListener("touchmove",U),document.removeEventListener("touchend",b),document.removeEventListener("touchstart",C)}),[b,j,U,R,C]),{width:f,setWidth:h,enableResize:S,isResizing:u}},uc=({holdToDragMs:s})=>{const[e,n]=y.useState(!1),[r,a]=y.useState(!1),[u,d]=y.useState(),[f,h]=y.useState(),p=m=>{d(S=>S||{clientX:m.clientX,clientY:m.clientY}),h({clientX:m.clientX,clientY:m.clientY})};return y.useEffect(()=>{if(!r)return;const m=setTimeout(()=>{const S=document.getSelection();(S===null||S.type!=="Range")&&(n(!0),a(!1))},s);return()=>clearTimeout(m)},[s,r]),y.useEffect(()=>{const m=b=>{b.button===0&&b.clientX<=window.innerWidth-50&&(a(!0),p(b))},S=()=>{n(!1),a(!1),d(void 0),h(void 0)};return window.addEventListener("mousedown",m),window.addEventListener("mouseup",S),window.addEventListener("mouseleave",S),()=>{window.removeEventListener("mousedown",m),window.removeEventListener("mouseup",S),window.removeEventListener("mouseleave",S)}},[]),y.useEffect(()=>{if(e)return window.addEventListener("mousemove",p),()=>window.removeEventListener("mousemove",p)},[e]),{dragging:e,draggingStartLocation:u,draggingCurrentLocation:f}};function cc({subtitle:s,availableWidth:e,scale:n}){if(s.textImage===void 0)return null;const a=n*e/s.textImage.screen.width*s.textImage.image.width;return v.jsx("div",{style:{maxWidth:a,margin:"auto"},children:v.jsx("img",{style:{width:"100%"},alt:"subtitle",src:s.textImage.dataUrl})})}const Ko=()=>{const[s,e]=y.useState(0);return y.useLayoutEffect(()=>{const n=document.querySelector("header.MuiAppBar-root");e((n==null?void 0:n.clientHeight)||0);function r(){e((n==null?void 0:n.clientHeight)||0)}const a=new MutationObserver(()=>{e((n==null?void 0:n.clientHeight)||0)});return n&&a.observe(n,{attributes:!0,attributeFilter:["class"]}),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),a.disconnect()}},[]),s};let Ui;const zo=200,mo=()=>Ui??Math.max(350,.25*window.innerWidth),bo=(s,e,n,r)=>s===n||e===r?!0:s<n?e>=n:r>=s,dc=(s,e,n)=>{const r=n.current;if(!r)return!1;const a={x:Math.min(s.clientX,e.clientX),y:Math.min(s.clientY,e.clientY),width:Math.abs(s.clientX-e.clientX),height:Math.abs(s.clientY-e.clientY)},u=r.getBoundingClientRect();return bo(a.x,a.x+a.width,u.x,u.x+u.width)&&bo(a.y,a.y+a.height,u.y,u.y+u.height)},fc=bn(s=>({container:{height:({appBarHidden:e,appBarHeight:n})=>e?"100vh":`calc(100vh - ${n}px)`,position:"relative",overflowX:"hidden",backgroundColor:s.palette.background.default,width:({resizable:e})=>e?"auto":"100%","&:focus":{outline:"none"}},table:{backgroundColor:s.palette.background.default,marginBottom:75},unselectableTable:{userSelect:"none"},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}})),hc=bn(s=>({subtitleRow:{"&:hover":{backgroundColor:s.palette.action.hover},minWidth:250},selectedSubtitleRow:{minWidth:250,"& td":{borderColor:s.palette.background.paper},animation:`$select-subtitle-row 300ms ${s.transitions.easing.easeInOut} forwards`},"@keyframes select-subtitle-row":{"100%":{backgroundColor:s.palette.background.paper}},unselectedSubtitleRow:{minWidth:250,animation:`$unselect-subtitle-row 300ms ${s.transitions.easing.easeInOut} forwards`},"@keyframes unselect-subtitle-row":{"100%":{filter:"brightness(.7)",backgroundColor:s.palette.action.disabledBackground}},subtitle:{fontSize:20,paddingRight:0,width:"100%",overflowWrap:"anywhere",whiteSpace:"pre-wrap"},compressedSubtitle:{fontSize:16,paddingRight:0,width:"100%",overflowWrap:"anywhere",whiteSpace:"pre-wrap"},disabledSubtitle:{color:"transparent",backgroundColor:s.palette.action.disabledBackground,borderRadius:5},unselectableSubtitle:{userSelect:"none"},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5,userSelect:"none"},copyButton:{textAlign:"right",padding:0}})),pc=Dn.memo(function({index:e,selectionState:n,subtitleRef:r,onClickSubtitle:a,onCopySubtitle:u,compressed:d,disabled:f,subtitle:h,showCopyButton:p}){const m=hc(),S=y.useRef(null),[b,R]=y.useState(!1),C=d?m.compressedSubtitle:m.subtitle,j=f?m.disabledSubtitle:"",{t:U}=hn();if(h.start<0||h.end<0)return null;function _(){var L,z;const G=document.getSelection(),D=(G==null?void 0:G.type)==="Range"&&((z=S.current)==null?void 0:z.isSameNode(((L=G.anchorNode)==null?void 0:L.parentNode)??null));R(D??!1)}const H=h.textImage?v.jsx(cc,{availableWidth:window.screen.availWidth/2,subtitle:h,scale:1}):v.jsx("span",{ref:S,className:j,dangerouslySetInnerHTML:{__html:h.text}});let E;return n===void 0?E=m.subtitleRow:n===1?E=m.selectedSubtitleRow:E=m.unselectedSubtitleRow,v.jsxs(za,{onClick:()=>!b&&a(e),onMouseUp:_,ref:r,className:E,children:[n===void 0&&v.jsx(kt,{disabled:!p,enterDelay:1500,enterNextDelay:1500,title:U("subtitlePlayer.multiSubtitleSelectHelp"),placement:"top",children:v.jsx(kr,{className:C,children:H})}),n!==void 0&&v.jsx(kr,{className:C,children:H}),p&&v.jsx(kr,{className:m.copyButton,children:v.jsx(dt,{disabled:n!==void 0,onClick:G=>u(G,e),children:v.jsx(Qi,{fontSize:d?"small":"medium"})})}),v.jsx(kr,{className:m.timestamp,children:v.jsxs("div",{children:[v.jsx("span",{style:{display:"none"},children:"."}),`
${h.displayTime}
`,v.jsx("span",{style:{display:"none"},children:"."})]})})]})}),gc=Dn.forwardRef(function({isResizing:e,style:n,...r},a){return v.jsx("div",{ref:a,style:{...n,position:"absolute",width:e?30:Gi.isMobile?20:5,left:e?-15:-2.5,height:"100%",cursor:"col-resize"},...r})});function mc({clock:s,extension:e,onSeek:n,onCopy:r,onOffsetChange:a,onToggleSubtitleTrack:u,onSubtitlesHighlighted:d,onResizeStart:f,onResizeEnd:h,autoPauseContext:p,subtitles:m,subtitleCollection:S,length:b,jumpToSubtitle:R,compressed:C,resizable:j,showCopyButton:U,loading:_,drawerOpen:H,appBarHidden:E,displayHelp:G,disableKeyEvents:D,disableMiningBinds:L,lastJumpToTopTimestamp:z,hidden:ie,disabledSubtitleTracks:ge,settings:Y,keyBinder:Z,maxResizeWidth:ee,webSocketClient:w}){const{t:P}=hn(),re=y.useRef(s);re.current=s;const ae=y.useRef();ae.current=m;const Te=y.useMemo(()=>m?Array(m.length).fill(void 0).map(ne=>y.createRef()):[],[m]),te=y.useRef(ir.empty());te.current=S??ir.empty();const ye=y.useRef([]);ye.current=Te;const xe=y.useRef({}),[we,se]=y.useState(),[pe,_e]=y.useState(),Pe=y.useRef(0);Pe.current=b;const je=y.useRef(!1);je.current=ie;const Ae=y.useRef(0),Re=y.useRef(),fe=y.useRef(null),Fe=y.useRef();Fe.current=H;const Le=Ko(),Ie=fc({resizable:j,appBarHidden:E,appBarHeight:Le}),yt=y.useRef();yt.current=p;const mt=y.useRef();mt.current=d;const Me=()=>{var de;const ne=xe.current;for(let oe=0;oe<ye.current.length;++oe){const O=(de=ye.current[oe].current)==null?void 0:de.classList;oe in ne?O==null||O.add("Mui-selected"):O==null||O.remove("Mui-selected")}};y.useEffect(()=>{const ne=()=>{var ht,Zt,en;const de=ye.current,oe=re.current,O={},ot=oe.time(Pe.current);let Ge=te.current.subtitlesAt(ot);const nt=Ge.showing.length===0?Ge.lastShown??[]:Ge.showing;let qe;for(const ut of nt)O[ut.index]=!0,(qe===void 0||ut.index<qe)&&(qe=ut.index);if(!Ou(O,xe.current)&&(xe.current=O,Me(),(ht=mt.current)==null||ht.call(mt,nt),qe!==void 0)){const ut=de[qe],Xt=!je.current&&Date.now()-Ae.current>5e3;ut!=null&&ut.current&&Xt&&ut.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}Ge.startedShowing!==void 0&&((Zt=yt.current)==null||Zt.startedShowing(Ge.startedShowing)),Ge.willStopShowing!==void 0&&((en=yt.current)==null||en.willStopShowing(Ge.willStopShowing)),Re.current=requestAnimationFrame(ne)};return Re.current=requestAnimationFrame(ne),()=>{Re.current!==void 0&&cancelAnimationFrame(Re.current)}},[]);const Ye=y.useCallback(()=>{var O;const ne=xe.current;if(!ne)return;const de=Object.keys(ne);if(de.length===0)return;const oe=Te[Number(de[0])];(O=oe==null?void 0:oe.current)==null||O.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})},[Te]);y.useEffect(()=>{if(ie)return;function ne(){document.visibilityState==="visible"&&Ye()}return document.addEventListener("visibilitychange",ne),()=>document.removeEventListener("visibilitychange",ne)},[ie,Te,Ye]),y.useEffect(()=>{ie||Ye()},[ie,Ye]),y.useEffect(()=>{var oe;if(je.current)return;const ne=ye.current;if(!ne||ne.length===0)return;const de=ne[0];(oe=de==null?void 0:de.current)==null||oe.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})},[z]),y.useEffect(()=>Z.bindAdjustOffset((ne,de)=>{ne.preventDefault(),ne.stopPropagation(),a(de)},()=>D,()=>m),[Z,a,D,m]),y.useEffect(()=>Z.bindResetOffet(ne=>{ne.preventDefault(),ne.stopPropagation(),a(0)},()=>D),[Z,a,D]),y.useEffect(()=>Z.bindOffsetToSubtitle((ne,de)=>{ne.preventDefault(),ne.stopPropagation(),a(de)},()=>D,()=>s.time(b),()=>m),[Z,a,D,s,m,b]),y.useEffect(()=>Z.bindSeekToSubtitle((ne,de)=>{ne.preventDefault(),ne.stopPropagation(),n(de.start,s.running??!1)},()=>D,()=>s.time(b),()=>m),[Z,n,m,D,s,b]),y.useEffect(()=>Z.bindSeekToBeginningOfCurrentSubtitle((ne,de)=>{ne.preventDefault(),ne.stopPropagation(),n(de.start,Y.alwaysPlayOnSubtitleRepeat||s.running)},()=>D,()=>s.time(b),()=>m),[Z,n,m,D,s,b,Y.alwaysPlayOnSubtitleRepeat]),y.useEffect(()=>Z.bindSeekBackwardOrForward((ne,de)=>{ne.stopPropagation(),ne.preventDefault(),n(de?Math.min(b,s.time(b)+1e4):Math.max(0,s.time(b)-1e4),s.running)},()=>D),[Z,s,b,D,n]),y.useEffect(()=>{function ne(){Ae.current=Date.now()}const de=fe.current;return de==null||de.addEventListener("wheel",ne,{passive:!0}),()=>de==null?void 0:de.removeEventListener("wheel",ne)},[fe,Ae]),y.useEffect(()=>{var oe,O;if(ie||!R||!m)return;let ne=-1,de=0;for(let ot of m){if(ot.originalStart===R.originalStart&&R.text.includes(ot.text)){ne=de;break}++de}ne!==-1&&((O=(oe=Te[ne])==null?void 0:oe.current)==null||O.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"}),_e(ne),setTimeout(()=>_e(void 0),1e3))},[ie,R,m,Te]);const vt=y.useCallback(()=>{const ne=s.time(b),de=Math.min(ne+5e3,b);return{text:"",start:ne,originalStart:ne,end:de,originalEnd:de,track:0}},[s,b]),Ce=y.useCallback(ne=>!m||m.length===0?Ua(vt(),b,5e3):Xa(m,ne,Y.surroundingSubtitlesCountRadius,Y.surroundingSubtitlesTimeRadius),[b,m,vt,Y.surroundingSubtitlesCountRadius,Y.surroundingSubtitlesTimeRadius]),Ne=y.useCallback(()=>{if(!xe.current)return[];const ne=Math.min(...Object.keys(xe.current).map(de=>Number(de)));return Ce(ne)},[Ce]),He=y.useCallback(()=>{if(!m||m.length===0){const oe=s.time(b),O=Math.min(oe+5e3,b);return{text:"",start:oe,originalStart:oe,end:O,originalEnd:O,track:0}}if(!xe.current)return;const ne=Object.keys(xe.current).map(oe=>Number(oe));if(ne.length===0)return;const de=Math.min(...ne);return m[de]},[s,m,b]);y.useEffect(()=>Z.bindCopy((ne,de)=>{ne.preventDefault(),ne.stopPropagation(),r(de,Ne(),qt.none)},()=>D||L,()=>He()),[Z,D,L,He,Ne,r]);const We=y.useCallback(({postMineAction:ne,text:de,word:oe,definition:O,customFieldValues:ot})=>{if(!m||m.length===0)return!1;let Ge=-1;if(de&&(Ge=m.findIndex(qe=>qe.text===de),Ge===-1)){const qe=de.trim();Ge=m.filter(ht=>ht.text.includes(qe)).length===1?m.findIndex(ht=>ht.text.includes(qe)):-1}const nt=Ge===-1?He():m[Ge];if(nt){const qe=Ge===-1?Ne():Ce(Ge),ht={text:Ge===-1?de:Wa(nt,qe),word:oe,definition:O,customFieldValues:ot};return r(nt,qe,ne,!0,ht),!0}return!1},[r,He,Ne,Ce,m]);y.useEffect(()=>{!w||e.supportsWebSocketClient||(w.onMineSubtitle=async({body:{fields:ne,postMineAction:de}})=>{const oe=ne??{},O=oe[Y.wordField]||void 0,ot=oe[Y.definitionField]||void 0,Ge=oe[Y.sentenceField]||void 0,nt=Object.fromEntries(Object.entries(Y.customAnkiFields).map(([ht,Zt])=>{const en=oe[Zt];if(en!==void 0)return[ht,en]}).filter(ht=>ht!==void 0)),qe=de??qt.showAnkiDialog;return We({postMineAction:qe,text:Ge,word:O,definition:ot,customFieldValues:nt})})},[w,e,Y,We]),y.useEffect(()=>{if(e.installed)return e.subscribe(ne=>{if(!document.hasFocus()||ne.data.command!=="copy-subtitle-with-additional-fields")return;const de=ne.data;We(de)})},[e,We]),y.useEffect(()=>Z.bindToggleSubtitleTrackInList((ne,de)=>{ne.preventDefault(),ne.stopPropagation(),u(de)},()=>D),[Z,D,u]);const lt=y.useCallback((ne,de)=>{ne.preventDefault(),ne.stopPropagation();const oe=He();oe&&r(oe,Ne(),de)},[r,He,Ne]);y.useEffect(()=>Z.bindAnkiExport(ne=>lt(ne,qt.showAnkiDialog),()=>D||L),[lt,Z,D,L]),y.useEffect(()=>Z.bindUpdateLastCard(ne=>lt(ne,qt.updateLastCard),()=>D||L),[lt,Z,D,L]),y.useEffect(()=>Z.bindExportCard(ne=>lt(ne,qt.exportCard),()=>D||L),[lt,Z,D,L]);const Pt=y.useCallback(ne=>{if(!m)return;const de=xe.current||{};n(m[ne].start,!s.running&&ne in de)},[m,n,s]),Kt=y.useRef(Ce);Kt.current=Ce;const Tt=y.useRef(Y);Tt.current=Y;const bt=y.useRef(r);bt.current=r;const At=y.useCallback((ne,de)=>{ne.preventDefault(),ne.stopPropagation(),m&&bt.current(m[de],Kt.current(de),Tt.current.clickToMineDefaultAction,!0)},[m]),Jt=y.useRef(null);y.useEffect(()=>{if(!j)return;const ne=setInterval(()=>{var oe;const de=Jt.current;de&&(de.style.top=`${((oe=fe.current)==null?void 0:oe.scrollTop)??0}px`)},1e3);return()=>clearInterval(ne)},[j]);const{width:$,setWidth:Qt,enableResize:Nt,isResizing:xt}=lc({initialWidth:mo,minWidth:zo,maxWidth:ee,onResizeStart:f,onResizeEnd:h});y.useEffect(()=>{Ui=$},[$,ee]),y.useEffect(()=>{const ne=()=>{Ui=void 0,Qt(mo())};return screen.orientation.addEventListener("change",ne),()=>screen.orientation.removeEventListener("change",ne)},[Qt]);const{dragging:Ot,draggingStartLocation:zt,draggingCurrentLocation:Ct}=uc({holdToDragMs:750});y.useEffect(()=>{if(!Ot||!zt||!Ct||!Te||xt||!U||D){se(void 0);return}se(Te.map(ne=>dc(zt,Ct,ne)))},[Ot,zt,Ct,Te,xt,U,D]),y.useEffect(()=>{if(m!==void 0&&!Ot&&we!==void 0&&we.length>0){const ne=we.map((de,oe)=>de?m[oe]:void 0).filter(de=>de!==void 0).filter(de=>!ge[de.track]);if(ne.length>0){const de=Math.min(...ne.map(ot=>ot.start)),oe=Math.max(...ne.map(ot=>ot.end)),{surroundingSubtitles:O}=Ga(m,de,oe,Y.surroundingSubtitlesCountRadius,Y.surroundingSubtitlesTimeRadius);if(O){const ot={text:ne.map(Ge=>Ge.text).join(`
`),start:de,end:oe,originalStart:Math.min(...ne.map(Ge=>Ge.originalStart)),originalEnd:Math.max(...ne.map(Ge=>Ge.originalEnd)),track:0};r(ot,O,qt.showAnkiDialog,!0)}}}Me()},[Ot,ge,we,m,Y.surroundingSubtitlesCountRadius,Y.surroundingSubtitlesTimeRadius,r]);let Se=null;if(!m||m.length===0)!_&&G?Se=!_&&G&&v.jsx("div",{className:Ie.noSubtitles,children:v.jsx(rr,{variant:"h6",children:G})}):m&&m.length===0&&(Se=v.jsx("div",{className:Ie.noSubtitles,children:v.jsx(rr,{variant:"h6",children:P("landing.noSubtitles")})}));else{const ne=xt||Ot?Ie.unselectableTable:"";Se=v.jsx(Ya,{className:`${Ie.table} ${ne}`,children:v.jsx(Ja,{children:v.jsx(Qa,{children:m.map((de,oe)=>{let O;return we!==void 0&&(O=we[oe]?1:2),pe!==void 0&&(O=pe===oe?1:2),v.jsx(pc,{index:oe,compressed:C,selectionState:O,showCopyButton:U,disabled:ge[de.track],subtitle:m[oe],subtitleRef:Te[oe],onClickSubtitle:Pt,onCopySubtitle:At},oe)})})})})}return v.jsxs(On,{square:!0,ref:fe,className:Ie.container,style:{width:j?$:"auto"},children:[Se,j&&v.jsx(gc,{isResizing:xt,onMouseDown:Nt,onTouchStart:Nt,ref:Jt})]})}class yo{constructor(e){ce(this,"protocol");ce(this,"time");ce(this,"isReady");ce(this,"readyCallbacks");ce(this,"playCallbacks");ce(this,"pauseCallbacks");ce(this,"audioTrackSelectedCallbacks");ce(this,"currentTimeCallbacks");ce(this,"exitCallbacks");ce(this,"offsetCallbacks");ce(this,"playbackRateCallbacks");ce(this,"popOutToggleCallbacks");ce(this,"copyCallbacks");ce(this,"playModeCallbacks");ce(this,"hideSubtitlePlayerToggleCallbacks");ce(this,"appBarToggleCallbacks");ce(this,"ankiDialogRequestCallbacks");ce(this,"toggleSubtitleTrackInListCallbacks");ce(this,"loadFilesCallbacks");ce(this,"readyState");ce(this,"oncanplay",null);ce(this,"audioTracks");ce(this,"selectedAudioTrack");ce(this,"duration");ce(this,"_playbackRate");this.protocol=e,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this._playbackRate=1,this.selectedAudioTrack=void 0,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.playbackRateCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[],this.loadFilesCallbacks=[];const n=this;this.protocol.onMessage=r=>{var a;switch(r.data.command){case"ready":const u=r.data;n.duration=u.duration,n.isReady=!0,n.audioTracks=u.audioTracks,n.selectedAudioTrack=u.selectedAudioTrack,n.readyState=4,n.time=u.currentTime,this._playbackRate=u.playbackRate;for(let C of n.readyCallbacks)C(u.paused);break;case"readyState":const d=r.data;n.readyState=d.value,n.readyState===4&&((a=n.oncanplay)==null||a.call(n,new Event("canplay")));break;case"play":const f=r.data;for(let C of n.playCallbacks)C(f.echo);break;case"pause":const h=r.data;for(let C of n.pauseCallbacks)C(h.echo);break;case"audioTrackSelected":const p=r.data;for(let C of n.audioTrackSelectedCallbacks)n.selectedAudioTrack=p.id,C(p.id);break;case"currentTime":const m=r.data;for(let C of n.currentTimeCallbacks)C(m.value,m.echo);break;case"exit":for(let C of n.exitCallbacks)C();break;case"offset":const S=r.data;for(let C of n.offsetCallbacks)C(S.value);break;case"playbackRate":const b=r.data;for(const C of n.playbackRateCallbacks)C(b.value,b.echo);break;case"popOutToggle":for(let C of n.popOutToggleCallbacks)C();break;case"copy":for(let C of n.copyCallbacks){const j=r.data,{word:U,text:_,definition:H,customFieldValues:E}=j;C(j.subtitle,j.surroundingSubtitles,{word:U,text:_,definition:H,customFieldValues:E},j.audio,j.image,j.url,j.postMineAction??qt.none,j.id,j.mediaTimestamp)}break;case"playMode":for(let C of n.playModeCallbacks){const j=r.data;C(j.playMode)}break;case"hideSubtitlePlayerToggle":for(let C of n.hideSubtitlePlayerToggleCallbacks)C();break;case"appBarToggle":for(let C of n.appBarToggleCallbacks)C();break;case"sync":break;case"syncv2":break;case"ankiDialogRequest":for(let C of n.ankiDialogRequestCallbacks)C();break;case"toggleSubtitleTrackInList":const R=r.data;for(const C of n.toggleSubtitleTrackInListCallbacks)C(R.track);break;case"loadFiles":for(const C of n.loadFilesCallbacks)C();break;default:console.error("Unrecognized event "+r.data.command)}}}get currentTime(){return this.time}set currentTime(e){this.time=e,this.readyState=3;const n={command:"currentTime",value:this.time};this.protocol.postMessage(n)}get playbackRate(){return this._playbackRate}set playbackRate(e){const n={command:"playbackRate",value:e};this.protocol.postMessage(n)}onReady(e){return this.isReady&&e(!1),this.readyCallbacks.push(e),()=>this._remove(e,this.readyCallbacks)}onPlay(e){return this.playCallbacks.push(e),()=>this._remove(e,this.playCallbacks)}onPause(e){return this.pauseCallbacks.push(e),()=>this._remove(e,this.pauseCallbacks)}onCurrentTime(e){return this.currentTimeCallbacks.push(e),()=>this._remove(e,this.currentTimeCallbacks)}onAudioTrackSelected(e){return this.audioTrackSelectedCallbacks.push(e),()=>this._remove(e,this.audioTrackSelectedCallbacks)}onExit(e){return this.exitCallbacks.push(e),()=>this._remove(e,this.exitCallbacks)}onOffset(e){return this.offsetCallbacks.push(e),()=>this._remove(e,this.offsetCallbacks)}onPlaybackRate(e){return this.playbackRateCallbacks.push(e),()=>this._remove(e,this.playbackRateCallbacks)}onPopOutToggle(e){return this.popOutToggleCallbacks.push(e),()=>this._remove(e,this.popOutToggleCallbacks)}onCopy(e){return this.copyCallbacks.push(e),()=>this._remove(e,this.copyCallbacks)}onPlayMode(e){return this.playModeCallbacks.push(e),()=>this._remove(e,this.playModeCallbacks)}onHideSubtitlePlayerToggle(e){return this.hideSubtitlePlayerToggleCallbacks.push(e),()=>this._remove(e,this.hideSubtitlePlayerToggleCallbacks)}onAppBarToggle(e){return this.appBarToggleCallbacks.push(e),()=>this._remove(e,this.appBarToggleCallbacks)}onAnkiDialogRequest(e){return this.ankiDialogRequestCallbacks.push(e),()=>this._remove(e,this.ankiDialogRequestCallbacks)}onToggleSubtitleTrackInList(e){return this.toggleSubtitleTrackInListCallbacks.push(e),()=>this._remove(e,this.toggleSubtitleTrackInListCallbacks)}onLoadFiles(e){return this.loadFilesCallbacks.push(e),()=>this._remove(e,this.loadFilesCallbacks)}ready(e,n){const r={command:"ready",duration:e,videoFileName:n};this.protocol.postMessage(r)}init(){this.protocol.postMessage({command:"init"})}play(){return this.protocol.postMessage({command:"play"}),new Promise((e,n)=>e())}pause(){this.protocol.postMessage({command:"pause"})}audioTrackSelected(e){const n={command:"audioTrackSelected",id:e};this.protocol.postMessage(n)}subtitles(e,n){this.protocol.postMessage({command:"subtitles",value:e,name:n.length>0?n[0]:null,names:n})}offset(e){const n={command:"offset",value:e};this.protocol.postMessage(n)}subtitleSettings(e){const{subtitleColor:n,subtitleSize:r,subtitleThickness:a,subtitleOutlineThickness:u,subtitleOutlineColor:d,subtitleShadowThickness:f,subtitleShadowColor:h,subtitleBackgroundOpacity:p,subtitleBackgroundColor:m,subtitleFontFamily:S,subtitleCustomStyles:b,subtitleBlur:R,imageBasedSubtitleScaleFactor:C,subtitleAlignment:j,subtitleTracksV2:U,subtitlePositionOffset:_,topSubtitlePositionOffset:H,subtitlesWidth:E}=e,G={command:"subtitleSettings",value:{subtitleColor:n,subtitleSize:r,subtitleThickness:a,subtitleOutlineThickness:u,subtitleOutlineColor:d,subtitleShadowThickness:f,subtitleShadowColor:h,subtitleBackgroundOpacity:p,subtitleBackgroundColor:m,subtitleFontFamily:S,subtitleCustomStyles:b,subtitleBlur:R,imageBasedSubtitleScaleFactor:C,subtitleAlignment:j,subtitleTracksV2:U,subtitlePositionOffset:_,topSubtitlePositionOffset:H,subtitlesWidth:E}};this.protocol.postMessage(G)}playMode(e){const n={command:"playMode",playMode:e};this.protocol.postMessage(n)}hideSubtitlePlayerToggle(e){const n={command:"hideSubtitlePlayerToggle",value:e};this.protocol.postMessage(n)}appBarToggle(e){const n={command:"appBarToggle",value:e};this.protocol.postMessage(n)}fullscreenToggle(e){const n={command:"fullscreenToggle",value:e};this.protocol.postMessage(n)}ankiSettings(e){const{ankiConnectUrl:n,deck:r,noteType:a,sentenceField:u,definitionField:d,audioField:f,imageField:h,wordField:p,sourceField:m,urlField:S,track1Field:b,track2Field:R,track3Field:C,customAnkiFields:j,tags:U,preferMp3:_,audioPaddingStart:H,audioPaddingEnd:E,maxImageWidth:G,maxImageHeight:D,surroundingSubtitlesCountRadius:L,surroundingSubtitlesTimeRadius:z,ankiFieldSettings:ie,customAnkiFieldSettings:ge,recordWithAudioPlayback:Y}=e,Z={command:"ankiSettings",value:{ankiConnectUrl:n,deck:r,noteType:a,sentenceField:u,definitionField:d,audioField:f,imageField:h,wordField:p,sourceField:m,urlField:S,track1Field:b,track2Field:R,track3Field:C,customAnkiFields:j,tags:U,preferMp3:_,audioPaddingStart:H,audioPaddingEnd:E,maxImageWidth:G,maxImageHeight:D,surroundingSubtitlesCountRadius:L,surroundingSubtitlesTimeRadius:z,ankiFieldSettings:ie,customAnkiFieldSettings:ge,recordWithAudioPlayback:Y}};this.protocol.postMessage(Z)}miscSettings(e){const{themeType:n,copyToClipboardOnMine:r,autoPausePreference:a,speedChangeStep:u,fastForwardModePlaybackRate:d,keyBindSet:f,rememberSubtitleOffset:h,autoCopyCurrentSubtitle:p,alwaysPlayOnSubtitleRepeat:m,subtitleRegexFilter:S,subtitleRegexFilterTextReplacement:b,subtitleHtml:R,miningHistoryStorageLimit:C,clickToMineDefaultAction:j,postMiningPlaybackState:U,language:_,lastSubtitleOffset:H,tabName:E,pauseOnHoverMode:G,lastSelectedAnkiExportMode:D}=e,L={command:"miscSettings",value:{themeType:n,copyToClipboardOnMine:r,autoPausePreference:a,speedChangeStep:u,fastForwardModePlaybackRate:d,keyBindSet:f,rememberSubtitleOffset:h,autoCopyCurrentSubtitle:p,alwaysPlayOnSubtitleRepeat:m,subtitleRegexFilter:S,subtitleRegexFilterTextReplacement:b,subtitleHtml:R,miningHistoryStorageLimit:C,clickToMineDefaultAction:j,postMiningPlaybackState:U,language:_,lastSubtitleOffset:H,tabName:E,pauseOnHoverMode:G,lastSelectedAnkiExportMode:D}};this.protocol.postMessage(L)}alert(e,n){const r={command:"alert",message:e,severity:n};this.protocol.postMessage(r)}copy(e,n,r,a){const u={command:"copy",postMineAction:e,subtitle:n,surroundingSubtitles:r,...a??{}};this.protocol.postMessage(u)}takeScreenshot(){const e={command:"takeScreenshot"};this.protocol.postMessage(e)}close(){this.protocol.postMessage({command:"close"}),this.protocol.close(),this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.playbackRateCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[],this.loadFilesCallbacks=[]}_remove(e,n){for(let r=n.length-1;r>=0;--r)if(e===n[r]){n.splice(r,1);break}}}function bc(s){const[e,n]=y.useState([0,0]);return y.useLayoutEffect(()=>{function r(){n([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",r),screen.orientation.addEventListener("change",r),r(),()=>{window.removeEventListener("resize",r),screen.orientation.removeEventListener("change",r)}},[s]),e}const vo=300,yc=bn(()=>({root:({appBarHidden:s,appBarHeight:e})=>({height:s?"100vh":`calc(100vh - ${e}px)`,position:"relative",overflowX:"hidden"}),container:{width:"100%",height:"100%"},videoFrame:{width:"100%",height:"100%",border:0,display:"block"}}));function $i(s,e,n){let r;e&&e.length>0?n?r=e[e.length-1].end:r=e[e.length-1].originalEnd:r=0;const a=s&&s.duration?1e3*s.duration:0;return Math.max(a,r)}const vc=Dn.memo(function({sources:e,subtitles:n,subtitleReader:r,settings:a,playbackPreferences:u,keyBinder:d,extension:f,videoFrameRef:h,videoChannelRef:p,drawerOpen:m,appBarHidden:S,showCopyButton:b,videoFullscreen:R,hideSubtitlePlayer:C,videoPopOut:j,tab:U,availableTabs:_,miningContext:H,origin:E,onError:G,onUnloadVideo:D,onCopy:L,onLoaded:z,onTabSelected:ie,onAnkiDialogRequest:ge,onAppBarToggle:Y,onHideSubtitlePlayer:Z,onVideoPopOut:ee,onPlayModeChangedViaBind:w,onSubtitles:P,onLoadFiles:re,disableKeyEvents:ae,jumpToSubtitle:Te,rewindSubtitle:te,hideControls:ye,forceCompressedMode:xe,webSocketClient:we}){const[se,pe]=y.useState(Ft.normal),[_e,Pe]=y.useState(),je=y.useRef();je.current=n;const Ae=y.useMemo(()=>new ir(n??[],{returnLastShown:!0,returnNextToShow:se===Ft.condensed||se===Ft.fastForward,showingCheckRadiusMs:100}),[n,se]),Re=e==null?void 0:e.subtitleFiles,fe=e==null?void 0:e.flattenSubtitleFiles,Fe=e==null?void 0:e.videoFile,Le=e==null?void 0:e.videoFileUrl,Ie=n&&n.length>0&&!!Le,[yt,mt]=y.useState(!1),[Me,Ye]=y.useState(!1),[vt,Ce]=y.useState(0),[Ne,He]=y.useState(0),[We,lt]=y.useState(1),[Pt,Kt]=y.useState(),[Tt,bt]=y.useState(),[At,Jt]=y.useState(),[$,Qt]=y.useState(),Nt=y.useRef();Nt.current=$;const xt=y.useRef();xt.current=u;const[Ot,zt]=y.useState(),Ct=y.useRef();Ct.current=C;const[Se,ne]=y.useState({}),de=y.useRef({x:0,y:0}),oe=y.useMemo(()=>Le||U?new go({current:$}):new go({current:null}),[$,Le,U]),O=y.useMemo(()=>new Lu,[]),ot=Ko(),Ge=yc({appBarHidden:S,appBarHeight:ot}),nt=()=>$i(Nt.current,je.current),qe=y.useCallback(async(Q,Ee,Oe)=>{var at;Ee.setTime(Q),Oe&&await oe.seek(Q/1e3),(at=tn.current)==null||at.clear()},[oe]),ht=y.useCallback(()=>mt(!0),[]),Zt=y.useCallback(()=>mt(!1),[]),en=y.useCallback(()=>{se!==Ft.autoPause||a.autoPausePreference!==Ss.atStart||Le||$t(O,oe,!0)},[se,O,oe,Le,a.autoPausePreference]),ut=y.useCallback(Q=>{se===Ft.repeat?qe(Q.start,O,!0):se===Ft.autoPause&&a.autoPausePreference===Ss.atEnd&&!Le&&$t(O,oe,!0)},[se,O,oe,Le,a.autoPausePreference,qe]),Xt=y.useMemo(()=>{const Q=new yl;return Q.onStartedShowing=en,Q.onWillStopShowing=ut,Q},[en,ut]),tn=y.useRef();tn.current=Xt;const ct=y.useCallback((Q,Ee)=>{O.rate!==Q&&(O.rate=Q,lt(Q),Ee&&oe.playbackRate(Q))},[O,oe]),Ue=y.useCallback((Q,Ee)=>{if(He(Q),!n)return;const Oe=n.length>0?n[n.length-1].end+Q:0,at=n.map((et,Mt)=>({text:et.text,textImage:et.textImage,start:et.originalStart+Q,originalStart:et.originalStart,end:et.originalEnd+Q,originalEnd:et.originalEnd,displayTime:sr(et.originalStart+Q,Oe),track:et.track,index:Mt}));Ee&&$!==void 0&&($.offset(Q),U!==void 0&&f.installed&&!f.supportsOffsetMessage&&$.subtitles(at,(Re==null?void 0:Re.map(et=>et.name))??[""])),P(at),u.offset=Q},[Re,n,f,u,U,$,P]);y.useEffect(()=>{if(!Fe&&!U)return;let Q;if(Fe){const Ee=Et();Q=new yo(new Mu(Ee)),Jt(Ee),z([Fe])}else Q=new yo(new ju(U.id,U.src,f)),Q.init();return p&&(p.current=Q),Qt(Q),()=>{O.setTime(0),O.stop(),Q.close()}},[O,j,Fe,U,f,p,z]),y.useEffect(()=>{async function Q(){var at;const Ee=((at=xt.current)==null?void 0:at.offset)??0;He(Ee);let Oe;if(Re!==void 0&&Re.length>0){Ye(!0);try{const et=await r.subtitles(Re,fe),Mt=et.length>0?et[et.length-1].end+Ee:0;Oe=et.map((wt,De)=>({text:wt.text,textImage:wt.textImage,start:wt.start+Ee,originalStart:wt.start,end:wt.end+Ee,originalEnd:wt.end,displayTime:sr(wt.start+Ee,Mt),track:wt.track,index:De})),Pe(!1),P(Oe),pe(wt=>!Oe||Oe.length===0?Ft.normal:wt)}catch(et){G(et),P([])}finally{Ye(!1)}}else Oe=void 0,pe(Ft.normal)}Q().then(()=>z(Re??[]))},[r,z,G,Re,fe,P]),y.useEffect(()=>{Pe(!1)},[$]),y.useEffect(()=>$==null?void 0:$.onExit(()=>Le&&D(Le)),[$,D,Le]),y.useEffect(()=>$==null?void 0:$.onPopOutToggle(()=>ee()),[$,ee]),y.useEffect(()=>$==null?void 0:$.onHideSubtitlePlayerToggle(Z),[$,Z]),y.useEffect(()=>$==null?void 0:$.onAppBarToggle(Y),[$,Y]),y.useEffect(()=>$==null?void 0:$.onReady(()=>$==null?void 0:$.ready($i($,n),Fe==null?void 0:Fe.name)),[$,n,Fe]),y.useEffect(()=>{if(!($===void 0||n===void 0||_e||Re===void 0||Re.length===0))return $.onReady(()=>{Pe(!0),$.subtitles(n,fe?[Re[0].name]:Re.map(Q=>Q.name))})},[n,$,fe,Re,_e]),y.useEffect(()=>$==null?void 0:$.onReady(()=>$==null?void 0:$.subtitleSettings(a)),[$,a]),y.useEffect(()=>$==null?void 0:$.onReady(()=>$==null?void 0:$.hideSubtitlePlayerToggle(C)),[$,C]),y.useEffect(()=>$==null?void 0:$.ankiSettings(a),[$,a]),y.useEffect(()=>$==null?void 0:$.miscSettings(a),[$,a]),y.useEffect(()=>$==null?void 0:$.playMode(se),[$,se]),y.useEffect(()=>$==null?void 0:$.onReady(()=>{var Q;$!=null&&$.audioTracks&&((Q=$==null?void 0:$.audioTracks)==null?void 0:Q.length)>1?(Kt($==null?void 0:$.audioTracks),bt($==null?void 0:$.selectedAudioTrack)):(Kt(void 0),bt(void 0))}),[$]),y.useEffect(()=>$==null?void 0:$.onReady(Q=>{$&&O.setTime($.currentTime*1e3),Q?O.stop():O.start(),$!=null&&$.playbackRate&&(O.rate=$.playbackRate,lt($.playbackRate))}),[$,O]),y.useEffect(()=>$==null?void 0:$.onPlay(Q=>Qe(O,oe,Q)),[$,oe,O]),y.useEffect(()=>$==null?void 0:$.onPause(Q=>$t(O,oe,Q)),[$,oe,O]),y.useEffect(()=>$==null?void 0:$.onOffset(Q=>Ue(Math.max(-nt()||0,Q),!1)),[$,Ue]),y.useEffect(()=>$==null?void 0:$.onPlaybackRate(ct),[$,ct]),y.useEffect(()=>$==null?void 0:$.onCopy((Q,Ee,Oe,at,et,Mt,wt,De,ar)=>{var Kn;return L({subtitle:Q,surroundingSubtitles:Ee,subtitleFileName:Q?((Kn=Re==null?void 0:Re[Q.track])==null?void 0:Kn.name)??"":"",...Oe,mediaTimestamp:ar??0,file:Fe?{name:Fe.name,blobUrl:Cs(Fe),audioTrack:$==null?void 0:$.selectedAudioTrack,playbackRate:$==null?void 0:$.playbackRate}:void 0,audio:at,image:et,url:Mt},wt,De)}),[$,L,Fe,Re]),y.useEffect(()=>$==null?void 0:$.onPlayMode(Q=>{pe(Q),$==null||$.playMode(Q)}),[$,se]),y.useEffect(()=>$==null?void 0:$.onCurrentTime(async(Q,Ee)=>{const Oe=O.running;Oe&&O.stop(),await qe(Q*1e3,O,Ee),Oe&&O.start()}),[$,O,qe]),y.useEffect(()=>$==null?void 0:$.onAudioTrackSelected(async Q=>{const Ee=O.running;Ee&&O.stop(),await oe.onReady(),Ee&&O.start(),bt(Q)}),[$,O,oe]),y.useEffect(()=>$==null?void 0:$.onAnkiDialogRequest(()=>ge()),[$,ge]),y.useEffect(()=>$==null?void 0:$.onToggleSubtitleTrackInList(Q=>ne(Ee=>{const Oe={...Ee};return Oe[Q]=!Ee[Q],Oe})),[$]),y.useEffect(()=>$==null?void 0:$.onLoadFiles(()=>re==null?void 0:re()),[$,re]);function Qe(Q,Ee,Oe){Q.start(),Oe&&Ee.play()}function $t(Q,Ee,Oe){Q.stop(),Oe&&Ee.pause()}y.useEffect(()=>H.onEvent("stopped-mining",()=>{switch(a.postMiningPlaybackState){case fi.play:Qe(O,oe,!0);break;case fi.pause:$t(O,oe,!0);break;case fi.remember:Ot&&Qe(O,oe,!0);break}}),[H,a,Ot,O,oe]),y.useEffect(()=>H.onEvent("started-mining",()=>{O.running?($t(O,oe,!0),zt(!0)):zt(!1)}),[H,O,oe]),y.useEffect(()=>{if(se!==Ft.condensed||!n||n.length===0)return;let Q=!1,Ee=1e3;const Oe=setInterval(async()=>{const at=O.time(nt()),et=Ae.subtitlesAt(at);if(et.nextToShow&&et.nextToShow.length>0){const Mt=et.nextToShow[0];if(Mt.start-at<Ee+500)return;const wt=O.running;if(wt&&O.stop(),!Q){Q=!0;const De=Date.now();await qe(Mt.start,O,!0),Ee=Date.now()-De,Q=!1}wt&&O.start()}},100);return()=>clearInterval(Oe)},[n,Ae,se,O,qe]),y.useEffect(()=>{if(se!==Ft.fastForward||!n||n.length===0)return;const Q=setInterval(async()=>{const Ee=O.time(nt()),Oe=Ae.subtitlesAt(Ee);Oe.showing.length===0&&(Oe.nextToShow===void 0||Oe.nextToShow.length>0&&Oe.nextToShow[0].start-Ee>1e3)?ct(a.fastForwardModePlaybackRate,!0):ct(1,!0)},100);return()=>clearInterval(Q)},[ct,Ae,O,n,se,a.fastForwardModePlaybackRate]),y.useEffect(()=>{j&&Le&&At&&window.open(E+"?video="+encodeURIComponent(Le)+"&channel="+At+"&popout=true","asbplayer-video-"+Le,"resizable,width=800,height=450"),Ce(Date.now())},[j,At,Le,h,p,E]);const yn=y.useCallback(()=>Qe(O,oe,!0),[O,oe]),vn=y.useCallback(()=>$t(O,oe,!0),[O,oe]),xn=y.useCallback(async Q=>{const Ee=O.running;Ee&&O.stop(),await qe(Q*nt(),O,!0),Ee&&O.start()},[O,qe]),Vn=y.useCallback(async(Q,Ee)=>{Ee||$t(O,oe,!0),await qe(Q,O,!0),Ee&&!O.running&&Qe(O,oe,!0)},[O,qe,oe]),nn=y.useCallback(async(Q,Ee,Oe,at,et)=>{var Mt;Le?at?$==null||$.copy(Oe,Q,Ee,et):$==null||$.copy(Oe):L({subtitle:Q,surroundingSubtitles:Ee,subtitleFileName:((Mt=Re==null?void 0:Re[Q.track])==null?void 0:Mt.name)??"",mediaTimestamp:O.time(nt()),file:Fe===void 0?void 0:{name:Fe.name,audioTrack:Tt,playbackRate:We,blobUrl:Cs(Fe)},...et},Oe,void 0)},[$,L,O,Fe,Le,Re,Tt,We]),un=y.useCallback(Q=>{de.current.x=Q.screenX,de.current.y=Q.screenY},[]),rn=y.useCallback(async Q=>{$==null||$.audioTrackSelected(Q),$t(O,oe,!0),await qe(0,O,!0),O.running&&Qe(O,oe,!0)},[$,O,oe,qe]),pn=y.useCallback(Q=>{const Ee=nt();Ue(Math.max(-Ee||0,Q),!0)},[Ue]),qn=y.useCallback(Q=>{ct(Q,!0)},[ct]),sn=y.useCallback(Q=>pe(Q),[]),Mn=y.useCallback(Q=>ne(Ee=>{const Oe={...Ee};return Oe[Q]=!Ee[Q],Oe}),[]),ln=y.useCallback(Q=>{Q.length===0||!a.autoCopyCurrentSubtitle||!document.hasFocus()||navigator.clipboard.writeText(Q.map(Ee=>Ee.text).join(`
`)).catch(Ee=>{})},[a.autoCopyCurrentSubtitle]);y.useEffect(()=>{if(U)return;const Q=setInterval(async()=>{O.progress(nt())>=1&&($t(O,oe,!0),await qe(0,O,!0),Ce(Date.now()))},1e3);return()=>clearInterval(Q)},[O,oe,qe,U]),y.useEffect(()=>{const Q=d.bindPlay(Ee=>{Ee.preventDefault(),O.running?$t(O,oe,!0):Qe(O,oe,!0)},()=>ae);return()=>Q()},[d,O,oe,ae]),y.useEffect(()=>d.bindAdjustPlaybackRate((Q,Ee)=>{Q.preventDefault(),ct(Ee?Math.min(5,We+.1):Math.max(.1,We-.1),!0)},()=>ae),[ct,We,ae,d]);const Wt=y.useCallback((Q,Ee)=>{if(!Ie)return;Q.preventDefault();const Oe=se===Ee?Ft.normal:Ee;pe(Oe),w(se,Oe),$==null||$.playMode(Oe),se===Ft.fastForward&&ct(1,!0)},[$,se,Ie,w,ct]);y.useEffect(()=>d.bindAutoPause(Q=>Wt(Q,Ft.autoPause),()=>ae),[Wt,d,ae]),y.useEffect(()=>d.bindCondensedPlayback(Q=>Wt(Q,Ft.condensed),()=>ae),[Wt,d,ae]),y.useEffect(()=>d.bindFastForwardPlayback(Q=>Wt(Q,Ft.fastForward),()=>ae),[Wt,d,ae]),y.useEffect(()=>d.bindToggleRepeat(Q=>{const Ee=nt(),Oe=O.time(Ee);Ae.subtitlesAt(Oe).showing.length>0&&Wt(Q,Ft.repeat)},()=>ae),[d,ae,Wt,Ae,O]),y.useEffect(()=>$==null?void 0:$.appBarToggle(S),[$,S]),y.useEffect(()=>$==null?void 0:$.fullscreenToggle(R),[$,R]),y.useEffect(()=>{(te==null?void 0:te.start)!==void 0&&($t(O,oe,!0),qe(te.start,O,!0))},[O,te==null?void 0:te.start,oe,qe]),y.useEffect(()=>{we&&(we.onSeekTimestamp=async({body:{timestamp:Q}})=>{qe(Q*1e3,O,!0)})},[we,f,qe,O]);const[Cn]=bc(!0),it=Le||n,Ht=!!(it&&Le&&!j),Dt=Math.max(0,Cn-vo),Xe=Dt<zo,Ze=Ht&&(C||!n||(n==null?void 0:n.length)===0||Xe);return v.jsx("div",{onMouseMove:un,className:Ge.root,children:v.jsxs(rt,{container:!0,direction:"row",wrap:"nowrap",className:Ge.container,children:[Ht&&v.jsx(rt,{item:!0,style:{flexGrow:1,minWidth:vo},children:v.jsx("iframe",{ref:h,className:Ge.videoFrame,style:{pointerEvents:yt?"none":"auto"},src:E+"?video="+encodeURIComponent(Le)+"&channel="+At+"&popout=false",title:"asbplayer"})}),v.jsxs(rt,{item:!0,hidden:Ze,style:{flexGrow:Ht?0:1,width:"auto"},children:[it&&!(Le&&!j)&&!ye&&v.jsx(ac,{mousePositionRef:de,clock:O,length:nt(),displayLength:$i($,n,!1),audioTracks:Pt,selectedAudioTrack:Tt,tabs:!Le&&_||void 0,selectedTab:U,offsetEnabled:!0,offset:Ne,playbackRate:We,playbackRateEnabled:!U||f.supportsPlaybackRateMessage,onPlaybackRateChange:qn,playModeEnabled:Ie,playMode:se,onPlay:yn,onPause:vn,onSeek:xn,onAudioTrackSelected:rn,onTabSelected:ie,onUnloadVideo:()=>Le&&D(Le),onOffsetChange:pn,onPlayMode:sn,disableKeyEvents:ae,playbackPreferences:u,showOnMouseMovement:!0}),v.jsx(mc,{subtitles:n,subtitleCollection:Ae,clock:O,extension:f,length:nt(),jumpToSubtitle:Te,drawerOpen:m,appBarHidden:S,compressed:Ht||(xe??!1),resizable:Ht,showCopyButton:b,loading:Me,displayHelp:j&&(Fe==null?void 0:Fe.name)||void 0,disableKeyEvents:ae,disableMiningBinds:f.supportsVideoPlayerMiningCommands&&Fe!==void 0,lastJumpToTopTimestamp:vt,hidden:Ze,disabledSubtitleTracks:Se,onSeek:Vn,onCopy:nn,onOffsetChange:pn,onToggleSubtitleTrack:Mn,onSubtitlesHighlighted:ln,onResizeStart:ht,onResizeEnd:Zt,maxResizeWidth:Dt,autoPauseContext:Xt,settings:a,keyBinder:d,webSocketClient:we})]})]})})});function xc(s){return Ji("MuiAlert",s)}const xo=Yi("MuiAlert",["root","action","icon","message","filled","colorSuccess","colorInfo","colorWarning","colorError","filledSuccess","filledInfo","filledWarning","filledError","outlined","outlinedSuccess","outlinedInfo","outlinedWarning","outlinedError","standard","standardSuccess","standardInfo","standardWarning","standardError"]),wc=ft(v.jsx("path",{d:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"}),"SuccessOutlined"),Sc=ft(v.jsx("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),"ReportProblemOutlined"),Ec=ft(v.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),kc=ft(v.jsx("path",{d:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),"InfoOutlined"),Tc=s=>{const{variant:e,color:n,severity:r,classes:a}=s,u={root:["root",`color${gt(n||r)}`,`${e}${gt(n||r)}`,`${e}`],icon:["icon"],message:["message"],action:["action"]};return Fr(u,xc,a)},Cc=fn(On,{name:"MuiAlert",slot:"Root",overridesResolver:(s,e)=>{const{ownerState:n}=s;return[e.root,e[n.variant],e[`${n.variant}${gt(n.color||n.severity)}`]]}})(Hn(({theme:s})=>{const e=s.palette.mode==="light"?Es:ks,n=s.palette.mode==="light"?ks:Es;return{...s.typography.body2,backgroundColor:"transparent",display:"flex",padding:"6px 16px",variants:[...Object.entries(s.palette).filter(tr(["light"])).map(([r])=>({props:{colorSeverity:r,variant:"standard"},style:{color:s.vars?s.vars.palette.Alert[`${r}Color`]:e(s.palette[r].light,.6),backgroundColor:s.vars?s.vars.palette.Alert[`${r}StandardBg`]:n(s.palette[r].light,.9),[`& .${xo.icon}`]:s.vars?{color:s.vars.palette.Alert[`${r}IconColor`]}:{color:s.palette[r].main}}})),...Object.entries(s.palette).filter(tr(["light"])).map(([r])=>({props:{colorSeverity:r,variant:"outlined"},style:{color:s.vars?s.vars.palette.Alert[`${r}Color`]:e(s.palette[r].light,.6),border:`1px solid ${(s.vars||s).palette[r].light}`,[`& .${xo.icon}`]:s.vars?{color:s.vars.palette.Alert[`${r}IconColor`]}:{color:s.palette[r].main}}})),...Object.entries(s.palette).filter(tr(["dark"])).map(([r])=>({props:{colorSeverity:r,variant:"filled"},style:{fontWeight:s.typography.fontWeightMedium,...s.vars?{color:s.vars.palette.Alert[`${r}FilledColor`],backgroundColor:s.vars.palette.Alert[`${r}FilledBg`]}:{backgroundColor:s.palette.mode==="dark"?s.palette[r].dark:s.palette[r].main,color:s.palette.getContrastText(s.palette[r].main)}}}))]}})),_c=fn("div",{name:"MuiAlert",slot:"Icon",overridesResolver:(s,e)=>e.icon})({marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9}),Rc=fn("div",{name:"MuiAlert",slot:"Message",overridesResolver:(s,e)=>e.message})({padding:"8px 0",minWidth:0,overflow:"auto"}),Ic=fn("div",{name:"MuiAlert",slot:"Action",overridesResolver:(s,e)=>e.action})({display:"flex",alignItems:"flex-start",padding:"4px 0 0 16px",marginLeft:"auto",marginRight:-8}),wo={success:v.jsx(wc,{fontSize:"inherit"}),warning:v.jsx(Sc,{fontSize:"inherit"}),error:v.jsx(Ec,{fontSize:"inherit"}),info:v.jsx(kc,{fontSize:"inherit"})},Pc=y.forwardRef(function(e,n){const r=Br({props:e,name:"MuiAlert"}),{action:a,children:u,className:d,closeText:f="Close",color:h,components:p={},componentsProps:m={},icon:S,iconMapping:b=wo,onClose:R,role:C="alert",severity:j="success",slotProps:U={},slots:_={},variant:H="standard",...E}=r,G={...r,color:h,severity:j,variant:H,colorSeverity:h||j},D=Tc(G),L={slots:{closeButton:p.CloseButton,closeIcon:p.CloseIcon,..._},slotProps:{...m,...U}},[z,ie]=Fn("root",{ref:n,shouldForwardComponentProp:!0,className:Nn(D.root,d),elementType:Cc,externalForwardedProps:{...L,...E},ownerState:G,additionalProps:{role:C,elevation:0}}),[ge,Y]=Fn("icon",{className:D.icon,elementType:_c,externalForwardedProps:L,ownerState:G}),[Z,ee]=Fn("message",{className:D.message,elementType:Rc,externalForwardedProps:L,ownerState:G}),[w,P]=Fn("action",{className:D.action,elementType:Ic,externalForwardedProps:L,ownerState:G}),[re,ae]=Fn("closeButton",{elementType:dt,externalForwardedProps:L,ownerState:G}),[Te,te]=Fn("closeIcon",{elementType:Za,externalForwardedProps:L,ownerState:G});return v.jsxs(z,{...ie,children:[S!==!1?v.jsx(ge,{...Y,children:S||b[j]||wo[j]}):null,v.jsx(Z,{...ee,children:u}),a!=null?v.jsx(w,{...P,children:a}):null,a==null&&R?v.jsx(w,{...P,children:v.jsx(re,{size:"small","aria-label":f,title:f,color:"inherit",onClick:R,...ae,children:v.jsx(Te,{fontSize:"small",...te})})}):null]})}),Ac=bn(()=>({root:{display:"flex",justifyContent:"center",position:"fixed",width:"100%",pointerEvents:"none",zIndex:2e3},bottom:{bottom:"10vh"},top:{top:"10vh"}}));function Nc(s){const e=Ac();y.useEffect(()=>{if(s.open&&!s.disableAutoHide){const r=setTimeout(s.onClose,s.autoHideDuration);return()=>clearTimeout(r)}},[s.open,s.autoHideDuration,s.disableAutoHide,s.onClose]);const n=s.anchor==="bottom"?e.bottom:e.top;return v.jsx("div",{className:`${e.root} ${n}`,children:v.jsx(Ea,{in:s.open,children:v.jsx(Pc,{severity:s.severity,children:s.children})})})}const Uo=s=>v.jsx(ka,{...s,children:v.jsx("path",{d:"M 20 9 H 4 c -1.1 0 -2 1 -2 5 v 6 c 0 1.1 0.9 2 2 2 h 16 c 1.1 0 2 -0.9 2 -2 V 11 c 0 -1.1 -0.9 -2 -2 -2 M 4 14 h 4 v 2 H 4 z m 10 6 H 4 v -2 h 10 z m 6 0 h -4 v -2 h 4 z m 0 -4 H 10 v -2 h 10 z M 17 9 L 17 12 L 7 12 L 7 9 M 10 6 L 10 10 L 14 10 L 14 6 L 19 6 L 12 0 L 5 6 L 10 6"})}),Xo=ft(v.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History");function Oc(s){return Ji("MuiButtonGroup",s)}const Ve=Yi("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","horizontal","vertical","colorPrimary","colorSecondary","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]),Mc=(s,e)=>{const{ownerState:n}=s;return[{[`& .${Ve.grouped}`]:e.grouped},{[`& .${Ve.grouped}`]:e[`grouped${gt(n.orientation)}`]},{[`& .${Ve.grouped}`]:e[`grouped${gt(n.variant)}`]},{[`& .${Ve.grouped}`]:e[`grouped${gt(n.variant)}${gt(n.orientation)}`]},{[`& .${Ve.grouped}`]:e[`grouped${gt(n.variant)}${gt(n.color)}`]},{[`& .${Ve.firstButton}`]:e.firstButton},{[`& .${Ve.lastButton}`]:e.lastButton},{[`& .${Ve.middleButton}`]:e.middleButton},e.root,e[n.variant],n.disableElevation===!0&&e.disableElevation,n.fullWidth&&e.fullWidth,n.orientation==="vertical"&&e.vertical]},jc=s=>{const{classes:e,color:n,disabled:r,disableElevation:a,fullWidth:u,orientation:d,variant:f}=s,h={root:["root",f,d,u&&"fullWidth",a&&"disableElevation",`color${gt(n)}`],grouped:["grouped",`grouped${gt(d)}`,`grouped${gt(f)}`,`grouped${gt(f)}${gt(d)}`,`grouped${gt(f)}${gt(n)}`,r&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return Fr(h,Oc,e)},Lc=fn("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:Mc})(Hn(({theme:s})=>({display:"inline-flex",borderRadius:(s.vars||s).shape.borderRadius,variants:[{props:{variant:"contained"},style:{boxShadow:(s.vars||s).shadows[2]}},{props:{disableElevation:!0},style:{boxShadow:"none"}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${Ve.lastButton},& .${Ve.middleButton}`]:{borderTopRightRadius:0,borderTopLeftRadius:0},[`& .${Ve.firstButton},& .${Ve.middleButton}`]:{borderBottomRightRadius:0,borderBottomLeftRadius:0}}},{props:{orientation:"horizontal"},style:{[`& .${Ve.firstButton},& .${Ve.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${Ve.lastButton},& .${Ve.middleButton}`]:{borderTopLeftRadius:0,borderBottomLeftRadius:0}}},{props:{variant:"text",orientation:"horizontal"},style:{[`& .${Ve.firstButton},& .${Ve.middleButton}`]:{borderRight:s.vars?`1px solid rgba(${s.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${s.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${Ve.disabled}`]:{borderRight:`1px solid ${(s.vars||s).palette.action.disabled}`}}}},{props:{variant:"text",orientation:"vertical"},style:{[`& .${Ve.firstButton},& .${Ve.middleButton}`]:{borderBottom:s.vars?`1px solid rgba(${s.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${s.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${Ve.disabled}`]:{borderBottom:`1px solid ${(s.vars||s).palette.action.disabled}`}}}},...Object.entries(s.palette).filter(tr()).flatMap(([e])=>[{props:{variant:"text",color:e},style:{[`& .${Ve.firstButton},& .${Ve.middleButton}`]:{borderColor:s.vars?`rgba(${s.vars.palette[e].mainChannel} / 0.5)`:Ro(s.palette[e].main,.5)}}}]),{props:{variant:"outlined",orientation:"horizontal"},style:{[`& .${Ve.firstButton},& .${Ve.middleButton}`]:{borderRightColor:"transparent","&:hover":{borderRightColor:"currentColor"}},[`& .${Ve.lastButton},& .${Ve.middleButton}`]:{marginLeft:-1}}},{props:{variant:"outlined",orientation:"vertical"},style:{[`& .${Ve.firstButton},& .${Ve.middleButton}`]:{borderBottomColor:"transparent","&:hover":{borderBottomColor:"currentColor"}},[`& .${Ve.lastButton},& .${Ve.middleButton}`]:{marginTop:-1}}},{props:{variant:"contained",orientation:"horizontal"},style:{[`& .${Ve.firstButton},& .${Ve.middleButton}`]:{borderRight:`1px solid ${(s.vars||s).palette.grey[400]}`,[`&.${Ve.disabled}`]:{borderRight:`1px solid ${(s.vars||s).palette.action.disabled}`}}}},{props:{variant:"contained",orientation:"vertical"},style:{[`& .${Ve.firstButton},& .${Ve.middleButton}`]:{borderBottom:`1px solid ${(s.vars||s).palette.grey[400]}`,[`&.${Ve.disabled}`]:{borderBottom:`1px solid ${(s.vars||s).palette.action.disabled}`}}}},...Object.entries(s.palette).filter(tr(["dark"])).map(([e])=>({props:{variant:"contained",color:e},style:{[`& .${Ve.firstButton},& .${Ve.middleButton}`]:{borderColor:(s.vars||s).palette[e].dark}}}))],[`& .${Ve.grouped}`]:{minWidth:40,boxShadow:"none",props:{variant:"contained"},style:{"&:hover":{boxShadow:"none"}}}}))),Bc=y.forwardRef(function(e,n){const r=Br({props:e,name:"MuiButtonGroup"}),{children:a,className:u,color:d="primary",component:f="div",disabled:h=!1,disableElevation:p=!1,disableFocusRipple:m=!1,disableRipple:S=!1,fullWidth:b=!1,orientation:R="horizontal",size:C="medium",variant:j="outlined",...U}=r,_={...r,color:d,component:f,disabled:h,disableElevation:p,disableFocusRipple:m,disableRipple:S,fullWidth:b,orientation:R,size:C,variant:j},H=jc(_),E=y.useMemo(()=>({className:H.grouped,color:d,disabled:h,disableElevation:p,disableFocusRipple:m,disableRipple:S,fullWidth:b,size:C,variant:j}),[d,h,p,m,S,b,C,j,H.grouped]),G=bl(a),D=G.length,L=z=>{const ie=z===0,ge=z===D-1;return ie&&ge?"":ie?H.firstButton:ge?H.lastButton:H.middleButton};return v.jsx(Lc,{as:f,role:"group",className:Nn(H.root,u),ref:n,ownerState:_,...U,children:v.jsx(dl.Provider,{value:E,children:G.map((z,ie)=>v.jsx(fl.Provider,{value:L(ie),children:z},ie))})})}),Fc=({videoElementCount:s})=>{const{t:e}=hn();return v.jsx($r,{p:3,children:v.jsx(rr,{variant:"h6",children:e(s===0?"landing.noVideoElementsDetected":"landing.videoElementsDetected")})})},$c=({videoElementCount:s,onLoadSubtitles:e,onShowMiningHistory:n})=>{const{t:r}=hn();return v.jsxs(Oo,{direction:"column",children:[v.jsx(Di,{children:v.jsx(Fc,{videoElementCount:s})}),v.jsx(Di,{children:v.jsxs(Bc,{variant:"contained",color:"primary",orientation:"vertical",children:[v.jsx(Mr,{startIcon:v.jsx(Uo,{}),disabled:s===0,onClick:e,children:r("action.loadSubtitles")}),v.jsx(Mr,{startIcon:v.jsx(Xo,{}),onClick:n,children:r("bar.miningHistory")})]})})]})},Hc=()=>{const[s,e]=y.useState();return y.useEffect(()=>{Ut.tabs.query({active:!0,currentWindow:!0}).then(n=>{n.length>0&&e(n[0].id)})},[]),y.useEffect(()=>{const n=r=>e(r.tabId);return Ut.tabs.onActivated.addListener(n),()=>Ut.tabs.onActivated.removeListener(n)}),s},Dc=({extension:s,currentTabId:e})=>{const[n,r]=y.useState();return y.useEffect(()=>{if(e===void 0)return;const a=u=>u.filter(d=>d.id===e&&d.subscribed).length;return s.tabs!==void 0&&r(a(s.tabs)),s.subscribeTabs(u=>{r(a(u))})},[s,e]),n},Vc=({disabled:s,postMineAction:e,emptySubtitleTrack:n,recordingAudio:r,audioRecordingEnabled:a,onMineSubtitle:u})=>{const{t:d}=hn();function f(){if(n)return d(a?r?"action.stopRecording":"action.startRecording":"action.mine");switch(e){case qt.exportCard:case qt.showAnkiDialog:case qt.none:return d("action.mine");case qt.updateLastCard:return d("action.updateLastCard")}}return n?v.jsx($r,{p:2,style:{position:"absolute",bottom:0,width:"100%"},children:v.jsx(Mr,{disabled:s||r&&!n,variant:"contained",color:"primary",startIcon:v.jsx(Qi,{}),onClick:u,style:{width:"100%"},children:f()})}):null},qc=bn(()=>({icon:{animation:"$blink infinite 1s"},"@keyframes blink":{"0%":{opacity:1},"100%":{opacity:0}}})),Kc=({show:s})=>{const e=qc();return s?v.jsx($r,{padding:1,style:{position:"absolute",top:0,left:0},children:v.jsx(cl,{className:e.icon,color:"error"})}):null},Wo=ft(v.jsx("path",{d:"M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7zm-6 .67 2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"}),"SaveAlt"),zc=Dn.forwardRef(function({show:e,canDownloadSubtitles:n,onLoadSubtitles:r,onDownloadSubtitles:a,onShowMiningHistory:u},d){const{t:f}=hn(),[h,p]=y.useState(!0);return y.useEffect(()=>{const m=setTimeout(()=>p(!1),1e3);return()=>clearTimeout(m)},[]),v.jsx(Hi,{in:e||h,children:v.jsx($r,{ref:d,style:{position:"absolute",top:12,right:12},children:v.jsxs(rt,{container:!0,direction:"column",children:[v.jsx(rt,{item:!0,children:v.jsx(kt,{title:f("action.loadSubtitles"),children:v.jsx(dt,{onClick:r,children:v.jsx(Uo,{})})})}),n&&v.jsx(rt,{item:!0,children:v.jsx(kt,{title:f("action.downloadSubtitlesAsSrt"),children:v.jsx(dt,{onClick:a,children:v.jsx(Wo,{})})})}),v.jsx(rt,{item:!0,children:v.jsx(dt,{onClick:u,children:v.jsx(kt,{title:f("bar.miningHistory"),children:v.jsx(Xo,{})})})})]})})})});function Uc(s,e,n){const r=e.getBoundingClientRect(),a=n&&n.getBoundingClientRect(),u=Io(e);let d;if(e.fakeTransform)d=e.fakeTransform;else{const p=u.getComputedStyle(e);d=p.getPropertyValue("-webkit-transform")||p.getPropertyValue("transform")}let f=0,h=0;if(d&&d!=="none"&&typeof d=="string"){const p=d.split("(")[1].split(")")[0].split(",");f=parseInt(p[4],10),h=parseInt(p[5],10)}return s==="left"?a?`translateX(${a.right+f-r.left}px)`:`translateX(${u.innerWidth+f-r.left}px)`:s==="right"?a?`translateX(-${r.right-a.left-f}px)`:`translateX(-${r.left+r.width-f}px)`:s==="up"?a?`translateY(${a.bottom+h-r.top}px)`:`translateY(${u.innerHeight+h-r.top}px)`:a?`translateY(-${r.top-a.top+r.height-h}px)`:`translateY(-${r.top+r.height-h}px)`}function Xc(s){return typeof s=="function"?s():s}function Pr(s,e,n){const r=Xc(n),a=Uc(s,e,r);a&&(e.style.webkitTransform=a,e.style.transform=a)}const Wc=y.forwardRef(function(e,n){const r=or(),a={enter:r.transitions.easing.easeOut,exit:r.transitions.easing.sharp},u={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:d,appear:f=!0,children:h,container:p,direction:m="down",easing:S=a,in:b,onEnter:R,onEntered:C,onEntering:j,onExit:U,onExited:_,onExiting:H,style:E,timeout:G=u,TransitionComponent:D=Ta,...L}=e,z=y.useRef(null),ie=Ca(_a(h),z,n),ge=te=>ye=>{te&&(ye===void 0?te(z.current):te(z.current,ye))},Y=ge((te,ye)=>{Pr(m,te,p),Ra(te),R&&R(te,ye)}),Z=ge((te,ye)=>{const xe=Ts({timeout:G,style:E,easing:S},{mode:"enter"});te.style.webkitTransition=r.transitions.create("-webkit-transform",{...xe}),te.style.transition=r.transitions.create("transform",{...xe}),te.style.webkitTransform="none",te.style.transform="none",j&&j(te,ye)}),ee=ge(C),w=ge(H),P=ge(te=>{const ye=Ts({timeout:G,style:E,easing:S},{mode:"exit"});te.style.webkitTransition=r.transitions.create("-webkit-transform",ye),te.style.transition=r.transitions.create("transform",ye),Pr(m,te,p),U&&U(te)}),re=ge(te=>{te.style.webkitTransition="",te.style.transition="",_&&_(te)}),ae=te=>{d&&d(z.current,te)},Te=y.useCallback(()=>{z.current&&Pr(m,z.current,p)},[m,p]);return y.useEffect(()=>{if(b||m==="down"||m==="right")return;const te=hl(()=>{z.current&&Pr(m,z.current,p)}),ye=Io(z.current);return ye.addEventListener("resize",te),()=>{te.clear(),ye.removeEventListener("resize",te)}},[m,b,p]),y.useEffect(()=>{b||Te()},[b,Te]),v.jsx(D,{nodeRef:z,onEnter:Y,onEntered:ee,onEntering:Z,onExit:P,onExited:re,onExiting:w,addEndListener:ae,appear:f,in:b,timeout:G,...L,children:(te,{ownerState:ye,...xe})=>y.cloneElement(h,{ref:ie,style:{visibility:te==="exited"&&!b?"hidden":void 0,...E,...h.props.style},...xe})})});function Gc(s){return Ji("MuiDrawer",s)}Yi("MuiDrawer",["root","docked","paper","anchorLeft","anchorRight","anchorTop","anchorBottom","paperAnchorLeft","paperAnchorRight","paperAnchorTop","paperAnchorBottom","paperAnchorDockedLeft","paperAnchorDockedRight","paperAnchorDockedTop","paperAnchorDockedBottom","modal"]);const Go=(s,e)=>{const{ownerState:n}=s;return[e.root,(n.variant==="permanent"||n.variant==="persistent")&&e.docked,e.modal]},Yc=s=>{const{classes:e,anchor:n,variant:r}=s,a={root:["root",`anchor${gt(n)}`],docked:[(r==="permanent"||r==="persistent")&&"docked"],modal:["modal"],paper:["paper",`paperAnchor${gt(n)}`,r!=="temporary"&&`paperAnchorDocked${gt(n)}`]};return Fr(a,Gc,e)},Jc=fn(Aa,{name:"MuiDrawer",slot:"Root",overridesResolver:Go})(Hn(({theme:s})=>({zIndex:(s.vars||s).zIndex.drawer}))),So=fn("div",{shouldForwardProp:Pa,name:"MuiDrawer",slot:"Docked",skipVariantsResolver:!1,overridesResolver:Go})({flex:"0 0 auto"}),Qc=fn(On,{name:"MuiDrawer",slot:"Paper",overridesResolver:(s,e)=>{const{ownerState:n}=s;return[e.paper,e[`paperAnchor${gt(n.anchor)}`],n.variant!=="temporary"&&e[`paperAnchorDocked${gt(n.anchor)}`]]}})(Hn(({theme:s})=>({overflowY:"auto",display:"flex",flexDirection:"column",height:"100%",flex:"1 0 auto",zIndex:(s.vars||s).zIndex.drawer,WebkitOverflowScrolling:"touch",position:"fixed",top:0,outline:0,variants:[{props:{anchor:"left"},style:{left:0}},{props:{anchor:"top"},style:{top:0,left:0,right:0,height:"auto",maxHeight:"100%"}},{props:{anchor:"right"},style:{right:0}},{props:{anchor:"bottom"},style:{top:"auto",left:0,bottom:0,right:0,height:"auto",maxHeight:"100%"}},{props:({ownerState:e})=>e.anchor==="left"&&e.variant!=="temporary",style:{borderRight:`1px solid ${(s.vars||s).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="top"&&e.variant!=="temporary",style:{borderBottom:`1px solid ${(s.vars||s).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="right"&&e.variant!=="temporary",style:{borderLeft:`1px solid ${(s.vars||s).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="bottom"&&e.variant!=="temporary",style:{borderTop:`1px solid ${(s.vars||s).palette.divider}`}}]}))),Yo={left:"right",right:"left",top:"down",bottom:"up"};function Zc(s){return["left","right"].includes(s)}function ed({direction:s},e){return s==="rtl"&&Zc(e)?Yo[e]:e}const td=y.forwardRef(function(e,n){const r=Br({props:e,name:"MuiDrawer"}),a=or(),u=Ia(),d={enter:a.transitions.duration.enteringScreen,exit:a.transitions.duration.leavingScreen},{anchor:f="left",BackdropProps:h,children:p,className:m,elevation:S=16,hideBackdrop:b=!1,ModalProps:{BackdropProps:R,...C}={},onClose:j,open:U=!1,PaperProps:_={},SlideProps:H,TransitionComponent:E=Wc,transitionDuration:G=d,variant:D="temporary",...L}=r,z=y.useRef(!1);y.useEffect(()=>{z.current=!0},[]);const ie=ed({direction:u?"rtl":"ltr"},f),Y={...r,anchor:f,elevation:S,open:U,variant:D,...L},Z=Yc(Y),ee=v.jsx(Qc,{elevation:D==="temporary"?S:0,square:!0,..._,className:Nn(Z.paper,_.className),ownerState:Y,children:p});if(D==="permanent")return v.jsx(So,{className:Nn(Z.root,Z.docked,m),ownerState:Y,ref:n,...L,children:ee});const w=v.jsx(E,{in:U,direction:Yo[ie],timeout:G,appear:z.current,...H,children:ee});return D==="persistent"?v.jsx(So,{className:Nn(Z.root,Z.docked,m),ownerState:Y,ref:n,...L,children:w}):v.jsx(Jc,{BackdropProps:{...h,...R,transitionDuration:G},className:Nn(Z.root,Z.modal,m),open:U,ownerState:Y,onClose:j,hideBackdrop:b,ref:n,...L,...C,children:w})}),nd=ft(v.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"ChevronRight"),rd=bn(s=>({listContainer:{display:"flex",height:"100%",flexDirection:"column",overflowY:"auto",overflowX:"hidden"},list:{flexGrow:1},clearButton:{margin:s.spacing(2)},listItem:{"&:hover":{backgroundColor:s.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20},emptyState:{display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",height:"100%",padding:15},text:{flexGrow:1},emptyText:{flexGrow:1,color:s.palette.text.secondary},timestamp:{paddingRight:15,paddingLeft:15,color:s.palette.text.secondary}})),id=s=>{const[e,n]=y.useState();return y.useEffect(()=>{const r=No.fromCard(s,0,0,!1);n(r?r.error===void 0:!1)},[s]),{isAudioAvailable:e}},sd=s=>{const[e,n]=y.useState();return y.useEffect(()=>{const r=Ao.fromCard(s,0,0);n(r?r.error===void 0:!1)},[s]),{isImageAvailable:e}};function od({open:s,anchorEl:e,forceShowDownloadOptions:n,onClose:r,onSelect:a,onClipAudio:u,onDownloadImage:d,onDelete:f,item:h}){const{t:p}=hn(),m=y.useCallback(()=>{navigator.clipboard.writeText(h.subtitle.text),r()},[h,r]),S=y.useCallback(()=>{a!==void 0&&(a(h),r())},[h,a,r]),b=y.useCallback(()=>{u(h),r()},[h,u,r]),R=y.useCallback(()=>{d(h),r()},[h,d,r]),C=y.useCallback(()=>{f(h),r()},[h,f,r]),{isImageAvailable:j}=sd(h),{isAudioAvailable:U}=id(h);return v.jsx(Zi,{disableEnforceFocus:!0,open:s,anchorEl:e,onClose:r,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:v.jsxs(Hr,{children:[v.jsx(mn,{disablePadding:!0,onClick:m,children:v.jsx(Pn,{children:v.jsx(An,{primaryTypographyProps:{variant:"body2"},primary:p("action.copy")})})}),a&&v.jsx(mn,{disablePadding:!0,onClick:S,children:v.jsx(Pn,{children:v.jsx(An,{primaryTypographyProps:{variant:"body2"},primary:p("action.jumpTo")})})}),(U||n)&&v.jsx(mn,{disablePadding:!0,onClick:b,children:v.jsx(Pn,{children:v.jsx(An,{primaryTypographyProps:{variant:"body2"},primary:p("action.downloadAudio")})})}),(j||n)&&v.jsx(mn,{disablePadding:!0,onClick:R,children:v.jsx(Pn,{children:v.jsx(An,{primaryTypographyProps:{variant:"body2"},primary:p("action.downloadImage")})})}),v.jsx(mn,{disablePadding:!0,onClick:C,children:v.jsx(Pn,{children:v.jsx(An,{primaryTypographyProps:{variant:"body2"},primary:p("action.delete")})})})]})})}function Jo({open:s,items:e,forceShowDownloadOptions:n,onSelect:r,onClipAudio:a,onDownloadImage:u,onDelete:d,onDeleteAll:f,onDownloadSectionAsSrt:h,onAnki:p}){const m=rd(),S=y.useCallback(z=>{z&&z.scrollIntoView()},[]),[b,R]=y.useState(),[C,j]=y.useState(!1),[U,_]=y.useState(),{t:H}=hn(),E=y.useCallback((z,ie)=>{R(ie),j(!0),_(z.currentTarget)},[]),G=y.useCallback(()=>{R(void 0),j(!1),_(void 0)},[]),D=y.useCallback(z=>{d(z)},[d]);let L;if(e.length>0){const z=[];let ie=null,ge=0;const Y={};let Z={},ee;for(const w of e){if(ie===null||ie!==w.subtitleFileName){w.subtitleFileName in Y?Y[w.subtitleFileName]++:Y[w.subtitleFileName]=0;const re=w.subtitleFileName+"-"+Y[w.subtitleFileName];Z[re]=[],ie=w.subtitleFileName,ee=re,z.push(v.jsxs(mn,{children:[v.jsx(rr,{color:"textSecondary",children:w.subtitleFileName}),h&&v.jsx(pl,{children:v.jsx(kt,{title:H("copyHistory.downloadMinedSubsAsSrt"),children:v.jsx(dt,{onClick:()=>h==null?void 0:h(w.subtitleFileName,Z[re]),edge:"end",children:v.jsx(Wo,{})})})})]},re))}Z[ee].push(w);const P=ge===e.length-1?S:null;z.push(v.jsxs(mn,{ref:P,className:m.listItem,classes:{gutters:m.listItemGutters},children:[v.jsx(_s,{classes:{root:m.listItemIconRoot},children:v.jsx(kt,{title:H("copyHistory.exportToAnki"),children:v.jsx(dt,{onClick:()=>p(w),children:v.jsx(Qi,{fontSize:"small"})})})}),v.jsx(_s,{classes:{root:m.listItemIconRoot},children:v.jsx(dt,{onClick:re=>E(re,w),children:v.jsx(Po,{fontSize:"small"})})}),v.jsx(An,{primary:v.jsxs(rt,{wrap:"nowrap",container:!0,children:[v.jsx(rt,{item:!0,className:w.subtitle.text===""?m.emptyText:m.text,children:w.subtitle.text===""?H("copyHistory.blank"):w.subtitle.text}),v.jsx(rt,{item:!0,className:m.timestamp,children:sr(w.subtitle.start,w.subtitle.start,!1)})]})})]},w.id)),++ge}L=v.jsxs(On,{className:m.listContainer,children:[v.jsx(Hr,{className:m.list,children:z}),v.jsx(Mr,{variant:"contained",color:"primary",className:m.clearButton,startIcon:v.jsx(el,{}),onClick:f,children:H("copyHistory.deleteAll")})]})}else L=v.jsx(On,{className:m.emptyState,children:v.jsx(rr,{variant:"h6",children:H("copyHistory.miningHistoryEmpty")})});return v.jsxs(v.Fragment,{children:[L,b&&v.jsx(od,{open:s&&C,forceShowDownloadOptions:n,anchorEl:U,item:b,onClose:G,onSelect:r,onClipAudio:a,onDownloadImage:u,onDelete:D})]})}const ad=bn(s=>({drawer:{width:({drawerWidth:e})=>e??"100%",flexShrink:0},drawerPaper:{width:({drawerWidth:e})=>e??"100%"},drawerHeader:{display:"flex",alignItems:"center",position:"static",padding:s.spacing(0,1),...s.mixins.toolbar,justifyContent:"flex-start"}}));function ld(s){const e=ad(s);return v.jsxs(td,{variant:"persistent",anchor:"right",open:s.open,className:e.drawer,classes:{paper:e.drawerPaper},children:[v.jsx(On,{className:e.drawerHeader,children:v.jsx(dt,{onClick:s.onClose,children:v.jsx(nd,{})})}),v.jsx(Vi,{}),v.jsx(Jo,{...s})]})}function Eo(s,e,n){const r=e;let a=-1,u=Number.MAX_SAFE_INTEGER;for(let d=0;d<n.length;++d){const f=n[d],h=s?f.start-r:r-f.start;u<=h||(s&&r<f.start?(u=h,a=d):!s&&r>f.start&&(u=h,a=r<f.end?Math.max(0,d-1):d))}return a!==-1?n[a]:null}class ko{constructor(e){ce(this,"keyBindSet");this.keyBindSet=e}bindCopy(e,n,r,a=!1){const u=this.keyBindSet.copySubtitle.keys;if(!u)return()=>{};const d=this.copyHandler(e,n,r);return this._bind(u,a,d)}copyHandler(e,n,r){return a=>{if(n())return!1;const u=r();return u?(e(a,u),!0):!1}}bindAnkiExport(e,n,r=!1){const a=this.keyBindSet.ankiExport.keys;if(!a)return()=>{};const u=this.ankiExportHandler(e,n);return this._bind(a,r,u)}ankiExportHandler(e,n){return r=>n()?!1:(e(r),!0)}bindUpdateLastCard(e,n,r=!1){const a=this.keyBindSet.updateLastCard.keys;if(!a)return()=>{};const u=this.updateLastCardHandler(e,n);return this._bind(a,r,u)}updateLastCardHandler(e,n){return r=>n()?!1:(e(r),!0)}bindExportCard(e,n,r=!1){const a=this.keyBindSet.exportCard.keys;if(!a)return()=>{};const u=this.exportCardHandler(e,n);return this._bind(a,r,u)}exportCardHandler(e,n){return r=>n()?!1:(e(r),!0)}bindTakeScreenshot(e,n,r=!1){const a=this.keyBindSet.takeScreenshot.keys;if(!a)return()=>{};const u=this.takeScreenshotHandler(e,n);return this._bind(a,r,u)}takeScreenshotHandler(e,n){return r=>n()?!1:(e(r),!0)}bindToggleRecording(e,n,r=!1){const a=this.keyBindSet.toggleRecording.keys;if(!a)return()=>{};const u=this.takeScreenshotHandler(e,n);return this._bind(a,r,u)}toggleRecordingHandler(e,n){return r=>n()?!1:(e(r),!0)}bindSeekToSubtitle(e,n,r,a,u=!1){const d=(R,C)=>{if(n())return!1;const j=a();if(!j||j.length===0)return!1;const U=Eo(C,r(),j);return U!==null&&U.start>=0&&U.end>=0?(e(R,U),!0):!1},f=this.keyBindSet.seekToPreviousSubtitle.keys,h=this.keyBindSet.seekToNextSubtitle.keys,p=R=>d(R,!1),m=R=>d(R,!0);let S,b;return f&&(S=this._bind(f,u,p)),h&&(b=this._bind(h,u,m)),()=>{S==null||S(),b==null||b()}}bindSeekToBeginningOfCurrentSubtitle(e,n,r,a,u=!1){const d=this.keyBindSet.seekToBeginningOfCurrentSubtitle.keys;if(!d)return()=>{};const f=h=>{if(n())return!1;const p=a();if(!p||p.length===0)return!1;const m=this._currentOrPreviousSubtitle(r(),p);return m!==void 0&&m.start>=0&&m.end>=0?(e(h,m),!0):!1};return this._bind(d,u,f)}_currentOrPreviousSubtitle(e,n){const r=e;let a,u,d=Number.MAX_SAFE_INTEGER;for(let f=0;f<n.length;++f){const h=n[f];if(h.start<0||h.end<0)continue;const p=r-h.start;r>=h.start&&r<h.end?p<d&&(a=h,d=p):r>h.end&&(u=h)}return a||u}bindSeekBackwardOrForward(e,n,r=!1){const a=(S,b)=>n()?!1:(e(S,b),!0),u=this.keyBindSet.seekBackward.keys,d=this.keyBindSet.seekForward.keys,f=S=>a(S,!1),h=S=>a(S,!0);let p,m;return u&&(p=this._bind(u,r,f)),d&&(m=this._bind(d,r,h)),()=>{p==null||p(),m==null||m()}}bindOffsetToSubtitle(e,n,r,a,u=!1){const d=(R,C)=>{if(n())return!1;const j=a();if(!j||j.length===0)return!1;const U=r(),_=Eo(C,U,j);if(_!==null){const H=_.originalStart,E=U-H;return e(R,E),!0}return!1},f=this.keyBindSet.adjustOffsetToPreviousSubtitle.keys,h=this.keyBindSet.adjustOffsetToNextSubtitle.keys,p=R=>d(R,!1),m=R=>d(R,!0);let S,b;return f&&(S=this._bind(f,u,p)),h&&(b=this._bind(h,u,m)),()=>{S==null||S(),b==null||b()}}bindAdjustOffset(e,n,r,a=!1){const u=(b,R)=>{if(n())return!1;const C=r();if(!C||C.length===0)return!1;const U=C[0].start-C[0].originalStart+(R?100:-100);return e(b,U),!0},d=this.keyBindSet.decreaseOffset.keys,f=this.keyBindSet.increaseOffset.keys,h=b=>u(b,!1),p=b=>u(b,!0),m=d?this._bind(d,a,h):()=>{},S=f?this._bind(f,a,p):()=>{};return()=>{m(),S()}}bindResetOffet(e,n,r){const a=this.keyBindSet.resetOffset.keys;if(!a)return()=>{};const u=d=>n()?!1:(e(d),!0);return this._bind(a,r??!1,u)}bindAdjustPlaybackRate(e,n,r=!1){const a=(S,b)=>n()?!1:(e(S,b),!0),u=this.keyBindSet.increasePlaybackRate.keys,d=this.keyBindSet.decreasePlaybackRate.keys,f=S=>a(S,!1),h=S=>a(S,!0);let p,m;return d&&(p=this._bind(d,r,f)),u&&(m=this._bind(u,r,h)),()=>{p==null||p(),m==null||m()}}bindToggleSubtitles(e,n,r=!1){const a=this.keyBindSet.toggleSubtitles.keys;if(!a)return()=>{};const u=d=>n()?!1:(e(d),!0);return this._bind(a,r,u)}bindToggleSubtitleTrackInVideo(e,n,r=!1){const a=[this.keyBindSet.toggleVideoSubtitleTrack1.keys,this.keyBindSet.toggleVideoSubtitleTrack2.keys,this.keyBindSet.toggleVideoSubtitleTrack3.keys].filter(f=>f);if(a.length===0)return()=>{};const u=(f,h)=>n()?!1:(e(f,h),!0);let d=[];for(let f=0;f<a.length;++f){const h=m=>u(m,f),p=a[f]?this._bind(a[f],r,h):()=>{};d.push(p)}return()=>{for(let f=0;f<a.length;++f){const h=d[f];h()}}}bindToggleSubtitleTrackInList(e,n,r=!1){const a=[this.keyBindSet.toggleAsbplayerSubtitleTrack1.keys,this.keyBindSet.toggleAsbplayerSubtitleTrack2.keys,this.keyBindSet.toggleAsbplayerSubtitleTrack3.keys].filter(f=>f);if(a.length===0)return()=>{};const u=(f,h)=>n()?!1:(e(f,h),!0);let d=[];for(let f=0;f<9;++f){const h=m=>u(m,f),p=a[f]?this._bind(a[f],r,h):()=>{};d.push(p)}return()=>{for(let f=0;f<9;++f){const h=d[f];h()}}}bindUnblurTrack(e,n,r=!1){const a=[this.keyBindSet.unblurAsbplayerTrack1.keys,this.keyBindSet.unblurAsbplayerTrack2.keys,this.keyBindSet.unblurAsbplayerTrack3.keys].filter(f=>f);if(a.length===0)return()=>{};const u=(f,h)=>n()?!1:(e(f,h),!0);let d=[];for(let f=0;f<a.length;++f){const h=m=>u(m,f),p=a[f]?this._bind(a[f],r,h):()=>{};d.push(p)}return()=>{for(let f=0;f<a.length;++f){const h=d[f];h()}}}bindPlay(e,n,r=!1){const a=this.keyBindSet.togglePlay.keys;if(!a)return()=>{};const u=d=>n()?!1:(e(d),!0);return this._bind(a,r,u)}bindAutoPause(e,n,r=!1){const a=this.keyBindSet.toggleAutoPause.keys;if(!a)return()=>{};const u=d=>n()?!1:(e(d),!0);return this._bind(a,r,u)}bindCondensedPlayback(e,n,r=!1){const a=this.keyBindSet.toggleCondensedPlayback.keys;if(!a)return()=>{};const u=d=>n()?!1:(e(d),!0);return this._bind(a,r,u)}bindFastForwardPlayback(e,n,r=!1){const a=this.keyBindSet.toggleFastForwardPlayback.keys;if(!a)return()=>{};const u=d=>n()?!1:(e(d),!0);return this._bind(a,r,u)}bindToggleSidePanel(e,n,r=!1){const a=this.keyBindSet.toggleSidePanel.keys;if(!a)return()=>{};const u=d=>n()?!1:(e(d),!0);return this._bind(a,r,u)}bindToggleRepeat(e,n,r=!1){const a=this.keyBindSet.toggleRepeat.keys,u=d=>n()?!1:(e(d),!0);return this._bind(a,r,u)}_bind(e,n,r){let a;const u=d=>{d.type==="keydown"?a=r(d):d.type==="keyup"&&(a&&(d.preventDefault(),d.stopImmediatePropagation()),a=void 0)};return Rs(e,{capture:n,keydown:!0,keyup:!0},u),()=>Rs.unbind(e,u)}}const ud=(s,e)=>{const[n,r]=y.useState(()=>new Is(new ko(s),e));return y.useEffect(()=>{const a=new Is(new ko(s),e);r(u=>(u.unsubscribeExtension(),a))},[s,e]),n};class cd{constructor(){ce(this,"_callbacks",{"started-mining":[],"stopped-mining":[]});ce(this,"_mining",!1)}get mining(){return this._mining}onEvent(e,n){return this._callbacks[e].push(n),()=>this._remove(n,this._callbacks[e])}started(){this._mining=!0,this._callbacks["started-mining"].forEach(e=>e())}stopped(){this._mining=!1,this._callbacks["stopped-mining"].forEach(e=>e())}_remove(e,n){for(let r=n.length-1;r>=0;--r)if(e===n[r]){n.splice(r,1);break}}}var Or={exports:{}},dd=Or.exports,To;function fd(){return To||(To=1,function(s,e){(function(n,r){s.exports=r()})(dd,function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,l){o.__proto__=l}||function(o,l){for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(o[c]=l[c])})(t,i)},r=function(){return(r=Object.assign||function(t){for(var i,o=1,l=arguments.length;o<l;o++)for(var c in i=arguments[o])Object.prototype.hasOwnProperty.call(i,c)&&(t[c]=i[c]);return t}).apply(this,arguments)};function a(t,i,o){for(var l,c=0,g=i.length;c<g;c++)!l&&c in i||((l=l||Array.prototype.slice.call(i,0,c))[c]=i[c]);return t.concat(l||Array.prototype.slice.call(i))}var u=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:xa,d=Object.keys,f=Array.isArray;function h(t,i){return typeof i!="object"||d(i).forEach(function(o){t[o]=i[o]}),t}typeof Promise>"u"||u.Promise||(u.Promise=Promise);var p=Object.getPrototypeOf,m={}.hasOwnProperty;function S(t,i){return m.call(t,i)}function b(t,i){typeof i=="function"&&(i=i(p(t))),(typeof Reflect>"u"?d:Reflect.ownKeys)(i).forEach(function(o){C(t,o,i[o])})}var R=Object.defineProperty;function C(t,i,o,l){R(t,i,h(o&&S(o,"get")&&typeof o.get=="function"?{get:o.get,set:o.set,configurable:!0}:{value:o,configurable:!0,writable:!0},l))}function j(t){return{from:function(i){return t.prototype=Object.create(i.prototype),C(t.prototype,"constructor",t),{extend:b.bind(null,t.prototype)}}}}var U=Object.getOwnPropertyDescriptor,_=[].slice;function H(t,i,o){return _.call(t,i,o)}function E(t,i){return i(t)}function G(t){if(!t)throw new Error("Assertion Failed")}function D(t){u.setImmediate?setImmediate(t):setTimeout(t,0)}function L(t,i){if(typeof i=="string"&&S(t,i))return t[i];if(!i)return t;if(typeof i!="string"){for(var o=[],l=0,c=i.length;l<c;++l){var g=L(t,i[l]);o.push(g)}return o}var x=i.indexOf(".");if(x!==-1){var k=t[i.substr(0,x)];return k==null?void 0:L(k,i.substr(x+1))}}function z(t,i,o){if(t&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof i!="string"&&"length"in i){G(typeof o!="string"&&"length"in o);for(var l=0,c=i.length;l<c;++l)z(t,i[l],o[l])}else{var g,x,k=i.indexOf(".");k!==-1?(g=i.substr(0,k),(x=i.substr(k+1))===""?o===void 0?f(t)&&!isNaN(parseInt(g))?t.splice(g,1):delete t[g]:t[g]=o:z(k=!(k=t[g])||!S(t,g)?t[g]={}:k,x,o)):o===void 0?f(t)&&!isNaN(parseInt(i))?t.splice(i,1):delete t[i]:t[i]=o}}function ie(t){var i,o={};for(i in t)S(t,i)&&(o[i]=t[i]);return o}var ge=[].concat;function Y(t){return ge.apply([],t)}var bt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Y([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(i){return i+t+"Array"})}))).filter(function(t){return u[t]}),Z=new Set(bt.map(function(t){return u[t]})),ee=null;function w(t){return ee=new WeakMap,t=function i(o){if(!o||typeof o!="object")return o;var l=ee.get(o);if(l)return l;if(f(o)){l=[],ee.set(o,l);for(var c=0,g=o.length;c<g;++c)l.push(i(o[c]))}else if(Z.has(o.constructor))l=o;else{var x,k=p(o);for(x in l=k===Object.prototype?{}:Object.create(k),ee.set(o,l),o)S(o,x)&&(l[x]=i(o[x]))}return l}(t),ee=null,t}var P={}.toString;function re(t){return P.call(t).slice(8,-1)}var ae=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Te=typeof ae=="symbol"?function(t){var i;return t!=null&&(i=t[ae])&&i.apply(t)}:function(){return null};function te(t,i){return i=t.indexOf(i),0<=i&&t.splice(i,1),0<=i}var ye={};function xe(t){var i,o,l,c;if(arguments.length===1){if(f(t))return t.slice();if(this===ye&&typeof t=="string")return[t];if(c=Te(t)){for(o=[];!(l=c.next()).done;)o.push(l.value);return o}if(t==null)return[t];if(typeof(i=t.length)!="number")return[t];for(o=new Array(i);i--;)o[i]=t[i];return o}for(i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return o}var we=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Tt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],on=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Tt),se={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function pe(t,i){this.name=t,this.message=i}function _e(t,i){return t+". Errors: "+Object.keys(i).map(function(o){return i[o].toString()}).filter(function(o,l,c){return c.indexOf(o)===l}).join(`
`)}function Pe(t,i,o,l){this.failures=i,this.failedKeys=l,this.successCount=o,this.message=_e(t,i)}function je(t,i){this.name="BulkError",this.failures=Object.keys(i).map(function(o){return i[o]}),this.failuresByPos=i,this.message=_e(t,this.failures)}j(pe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),j(Pe).from(pe),j(je).from(pe);var Ae=on.reduce(function(t,i){return t[i]=i+"Error",t},{}),Re=pe,fe=on.reduce(function(t,i){var o=i+"Error";function l(c,g){this.name=o,c?typeof c=="string"?(this.message="".concat(c).concat(g?`
 `+g:""),this.inner=g||null):typeof c=="object"&&(this.message="".concat(c.name," ").concat(c.message),this.inner=c):(this.message=se[i]||o,this.inner=null)}return j(l).from(Re),t[i]=l,t},{});fe.Syntax=SyntaxError,fe.Type=TypeError,fe.Range=RangeError;var Fe=Tt.reduce(function(t,i){return t[i+"Error"]=fe[i],t},{}),Le=on.reduce(function(t,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(t[i+"Error"]=fe[i]),t},{});function Ie(){}function yt(t){return t}function mt(t,i){return t==null||t===yt?i:function(o){return i(t(o))}}function Me(t,i){return function(){t.apply(this,arguments),i.apply(this,arguments)}}function Ye(t,i){return t===Ie?i:function(){var o=t.apply(this,arguments);o!==void 0&&(arguments[0]=o);var l=this.onsuccess,c=this.onerror;this.onsuccess=null,this.onerror=null;var g=i.apply(this,arguments);return l&&(this.onsuccess=this.onsuccess?Me(l,this.onsuccess):l),c&&(this.onerror=this.onerror?Me(c,this.onerror):c),g!==void 0?g:o}}function vt(t,i){return t===Ie?i:function(){t.apply(this,arguments);var o=this.onsuccess,l=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),o&&(this.onsuccess=this.onsuccess?Me(o,this.onsuccess):o),l&&(this.onerror=this.onerror?Me(l,this.onerror):l)}}function Ce(t,i){return t===Ie?i:function(o){var l=t.apply(this,arguments);h(o,l);var c=this.onsuccess,g=this.onerror;return this.onsuccess=null,this.onerror=null,o=i.apply(this,arguments),c&&(this.onsuccess=this.onsuccess?Me(c,this.onsuccess):c),g&&(this.onerror=this.onerror?Me(g,this.onerror):g),l===void 0?o===void 0?void 0:o:h(l,o)}}function Ne(t,i){return t===Ie?i:function(){return i.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function He(t,i){return t===Ie?i:function(){var o=t.apply(this,arguments);if(o&&typeof o.then=="function"){for(var l=this,c=arguments.length,g=new Array(c);c--;)g[c]=arguments[c];return o.then(function(){return i.apply(l,g)})}return i.apply(this,arguments)}}Le.ModifyError=Pe,Le.DexieError=pe,Le.BulkError=je;var We=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function lt(t){We=t}var Pt={},Kt=100,bt=typeof Promise>"u"?[]:function(){var t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,p(t),t];var i=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[i,p(i),t]}(),Tt=bt[0],on=bt[1],bt=bt[2],on=on&&on.then,At=Tt&&Tt.constructor,Jt=!!bt,$=function(t,i){ne.push([t,i]),Nt&&(queueMicrotask(en),Nt=!1)},Qt=!0,Nt=!0,xt=[],Ot=[],zt=yt,Ct={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ie,pgp:!1,env:{},finalize:Ie},Se=Ct,ne=[],de=0,oe=[];function O(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=Se;if(typeof t!="function"){if(t!==Pt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&nt(this,this._value))}this._state=null,this._value=null,++i.ref,function o(l,c){try{c(function(g){if(l._state===null){if(g===l)throw new TypeError("A promise cannot be resolved with itself.");var x=l._lib&&ut();g&&typeof g.then=="function"?o(l,function(k,I){g instanceof O?g._then(k,I):g.then(k,I)}):(l._state=!0,l._value=g,qe(l)),x&&Xt()}},nt.bind(null,l))}catch(g){nt(l,g)}}(this,t)}var ot={get:function(){var t=Se,i=xn;function o(l,c){var g=this,x=!t.global&&(t!==Se||i!==xn),k=x&&!rn(),I=new O(function(N,F){ht(g,new Ge(Wt(l,t,x,k),Wt(c,t,x,k),N,F,t))});return this._consoleTask&&(I._consoleTask=this._consoleTask),I}return o.prototype=Pt,o},set:function(t){C(this,"then",t&&t.prototype===Pt?ot:{get:function(){return t},set:ot.set})}};function Ge(t,i,o,l,c){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof i=="function"?i:null,this.resolve=o,this.reject=l,this.psd=c}function nt(t,i){var o,l;Ot.push(i),t._state===null&&(o=t._lib&&ut(),i=zt(i),t._state=!1,t._value=i,l=t,xt.some(function(c){return c._value===l._value})||xt.push(l),qe(t),o&&Xt())}function qe(t){var i=t._listeners;t._listeners=[];for(var o=0,l=i.length;o<l;++o)ht(t,i[o]);var c=t._PSD;--c.ref||c.finalize(),de===0&&(++de,$(function(){--de==0&&tn()},[]))}function ht(t,i){if(t._state!==null){var o=t._state?i.onFulfilled:i.onRejected;if(o===null)return(t._state?i.resolve:i.reject)(t._value);++i.psd.ref,++de,$(Zt,[o,t,i])}else t._listeners.push(i)}function Zt(t,i,o){try{var l,c=i._value;!i._state&&Ot.length&&(Ot=[]),l=We&&i._consoleTask?i._consoleTask.run(function(){return t(c)}):t(c),i._state||Ot.indexOf(c)!==-1||function(g){for(var x=xt.length;x;)if(xt[--x]._value===g._value)return xt.splice(x,1)}(i),o.resolve(l)}catch(g){o.reject(g)}finally{--de==0&&tn(),--o.psd.ref||o.psd.finalize()}}function en(){ln(Ct,function(){ut()&&Xt()})}function ut(){var t=Qt;return Nt=Qt=!1,t}function Xt(){var t,i,o;do for(;0<ne.length;)for(t=ne,ne=[],o=t.length,i=0;i<o;++i){var l=t[i];l[0].apply(null,l[1])}while(0<ne.length);Nt=Qt=!0}function tn(){var t=xt;xt=[],t.forEach(function(l){l._PSD.onunhandled.call(null,l._value,l)});for(var i=oe.slice(0),o=i.length;o;)i[--o]()}function ct(t){return new O(Pt,!1,t)}function Ue(t,i){var o=Se;return function(){var l=ut(),c=Se;try{return sn(o,!0),t.apply(this,arguments)}catch(g){i&&i(g)}finally{sn(c,!1),l&&Xt()}}}b(O.prototype,{then:ot,_then:function(t,i){ht(this,new Ge(null,null,t,i,Se))},catch:function(t){if(arguments.length===1)return this.then(null,t);var i=t,o=arguments[1];return typeof i=="function"?this.then(null,function(l){return(l instanceof i?o:ct)(l)}):this.then(null,function(l){return(l&&l.name===i?o:ct)(l)})},finally:function(t){return this.then(function(i){return O.resolve(t()).then(function(){return i})},function(i){return O.resolve(t()).then(function(){return ct(i)})})},timeout:function(t,i){var o=this;return t<1/0?new O(function(l,c){var g=setTimeout(function(){return c(new fe.Timeout(i))},t);o.then(l,c).finally(clearTimeout.bind(null,g))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&C(O.prototype,Symbol.toStringTag,"Dexie.Promise"),Ct.env=Mn(),b(O,{all:function(){var t=xe.apply(null,arguments).map(pn);return new O(function(i,o){t.length===0&&i([]);var l=t.length;t.forEach(function(c,g){return O.resolve(c).then(function(x){t[g]=x,--l||i(t)},o)})})},resolve:function(t){return t instanceof O?t:t&&typeof t.then=="function"?new O(function(i,o){t.then(i,o)}):new O(Pt,!0,t)},reject:ct,race:function(){var t=xe.apply(null,arguments).map(pn);return new O(function(i,o){t.map(function(l){return O.resolve(l).then(i,o)})})},PSD:{get:function(){return Se},set:function(t){return Se=t}},totalEchoes:{get:function(){return xn}},newPSD:nn,usePSD:ln,scheduler:{get:function(){return $},set:function(t){$=t}},rejectionMapper:{get:function(){return zt},set:function(t){zt=t}},follow:function(t,i){return new O(function(o,l){return nn(function(c,g){var x=Se;x.unhandleds=[],x.onunhandled=g,x.finalize=Me(function(){var k,I=this;k=function(){I.unhandleds.length===0?c():g(I.unhandleds[0])},oe.push(function N(){k(),oe.splice(oe.indexOf(N),1)}),++de,$(function(){--de==0&&tn()},[])},x.finalize),t()},i,o,l)})}}),At&&(At.allSettled&&C(O,"allSettled",function(){var t=xe.apply(null,arguments).map(pn);return new O(function(i){t.length===0&&i([]);var o=t.length,l=new Array(o);t.forEach(function(c,g){return O.resolve(c).then(function(x){return l[g]={status:"fulfilled",value:x}},function(x){return l[g]={status:"rejected",reason:x}}).then(function(){return--o||i(l)})})})}),At.any&&typeof AggregateError<"u"&&C(O,"any",function(){var t=xe.apply(null,arguments).map(pn);return new O(function(i,o){t.length===0&&o(new AggregateError([]));var l=t.length,c=new Array(l);t.forEach(function(g,x){return O.resolve(g).then(function(k){return i(k)},function(k){c[x]=k,--l||o(new AggregateError(c))})})})}),At.withResolvers&&(O.withResolvers=At.withResolvers));var Qe={awaits:0,echoes:0,id:0},$t=0,yn=[],vn=0,xn=0,Vn=0;function nn(t,i,o,l){var c=Se,g=Object.create(c);return g.parent=c,g.ref=0,g.global=!1,g.id=++Vn,Ct.env,g.env=Jt?{Promise:O,PromiseProp:{value:O,configurable:!0,writable:!0},all:O.all,race:O.race,allSettled:O.allSettled,any:O.any,resolve:O.resolve,reject:O.reject}:{},i&&h(g,i),++c.ref,g.finalize=function(){--this.parent.ref||this.parent.finalize()},l=ln(g,t,o,l),g.ref===0&&g.finalize(),l}function un(){return Qe.id||(Qe.id=++$t),++Qe.awaits,Qe.echoes+=Kt,Qe.id}function rn(){return!!Qe.awaits&&(--Qe.awaits==0&&(Qe.id=0),Qe.echoes=Qe.awaits*Kt,!0)}function pn(t){return Qe.echoes&&t&&t.constructor===At?(un(),t.then(function(i){return rn(),i},function(i){return rn(),it(i)})):t}function qn(){var t=yn[yn.length-1];yn.pop(),sn(t,!1)}function sn(t,i){var o,l=Se;(i?!Qe.echoes||vn++&&t===Se:!vn||--vn&&t===Se)||queueMicrotask(i?(function(c){++xn,Qe.echoes&&--Qe.echoes!=0||(Qe.echoes=Qe.awaits=Qe.id=0),yn.push(Se),sn(c,!0)}).bind(null,t):qn),t!==Se&&(Se=t,l===Ct&&(Ct.env=Mn()),Jt&&(o=Ct.env.Promise,i=t.env,(l.global||t.global)&&(Object.defineProperty(u,"Promise",i.PromiseProp),o.all=i.all,o.race=i.race,o.resolve=i.resolve,o.reject=i.reject,i.allSettled&&(o.allSettled=i.allSettled),i.any&&(o.any=i.any))))}function Mn(){var t=u.Promise;return Jt?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(u,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function ln(t,i,o,l,c){var g=Se;try{return sn(t,!0),i(o,l,c)}finally{sn(g,!1)}}function Wt(t,i,o,l){return typeof t!="function"?t:function(){var c=Se;o&&un(),sn(i,!0);try{return t.apply(this,arguments)}finally{sn(c,!1),l&&queueMicrotask(rn)}}}function Cn(t){Promise===At&&Qe.echoes===0?vn===0?t():enqueueNativeMicroTask(t):setTimeout(t,0)}(""+on).indexOf("[native code]")===-1&&(un=rn=Ie);var it=O.reject,Ht="￿",Dt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Xe="String expected.",Ze=[],Q="__dbnames",Ee="readonly",Oe="readwrite";function at(t,i){return t?i?function(){return t.apply(this,arguments)&&i.apply(this,arguments)}:t:i}var et={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Mt(t){return typeof t!="string"||/\./.test(t)?function(i){return i}:function(i){return i[t]===void 0&&t in i&&delete(i=w(i))[t],i}}function wt(){throw fe.Type()}function De(t,i){try{var o=ar(t),l=ar(i);if(o!==l)return o==="Array"?1:l==="Array"?-1:o==="binary"?1:l==="binary"?-1:o==="string"?1:l==="string"?-1:o==="Date"?1:l!=="Date"?NaN:-1;switch(o){case"number":case"Date":case"string":return i<t?1:t<i?-1:0;case"binary":return function(c,g){for(var x=c.length,k=g.length,I=x<k?x:k,N=0;N<I;++N)if(c[N]!==g[N])return c[N]<g[N]?-1:1;return x===k?0:x<k?-1:1}(Kn(t),Kn(i));case"Array":return function(c,g){for(var x=c.length,k=g.length,I=x<k?x:k,N=0;N<I;++N){var F=De(c[N],g[N]);if(F!==0)return F}return x===k?0:x<k?-1:1}(t,i)}}catch{}return NaN}function ar(t){var i=typeof t;return i!="object"?i:ArrayBuffer.isView(t)?"binary":(t=re(t),t==="ArrayBuffer"?"binary":t)}function Kn(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var es=(st.prototype._trans=function(t,i,o){var l=this._tx||Se.trans,c=this.name,g=We&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(t==="readonly"?"read":"write"," ").concat(this.name));function x(N,F,T){if(!T.schema[c])throw new fe.NotFound("Table "+c+" not part of transaction");return i(T.idbtrans,T)}var k=ut();try{var I=l&&l.db._novip===this.db._novip?l===Se.trans?l._promise(t,x,o):nn(function(){return l._promise(t,x,o)},{trans:l,transless:Se.transless||Se}):function N(F,T,q,A){if(F.idbdb&&(F._state.openComplete||Se.letThrough||F._vip)){var B=F._createTransaction(T,q,F._dbSchema);try{B.create(),F._state.PR1398_maxLoop=3}catch(V){return V.name===Ae.InvalidState&&F.isOpen()&&0<--F._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),F.close({disableAutoOpen:!1}),F.open().then(function(){return N(F,T,q,A)})):it(V)}return B._promise(T,function(V,M){return nn(function(){return Se.trans=B,A(V,M,B)})}).then(function(V){if(T==="readwrite")try{B.idbtrans.commit()}catch{}return T==="readonly"?V:B._completion.then(function(){return V})})}if(F._state.openComplete)return it(new fe.DatabaseClosed(F._state.dbOpenError));if(!F._state.isBeingOpened){if(!F._state.autoOpen)return it(new fe.DatabaseClosed);F.open().catch(Ie)}return F._state.dbReadyPromise.then(function(){return N(F,T,q,A)})}(this.db,t,[this.name],x);return g&&(I._consoleTask=g,I=I.catch(function(N){return console.trace(N),it(N)})),I}finally{k&&Xt()}},st.prototype.get=function(t,i){var o=this;return t&&t.constructor===Object?this.where(t).first(i):t==null?it(new fe.Type("Invalid argument to Table.get()")):this._trans("readonly",function(l){return o.core.get({trans:l,key:t}).then(function(c){return o.hook.reading.fire(c)})}).then(i)},st.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(f(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var i=d(t);if(i.length===1)return this.where(i[0]).equals(t[i[0]]);var o=this.schema.indexes.concat(this.schema.primKey).filter(function(k){if(k.compound&&i.every(function(N){return 0<=k.keyPath.indexOf(N)})){for(var I=0;I<i.length;++I)if(i.indexOf(k.keyPath[I])===-1)return!1;return!0}return!1}).sort(function(k,I){return k.keyPath.length-I.keyPath.length})[0];if(o&&this.db._maxKey!==Ht){var g=o.keyPath.slice(0,i.length);return this.where(g).equals(g.map(function(I){return t[I]}))}!o&&We&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var l=this.schema.idxByName;function c(k,I){return De(k,I)===0}var x=i.reduce(function(T,I){var N=T[0],F=T[1],T=l[I],q=t[I];return[N||T,N||!T?at(F,T&&T.multi?function(A){return A=L(A,I),f(A)&&A.some(function(B){return c(q,B)})}:function(A){return c(q,L(A,I))}):F]},[null,null]),g=x[0],x=x[1];return g?this.where(g.name).equals(t[g.keyPath]).filter(x):o?this.filter(x):this.where(i).equals("")},st.prototype.filter=function(t){return this.toCollection().and(t)},st.prototype.count=function(t){return this.toCollection().count(t)},st.prototype.offset=function(t){return this.toCollection().offset(t)},st.prototype.limit=function(t){return this.toCollection().limit(t)},st.prototype.each=function(t){return this.toCollection().each(t)},st.prototype.toArray=function(t){return this.toCollection().toArray(t)},st.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},st.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,f(t)?"[".concat(t.join("+"),"]"):t))},st.prototype.reverse=function(){return this.toCollection().reverse()},st.prototype.mapToClass=function(t){var i,o=this.db,l=this.name;function c(){return i!==null&&i.apply(this,arguments)||this}(this.schema.mappedClass=t).prototype instanceof wt&&(function(I,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");function F(){this.constructor=I}n(I,N),I.prototype=N===null?Object.create(N):(F.prototype=N.prototype,new F)}(c,i=t),Object.defineProperty(c.prototype,"db",{get:function(){return o},enumerable:!1,configurable:!0}),c.prototype.table=function(){return l},t=c);for(var g=new Set,x=t.prototype;x;x=p(x))Object.getOwnPropertyNames(x).forEach(function(I){return g.add(I)});function k(I){if(!I)return I;var N,F=Object.create(t.prototype);for(N in I)if(!g.has(N))try{F[N]=I[N]}catch{}return F}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=k,this.hook("reading",k),t},st.prototype.defineClass=function(){return this.mapToClass(function(t){h(this,t)})},st.prototype.add=function(t,i){var o=this,l=this.schema.primKey,c=l.auto,g=l.keyPath,x=t;return g&&c&&(x=Mt(g)(t)),this._trans("readwrite",function(k){return o.core.mutate({trans:k,type:"add",keys:i!=null?[i]:null,values:[x]})}).then(function(k){return k.numFailures?O.reject(k.failures[0]):k.lastResult}).then(function(k){if(g)try{z(t,g,k)}catch{}return k})},st.prototype.update=function(t,i){return typeof t!="object"||f(t)?this.where(":id").equals(t).modify(i):(t=L(t,this.schema.primKey.keyPath),t===void 0?it(new fe.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(i))},st.prototype.put=function(t,i){var o=this,l=this.schema.primKey,c=l.auto,g=l.keyPath,x=t;return g&&c&&(x=Mt(g)(t)),this._trans("readwrite",function(k){return o.core.mutate({trans:k,type:"put",values:[x],keys:i!=null?[i]:null})}).then(function(k){return k.numFailures?O.reject(k.failures[0]):k.lastResult}).then(function(k){if(g)try{z(t,g,k)}catch{}return k})},st.prototype.delete=function(t){var i=this;return this._trans("readwrite",function(o){return i.core.mutate({trans:o,type:"delete",keys:[t]})}).then(function(o){return o.numFailures?O.reject(o.failures[0]):void 0})},st.prototype.clear=function(){var t=this;return this._trans("readwrite",function(i){return t.core.mutate({trans:i,type:"deleteRange",range:et})}).then(function(i){return i.numFailures?O.reject(i.failures[0]):void 0})},st.prototype.bulkGet=function(t){var i=this;return this._trans("readonly",function(o){return i.core.getMany({keys:t,trans:o}).then(function(l){return l.map(function(c){return i.hook.reading.fire(c)})})})},st.prototype.bulkAdd=function(t,i,o){var l=this,c=Array.isArray(i)?i:void 0,g=(o=o||(c?void 0:i))?o.allKeys:void 0;return this._trans("readwrite",function(x){var N=l.schema.primKey,k=N.auto,N=N.keyPath;if(N&&c)throw new fe.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(c&&c.length!==t.length)throw new fe.InvalidArgument("Arguments objects and keys must have the same length");var I=t.length,N=N&&k?t.map(Mt(N)):t;return l.core.mutate({trans:x,type:"add",keys:c,values:N,wantResults:g}).then(function(B){var T=B.numFailures,q=B.results,A=B.lastResult,B=B.failures;if(T===0)return g?q:A;throw new je("".concat(l.name,".bulkAdd(): ").concat(T," of ").concat(I," operations failed"),B)})})},st.prototype.bulkPut=function(t,i,o){var l=this,c=Array.isArray(i)?i:void 0,g=(o=o||(c?void 0:i))?o.allKeys:void 0;return this._trans("readwrite",function(x){var N=l.schema.primKey,k=N.auto,N=N.keyPath;if(N&&c)throw new fe.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(c&&c.length!==t.length)throw new fe.InvalidArgument("Arguments objects and keys must have the same length");var I=t.length,N=N&&k?t.map(Mt(N)):t;return l.core.mutate({trans:x,type:"put",keys:c,values:N,wantResults:g}).then(function(B){var T=B.numFailures,q=B.results,A=B.lastResult,B=B.failures;if(T===0)return g?q:A;throw new je("".concat(l.name,".bulkPut(): ").concat(T," of ").concat(I," operations failed"),B)})})},st.prototype.bulkUpdate=function(t){var i=this,o=this.core,l=t.map(function(x){return x.key}),c=t.map(function(x){return x.changes}),g=[];return this._trans("readwrite",function(x){return o.getMany({trans:x,keys:l,cache:"clone"}).then(function(k){var I=[],N=[];t.forEach(function(T,q){var A=T.key,B=T.changes,V=k[q];if(V){for(var M=0,K=Object.keys(B);M<K.length;M++){var X=K[M],W=B[X];if(X===i.schema.primKey.keyPath){if(De(W,A)!==0)throw new fe.Constraint("Cannot update primary key in bulkUpdate()")}else z(V,X,W)}g.push(q),I.push(A),N.push(V)}});var F=I.length;return o.mutate({trans:x,type:"put",keys:I,values:N,updates:{keys:l,changeSpecs:c}}).then(function(T){var q=T.numFailures,A=T.failures;if(q===0)return F;for(var B=0,V=Object.keys(A);B<V.length;B++){var M,K=V[B],X=g[Number(K)];X!=null&&(M=A[K],delete A[K],A[X]=M)}throw new je("".concat(i.name,".bulkUpdate(): ").concat(q," of ").concat(F," operations failed"),A)})})})},st.prototype.bulkDelete=function(t){var i=this,o=t.length;return this._trans("readwrite",function(l){return i.core.mutate({trans:l,type:"delete",keys:t})}).then(function(x){var c=x.numFailures,g=x.lastResult,x=x.failures;if(c===0)return g;throw new je("".concat(i.name,".bulkDelete(): ").concat(c," of ").concat(o," operations failed"),x)})},st);function st(){}function zn(t){function i(x,k){if(k){for(var I=arguments.length,N=new Array(I-1);--I;)N[I-1]=arguments[I];return o[x].subscribe.apply(null,N),t}if(typeof x=="string")return o[x]}var o={};i.addEventType=g;for(var l=1,c=arguments.length;l<c;++l)g(arguments[l]);return i;function g(x,k,I){if(typeof x!="object"){var N;k=k||Ne;var F={subscribers:[],fire:I=I||Ie,subscribe:function(T){F.subscribers.indexOf(T)===-1&&(F.subscribers.push(T),F.fire=k(F.fire,T))},unsubscribe:function(T){F.subscribers=F.subscribers.filter(function(q){return q!==T}),F.fire=F.subscribers.reduce(k,I)}};return o[x]=i[x]=F}d(N=x).forEach(function(T){var q=N[T];if(f(q))g(T,N[T][0],N[T][1]);else{if(q!=="asap")throw new fe.InvalidArgument("Invalid event config");var A=g(T,yt,function(){for(var B=arguments.length,V=new Array(B);B--;)V[B]=arguments[B];A.subscribers.forEach(function(M){D(function(){M.apply(null,V)})})})}})}}function Un(t,i){return j(i).from({prototype:t}),i}function jn(t,i){return!(t.filter||t.algorithm||t.or)&&(i?t.justLimit:!t.replayFilter)}function Dr(t,i){t.filter=at(t.filter,i)}function Vr(t,i,o){var l=t.replayFilter;t.replayFilter=l?function(){return at(l(),i())}:i,t.justLimit=o&&!l}function lr(t,i){if(t.isPrimKey)return i.primaryKey;var o=i.getIndexByKeyPath(t.index);if(!o)throw new fe.Schema("KeyPath "+t.index+" on object store "+i.name+" is not indexed");return o}function ts(t,i,o){var l=lr(t,i.schema);return i.openCursor({trans:o,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:l,range:t.range}})}function ur(t,i,o,l){var c=t.replayFilter?at(t.filter,t.replayFilter()):t.filter;if(t.or){var g={},x=function(k,I,N){var F,T;c&&!c(I,N,function(q){return I.stop(q)},function(q){return I.fail(q)})||((T=""+(F=I.primaryKey))=="[object ArrayBuffer]"&&(T=""+new Uint8Array(F)),S(g,T)||(g[T]=!0,i(k,I,N)))};return Promise.all([t.or._iterate(x,o),ns(ts(t,l,o),t.algorithm,x,!t.keysOnly&&t.valueMapper)])}return ns(ts(t,l,o),at(t.algorithm,c),i,!t.keysOnly&&t.valueMapper)}function ns(t,i,o,l){var c=Ue(l?function(g,x,k){return o(l(g),x,k)}:o);return t.then(function(g){if(g)return g.start(function(){var x=function(){return g.continue()};i&&!i(g,function(k){return x=k},function(k){g.stop(k),x=Ie},function(k){g.fail(k),x=Ie})||c(g.value,g,function(k){return x=k}),x()})})}var Xn=(rs.prototype.execute=function(t){var i=this["@@propmod"];if(i.add!==void 0){var o=i.add;if(f(o))return a(a([],f(t)?t:[],!0),o).sort();if(typeof o=="number")return(Number(t)||0)+o;if(typeof o=="bigint")try{return BigInt(t)+o}catch{return BigInt(0)+o}throw new TypeError("Invalid term ".concat(o))}if(i.remove!==void 0){var l=i.remove;if(f(l))return f(t)?t.filter(function(c){return!l.includes(c)}).sort():[];if(typeof l=="number")return Number(t)-l;if(typeof l=="bigint")try{return BigInt(t)-l}catch{return BigInt(0)-l}throw new TypeError("Invalid subtrahend ".concat(l))}return o=(o=i.replacePrefix)===null||o===void 0?void 0:o[0],o&&typeof t=="string"&&t.startsWith(o)?i.replacePrefix[1]+t.substring(o.length):t},rs);function rs(t){this["@@propmod"]=t}var Qo=(Je.prototype._read=function(t,i){var o=this._ctx;return o.error?o.table._trans(null,it.bind(null,o.error)):o.table._trans("readonly",t).then(i)},Je.prototype._write=function(t){var i=this._ctx;return i.error?i.table._trans(null,it.bind(null,i.error)):i.table._trans("readwrite",t,"locked")},Je.prototype._addAlgorithm=function(t){var i=this._ctx;i.algorithm=at(i.algorithm,t)},Je.prototype._iterate=function(t,i){return ur(this._ctx,t,i,this._ctx.table.core)},Je.prototype.clone=function(t){var i=Object.create(this.constructor.prototype),o=Object.create(this._ctx);return t&&h(o,t),i._ctx=o,i},Je.prototype.raw=function(){return this._ctx.valueMapper=null,this},Je.prototype.each=function(t){var i=this._ctx;return this._read(function(o){return ur(i,t,o,i.table.core)})},Je.prototype.count=function(t){var i=this;return this._read(function(o){var l=i._ctx,c=l.table.core;if(jn(l,!0))return c.count({trans:o,query:{index:lr(l,c.schema),range:l.range}}).then(function(x){return Math.min(x,l.limit)});var g=0;return ur(l,function(){return++g,!1},o,c).then(function(){return g})}).then(t)},Je.prototype.sortBy=function(t,i){var o=t.split(".").reverse(),l=o[0],c=o.length-1;function g(I,N){return N?g(I[o[N]],N-1):I[l]}var x=this._ctx.dir==="next"?1:-1;function k(I,N){return De(g(I,c),g(N,c))*x}return this.toArray(function(I){return I.sort(k)}).then(i)},Je.prototype.toArray=function(t){var i=this;return this._read(function(o){var l=i._ctx;if(l.dir==="next"&&jn(l,!0)&&0<l.limit){var c=l.valueMapper,g=lr(l,l.table.core.schema);return l.table.core.query({trans:o,limit:l.limit,values:!0,query:{index:g,range:l.range}}).then(function(k){return k=k.result,c?k.map(c):k})}var x=[];return ur(l,function(k){return x.push(k)},o,l.table.core).then(function(){return x})},t)},Je.prototype.offset=function(t){var i=this._ctx;return t<=0||(i.offset+=t,jn(i)?Vr(i,function(){var o=t;return function(l,c){return o===0||(o===1?--o:c(function(){l.advance(o),o=0}),!1)}}):Vr(i,function(){var o=t;return function(){return--o<0}})),this},Je.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Vr(this._ctx,function(){var i=t;return function(o,l,c){return--i<=0&&l(c),0<=i}},!0),this},Je.prototype.until=function(t,i){return Dr(this._ctx,function(o,l,c){return!t(o.value)||(l(c),i)}),this},Je.prototype.first=function(t){return this.limit(1).toArray(function(i){return i[0]}).then(t)},Je.prototype.last=function(t){return this.reverse().first(t)},Je.prototype.filter=function(t){var i;return Dr(this._ctx,function(o){return t(o.value)}),(i=this._ctx).isMatch=at(i.isMatch,t),this},Je.prototype.and=function(t){return this.filter(t)},Je.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},Je.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Je.prototype.desc=function(){return this.reverse()},Je.prototype.eachKey=function(t){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(o,l){t(l.key,l)})},Je.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},Je.prototype.eachPrimaryKey=function(t){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(o,l){t(l.primaryKey,l)})},Je.prototype.keys=function(t){var i=this._ctx;i.keysOnly=!i.isMatch;var o=[];return this.each(function(l,c){o.push(c.key)}).then(function(){return o}).then(t)},Je.prototype.primaryKeys=function(t){var i=this._ctx;if(i.dir==="next"&&jn(i,!0)&&0<i.limit)return this._read(function(l){var c=lr(i,i.table.core.schema);return i.table.core.query({trans:l,values:!1,limit:i.limit,query:{index:c,range:i.range}})}).then(function(l){return l.result}).then(t);i.keysOnly=!i.isMatch;var o=[];return this.each(function(l,c){o.push(c.primaryKey)}).then(function(){return o}).then(t)},Je.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},Je.prototype.firstKey=function(t){return this.limit(1).keys(function(i){return i[0]}).then(t)},Je.prototype.lastKey=function(t){return this.reverse().firstKey(t)},Je.prototype.distinct=function(){var t=this._ctx,t=t.index&&t.table.schema.idxByName[t.index];if(!t||!t.multi)return this;var i={};return Dr(this._ctx,function(c){var l=c.primaryKey.toString(),c=S(i,l);return i[l]=!0,!c}),this},Je.prototype.modify=function(t){var i=this,o=this._ctx;return this._write(function(l){var c,g,x;x=typeof t=="function"?t:(c=d(t),g=c.length,function(M){for(var K=!1,X=0;X<g;++X){var W=c[X],J=t[W],le=L(M,W);J instanceof Xn?(z(M,W,J.execute(le)),K=!0):le!==J&&(z(M,W,J),K=!0)}return K});var k=o.table.core,T=k.schema.primaryKey,I=T.outbound,N=T.extractKey,F=200,T=i.db._options.modifyChunkSize;T&&(F=typeof T=="object"?T[k.name]||T["*"]||200:T);function q(M,W){var X=W.failures,W=W.numFailures;B+=M-W;for(var J=0,le=d(X);J<le.length;J++){var be=le[J];A.push(X[be])}}var A=[],B=0,V=[];return i.clone().primaryKeys().then(function(M){function K(W){var J=Math.min(F,M.length-W);return k.getMany({trans:l,keys:M.slice(W,W+J),cache:"immutable"}).then(function(le){for(var be=[],ue=[],he=I?[]:null,ve=[],me=0;me<J;++me){var ke=le[me],$e={value:w(ke),primKey:M[W+me]};x.call($e,$e.value,$e)!==!1&&($e.value==null?ve.push(M[W+me]):I||De(N(ke),N($e.value))===0?(ue.push($e.value),I&&he.push(M[W+me])):(ve.push(M[W+me]),be.push($e.value)))}return Promise.resolve(0<be.length&&k.mutate({trans:l,type:"add",values:be}).then(function(Ke){for(var ze in Ke.failures)ve.splice(parseInt(ze),1);q(be.length,Ke)})).then(function(){return(0<ue.length||X&&typeof t=="object")&&k.mutate({trans:l,type:"put",keys:he,values:ue,criteria:X,changeSpec:typeof t!="function"&&t,isAdditionalChunk:0<W}).then(function(Ke){return q(ue.length,Ke)})}).then(function(){return(0<ve.length||X&&t===qr)&&k.mutate({trans:l,type:"delete",keys:ve,criteria:X,isAdditionalChunk:0<W}).then(function(Ke){return q(ve.length,Ke)})}).then(function(){return M.length>W+J&&K(W+F)})})}var X=jn(o)&&o.limit===1/0&&(typeof t!="function"||t===qr)&&{index:o.index,range:o.range};return K(0).then(function(){if(0<A.length)throw new Pe("Error modifying one or more objects",A,B,V);return M.length})})})},Je.prototype.delete=function(){var t=this._ctx,i=t.range;return jn(t)&&(t.isPrimKey||i.type===3)?this._write(function(o){var l=t.table.core.schema.primaryKey,c=i;return t.table.core.count({trans:o,query:{index:l,range:c}}).then(function(g){return t.table.core.mutate({trans:o,type:"deleteRange",range:c}).then(function(x){var k=x.failures;if(x.lastResult,x.results,x=x.numFailures,x)throw new Pe("Could not delete some values",Object.keys(k).map(function(I){return k[I]}),g-x);return g-x})})}):this.modify(qr)},Je);function Je(){}var qr=function(t,i){return i.value=null};function Zo(t,i){return t<i?-1:t===i?0:1}function ea(t,i){return i<t?-1:t===i?0:1}function Gt(t,i,o){return t=t instanceof ss?new t.Collection(t):t,t._ctx.error=new(o||TypeError)(i),t}function Ln(t){return new t.Collection(t,function(){return is("")}).limit(0)}function cr(t,i,o,l){var c,g,x,k,I,N,F,T=o.length;if(!o.every(function(B){return typeof B=="string"}))return Gt(t,Xe);function q(B){c=B==="next"?function(M){return M.toUpperCase()}:function(M){return M.toLowerCase()},g=B==="next"?function(M){return M.toLowerCase()}:function(M){return M.toUpperCase()},x=B==="next"?Zo:ea;var V=o.map(function(M){return{lower:g(M),upper:c(M)}}).sort(function(M,K){return x(M.lower,K.lower)});k=V.map(function(M){return M.upper}),I=V.map(function(M){return M.lower}),F=(N=B)==="next"?"":l}q("next"),t=new t.Collection(t,function(){return wn(k[0],I[T-1]+l)}),t._ondirectionchange=function(B){q(B)};var A=0;return t._addAlgorithm(function(B,V,M){var K=B.key;if(typeof K!="string")return!1;var X=g(K);if(i(X,I,A))return!0;for(var W=null,J=A;J<T;++J){var le=function(be,ue,he,ve,me,ke){for(var $e=Math.min(be.length,ve.length),Ke=-1,ze=0;ze<$e;++ze){var Yt=ue[ze];if(Yt!==ve[ze])return me(be[ze],he[ze])<0?be.substr(0,ze)+he[ze]+he.substr(ze+1):me(be[ze],ve[ze])<0?be.substr(0,ze)+ve[ze]+he.substr(ze+1):0<=Ke?be.substr(0,Ke)+ue[Ke]+he.substr(Ke+1):null;me(be[ze],Yt)<0&&(Ke=ze)}return $e<ve.length&&ke==="next"?be+he.substr(be.length):$e<be.length&&ke==="prev"?be.substr(0,he.length):Ke<0?null:be.substr(0,Ke)+ve[Ke]+he.substr(Ke+1)}(K,X,k[J],I[J],x,N);le===null&&W===null?A=J+1:(W===null||0<x(W,le))&&(W=le)}return V(W!==null?function(){B.continue(W+F)}:M),!1}),t}function wn(t,i,o,l){return{type:2,lower:t,upper:i,lowerOpen:o,upperOpen:l}}function is(t){return{type:1,lower:t,upper:t}}var ss=(Object.defineProperty(St.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),St.prototype.between=function(t,i,o,l){o=o!==!1,l=l===!0;try{return 0<this._cmp(t,i)||this._cmp(t,i)===0&&(o||l)&&(!o||!l)?Ln(this):new this.Collection(this,function(){return wn(t,i,!o,!l)})}catch{return Gt(this,Dt)}},St.prototype.equals=function(t){return t==null?Gt(this,Dt):new this.Collection(this,function(){return is(t)})},St.prototype.above=function(t){return t==null?Gt(this,Dt):new this.Collection(this,function(){return wn(t,void 0,!0)})},St.prototype.aboveOrEqual=function(t){return t==null?Gt(this,Dt):new this.Collection(this,function(){return wn(t,void 0,!1)})},St.prototype.below=function(t){return t==null?Gt(this,Dt):new this.Collection(this,function(){return wn(void 0,t,!1,!0)})},St.prototype.belowOrEqual=function(t){return t==null?Gt(this,Dt):new this.Collection(this,function(){return wn(void 0,t)})},St.prototype.startsWith=function(t){return typeof t!="string"?Gt(this,Xe):this.between(t,t+Ht,!0,!0)},St.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):cr(this,function(i,o){return i.indexOf(o[0])===0},[t],Ht)},St.prototype.equalsIgnoreCase=function(t){return cr(this,function(i,o){return i===o[0]},[t],"")},St.prototype.anyOfIgnoreCase=function(){var t=xe.apply(ye,arguments);return t.length===0?Ln(this):cr(this,function(i,o){return o.indexOf(i)!==-1},t,"")},St.prototype.startsWithAnyOfIgnoreCase=function(){var t=xe.apply(ye,arguments);return t.length===0?Ln(this):cr(this,function(i,o){return o.some(function(l){return i.indexOf(l)===0})},t,Ht)},St.prototype.anyOf=function(){var t=this,i=xe.apply(ye,arguments),o=this._cmp;try{i.sort(o)}catch{return Gt(this,Dt)}if(i.length===0)return Ln(this);var l=new this.Collection(this,function(){return wn(i[0],i[i.length-1])});l._ondirectionchange=function(g){o=g==="next"?t._ascending:t._descending,i.sort(o)};var c=0;return l._addAlgorithm(function(g,x,k){for(var I=g.key;0<o(I,i[c]);)if(++c===i.length)return x(k),!1;return o(I,i[c])===0||(x(function(){g.continue(i[c])}),!1)}),l},St.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},St.prototype.noneOf=function(){var t=xe.apply(ye,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return Gt(this,Dt)}var i=t.reduce(function(o,l){return o?o.concat([[o[o.length-1][1],l]]):[[-1/0,l]]},null);return i.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},St.prototype.inAnyRange=function(K,i){var o=this,l=this._cmp,c=this._ascending,g=this._descending,x=this._min,k=this._max;if(K.length===0)return Ln(this);if(!K.every(function(X){return X[0]!==void 0&&X[1]!==void 0&&c(X[0],X[1])<=0}))return Gt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",fe.InvalidArgument);var I=!i||i.includeLowers!==!1,N=i&&i.includeUppers===!0,F,T=c;function q(X,W){return T(X[0],W[0])}try{(F=K.reduce(function(X,W){for(var J=0,le=X.length;J<le;++J){var be=X[J];if(l(W[0],be[1])<0&&0<l(W[1],be[0])){be[0]=x(be[0],W[0]),be[1]=k(be[1],W[1]);break}}return J===le&&X.push(W),X},[])).sort(q)}catch{return Gt(this,Dt)}var A=0,B=N?function(X){return 0<c(X,F[A][1])}:function(X){return 0<=c(X,F[A][1])},V=I?function(X){return 0<g(X,F[A][0])}:function(X){return 0<=g(X,F[A][0])},M=B,K=new this.Collection(this,function(){return wn(F[0][0],F[F.length-1][1],!I,!N)});return K._ondirectionchange=function(X){T=X==="next"?(M=B,c):(M=V,g),F.sort(q)},K._addAlgorithm(function(X,W,J){for(var le,be=X.key;M(be);)if(++A===F.length)return W(J),!1;return!B(le=be)&&!V(le)||(o._cmp(be,F[A][1])===0||o._cmp(be,F[A][0])===0||W(function(){T===c?X.continue(F[A][0]):X.continue(F[A][1])}),!1)}),K},St.prototype.startsWithAnyOf=function(){var t=xe.apply(ye,arguments);return t.every(function(i){return typeof i=="string"})?t.length===0?Ln(this):this.inAnyRange(t.map(function(i){return[i,i+Ht]})):Gt(this,"startsWithAnyOf() only works with strings")},St);function St(){}function cn(t){return Ue(function(i){return Wn(i),t(i.target.error),!1})}function Wn(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Gn="storagemutated",Kr="x-storagemutated-1",Sn=zn(null,Gn),ta=(dn.prototype._lock=function(){return G(!Se.global),++this._reculock,this._reculock!==1||Se.global||(Se.lockOwnerFor=this),this},dn.prototype._unlock=function(){if(G(!Se.global),--this._reculock==0)for(Se.global||(Se.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var t=this._blockedFuncs.shift();try{ln(t[1],t[0])}catch{}}return this},dn.prototype._locked=function(){return this._reculock&&Se.lockOwnerFor!==this},dn.prototype.create=function(t){var i=this;if(!this.mode)return this;var o=this.db.idbdb,l=this.db._state.dbOpenError;if(G(!this.idbtrans),!t&&!o)switch(l&&l.name){case"DatabaseClosedError":throw new fe.DatabaseClosed(l);case"MissingAPIError":throw new fe.MissingAPI(l.message,l);default:throw new fe.OpenFailed(l)}if(!this.active)throw new fe.TransactionInactive;return G(this._completion._state===null),(t=this.idbtrans=t||(this.db.core||o).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ue(function(c){Wn(c),i._reject(t.error)}),t.onabort=Ue(function(c){Wn(c),i.active&&i._reject(new fe.Abort(t.error)),i.active=!1,i.on("abort").fire(c)}),t.oncomplete=Ue(function(){i.active=!1,i._resolve(),"mutatedParts"in t&&Sn.storagemutated.fire(t.mutatedParts)}),this},dn.prototype._promise=function(t,i,o){var l=this;if(t==="readwrite"&&this.mode!=="readwrite")return it(new fe.ReadOnly("Transaction is readonly"));if(!this.active)return it(new fe.TransactionInactive);if(this._locked())return new O(function(g,x){l._blockedFuncs.push([function(){l._promise(t,i,o).then(g,x)},Se])});if(o)return nn(function(){var g=new O(function(x,k){l._lock();var I=i(x,k,l);I&&I.then&&I.then(x,k)});return g.finally(function(){return l._unlock()}),g._lib=!0,g});var c=new O(function(g,x){var k=i(g,x,l);k&&k.then&&k.then(g,x)});return c._lib=!0,c},dn.prototype._root=function(){return this.parent?this.parent._root():this},dn.prototype.waitFor=function(t){var i,o=this._root(),l=O.resolve(t);o._waitingFor?o._waitingFor=o._waitingFor.then(function(){return l}):(o._waitingFor=l,o._waitingQueue=[],i=o.idbtrans.objectStore(o.storeNames[0]),function g(){for(++o._spinCount;o._waitingQueue.length;)o._waitingQueue.shift()();o._waitingFor&&(i.get(-1/0).onsuccess=g)}());var c=o._waitingFor;return new O(function(g,x){l.then(function(k){return o._waitingQueue.push(Ue(g.bind(null,k)))},function(k){return o._waitingQueue.push(Ue(x.bind(null,k)))}).finally(function(){o._waitingFor===c&&(o._waitingFor=null)})})},dn.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new fe.Abort))},dn.prototype.table=function(t){var i=this._memoizedTables||(this._memoizedTables={});if(S(i,t))return i[t];var o=this.schema[t];if(!o)throw new fe.NotFound("Table "+t+" not part of transaction");return o=new this.db.Table(t,o,this),o.core=this.db.core.table(t),i[t]=o},dn);function dn(){}function zr(t,i,o,l,c,g,x){return{name:t,keyPath:i,unique:o,multi:l,auto:c,compound:g,src:(o&&!x?"&":"")+(l?"*":"")+(c?"++":"")+os(i)}}function os(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Ur(t,i,o){return{name:t,primKey:i,indexes:o,mappedClass:null,idxByName:(l=function(c){return[c.name,c]},o.reduce(function(c,g,x){return x=l(g,x),x&&(c[x[0]]=x[1]),c},{}))};var l}var Yn=function(t){try{return t.only([[]]),Yn=function(){return[[]]},[[]]}catch{return Yn=function(){return Ht},Ht}};function Xr(t){return t==null?function(){}:typeof t=="string"?(i=t).split(".").length===1?function(o){return o[i]}:function(o){return L(o,i)}:function(o){return L(o,t)};var i}function as(t){return[].slice.call(t)}var na=0;function Jn(t){return t==null?":id":typeof t=="string"?t:"[".concat(t.join("+"),"]")}function ra(t,i,I){function l(M){if(M.type===3)return null;if(M.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var A=M.lower,B=M.upper,V=M.lowerOpen,M=M.upperOpen;return A===void 0?B===void 0?null:i.upperBound(B,!!M):B===void 0?i.lowerBound(A,!!V):i.bound(A,B,!!V,!!M)}function c(q){var A,B=q.name;return{name:B,schema:q,mutate:function(V){var M=V.trans,K=V.type,X=V.keys,W=V.values,J=V.range;return new Promise(function(le,be){le=Ue(le);var ue=M.objectStore(B),he=ue.keyPath==null,ve=K==="put"||K==="add";if(!ve&&K!=="delete"&&K!=="deleteRange")throw new Error("Invalid operation type: "+K);var me,ke=(X||W||{length:1}).length;if(X&&W&&X.length!==W.length)throw new Error("Given keys array must have same length as given values array.");if(ke===0)return le({numFailures:0,failures:{},results:[],lastResult:void 0});function $e(Vt){++Yt,Wn(Vt)}var Ke=[],ze=[],Yt=0;if(K==="deleteRange"){if(J.type===4)return le({numFailures:Yt,failures:ze,results:[],lastResult:void 0});J.type===3?Ke.push(me=ue.clear()):Ke.push(me=ue.delete(l(J)))}else{var he=ve?he?[W,X]:[W,null]:[X,null],Be=he[0],Lt=he[1];if(ve)for(var Bt=0;Bt<ke;++Bt)Ke.push(me=Lt&&Lt[Bt]!==void 0?ue[K](Be[Bt],Lt[Bt]):ue[K](Be[Bt])),me.onerror=$e;else for(Bt=0;Bt<ke;++Bt)Ke.push(me=ue[K](Be[Bt])),me.onerror=$e}function Er(Vt){Vt=Vt.target.result,Ke.forEach(function(In,di){return In.error!=null&&(ze[di]=In.error)}),le({numFailures:Yt,failures:ze,results:K==="delete"?X:Ke.map(function(In){return In.result}),lastResult:Vt})}me.onerror=function(Vt){$e(Vt),Er(Vt)},me.onsuccess=Er})},getMany:function(V){var M=V.trans,K=V.keys;return new Promise(function(X,W){X=Ue(X);for(var J,le=M.objectStore(B),be=K.length,ue=new Array(be),he=0,ve=0,me=function(Ke){Ke=Ke.target,ue[Ke._pos]=Ke.result,++ve===he&&X(ue)},ke=cn(W),$e=0;$e<be;++$e)K[$e]!=null&&((J=le.get(K[$e]))._pos=$e,J.onsuccess=me,J.onerror=ke,++he);he===0&&X(ue)})},get:function(V){var M=V.trans,K=V.key;return new Promise(function(X,W){X=Ue(X);var J=M.objectStore(B).get(K);J.onsuccess=function(le){return X(le.target.result)},J.onerror=cn(W)})},query:(A=N,function(V){return new Promise(function(M,K){M=Ue(M);var X,W,J,he=V.trans,le=V.values,be=V.limit,me=V.query,ue=be===1/0?void 0:be,ve=me.index,me=me.range,he=he.objectStore(B),ve=ve.isPrimaryKey?he:he.index(ve.name),me=l(me);if(be===0)return M({result:[]});A?((ue=le?ve.getAll(me,ue):ve.getAllKeys(me,ue)).onsuccess=function(ke){return M({result:ke.target.result})},ue.onerror=cn(K)):(X=0,W=!le&&"openKeyCursor"in ve?ve.openKeyCursor(me):ve.openCursor(me),J=[],W.onsuccess=function(ke){var $e=W.result;return $e?(J.push(le?$e.value:$e.primaryKey),++X===be?M({result:J}):void $e.continue()):M({result:J})},W.onerror=cn(K))})}),openCursor:function(V){var M=V.trans,K=V.values,X=V.query,W=V.reverse,J=V.unique;return new Promise(function(le,be){le=Ue(le);var ve=X.index,ue=X.range,he=M.objectStore(B),he=ve.isPrimaryKey?he:he.index(ve.name),ve=W?J?"prevunique":"prev":J?"nextunique":"next",me=!K&&"openKeyCursor"in he?he.openKeyCursor(l(ue),ve):he.openCursor(l(ue),ve);me.onerror=cn(be),me.onsuccess=Ue(function(ke){var $e,Ke,ze,Yt,Be=me.result;Be?(Be.___id=++na,Be.done=!1,$e=Be.continue.bind(Be),Ke=(Ke=Be.continuePrimaryKey)&&Ke.bind(Be),ze=Be.advance.bind(Be),Yt=function(){throw new Error("Cursor not stopped")},Be.trans=M,Be.stop=Be.continue=Be.continuePrimaryKey=Be.advance=function(){throw new Error("Cursor not started")},Be.fail=Ue(be),Be.next=function(){var Lt=this,Bt=1;return this.start(function(){return Bt--?Lt.continue():Lt.stop()}).then(function(){return Lt})},Be.start=function(Lt){function Bt(){if(me.result)try{Lt()}catch(Vt){Be.fail(Vt)}else Be.done=!0,Be.start=function(){throw new Error("Cursor behind last entry")},Be.stop()}var Er=new Promise(function(Vt,In){Vt=Ue(Vt),me.onerror=cn(In),Be.fail=In,Be.stop=function(di){Be.stop=Be.continue=Be.continuePrimaryKey=Be.advance=Yt,Vt(di)}});return me.onsuccess=Ue(function(Vt){me.onsuccess=Bt,Bt()}),Be.continue=$e,Be.continuePrimaryKey=Ke,Be.advance=ze,Bt(),Er},le(Be)):le(null)},be)})},count:function(V){var M=V.query,K=V.trans,X=M.index,W=M.range;return new Promise(function(J,le){var be=K.objectStore(B),ue=X.isPrimaryKey?be:be.index(X.name),be=l(W),ue=be?ue.count(be):ue.count();ue.onsuccess=Ue(function(he){return J(he.target.result)}),ue.onerror=cn(le)})}}}var g,x,k,F=(x=I,k=as((g=t).objectStoreNames),{schema:{name:g.name,tables:k.map(function(q){return x.objectStore(q)}).map(function(q){var A=q.keyPath,M=q.autoIncrement,B=f(A),V={},M={name:q.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:A==null,compound:B,keyPath:A,autoIncrement:M,unique:!0,extractKey:Xr(A)},indexes:as(q.indexNames).map(function(K){return q.index(K)}).map(function(J){var X=J.name,W=J.unique,le=J.multiEntry,J=J.keyPath,le={name:X,compound:f(J),keyPath:J,unique:W,multiEntry:le,extractKey:Xr(J)};return V[Jn(J)]=le}),getIndexByKeyPath:function(K){return V[Jn(K)]}};return V[":id"]=M.primaryKey,A!=null&&(V[Jn(A)]=M.primaryKey),M})},hasGetAll:0<k.length&&"getAll"in x.objectStore(k[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),I=F.schema,N=F.hasGetAll,F=I.tables.map(c),T={};return F.forEach(function(q){return T[q.name]=q}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(q){if(!T[q])throw new Error("Table '".concat(q,"' not found"));return T[q]},MIN_KEY:-1/0,MAX_KEY:Yn(i),schema:I}}function ia(t,i,o,l){var c=o.IDBKeyRange;return o.indexedDB,{dbcore:(l=ra(i,c,l),t.dbcore.reduce(function(g,x){return x=x.create,r(r({},g),x(g))},l))}}function dr(t,l){var o=l.db,l=ia(t._middlewares,o,t._deps,l);t.core=l.dbcore,t.tables.forEach(function(c){var g=c.name;t.core.schema.tables.some(function(x){return x.name===g})&&(c.core=t.core.table(g),t[g]instanceof t.Table&&(t[g].core=c.core))})}function fr(t,i,o,l){o.forEach(function(c){var g=l[c];i.forEach(function(x){var k=function I(N,F){return U(N,F)||(N=p(N))&&I(N,F)}(x,c);(!k||"value"in k&&k.value===void 0)&&(x===t.Transaction.prototype||x instanceof t.Transaction?C(x,c,{get:function(){return this.table(c)},set:function(I){R(this,c,{value:I,writable:!0,configurable:!0,enumerable:!0})}}):x[c]=new t.Table(c,g))})})}function Wr(t,i){i.forEach(function(o){for(var l in o)o[l]instanceof t.Table&&delete o[l]})}function sa(t,i){return t._cfg.version-i._cfg.version}function oa(t,i,o,l){var c=t._dbSchema;o.objectStoreNames.contains("$meta")&&!c.$meta&&(c.$meta=Ur("$meta",us("")[0],[]),t._storeNames.push("$meta"));var g=t._createTransaction("readwrite",t._storeNames,c);g.create(o),g._completion.catch(l);var x=g._reject.bind(g),k=Se.transless||Se;nn(function(){return Se.trans=g,Se.transless=k,i!==0?(dr(t,o),N=i,((I=g).storeNames.includes("$meta")?I.table("$meta").get("version").then(function(F){return F??N}):O.resolve(N)).then(function(F){return q=F,A=g,B=o,V=[],F=(T=t)._versions,M=T._dbSchema=pr(0,T.idbdb,B),(F=F.filter(function(K){return K._cfg.version>=q})).length!==0?(F.forEach(function(K){V.push(function(){var X=M,W=K._cfg.dbschema;gr(T,X,B),gr(T,W,B),M=T._dbSchema=W;var J=Gr(X,W);J.add.forEach(function(ve){Yr(B,ve[0],ve[1].primKey,ve[1].indexes)}),J.change.forEach(function(ve){if(ve.recreate)throw new fe.Upgrade("Not yet support for changing primary key");var me=B.objectStore(ve.name);ve.add.forEach(function(ke){return hr(me,ke)}),ve.change.forEach(function(ke){me.deleteIndex(ke.name),hr(me,ke)}),ve.del.forEach(function(ke){return me.deleteIndex(ke)})});var le=K._cfg.contentUpgrade;if(le&&K._cfg.version>q){dr(T,B),A._memoizedTables={};var be=ie(W);J.del.forEach(function(ve){be[ve]=X[ve]}),Wr(T,[T.Transaction.prototype]),fr(T,[T.Transaction.prototype],d(be),be),A.schema=be;var ue,he=we(le);return he&&un(),J=O.follow(function(){var ve;(ue=le(A))&&he&&(ve=rn.bind(null,null),ue.then(ve,ve))}),ue&&typeof ue.then=="function"?O.resolve(ue):J.then(function(){return ue})}}),V.push(function(X){var W,J,le=K._cfg.dbschema;W=le,J=X,[].slice.call(J.db.objectStoreNames).forEach(function(be){return W[be]==null&&J.db.deleteObjectStore(be)}),Wr(T,[T.Transaction.prototype]),fr(T,[T.Transaction.prototype],T._storeNames,T._dbSchema),A.schema=T._dbSchema}),V.push(function(X){T.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(T.idbdb.version/10)===K._cfg.version?(T.idbdb.deleteObjectStore("$meta"),delete T._dbSchema.$meta,T._storeNames=T._storeNames.filter(function(W){return W!=="$meta"})):X.objectStore("$meta").put(K._cfg.version,"version"))})}),function K(){return V.length?O.resolve(V.shift()(A.idbtrans)).then(K):O.resolve()}().then(function(){ls(M,B)})):O.resolve();var T,q,A,B,V,M}).catch(x)):(d(c).forEach(function(F){Yr(o,F,c[F].primKey,c[F].indexes)}),dr(t,o),void O.follow(function(){return t.on.populate.fire(g)}).catch(x));var I,N})}function aa(t,i){ls(t._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var o=pr(0,t.idbdb,i);gr(t,t._dbSchema,i);for(var l=0,c=Gr(o,t._dbSchema).change;l<c.length;l++){var g=function(x){if(x.change.length||x.recreate)return console.warn("Unable to patch indexes of table ".concat(x.name," because it has changes on the type of index or primary key.")),{value:void 0};var k=i.objectStore(x.name);x.add.forEach(function(I){We&&console.debug("Dexie upgrade patch: Creating missing index ".concat(x.name,".").concat(I.src)),hr(k,I)})}(c[l]);if(typeof g=="object")return g.value}}function Gr(t,i){var o,l={del:[],add:[],change:[]};for(o in t)i[o]||l.del.push(o);for(o in i){var c=t[o],g=i[o];if(c){var x={name:o,def:g,recreate:!1,del:[],add:[],change:[]};if(""+(c.primKey.keyPath||"")!=""+(g.primKey.keyPath||"")||c.primKey.auto!==g.primKey.auto)x.recreate=!0,l.change.push(x);else{var k=c.idxByName,I=g.idxByName,N=void 0;for(N in k)I[N]||x.del.push(N);for(N in I){var F=k[N],T=I[N];F?F.src!==T.src&&x.change.push(T):x.add.push(T)}(0<x.del.length||0<x.add.length||0<x.change.length)&&l.change.push(x)}}else l.add.push([o,g])}return l}function Yr(t,i,o,l){var c=t.db.createObjectStore(i,o.keyPath?{keyPath:o.keyPath,autoIncrement:o.auto}:{autoIncrement:o.auto});return l.forEach(function(g){return hr(c,g)}),c}function ls(t,i){d(t).forEach(function(o){i.db.objectStoreNames.contains(o)||(We&&console.debug("Dexie: Creating missing table",o),Yr(i,o,t[o].primKey,t[o].indexes))})}function hr(t,i){t.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function pr(t,i,o){var l={};return H(i.objectStoreNames,0).forEach(function(c){for(var g=o.objectStore(c),x=zr(os(N=g.keyPath),N||"",!0,!1,!!g.autoIncrement,N&&typeof N!="string",!0),k=[],I=0;I<g.indexNames.length;++I){var F=g.index(g.indexNames[I]),N=F.keyPath,F=zr(F.name,N,!!F.unique,!!F.multiEntry,!1,N&&typeof N!="string",!1);k.push(F)}l[c]=Ur(c,x,k)}),l}function gr(t,i,o){for(var l=o.db.objectStoreNames,c=0;c<l.length;++c){var g=l[c],x=o.objectStore(g);t._hasGetAll="getAll"in x;for(var k=0;k<x.indexNames.length;++k){var I=x.indexNames[k],N=x.index(I).keyPath,F=typeof N=="string"?N:"["+H(N).join("+")+"]";!i[g]||(N=i[g].idxByName[F])&&(N.name=I,delete i[g].idxByName[F],i[g].idxByName[I]=N)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&u.WorkerGlobalScope&&u instanceof u.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function us(t){return t.split(",").map(function(i,o){var l=(i=i.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return zr(l,c||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),f(c),o===0)})}var la=(mr.prototype._parseStoresSpec=function(t,i){d(t).forEach(function(o){if(t[o]!==null){var l=us(t[o]),c=l.shift();if(c.unique=!0,c.multi)throw new fe.Schema("Primary key cannot be multi-valued");l.forEach(function(g){if(g.auto)throw new fe.Schema("Only primary key can be marked as autoIncrement (++)");if(!g.keyPath)throw new fe.Schema("Index must have a name and cannot be an empty string")}),i[o]=Ur(o,c,l)}})},mr.prototype.stores=function(o){var i=this.db;this._cfg.storesSource=this._cfg.storesSource?h(this._cfg.storesSource,o):o;var o=i._versions,l={},c={};return o.forEach(function(g){h(l,g._cfg.storesSource),c=g._cfg.dbschema={},g._parseStoresSpec(l,c)}),i._dbSchema=c,Wr(i,[i._allTables,i,i.Transaction.prototype]),fr(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],d(c),c),i._storeNames=d(c),this},mr.prototype.upgrade=function(t){return this._cfg.contentUpgrade=He(this._cfg.contentUpgrade||Ie,t),this},mr);function mr(){}function Jr(t,i){var o=t._dbNamesDB;return o||(o=t._dbNamesDB=new gn(Q,{addons:[],indexedDB:t,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),o.table("dbnames")}function Qr(t){return t&&typeof t.databases=="function"}function Zr(t){return nn(function(){return Se.letThrough=!0,t()})}function ei(t){return!("from"in t)}var jt=function(t,i){if(!this){var o=new jt;return t&&"d"in t&&h(o,t),o}h(this,arguments.length?{d:1,from:t,to:1<arguments.length?i:t}:{d:0})};function Qn(t,i,o){var l=De(i,o);if(!isNaN(l)){if(0<l)throw RangeError();if(ei(t))return h(t,{from:i,to:o,d:1});var c=t.l,l=t.r;if(De(o,t.from)<0)return c?Qn(c,i,o):t.l={from:i,to:o,d:1,l:null,r:null},ds(t);if(0<De(i,t.to))return l?Qn(l,i,o):t.r={from:i,to:o,d:1,l:null,r:null},ds(t);De(i,t.from)<0&&(t.from=i,t.l=null,t.d=l?l.d+1:1),0<De(o,t.to)&&(t.to=o,t.r=null,t.d=t.l?t.l.d+1:1),o=!t.r,c&&!t.l&&Zn(t,c),l&&o&&Zn(t,l)}}function Zn(t,i){ei(i)||function o(l,I){var g=I.from,x=I.to,k=I.l,I=I.r;Qn(l,g,x),k&&o(l,k),I&&o(l,I)}(t,i)}function cs(t,i){var o=br(i),l=o.next();if(l.done)return!1;for(var c=l.value,g=br(t),x=g.next(c.from),k=x.value;!l.done&&!x.done;){if(De(k.from,c.to)<=0&&0<=De(k.to,c.from))return!0;De(c.from,k.from)<0?c=(l=o.next(k.from)).value:k=(x=g.next(c.from)).value}return!1}function br(t){var i=ei(t)?null:{s:0,n:t};return{next:function(o){for(var l=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,l)for(;i.n.l&&De(o,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!l||De(o,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function ds(t){var i,o,l=(((i=t.r)===null||i===void 0?void 0:i.d)||0)-(((o=t.l)===null||o===void 0?void 0:o.d)||0),c=1<l?"r":l<-1?"l":"";c&&(i=c=="r"?"l":"r",o=r({},t),l=t[c],t.from=l.from,t.to=l.to,t[c]=l[c],o[c]=l[i],(t[i]=o).d=fs(o)),t.d=fs(t)}function fs(o){var i=o.r,o=o.l;return(i?o?Math.max(i.d,o.d):i.d:o?o.d:0)+1}function yr(t,i){return d(i).forEach(function(o){t[o]?Zn(t[o],i[o]):t[o]=function l(c){var g,x,k={};for(g in c)S(c,g)&&(x=c[g],k[g]=!x||typeof x!="object"||Z.has(x.constructor)?x:l(x));return k}(i[o])}),t}function ti(t,i){return t.all||i.all||Object.keys(t).some(function(o){return i[o]&&cs(i[o],t[o])})}b(jt.prototype,((on={add:function(t){return Zn(this,t),this},addKey:function(t){return Qn(this,t,t),this},addKeys:function(t){var i=this;return t.forEach(function(o){return Qn(i,o,o)}),this},hasKey:function(t){var i=br(this).next(t).value;return i&&De(i.from,t)<=0&&0<=De(i.to,t)}})[ae]=function(){return br(this)},on));var _n={},ni={},ri=!1;function vr(t){yr(ni,t),ri||(ri=!0,setTimeout(function(){ri=!1,ii(ni,!(ni={}))},0))}function ii(t,i){i===void 0&&(i=!1);var o=new Set;if(t.all)for(var l=0,c=Object.values(_n);l<c.length;l++)hs(x=c[l],t,o,i);else for(var g in t){var x,k=/^idb\:\/\/(.*)\/(.*)\//.exec(g);k&&(g=k[1],k=k[2],(x=_n["idb://".concat(g,"/").concat(k)])&&hs(x,t,o,i))}o.forEach(function(I){return I()})}function hs(t,i,o,l){for(var c=[],g=0,x=Object.entries(t.queries.query);g<x.length;g++){for(var k=x[g],I=k[0],N=[],F=0,T=k[1];F<T.length;F++){var q=T[F];ti(i,q.obsSet)?q.subscribers.forEach(function(M){return o.add(M)}):l&&N.push(q)}l&&c.push([I,N])}if(l)for(var A=0,B=c;A<B.length;A++){var V=B[A],I=V[0],N=V[1];t.queries.query[I]=N}}function ua(t){var i=t._state,o=t._deps.indexedDB;if(i.isBeingOpened||t.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?it(i.dbOpenError):t});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var l=i.openCanceller,c=Math.round(10*t.verno),g=!1;function x(){if(i.openCanceller!==l)throw new fe.DatabaseClosed("db.open() was cancelled")}function k(){return new O(function(q,A){if(x(),!o)throw new fe.MissingAPI;var B=t.name,V=i.autoSchema||!c?o.open(B):o.open(B,c);if(!V)throw new fe.MissingAPI;V.onerror=cn(A),V.onblocked=Ue(t._fireOnBlocked),V.onupgradeneeded=Ue(function(M){var K;F=V.transaction,i.autoSchema&&!t._options.allowEmptyDB?(V.onerror=Wn,F.abort(),V.result.close(),(K=o.deleteDatabase(B)).onsuccess=K.onerror=Ue(function(){A(new fe.NoSuchDatabase("Database ".concat(B," doesnt exist")))})):(F.onerror=cn(A),M=M.oldVersion>Math.pow(2,62)?0:M.oldVersion,T=M<1,t.idbdb=V.result,g&&aa(t,F),oa(t,M/10,F,A))},A),V.onsuccess=Ue(function(){F=null;var M,K,X,W,J,le=t.idbdb=V.result,be=H(le.objectStoreNames);if(0<be.length)try{var ue=le.transaction((W=be).length===1?W[0]:W,"readonly");if(i.autoSchema)K=le,X=ue,(M=t).verno=K.version/10,X=M._dbSchema=pr(0,K,X),M._storeNames=H(K.objectStoreNames,0),fr(M,[M._allTables],d(X),X);else if(gr(t,t._dbSchema,ue),((J=Gr(pr(0,(J=t).idbdb,ue),J._dbSchema)).add.length||J.change.some(function(he){return he.add.length||he.change.length}))&&!g)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),le.close(),c=le.version+1,g=!0,q(k());dr(t,ue)}catch{}Ze.push(t),le.onversionchange=Ue(function(he){i.vcFired=!0,t.on("versionchange").fire(he)}),le.onclose=Ue(function(he){t.on("close").fire(he)}),T&&(J=t._deps,ue=B,le=J.indexedDB,J=J.IDBKeyRange,Qr(le)||ue===Q||Jr(le,J).put({name:ue}).catch(Ie)),q()},A)}).catch(function(q){switch(q==null?void 0:q.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),k();break;case"VersionError":if(0<c)return c=0,k()}return O.reject(q)})}var I,N=i.dbReadyResolve,F=null,T=!1;return O.race([l,(typeof navigator>"u"?O.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(q){function A(){return indexedDB.databases().finally(q)}I=setInterval(A,100),A()}).finally(function(){return clearInterval(I)}):Promise.resolve()).then(k)]).then(function(){return x(),i.onReadyBeingFired=[],O.resolve(Zr(function(){return t.on.ready.fire(t.vip)})).then(function q(){if(0<i.onReadyBeingFired.length){var A=i.onReadyBeingFired.reduce(He,Ie);return i.onReadyBeingFired=[],O.resolve(Zr(function(){return A(t.vip)})).then(q)}})}).finally(function(){i.openCanceller===l&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(q){i.dbOpenError=q;try{F&&F.abort()}catch{}return l===i.openCanceller&&t._close(),it(q)}).finally(function(){i.openComplete=!0,N()}).then(function(){var q;return T&&(q={},t.tables.forEach(function(A){A.schema.indexes.forEach(function(B){B.name&&(q["idb://".concat(t.name,"/").concat(A.name,"/").concat(B.name)]=new jt(-1/0,[[[]]]))}),q["idb://".concat(t.name,"/").concat(A.name,"/")]=q["idb://".concat(t.name,"/").concat(A.name,"/:dels")]=new jt(-1/0,[[[]]])}),Sn(Gn).fire(q),ii(q,!0)),t})}function si(t){function i(g){return t.next(g)}var o=c(i),l=c(function(g){return t.throw(g)});function c(g){return function(I){var k=g(I),I=k.value;return k.done?I:I&&typeof I.then=="function"?I.then(o,l):f(I)?Promise.all(I).then(o,l):o(I)}}return c(i)()}function xr(t,i,o){for(var l=f(t)?t.slice():[t],c=0;c<o;++c)l.push(i);return l}var ca={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return r(r({},t),{table:function(i){var o=t.table(i),l=o.schema,c={},g=[];function x(T,q,A){var B=Jn(T),V=c[B]=c[B]||[],M=T==null?0:typeof T=="string"?1:T.length,K=0<q,K=r(r({},A),{name:K?"".concat(B,"(virtual-from:").concat(A.name,")"):A.name,lowLevelIndex:A,isVirtual:K,keyTail:q,keyLength:M,extractKey:Xr(T),unique:!K&&A.unique});return V.push(K),K.isPrimaryKey||g.push(K),1<M&&x(M===2?T[0]:T.slice(0,M-1),q+1,A),V.sort(function(X,W){return X.keyTail-W.keyTail}),K}i=x(l.primaryKey.keyPath,0,l.primaryKey),c[":id"]=[i];for(var k=0,I=l.indexes;k<I.length;k++){var N=I[k];x(N.keyPath,0,N)}function F(T){var q,A=T.query.index;return A.isVirtual?r(r({},T),{query:{index:A.lowLevelIndex,range:(q=T.query.range,A=A.keyTail,{type:q.type===1?2:q.type,lower:xr(q.lower,q.lowerOpen?t.MAX_KEY:t.MIN_KEY,A),lowerOpen:!0,upper:xr(q.upper,q.upperOpen?t.MIN_KEY:t.MAX_KEY,A),upperOpen:!0})}}):T}return r(r({},o),{schema:r(r({},l),{primaryKey:i,indexes:g,getIndexByKeyPath:function(T){return(T=c[Jn(T)])&&T[0]}}),count:function(T){return o.count(F(T))},query:function(T){return o.query(F(T))},openCursor:function(T){var q=T.query.index,A=q.keyTail,B=q.isVirtual,V=q.keyLength;return B?o.openCursor(F(T)).then(function(K){return K&&M(K)}):o.openCursor(T);function M(K){return Object.create(K,{continue:{value:function(X){X!=null?K.continue(xr(X,T.reverse?t.MAX_KEY:t.MIN_KEY,A)):T.unique?K.continue(K.key.slice(0,V).concat(T.reverse?t.MIN_KEY:t.MAX_KEY,A)):K.continue()}},continuePrimaryKey:{value:function(X,W){K.continuePrimaryKey(xr(X,t.MAX_KEY,A),W)}},primaryKey:{get:function(){return K.primaryKey}},key:{get:function(){var X=K.key;return V===1?X[0]:X.slice(0,V)}},value:{get:function(){return K.value}}})}}})}})}};function oi(t,i,o,l){return o=o||{},l=l||"",d(t).forEach(function(c){var g,x,k;S(i,c)?(g=t[c],x=i[c],typeof g=="object"&&typeof x=="object"&&g&&x?(k=re(g))!==re(x)?o[l+c]=i[c]:k==="Object"?oi(g,x,o,l+c+"."):g!==x&&(o[l+c]=i[c]):g!==x&&(o[l+c]=i[c])):o[l+c]=void 0}),d(i).forEach(function(c){S(t,c)||(o[l+c]=i[c])}),o}function ai(t,i){return i.type==="delete"?i.keys:i.keys||i.values.map(t.extractKey)}var da={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return r(r({},t),{table:function(i){var o=t.table(i),l=o.schema.primaryKey;return r(r({},o),{mutate:function(c){var g=Se.trans,x=g.table(i).hook,k=x.deleting,I=x.creating,N=x.updating;switch(c.type){case"add":if(I.fire===Ie)break;return g._promise("readwrite",function(){return F(c)},!0);case"put":if(I.fire===Ie&&N.fire===Ie)break;return g._promise("readwrite",function(){return F(c)},!0);case"delete":if(k.fire===Ie)break;return g._promise("readwrite",function(){return F(c)},!0);case"deleteRange":if(k.fire===Ie)break;return g._promise("readwrite",function(){return function T(q,A,B){return o.query({trans:q,values:!1,query:{index:l,range:A},limit:B}).then(function(V){var M=V.result;return F({type:"delete",keys:M,trans:q}).then(function(K){return 0<K.numFailures?Promise.reject(K.failures[0]):M.length<B?{failures:[],numFailures:0,lastResult:void 0}:T(q,r(r({},A),{lower:M[M.length-1],lowerOpen:!0}),B)})})}(c.trans,c.range,1e4)},!0)}return o.mutate(c);function F(T){var q,A,B,V=Se.trans,M=T.keys||ai(l,T);if(!M)throw new Error("Keys missing");return(T=T.type==="add"||T.type==="put"?r(r({},T),{keys:M}):r({},T)).type!=="delete"&&(T.values=a([],T.values)),T.keys&&(T.keys=a([],T.keys)),q=o,B=M,((A=T).type==="add"?Promise.resolve([]):q.getMany({trans:A.trans,keys:B,cache:"immutable"})).then(function(K){var X=M.map(function(W,J){var le,be,ue,he=K[J],ve={onerror:null,onsuccess:null};return T.type==="delete"?k.fire.call(ve,W,he,V):T.type==="add"||he===void 0?(le=I.fire.call(ve,W,T.values[J],V),W==null&&le!=null&&(T.keys[J]=W=le,l.outbound||z(T.values[J],l.keyPath,W))):(le=oi(he,T.values[J]),(be=N.fire.call(ve,le,W,he,V))&&(ue=T.values[J],Object.keys(be).forEach(function(me){S(ue,me)?ue[me]=be[me]:z(ue,me,be[me])}))),ve});return o.mutate(T).then(function(W){for(var J=W.failures,le=W.results,be=W.numFailures,W=W.lastResult,ue=0;ue<M.length;++ue){var he=(le||M)[ue],ve=X[ue];he==null?ve.onerror&&ve.onerror(J[ue]):ve.onsuccess&&ve.onsuccess(T.type==="put"&&K[ue]?T.values[ue]:he)}return{failures:J,results:le,numFailures:be,lastResult:W}}).catch(function(W){return X.forEach(function(J){return J.onerror&&J.onerror(W)}),Promise.reject(W)})})}}})}})}};function ps(t,i,o){try{if(!i||i.keys.length<t.length)return null;for(var l=[],c=0,g=0;c<i.keys.length&&g<t.length;++c)De(i.keys[c],t[g])===0&&(l.push(o?w(i.values[c]):i.values[c]),++g);return l.length===t.length?l:null}catch{return null}}var fa={stack:"dbcore",level:-1,create:function(t){return{table:function(i){var o=t.table(i);return r(r({},o),{getMany:function(l){if(!l.cache)return o.getMany(l);var c=ps(l.keys,l.trans._cache,l.cache==="clone");return c?O.resolve(c):o.getMany(l).then(function(g){return l.trans._cache={keys:l.keys,values:l.cache==="clone"?w(g):g},g})},mutate:function(l){return l.type!=="add"&&(l.trans._cache=null),o.mutate(l)}})}}}};function gs(t,i){return t.trans.mode==="readonly"&&!!t.subscr&&!t.trans.explicit&&t.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function ms(t,i){switch(t){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var ha={stack:"dbcore",level:0,name:"Observability",create:function(t){var i=t.schema.name,o=new jt(t.MIN_KEY,t.MAX_KEY);return r(r({},t),{transaction:function(l,c,g){if(Se.subscr&&c!=="readonly")throw new fe.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Se.querier));return t.transaction(l,c,g)},table:function(l){var c=t.table(l),g=c.schema,x=g.primaryKey,T=g.indexes,k=x.extractKey,I=x.outbound,N=x.autoIncrement&&T.filter(function(A){return A.compound&&A.keyPath.includes(x.keyPath)}),F=r(r({},c),{mutate:function(A){function B(me){return me="idb://".concat(i,"/").concat(l,"/").concat(me),W[me]||(W[me]=new jt)}var V,M,K,X=A.trans,W=A.mutatedParts||(A.mutatedParts={}),J=B(""),le=B(":dels"),be=A.type,ve=A.type==="deleteRange"?[A.range]:A.type==="delete"?[A.keys]:A.values.length<50?[ai(x,A).filter(function(me){return me}),A.values]:[],ue=ve[0],he=ve[1],ve=A.trans._cache;return f(ue)?(J.addKeys(ue),(ve=be==="delete"||ue.length===he.length?ps(ue,ve):null)||le.addKeys(ue),(ve||he)&&(V=B,M=ve,K=he,g.indexes.forEach(function(me){var ke=V(me.name||"");function $e(ze){return ze!=null?me.extractKey(ze):null}function Ke(ze){return me.multiEntry&&f(ze)?ze.forEach(function(Yt){return ke.addKey(Yt)}):ke.addKey(ze)}(M||K).forEach(function(ze,Lt){var Be=M&&$e(M[Lt]),Lt=K&&$e(K[Lt]);De(Be,Lt)!==0&&(Be!=null&&Ke(Be),Lt!=null&&Ke(Lt))})}))):ue?(he={from:(he=ue.lower)!==null&&he!==void 0?he:t.MIN_KEY,to:(he=ue.upper)!==null&&he!==void 0?he:t.MAX_KEY},le.add(he),J.add(he)):(J.add(o),le.add(o),g.indexes.forEach(function(me){return B(me.name).add(o)})),c.mutate(A).then(function(me){return!ue||A.type!=="add"&&A.type!=="put"||(J.addKeys(me.results),N&&N.forEach(function(ke){for(var $e=A.values.map(function(Be){return ke.extractKey(Be)}),Ke=ke.keyPath.findIndex(function(Be){return Be===x.keyPath}),ze=0,Yt=me.results.length;ze<Yt;++ze)$e[ze][Ke]=me.results[ze];B(ke.name).addKeys($e)})),X.mutatedParts=yr(X.mutatedParts||{},W),me})}}),T=function(B){var V=B.query,B=V.index,V=V.range;return[B,new jt((B=V.lower)!==null&&B!==void 0?B:t.MIN_KEY,(V=V.upper)!==null&&V!==void 0?V:t.MAX_KEY)]},q={get:function(A){return[x,new jt(A.key)]},getMany:function(A){return[x,new jt().addKeys(A.keys)]},count:T,query:T,openCursor:T};return d(q).forEach(function(A){F[A]=function(B){var V=Se.subscr,M=!!V,K=gs(Se,c)&&ms(A,B)?B.obsSet={}:V;if(M){var X=function(he){return he="idb://".concat(i,"/").concat(l,"/").concat(he),K[he]||(K[he]=new jt)},W=X(""),J=X(":dels"),V=q[A](B),M=V[0],V=V[1];if((A==="query"&&M.isPrimaryKey&&!B.values?J:X(M.name||"")).add(V),!M.isPrimaryKey){if(A!=="count"){var le=A==="query"&&I&&B.values&&c.query(r(r({},B),{values:!1}));return c[A].apply(this,arguments).then(function(he){if(A==="query"){if(I&&B.values)return le.then(function($e){return $e=$e.result,W.addKeys($e),he});var ve=B.values?he.result.map(k):he.result;(B.values?W:J).addKeys(ve)}else if(A==="openCursor"){var me=he,ke=B.values;return me&&Object.create(me,{key:{get:function(){return J.addKey(me.primaryKey),me.key}},primaryKey:{get:function(){var $e=me.primaryKey;return J.addKey($e),$e}},value:{get:function(){return ke&&W.addKey(me.primaryKey),me.value}}})}return he})}J.add(o)}}return c[A].apply(this,arguments)}}),F}})}};function bs(t,i,o){if(o.numFailures===0)return i;if(i.type==="deleteRange")return null;var l=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1;return o.numFailures===l?null:(i=r({},i),f(i.keys)&&(i.keys=i.keys.filter(function(c,g){return!(g in o.failures)})),"values"in i&&f(i.values)&&(i.values=i.values.filter(function(c,g){return!(g in o.failures)})),i)}function li(t,i){return o=t,((l=i).lower===void 0||(l.lowerOpen?0<De(o,l.lower):0<=De(o,l.lower)))&&(t=t,(i=i).upper===void 0||(i.upperOpen?De(t,i.upper)<0:De(t,i.upper)<=0));var o,l}function ys(t,i,q,l,c,g){if(!q||q.length===0)return t;var x=i.query.index,k=x.multiEntry,I=i.query.range,N=l.schema.primaryKey.extractKey,F=x.extractKey,T=(x.lowLevelIndex||x).extractKey,q=q.reduce(function(A,B){var V=A,M=[];if(B.type==="add"||B.type==="put")for(var K=new jt,X=B.values.length-1;0<=X;--X){var W,J=B.values[X],le=N(J);K.hasKey(le)||(W=F(J),(k&&f(W)?W.some(function(me){return li(me,I)}):li(W,I))&&(K.addKey(le),M.push(J)))}switch(B.type){case"add":var be=new jt().addKeys(i.values?A.map(function(ke){return N(ke)}):A),V=A.concat(i.values?M.filter(function(ke){return ke=N(ke),!be.hasKey(ke)&&(be.addKey(ke),!0)}):M.map(function(ke){return N(ke)}).filter(function(ke){return!be.hasKey(ke)&&(be.addKey(ke),!0)}));break;case"put":var ue=new jt().addKeys(B.values.map(function(ke){return N(ke)}));V=A.filter(function(ke){return!ue.hasKey(i.values?N(ke):ke)}).concat(i.values?M:M.map(function(ke){return N(ke)}));break;case"delete":var he=new jt().addKeys(B.keys);V=A.filter(function(ke){return!he.hasKey(i.values?N(ke):ke)});break;case"deleteRange":var ve=B.range;V=A.filter(function(ke){return!li(N(ke),ve)})}return V},t);return q===t?t:(q.sort(function(A,B){return De(T(A),T(B))||De(N(A),N(B))}),i.limit&&i.limit<1/0&&(q.length>i.limit?q.length=i.limit:t.length===i.limit&&q.length<i.limit&&(c.dirty=!0)),g?Object.freeze(q):q)}function vs(t,i){return De(t.lower,i.lower)===0&&De(t.upper,i.upper)===0&&!!t.lowerOpen==!!i.lowerOpen&&!!t.upperOpen==!!i.upperOpen}function pa(t,i){return function(o,l,c,g){if(o===void 0)return l!==void 0?-1:0;if(l===void 0)return 1;if((l=De(o,l))===0){if(c&&g)return 0;if(c)return 1;if(g)return-1}return l}(t.lower,i.lower,t.lowerOpen,i.lowerOpen)<=0&&0<=function(o,l,c,g){if(o===void 0)return l!==void 0?1:0;if(l===void 0)return-1;if((l=De(o,l))===0){if(c&&g)return 0;if(c)return-1;if(g)return 1}return l}(t.upper,i.upper,t.upperOpen,i.upperOpen)}function ga(t,i,o,l){t.subscribers.add(o),l.addEventListener("abort",function(){var c,g;t.subscribers.delete(o),t.subscribers.size===0&&(c=t,g=i,setTimeout(function(){c.subscribers.size===0&&te(g,c)},3e3))})}var ma={stack:"dbcore",level:0,name:"Cache",create:function(t){var i=t.schema.name;return r(r({},t),{transaction:function(o,l,c){var g,x,k=t.transaction(o,l,c);return l==="readwrite"&&(x=(g=new AbortController).signal,c=function(I){return function(){if(g.abort(),l==="readwrite"){for(var N=new Set,F=0,T=o;F<T.length;F++){var q=T[F],A=_n["idb://".concat(i,"/").concat(q)];if(A){var B=t.table(q),V=A.optimisticOps.filter(function(ke){return ke.trans===k});if(k._explicit&&I&&k.mutatedParts)for(var M=0,K=Object.values(A.queries.query);M<K.length;M++)for(var X=0,W=(be=K[M]).slice();X<W.length;X++)ti((ue=W[X]).obsSet,k.mutatedParts)&&(te(be,ue),ue.subscribers.forEach(function(ke){return N.add(ke)}));else if(0<V.length){A.optimisticOps=A.optimisticOps.filter(function(ke){return ke.trans!==k});for(var J=0,le=Object.values(A.queries.query);J<le.length;J++)for(var be,ue,he,ve=0,me=(be=le[J]).slice();ve<me.length;ve++)(ue=me[ve]).res!=null&&k.mutatedParts&&(I&&!ue.dirty?(he=Object.isFrozen(ue.res),he=ys(ue.res,ue.req,V,B,ue,he),ue.dirty?(te(be,ue),ue.subscribers.forEach(function(ke){return N.add(ke)})):he!==ue.res&&(ue.res=he,ue.promise=O.resolve({result:he}))):(ue.dirty&&te(be,ue),ue.subscribers.forEach(function(ke){return N.add(ke)})))}}}N.forEach(function(ke){return ke()})}}},k.addEventListener("abort",c(!1),{signal:x}),k.addEventListener("error",c(!1),{signal:x}),k.addEventListener("complete",c(!0),{signal:x})),k},table:function(o){var l=t.table(o),c=l.schema.primaryKey;return r(r({},l),{mutate:function(g){var x=Se.trans;if(c.outbound||x.db._options.cache==="disabled"||x.explicit||x.idbtrans.mode!=="readwrite")return l.mutate(g);var k=_n["idb://".concat(i,"/").concat(o)];return k?(x=l.mutate(g),g.type!=="add"&&g.type!=="put"||!(50<=g.values.length||ai(c,g).some(function(I){return I==null}))?(k.optimisticOps.push(g),g.mutatedParts&&vr(g.mutatedParts),x.then(function(I){0<I.numFailures&&(te(k.optimisticOps,g),(I=bs(0,g,I))&&k.optimisticOps.push(I),g.mutatedParts&&vr(g.mutatedParts))}),x.catch(function(){te(k.optimisticOps,g),g.mutatedParts&&vr(g.mutatedParts)})):x.then(function(I){var N=bs(0,r(r({},g),{values:g.values.map(function(F,T){var q;return I.failures[T]?F:(F=(q=c.keyPath)!==null&&q!==void 0&&q.includes(".")?w(F):r({},F),z(F,c.keyPath,I.results[T]),F)})}),I);k.optimisticOps.push(N),queueMicrotask(function(){return g.mutatedParts&&vr(g.mutatedParts)})}),x):l.mutate(g)},query:function(g){if(!gs(Se,l)||!ms("query",g))return l.query(g);var x=((N=Se.trans)===null||N===void 0?void 0:N.db._options.cache)==="immutable",T=Se,k=T.requery,I=T.signal,N=function(B,V,M,K){var X=_n["idb://".concat(B,"/").concat(V)];if(!X)return[];if(!(V=X.queries[M]))return[null,!1,X,null];var W=V[(K.query?K.query.index.name:null)||""];if(!W)return[null,!1,X,null];switch(M){case"query":var J=W.find(function(le){return le.req.limit===K.limit&&le.req.values===K.values&&vs(le.req.query.range,K.query.range)});return J?[J,!0,X,W]:[W.find(function(le){return("limit"in le.req?le.req.limit:1/0)>=K.limit&&(!K.values||le.req.values)&&pa(le.req.query.range,K.query.range)}),!1,X,W];case"count":return J=W.find(function(le){return vs(le.req.query.range,K.query.range)}),[J,!!J,X,W]}}(i,o,"query",g),F=N[0],T=N[1],q=N[2],A=N[3];return F&&T?F.obsSet=g.obsSet:(T=l.query(g).then(function(B){var V=B.result;if(F&&(F.res=V),x){for(var M=0,K=V.length;M<K;++M)Object.freeze(V[M]);Object.freeze(V)}else B.result=w(V);return B}).catch(function(B){return A&&F&&te(A,F),Promise.reject(B)}),F={obsSet:g.obsSet,promise:T,subscribers:new Set,type:"query",req:g,dirty:!1},A?A.push(F):(A=[F],(q=q||(_n["idb://".concat(i,"/").concat(o)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[g.query.index.name||""]=A)),ga(F,A,k,I),F.promise.then(function(B){return{result:ys(B.result,g,q==null?void 0:q.optimisticOps,l,F,x)}})}})}})}};function wr(t,i){return new Proxy(t,{get:function(o,l,c){return l==="db"?i:Reflect.get(o,l,c)}})}var gn=(pt.prototype.version=function(t){if(isNaN(t)||t<.1)throw new fe.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new fe.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var i=this._versions,o=i.filter(function(l){return l._cfg.version===t})[0];return o||(o=new this.Version(t),i.push(o),i.sort(sa),o.stores({}),this._state.autoSchema=!1,o)},pt.prototype._whenReady=function(t){var i=this;return this.idbdb&&(this._state.openComplete||Se.letThrough||this._vip)?t():new O(function(o,l){if(i._state.openComplete)return l(new fe.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void l(new fe.DatabaseClosed);i.open().catch(Ie)}i._state.dbReadyPromise.then(o,l)}).then(t)},pt.prototype.use=function(t){var i=t.stack,o=t.create,l=t.level,c=t.name;return c&&this.unuse({stack:i,name:c}),t=this._middlewares[i]||(this._middlewares[i]=[]),t.push({stack:i,create:o,level:l??10,name:c}),t.sort(function(g,x){return g.level-x.level}),this},pt.prototype.unuse=function(t){var i=t.stack,o=t.name,l=t.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(c){return l?c.create!==l:!!o&&c.name!==o})),this},pt.prototype.open=function(){var t=this;return ln(Ct,function(){return ua(t)})},pt.prototype._close=function(){var t=this._state,i=Ze.indexOf(this);if(0<=i&&Ze.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new O(function(o){t.dbReadyResolve=o}),t.openCanceller=new O(function(o,l){t.cancelOpen=l}))},pt.prototype.close=function(o){var i=(o===void 0?{disableAutoOpen:!0}:o).disableAutoOpen,o=this._state;i?(o.isBeingOpened&&o.cancelOpen(new fe.DatabaseClosed),this._close(),o.autoOpen=!1,o.dbOpenError=new fe.DatabaseClosed):(this._close(),o.autoOpen=this._options.autoOpen||o.isBeingOpened,o.openComplete=!1,o.dbOpenError=null)},pt.prototype.delete=function(t){var i=this;t===void 0&&(t={disableAutoOpen:!0});var o=0<arguments.length&&typeof arguments[0]!="object",l=this._state;return new O(function(c,g){function x(){i.close(t);var k=i._deps.indexedDB.deleteDatabase(i.name);k.onsuccess=Ue(function(){var I,N,F;I=i._deps,N=i.name,F=I.indexedDB,I=I.IDBKeyRange,Qr(F)||N===Q||Jr(F,I).delete(N).catch(Ie),c()}),k.onerror=cn(g),k.onblocked=i._fireOnBlocked}if(o)throw new fe.InvalidArgument("Invalid closeOptions argument to db.delete()");l.isBeingOpened?l.dbReadyPromise.then(x):x()})},pt.prototype.backendDB=function(){return this.idbdb},pt.prototype.isOpen=function(){return this.idbdb!==null},pt.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},pt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},pt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(pt.prototype,"tables",{get:function(){var t=this;return d(this._allTables).map(function(i){return t._allTables[i]})},enumerable:!1,configurable:!0}),pt.prototype.transaction=function(){var t=(function(i,o,l){var c=arguments.length;if(c<2)throw new fe.InvalidArgument("Too few arguments");for(var g=new Array(c-1);--c;)g[c-1]=arguments[c];return l=g.pop(),[i,Y(g),l]}).apply(this,arguments);return this._transaction.apply(this,t)},pt.prototype._transaction=function(t,i,o){var l=this,c=Se.trans;c&&c.db===this&&t.indexOf("!")===-1||(c=null);var g,x,k=t.indexOf("?")!==-1;t=t.replace("!","").replace("?","");try{if(x=i.map(function(N){if(N=N instanceof l.Table?N.name:N,typeof N!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return N}),t=="r"||t===Ee)g=Ee;else{if(t!="rw"&&t!=Oe)throw new fe.InvalidArgument("Invalid transaction mode: "+t);g=Oe}if(c){if(c.mode===Ee&&g===Oe){if(!k)throw new fe.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");c=null}c&&x.forEach(function(N){if(c&&c.storeNames.indexOf(N)===-1){if(!k)throw new fe.SubTransaction("Table "+N+" not included in parent transaction.");c=null}}),k&&c&&!c.active&&(c=null)}}catch(N){return c?c._promise(null,function(F,T){T(N)}):it(N)}var I=(function N(F,T,q,A,B){return O.resolve().then(function(){var V=Se.transless||Se,M=F._createTransaction(T,q,F._dbSchema,A);if(M.explicit=!0,V={trans:M,transless:V},A)M.idbtrans=A.idbtrans;else try{M.create(),M.idbtrans._explicit=!0,F._state.PR1398_maxLoop=3}catch(W){return W.name===Ae.InvalidState&&F.isOpen()&&0<--F._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),F.close({disableAutoOpen:!1}),F.open().then(function(){return N(F,T,q,null,B)})):it(W)}var K,X=we(B);return X&&un(),V=O.follow(function(){var W;(K=B.call(M,M))&&(X?(W=rn.bind(null,null),K.then(W,W)):typeof K.next=="function"&&typeof K.throw=="function"&&(K=si(K)))},V),(K&&typeof K.then=="function"?O.resolve(K).then(function(W){return M.active?W:it(new fe.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):V.then(function(){return K})).then(function(W){return A&&M._resolve(),M._completion.then(function(){return W})}).catch(function(W){return M._reject(W),it(W)})})}).bind(null,this,g,x,c,o);return c?c._promise(g,I,"lock"):Se.trans?ln(Se.transless,function(){return l._whenReady(I)}):this._whenReady(I)},pt.prototype.table=function(t){if(!S(this._allTables,t))throw new fe.InvalidTable("Table ".concat(t," does not exist"));return this._allTables[t]},pt);function pt(t,i){var o=this;this._middlewares={},this.verno=0;var l=pt.dependencies;this._options=i=r({addons:pt.addons,autoOpen:!0,indexedDB:l.indexedDB,IDBKeyRange:l.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},l=i.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var c,g,x,k,I,N={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Ie,dbReadyPromise:null,cancelOpen:Ie,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen};N.dbReadyPromise=new O(function(T){N.dbReadyResolve=T}),N.openCanceller=new O(function(T,q){N.cancelOpen=q}),this._state=N,this.name=t,this.on=zn(this,"populate","blocked","versionchange","close",{ready:[He,Ie]}),this.on.ready.subscribe=E(this.on.ready.subscribe,function(T){return function(q,A){pt.vip(function(){var B,V=o._state;V.openComplete?(V.dbOpenError||O.resolve().then(q),A&&T(q)):V.onReadyBeingFired?(V.onReadyBeingFired.push(q),A&&T(q)):(T(q),B=o,A||T(function M(){B.on.ready.unsubscribe(q),B.on.ready.unsubscribe(M)}))})}}),this.Collection=(c=this,Un(Qo.prototype,function(K,M){this.db=c;var A=et,B=null;if(M)try{A=M()}catch(X){B=X}var V=K._ctx,M=V.table,K=M.hook.reading.fire;this._ctx={table:M,index:V.index,isPrimKey:!V.index||M.schema.primKey.keyPath&&V.index===M.schema.primKey.name,range:A,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:B,or:V.or,valueMapper:K!==yt?K:null}})),this.Table=(g=this,Un(es.prototype,function(T,q,A){this.db=g,this._tx=A,this.name=T,this.schema=q,this.hook=g._allTables[T]?g._allTables[T].hook:zn(null,{creating:[Ye,Ie],reading:[mt,yt],updating:[Ce,Ie],deleting:[vt,Ie]})})),this.Transaction=(x=this,Un(ta.prototype,function(T,q,A,B,V){var M=this;this.db=x,this.mode=T,this.storeNames=q,this.schema=A,this.chromeTransactionDurability=B,this.idbtrans=null,this.on=zn(this,"complete","error","abort"),this.parent=V||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new O(function(K,X){M._resolve=K,M._reject=X}),this._completion.then(function(){M.active=!1,M.on.complete.fire()},function(K){var X=M.active;return M.active=!1,M.on.error.fire(K),M.parent?M.parent._reject(K):X&&M.idbtrans&&M.idbtrans.abort(),it(K)})})),this.Version=(k=this,Un(la.prototype,function(T){this.db=k,this._cfg={version:T,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(I=this,Un(ss.prototype,function(T,q,A){if(this.db=I,this._ctx={table:T,index:q===":id"?null:q,or:A},this._cmp=this._ascending=De,this._descending=function(B,V){return De(V,B)},this._max=function(B,V){return 0<De(B,V)?B:V},this._min=function(B,V){return De(B,V)<0?B:V},this._IDBKeyRange=I._deps.IDBKeyRange,!this._IDBKeyRange)throw new fe.MissingAPI})),this.on("versionchange",function(T){0<T.newVersion?console.warn("Another connection wants to upgrade database '".concat(o.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(o.name,"'. Closing db now to resume the delete request.")),o.close({disableAutoOpen:!1})}),this.on("blocked",function(T){!T.newVersion||T.newVersion<T.oldVersion?console.warn("Dexie.delete('".concat(o.name,"') was blocked")):console.warn("Upgrade '".concat(o.name,"' blocked by other connection holding version ").concat(T.oldVersion/10))}),this._maxKey=Yn(i.IDBKeyRange),this._createTransaction=function(T,q,A,B){return new o.Transaction(T,q,A,o._options.chromeTransactionDurability,B)},this._fireOnBlocked=function(T){o.on("blocked").fire(T),Ze.filter(function(q){return q.name===o.name&&q!==o&&!q._state.vcFired}).map(function(q){return q.on("versionchange").fire(T)})},this.use(fa),this.use(ma),this.use(ha),this.use(ca),this.use(da);var F=new Proxy(this,{get:function(T,q,A){if(q==="_vip")return!0;if(q==="table")return function(V){return wr(o.table(V),F)};var B=Reflect.get(T,q,A);return B instanceof es?wr(B,F):q==="tables"?B.map(function(V){return wr(V,F)}):q==="_createTransaction"?function(){return wr(B.apply(this,arguments),F)}:B}});this.vip=F,l.forEach(function(T){return T(o)})}var Sr,on=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",ba=(ui.prototype.subscribe=function(t,i,o){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:i,complete:o})},ui.prototype[on]=function(){return this},ui);function ui(t){this._subscribe=t}try{Sr={indexedDB:u.indexedDB||u.mozIndexedDB||u.webkitIndexedDB||u.msIndexedDB,IDBKeyRange:u.IDBKeyRange||u.webkitIDBKeyRange}}catch{Sr={indexedDB:null,IDBKeyRange:null}}function xs(t){var i,o=!1,l=new ba(function(c){var g=we(t),x,k=!1,I={},N={},F={get closed(){return k},unsubscribe:function(){k||(k=!0,x&&x.abort(),T&&Sn.storagemutated.unsubscribe(A))}};c.start&&c.start(F);var T=!1,q=function(){return Cn(B)},A=function(V){yr(I,V),ti(N,I)&&q()},B=function(){var V,M,K;!k&&Sr.indexedDB&&(I={},V={},x&&x.abort(),x=new AbortController,K=function(X){var W=ut();try{g&&un();var J=nn(t,X);return J=g?J.finally(rn):J}finally{W&&Xt()}}(M={subscr:V,signal:x.signal,requery:q,querier:t,trans:null}),Promise.resolve(K).then(function(X){o=!0,i=X,k||M.signal.aborted||(I={},function(W){for(var J in W)if(S(W,J))return;return 1}(N=V)||T||(Sn(Gn,A),T=!0),Cn(function(){return!k&&c.next&&c.next(X)}))},function(X){o=!1,["DatabaseClosedError","AbortError"].includes(X==null?void 0:X.name)||k||Cn(function(){k||c.error&&c.error(X)})}))};return setTimeout(q,0),F});return l.hasValue=function(){return o},l.getValue=function(){return i},l}var Rn=gn;function ci(t){var i=En;try{En=!0,Sn.storagemutated.fire(t),ii(t,!0)}finally{En=i}}b(Rn,r(r({},Le),{delete:function(t){return new Rn(t,{addons:[]}).delete()},exists:function(t){return new Rn(t,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return i=Rn.dependencies,o=i.indexedDB,i=i.IDBKeyRange,(Qr(o)?Promise.resolve(o.databases()).then(function(l){return l.map(function(c){return c.name}).filter(function(c){return c!==Q})}):Jr(o,i).toCollection().primaryKeys()).then(t)}catch{return it(new fe.MissingAPI)}var i,o},defineClass:function(){return function(t){h(this,t)}},ignoreTransaction:function(t){return Se.trans?ln(Se.transless,t):t()},vip:Zr,async:function(t){return function(){try{var i=si(t.apply(this,arguments));return i&&typeof i.then=="function"?i:O.resolve(i)}catch(o){return it(o)}}},spawn:function(t,i,o){try{var l=si(t.apply(o,i||[]));return l&&typeof l.then=="function"?l:O.resolve(l)}catch(c){return it(c)}},currentTransaction:{get:function(){return Se.trans||null}},waitFor:function(t,i){return i=O.resolve(typeof t=="function"?Rn.ignoreTransaction(t):t).timeout(i||6e4),Se.trans?Se.trans.waitFor(i):i},Promise:O,debug:{get:function(){return We},set:function(t){lt(t)}},derive:j,extend:h,props:b,override:E,Events:zn,on:Sn,liveQuery:xs,extendObservabilitySet:yr,getByKeyPath:L,setByKeyPath:z,delByKeyPath:function(t,i){typeof i=="string"?z(t,i,void 0):"length"in i&&[].map.call(i,function(o){z(t,o,void 0)})},shallowClone:ie,deepClone:w,getObjectDiff:oi,cmp:De,asap:D,minKey:-1/0,addons:[],connections:Ze,errnames:Ae,dependencies:Sr,cache:_n,semVer:"4.0.11",version:"4.0.11".split(".").map(function(t){return parseInt(t)}).reduce(function(t,i,o){return t+i/Math.pow(10,2*o)})})),Rn.maxKey=Yn(Rn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Sn(Gn,function(t){En||(t=new CustomEvent(Kr,{detail:t}),En=!0,dispatchEvent(t),En=!1)}),addEventListener(Kr,function(t){t=t.detail,En||ci(t)}));var Bn,En=!1,ws=function(){};return typeof BroadcastChannel<"u"&&((ws=function(){(Bn=new BroadcastChannel(Kr)).onmessage=function(t){return t.data&&ci(t.data)}})(),typeof Bn.unref=="function"&&Bn.unref(),Sn(Gn,function(t){En||Bn.postMessage(t)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(t){if(!gn.disableBfCache&&t.persisted){We&&console.debug("Dexie: handling persisted pagehide"),Bn!=null&&Bn.close();for(var i=0,o=Ze;i<o.length;i++)o[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(t){!gn.disableBfCache&&t.persisted&&(We&&console.debug("Dexie: handling persisted pageshow"),ws(),ci({all:new jt(-1/0,[[]])}))})),O.rejectionMapper=function(t,i){return!t||t instanceof pe||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Fe[t.name]?t:(i=new Fe[t.name](i||t.message,t),"stack"in t&&C(i,"stack",{get:function(){return this.inner.stack}}),i)},lt(We),r(gn,Object.freeze({__proto__:null,Dexie:gn,liveQuery:xs,Entity:wt,cmp:De,PropModification:Xn,replacePrefix:function(t,i){return new Xn({replacePrefix:[t,i]})},add:function(t){return new Xn({add:t})},remove:function(t){return new Xn({remove:t})},default:gn,RangeSet:jt,mergeRanges:Zn,rangesOverlap:cs}),{default:gn}),gn})}(Or)),Or.exports}var hd=fd();const Xi=Wi(hd),Co=Symbol.for("Dexie"),Lr=globalThis[Co]||(globalThis[Co]=Xi);if(Xi.semVer!==Lr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Xi.semVer} and ${Lr.semVer}`);const{liveQuery:pd,mergeRanges:jd,rangesOverlap:Ld,RangeSet:Bd,cmp:Fd,Entity:$d,PropModification:Hd,replacePrefix:Dd,add:Vd,remove:qd}=Lr;class gd extends Lr{constructor(){super("CopyHistoryDatabase");ce(this,"copyHistoryItems");this.version(1).stores({copyHistoryItems:"++index,id,timestamp"}),this.version(2).stores({copyHistoryItems:"++index,id,timestamp"}).upgrade(n=>n.table("copyHistoryItems").toCollection().modify(r=>{const a={text:r.text,textImage:r.textImage,start:r.start,end:r.end,originalStart:r.originalStart,originalEnd:r.originalEnd,track:r.track};if(r.subtitle=a,delete r.text,delete r.textImage,delete r.start,delete r.end,delete r.originalStart,delete r.originalEnd,delete r.track,r.videoFileName||r.audioFileName){const u={name:r.videoFileName||r.audioFileName,blobUrl:"",playbackRate:r.filePlaybackRate,audioTrack:r.audioTrack};r.file=u,delete r.videoFileName,delete r.audioFileName,delete r.filePlaybackRate,delete r.audioTrack}}))}}class md{constructor(e){ce(this,"_db",new gd);ce(this,"_limit");this._limit=e}set limit(e){this._limit=e}async clear(){await this._db.copyHistoryItems.clear()}async fetch(e){if(e<=0)return[];const n=await await this._db.copyHistoryItems.reverse().limit(e).toArray();return n.reverse(),n}liveFetch(e,n){const a=pd(()=>this.fetch(e)).subscribe(n);return()=>a.unsubscribe()}async save(e){if(this._limit<=0)return;const n={id:e.id,timestamp:e.timestamp,subtitle:e.subtitle,surroundingSubtitles:e.surroundingSubtitles,subtitleFileName:e.subtitleFileName,url:e.url,image:e.image,audio:e.audio,file:e.file,mediaTimestamp:e.mediaTimestamp},r=await this._db.copyHistoryItems.where("id").equals(e.id).primaryKeys();r.length>0&&(n.index=r[0]);const a=await this._db.copyHistoryItems.put(n);await this._prune(a)}async _prune(e){if(await this._db.copyHistoryItems.count()>this._limit){const r=await this._db.copyHistoryItems.where("index").belowOrEqual(e-this._limit).primaryKeys();r.length>0&&await this._db.copyHistoryItems.bulkDelete(r)}}async delete(e){const n=await this._db.copyHistoryItems.where("id").equals(e).primaryKeys();await this._db.copyHistoryItems.bulkDelete(n)}}const bd=async()=>{const s=await(await fetch(Ut.runtime.getURL("/pgs-parser-worker.js"))).text(),e=new Blob([s],{type:"application/javascript"});return new Worker(URL.createObjectURL(e))},yd=(s,e)=>s.id===e.id&&s.src===e.src&&s.synced===e.synced&&s.syncedTimestamp===e.syncedTimestamp,vd=[],xd=new cd;function wd({settings:s,extension:e}){const{t:n}=hn(),r=y.useMemo(()=>new Fl(s,e),[s,e]),a=y.useMemo(()=>new Au({regexFilter:s.subtitleRegexFilter,regexFilterTextReplacement:s.subtitleRegexFilterTextReplacement,subtitleHtml:s.subtitleHtml,pgsParserWorkerFactory:bd}),[s]),[u,d]=y.useState(),[f,h]=y.useState(),[p,m]=y.useState(!0),[S,b]=y.useState(),[R,C]=y.useState(!1),[j,U]=y.useState(),[_,H]=y.useState(!0),[E,G]=y.useState(),[D,L]=y.useState(!1),[z,ie]=y.useState(!1),ge=ud(s.keyBindSet,e),Y=Hc(),Z=Dc({extension:e,currentTabId:Y});y.useEffect(()=>{e.loadedSubtitles=u!==void 0&&u.length>0,e.startHeartbeat()},[e,u]),y.useEffect(()=>{m((u==null?void 0:u.some(Ce=>Ce.text!==""))??!1)},[u]),y.useEffect(()=>{if(Y!==void 0)return e.subscribeTabs(async Ce=>{const Ne=Ce.filter(He=>He.id===Y);if(Ne.length>0){let He;for(const We of Ne)We.synced&&(He===void 0||We.syncedTimestamp>He.syncedTimestamp)&&(He=We);if(He!==void 0&&(E===void 0||!yd(He,E))){const We={sender:"asbplayer-extension-to-video",message:{command:"request-subtitles"},src:He.src},lt=await Ut.tabs.sendMessage(He.id,We);if(lt!==void 0){const Pt=lt.subtitles,Kt=Pt.length>0?Pt[Pt.length-1].end:0;G(He),d(Pt.map((Tt,bt)=>({...Tt,index:bt,displayTime:sr(Tt.start,Kt)}))),h(lt.subtitleFileNames)}}}H(!1)})},[e,u,_,Y,E]),y.useEffect(()=>e.subscribe(Ce=>{Ce.data.command==="close-side-panel"&&window.close()}),[e]),y.useEffect(()=>{if(!(Y===void 0||E===void 0))return e.subscribeTabs(Ce=>{Ce.find(He=>He.id===E.id&&He.src===E.src&&He.synced)!==void 0||(d(void 0),G(void 0))})},[e,Y,E]),y.useEffect(()=>{if(Y===void 0){ie(!1);return}return e.subscribeTabs(()=>{var Ne;const Ce=(Ne=e.asbplayers)==null?void 0:Ne.find(He=>He.tabId===Y);ie(Ce!==void 0)})},[Y,e]),y.useEffect(()=>e.subscribe(Ce=>{Ce.data.command==="recording-started"?L(!0):Ce.data.command==="recording-finished"&&L(!1)}),[e]),y.useEffect(()=>ge.bindToggleSidePanel(()=>window.close(),()=>!1),[ge]);const ee=y.useCallback(Ce=>{console.error(Ce),U("error"),Ce instanceof Vl?b(n(Ce.locKey,Ce.locParams)??"<failed to localize error>"):Ce instanceof Error?b(Ce.message):b(typeof Ce=="string"?Ce:String(Ce)),C(!0)},[n]),w=y.useCallback(()=>C(!1),[]),P=y.useCallback(()=>{if(E===void 0)return;const Ce={sender:"asbplayerv2",message:{command:"copy-subtitle",postMineAction:s.clickToMineDefaultAction},tabId:E.id,src:E.src};Ut.runtime.sendMessage(Ce)},[E,s.clickToMineDefaultAction]),re=y.useCallback(()=>{if(Y===void 0)return;const Ce={sender:"asbplayerv2",message:{command:"load-subtitles"},tabId:Y};Ut.runtime.sendMessage(Ce)},[Y]),ae=y.useCallback(()=>{if(u){const Ce=f!==void 0&&f.length>0?`${f[0]}.srt`:"subtitles.srt";tl(new Blob([a.subtitlesToSrt(u)],{type:"text/plain"}),Ce)}},[u,f,a]),Te=y.useRef(null),[te,ye]=y.useState(!1),xe=y.useCallback(Ce=>{var lt;const Ne=(lt=Te.current)==null?void 0:lt.getBoundingClientRect();if(!Ne)return;const He=Math.min(Math.abs(Ce.clientX-Ne.left),Math.abs(Ce.clientX-Ne.left-Ne.width)),We=Math.min(Math.abs(Ce.clientY-Ne.top),Math.abs(Ce.clientY-Ne.top-Ne.height));!te&&He<100&&We<100?ye(!0):te&&(He>=100||We>=100)&&ye(!1)},[te]),we=y.useMemo(()=>new md(s.miningHistoryStorageLimit),[s.miningHistoryStorageLimit]),{copyHistoryItems:se,refreshCopyHistory:pe,deleteCopyHistoryItem:_e,deleteAllCopyHistoryItems:Pe}=Dl(s.miningHistoryStorageLimit,we);y.useEffect(()=>{z&&pe()},[pe,z]);const[je,Ae]=y.useState(!1),Re=y.useCallback(async()=>{await pe(),Ae(!0)},[pe]),fe=y.useCallback(()=>Ae(!1),[]),Fe=y.useCallback(async Ce=>{if(z){if(Y){const Ne={sender:"asbplayer-extension-to-player",message:{command:"download-audio",...Ce}};Ut.tabs.sendMessage(Y,Ne)}}else{const Ne=No.fromCard(Ce,s.audioPaddingStart,s.audioPaddingEnd,!1);if(Ne)if(s.preferMp3){const He=await ml();Ne.toMp3(()=>He).download()}else Ne.download()}},[s,Y,z]),Le=y.useCallback(Ce=>{if(z){if(Y){const Ne={sender:"asbplayer-extension-to-player",message:{command:"download-image",...Ce}};Ut.tabs.sendMessage(Y,Ne)}}else{const Ne=Ao.fromCard(Ce,s.maxImageWidth,s.maxImageHeight);Ne&&Ne.download()}},[s,Y,z]),Ie=y.useCallback(Ce=>{if(!Y||!z)return;const Ne={sender:"asbplayer-extension-to-player",message:{command:"jump-to-subtitle",subtitle:Ce.subtitle,subtitleFileName:Ce.subtitleFileName}};Ut.tabs.sendMessage(Y,Ne)},[Y,z]),yt=y.useCallback(Ce=>{if(Y===void 0)return;const Ne={...Ce,command:"show-anki-ui"},He={sender:"asbplayer-extension-to-video",message:Ne},We={sender:"asbplayer-extension-to-player",message:Ne};Ut.tabs.sendMessage(Y,He),Ut.tabs.sendMessage(Y,We)},[Y]),mt=y.useRef(D);mt.current=D;const Me=y.useCallback(Ce=>{if(E===void 0||mt.current||Y!==E.id)return;const Ne={sender:"asbplayerv2",message:{command:"copy-subtitle",subtitle:Ce.subtitle,surroundingSubtitles:Ce.surroundingSubtitles,postMineAction:s.clickToMineDefaultAction},tabId:E.id,src:E.src};Ut.runtime.sendMessage(Ne)},[E,s.clickToMineDefaultAction,Y]),Ye=y.useCallback(()=>{},[]),{initialized:vt}=Na({language:s.language});return vt?_||Y===void 0||Z===void 0?v.jsx(Oo,{children:v.jsx(Di,{children:v.jsx(Oa,{color:"primary"})})}):v.jsxs("div",{style:{width:"100%",height:"100%"},onMouseMove:xe,children:[v.jsx(Nc,{open:R,onClose:w,autoHideDuration:3e3,severity:j,children:S}),z?v.jsx(Jo,{open:!0,items:se,forceShowDownloadOptions:!0,onClose:fe,onDelete:_e,onDeleteAll:Pe,onAnki:yt,onClipAudio:Fe,onDownloadImage:Le,onSelect:Ie}):v.jsxs(v.Fragment,{children:[v.jsx(ld,{open:je,items:se,onClose:fe,onDelete:_e,onDeleteAll:Pe,onAnki:yt,onClipAudio:Fe,onDownloadImage:Le}),u===void 0?v.jsx($c,{extension:e,videoElementCount:Z,onLoadSubtitles:re,onShowMiningHistory:Re}):v.jsxs(v.Fragment,{children:[v.jsx(Kc,{show:D}),v.jsx(vc,{origin:Ut.runtime.getURL("/sidepanel.html"),subtitles:u,hideControls:!0,showCopyButton:!0,forceCompressedMode:!0,subtitleReader:a,settings:s,playbackPreferences:r,onCopy:Me,onError:ee,onUnloadVideo:Ye,onLoaded:Ye,onTabSelected:Ye,onAnkiDialogRequest:Ye,onAnkiDialogRewind:Ye,onAppBarToggle:Ye,onHideSubtitlePlayer:Ye,onVideoPopOut:Ye,onPlayModeChangedViaBind:Ye,onSubtitles:d,tab:E,availableTabs:vd,extension:e,drawerOpen:!1,appBarHidden:!0,videoFullscreen:!1,hideSubtitlePlayer:!1,videoPopOut:!1,disableKeyEvents:!1,miningContext:xd,keyBinder:ge}),v.jsx(zc,{ref:Te,show:te,onLoadSubtitles:re,canDownloadSubtitles:p,onDownloadSubtitles:ae,onShowMiningHistory:Re}),v.jsx(Vc,{disabled:Y!==(E==null?void 0:E.id),onMineSubtitle:P,postMineAction:s.clickToMineDefaultAction,emptySubtitleTrack:u.length===0,audioRecordingEnabled:s.streamingRecordMedia,recordingAudio:D})]})]})]}):null}const _o=new Ma(new ja),Sd=()=>{const[s,e]=y.useState(),n=Hl({component:"sidePanel"}),r=y.useMemo(()=>s&&La(s.themeType),[s]);return y.useEffect(()=>{_o.getAll().then(e)},[]),y.useEffect(()=>n.subscribe(a=>{a.data.command==="settings-updated"&&_o.getAll().then(e)}),[n]),!s||r===void 0?null:v.jsx(gl,{injectFirst:!0,children:v.jsxs(Ba,{theme:r,children:[v.jsx(Fa,{}),v.jsx(On,{square:!0,style:{width:"100%",height:"100%"},children:v.jsx(wd,{settings:s,extension:n})})]})})};function Ed(s){$a.createRoot(s).render(v.jsx(Sd,{}))}window.addEventListener("load",()=>{const s=document.getElementById("root");Ed(s)});
