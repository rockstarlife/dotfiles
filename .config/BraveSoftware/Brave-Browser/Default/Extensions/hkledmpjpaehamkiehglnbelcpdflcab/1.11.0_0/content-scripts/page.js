var page=function(){"use strict";var A=Object.defineProperty;var F=(l,a,i)=>a in l?A(l,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[a]=i;var r=(l,a,i)=>F(l,typeof a!="symbol"?a+"":a,i);var b,v;function l(s){return s}const i=(v=(b=globalThis.browser)==null?void 0:b.runtime)!=null&&v.id?globalThis.browser:globalThis.chrome,E={pages:[{host:"www\\.netflix\\.com",script:"netflix-page.js",path:"watch",autoSync:{enabled:!0}},{host:"(m|www)\\.youtube\\.com",script:"youtube-page.js",path:"watch|shorts|embed",autoSync:{enabled:!0}},{host:"tver\\.jp",script:"tver-page.js",path:"episodes",autoSync:{enabled:!0}},{host:"www\\.b-ch\\.com",script:"bandai-channel-page.js",path:"titles",autoSync:{enabled:!0}},{host:"www\\.amazon\\..+|www\\.primevideo\\.com",script:"amazon-prime-page.js",path:".*",autoSync:{enabled:!0,videoSrc:"^blob:.+"},ignore:{class:"tst-video-overlay-player-html5",style:{display:"none"}}},{host:"www\\.hulu\\..+",script:"hulu-page.js",path:"watch",autoSync:{enabled:!0,elementId:"content-video-player"}},{host:"www\\.disneyplus\\..+",script:"disney-plus-page.js",path:"video|play",searchShadowRoots:!0,autoSync:{enabled:!0}},{host:"www\\.apps\\.disneyplus\\..+",script:"apps-disney-plus-page.js",path:"watch",searchShadowRoots:!0,autoSync:{enabled:!0}},{host:"video.unext.jp",script:"unext-page.js",path:"play",autoSync:{enabled:!1}},{host:".+\\.viki\\.(io|com)",script:"viki-page.js",path:"videos",autoSync:{enabled:!0}},{host:"(jellyfin.*)|(emby.*)|(:8096$)",script:"emby-jellyfin-page.js",hash:"#!/videoosd/videoosd.html|#/video",autoSync:{enabled:!0}},{host:"www.twitch.tv",allowBlankSrc:!0},{host:"osnplus.com",script:"osnplus-page.js",path:"watch",autoSync:{enabled:!0}},{host:"www.bilibili.tv",script:"bilibili-page.js",path:"play|video",autoSync:{enabled:!0}},{host:"tv.nrk.no",script:"nrk-tv-page.js",path:".*",autoSync:{enabled:!0}},{host:"(plex.*)|(:32400$)",script:"plex-page.js",path:".*",autoSync:{enabled:!0}},{host:"areena.yle.fi",script:"areena-yle-page.js",path:".*",autoSync:{enabled:!0}},{host:"play.max.com",script:"hbo-max-page.js",path:"watch",autoSync:{enabled:!0}}]},I=()=>window.location.href.startsWith(i.runtime.getURL("/ftue-ui.html"));function j(){const s=new URL(window.location.href);for(const t of E.pages)if(new RegExp(t.host).test(s.host))return new m(t,s);if(I())return new m({host:window.location.host,script:"asbplayer-tutorial-page.js",path:".*",autoSync:{enabled:!1}},s)}class m{constructor(t,e){r(this,"config");r(this,"url");this.config=t,this.url=e}loadScripts(){if(this.config.script===void 0)return;const t=document.createElement("script");t.src=i.runtime.getURL(`${this.config.script}`),t.onload=()=>t.remove(),(document.head||document.documentElement).appendChild(t)}shouldIgnore(t){if(this.config.ignore===void 0)return!1;if(this.config.ignore.class!==void 0&&t.classList.contains(this.config.ignore.class))return!0;if(this.config.ignore.style!==void 0){for(const e of Object.keys(this.config.ignore.style))if(t.style[e]===this.config.ignore.style[e])return!0}return!1}canAutoSync(t){return this.config.autoSync!==void 0&&this.config.autoSync.enabled&&(this.config.autoSync.elementId===void 0||t.id===this.config.autoSync.elementId)&&(this.config.autoSync.videoSrc===void 0||new RegExp(this.config.autoSync.videoSrc).test(t.src))}isVideoPage(){var t=!0,e=!0;return this.config.hash&&(t=new RegExp(this.config.hash).test(this.url.hash)),this.config.path&&(e=new RegExp(this.config.path).test(this.url.pathname)),t&&e}}const T={matches:["<all_urls>"],excludeGlobs:["*://killergerbah.github.io/asbplayer*","*://app.asbplayer.dev/*"],allFrames:!0,runAt:"document_start",main(s){var t;(t=j())==null||t.loadScripts()}};function h(s,...t){}const x={debug:(...s)=>h(console.debug,...s),log:(...s)=>h(console.log,...s),warn:(...s)=>h(console.warn,...s),error:(...s)=>h(console.error,...s)},p=class p extends Event{constructor(t,e){super(p.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=e}};r(p,"EVENT_NAME",w("wxt:locationchange"));let g=p;function w(s){var t;return`${(t=i==null?void 0:i.runtime)==null?void 0:t.id}:page:${s}`}function R(s){let t,e;return{run(){t==null&&(e=new URL(location.href),t=s.setInterval(()=>{let n=new URL(location.href);n.href!==e.href&&(window.dispatchEvent(new g(n,e)),e=n)},1e3))}}}const d=class d{constructor(t,e){r(this,"isTopFrame",window.self===window.top);r(this,"abortController");r(this,"locationWatcher",R(this));r(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=e,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return i.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,e){const n=setInterval(()=>{this.isValid&&t()},e);return this.onInvalidated(()=>clearInterval(n)),n}setTimeout(t,e){const n=setTimeout(()=>{this.isValid&&t()},e);return this.onInvalidated(()=>clearTimeout(n)),n}requestAnimationFrame(t){const e=requestAnimationFrame((...n)=>{this.isValid&&t(...n)});return this.onInvalidated(()=>cancelAnimationFrame(e)),e}requestIdleCallback(t,e){const n=requestIdleCallback((...o)=>{this.signal.aborted||t(...o)},e);return this.onInvalidated(()=>cancelIdleCallback(n)),n}addEventListener(t,e,n,o){var c;e==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(c=t.addEventListener)==null||c.call(t,e.startsWith("wxt:")?w(e):e,n,{...o,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),x.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:d.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var c,S,y;const e=((c=t.data)==null?void 0:c.type)===d.SCRIPT_STARTED_MESSAGE_TYPE,n=((S=t.data)==null?void 0:S.contentScriptName)===this.contentScriptName,o=!this.receivedMessageIds.has((y=t.data)==null?void 0:y.messageId);return e&&n&&o}listenForNewerScripts(t){let e=!0;const n=o=>{if(this.verifyScriptStartedEvent(o)){this.receivedMessageIds.add(o.data.messageId);const c=e;if(e=!1,c&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",n),this.onInvalidated(()=>removeEventListener("message",n))}};r(d,"SCRIPT_STARTED_MESSAGE_TYPE",w("wxt:content-script-started"));let f=d;function P(){}function u(s,...t){}const N={debug:(...s)=>u(console.debug,...s),log:(...s)=>u(console.log,...s),warn:(...s)=>u(console.warn,...s),error:(...s)=>u(console.error,...s)};return(async()=>{try{const{main:s,...t}=T,e=new f("page",t);return await s(e)}catch(s){throw N.error('The content script "page" crashed on startup!',s),s}})()}();
page;
