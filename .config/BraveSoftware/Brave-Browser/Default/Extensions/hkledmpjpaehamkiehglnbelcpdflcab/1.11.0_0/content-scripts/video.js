var video=function(){"use strict";var mc=Object.defineProperty;var yc=(Ke,Ie,W)=>Ie in Ke?mc(Ke,Ie,{enumerable:!0,configurable:!0,writable:!0,value:W}):Ke[Ie]=W;var A=(Ke,Ie,W)=>yc(Ke,typeof Ie!="symbol"?Ie+"":Ie,W);var ga,ma,ya,va,ba,Sa,wa,_a;function Ke(i){return i}const W=(ma=(ga=globalThis.browser)==null?void 0:ga.runtime)!=null&&ma.id?globalThis.browser:globalThis.chrome,La=(i,e,t,r)=>new Promise((n,s)=>{const a=t<=0?1:t/i.width,o=r<=0?1:r/i.height,u=Math.min(1,Math.min(a,o));if(u<1){const v=i.width*u,h=i.height*u;createImageBitmap(i,{resizeWidth:v,resizeHeight:h,resizeQuality:"high"}).then(f=>{i.width=v,i.height=h,e.drawImage(f,0,0),n(i)}).catch(f=>s(f))}else n(i)}),ti=async(i,e,t,r)=>new Promise((n,s)=>{const a=new Image;a.onload=async()=>{const o=document.createElement("canvas"),u=window.devicePixelRatio,v=t.width*u,h=t.height*u;o.width=v,o.height=h;const f=o.getContext("2d");if(f.drawImage(a,t.left*u,t.top*u,v,h,0,0,v,h),i>0||e>0)try{await La(o,f,i,e),n(o.toDataURL("image/jpeg"))}catch(l){console.error("Failed to crop and resize image: "+l),s(l)}else n(o.toDataURL("image/jpeg"))},a.src=r});var St=(i=>(i[i.miningCommand=1]="miningCommand",i[i.failedToAutoLoadPreferredTrack=2]="failedToAutoLoadPreferredTrack",i[i.userRequested=3]="userRequested",i))(St||{}),ar=(i=>(i[i.none=0]="none",i[i.showAnkiDialog=1]="showAnkiDialog",i[i.updateLastCard=2]="updateLastCard",i[i.exportCard=3]="exportCard",i))(ar||{}),Ee=(i=>(i[i.remember=0]="remember",i[i.play=1]="play",i[i.pause=2]="pause",i))(Ee||{}),st=(i=>(i[i.atStart=1]="atStart",i[i.atEnd=2]="atEnd",i))(st||{}),or=(i=>(i[i.remove=0]="remove",i[i.render=1]="render",i))(or||{}),te=(i=>(i[i.normal=1]="normal",i[i.condensed=2]="condensed",i[i.autoPause=3]="autoPause",i[i.fastForward=4]="fastForward",i[i.repeat=5]="repeat",i))(te||{}),lr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ia(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),t}var ur,ri;function Na(){if(ri)return ur;ri=1;function i(t){return t>=55296&&t<=56319}function e(t){return t>=56320&&t<=57343}return ur=function(r,n,s){if(typeof n!="string")throw new Error("Input must be string");for(var a=n.length,o=0,u,v,h=0;h<a;h+=1){if(u=n.charCodeAt(h),v=n[h],i(u)&&e(n.charCodeAt(h+1))&&(h+=1,v+=n[h]),o+=r(v),o===s)return n.slice(0,h+1);if(o>s)return n.slice(0,h-v.length+1)}return n},ur}var cr,ni;function Ma(){if(ni)return cr;ni=1;function i(t){return t>=55296&&t<=56319}function e(t){return t>=56320&&t<=57343}return cr=function(r){if(typeof r!="string")throw new Error("Input must be string");for(var n=r.length,s=0,a=null,o=null,u=0;u<n;u++)a=r.charCodeAt(u),e(a)?o!=null&&i(o)?s+=1:s+=3:a<=127?s+=1:a>=128&&a<=2047?s+=2:a>=2048&&a<=65535&&(s+=3),o=a;return s},cr}var fr,ii;function $a(){if(ii)return fr;ii=1;var i=Na(),e=Ma();return fr=i.bind(null,e),fr}var dr,si;function Ba(){if(si)return dr;si=1;var i=$a(),e=/[\/\?<>\\:\*\|"]/g,t=/[\x00-\x1f\x80-\x9f]/g,r=/^\.+$/,n=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,s=/[\. ]+$/;function a(o,u){if(typeof o!="string")throw new Error("Input must be string");var v=o.replace(e,u).replace(t,u).replace(r,u).replace(n,u).replace(s,u);return i(v,255)}return dr=function(o,u){var v=u&&u.replacement||"",h=a(o,v);return v===""?h:a(h,"")},dr}Ba();function Ua(i,e=!1){const t=Math.floor(i/1e3);let r;e?r=Math.round(i/1e3%60*10)/10:r=t%60;const n=Math.floor(t/60)%60,s=Math.floor(t/3600);return s>0?s+"h"+String(n).padStart(2,"0")+"m"+String(r).padStart(2,"0")+"s":n+"m"+String(r).padStart(2,"0")+"s"}function ja(i,e,t,r){let n=e;for(let a=e;a>=0&&(n=a,!oi(i,n,e,t,r,1));--a);let s=n;for(let a=e;a<=i.length-1&&(s=a,!oi(i,s,e,t,r,0));++a);return i.slice(n,s+1)}function ai(i,e,t){if(t===0){for(let r=0;r<i.length;++r)if(i[r].start>=e)return r}else for(let r=i.length-1;r>=0;--r)if(i[r].start<=e)return r}function Da(i,e,t,r,n){if(i.length===0)return{};let s=0;const a=ai(i,e,0)??i.length-1;for(let v=0;v<i.length&&(s=v,!li(i,v,r,n,e,a));++v);let o=i.length-1;const u=ai(i,t,1)??0;for(let v=i.length-1;v>=0&&(o=v,!li(i,v,r,n,t,u));--v);return o<=s?{}:{surroundingSubtitles:i.slice(s,o+1),subtitle:i[a]}}function oi(i,e,t,r,n,s){let a;return s==0?a=e+1<i.length?i[e+1]:null:a=e-1>=0?i[e-1]:null,Math.abs(t-e)>=r&&(a===null||Math.abs(a.start-i[t].start)>=n)}function li(i,e,t,r,n,s){const a=i[e];return Math.abs(s-e)<=t||Math.abs(a.start-n)<=r}function Va(i,e){const t=Math.max(0,i.end-i.start);if(t===0)return!1;const r=Math.max(i.start,e[0]);return Math.min(i.end,e[1])-r>=t/2}function Ha(i){return i.filter(e=>e.text.trim()!=="").map(e=>e.text).join(`
`)}function za(i,e,t){if(e.length===0)return i.text;const r=[i.start,i.end];return Ha(e.filter(n=>Va(n,r)).filter(n=>t===void 0))}function qa({subtitleColor:i,subtitleSize:e,subtitleThickness:t,subtitleOutlineThickness:r,subtitleOutlineColor:n,subtitleShadowThickness:s,subtitleShadowColor:a,subtitleBackgroundOpacity:o,subtitleBackgroundColor:u,subtitleFontFamily:v,subtitleCustomStyles:h}){const f={color:i,fontSize:`${e}px`,fontWeight:String(t)};if(r>0){const l=r,d=n;f.WebkitTextStroke=`${d} ${l}px`,f.paintOrder="stroke fill"}if(s>0&&(f.textShadow=`0 0 ${s}px ${a}, 0 0 ${s}px ${a}, 0 0 ${s}px ${a}, 0 0 ${s}px ${a}`),o>0){const l=o,d=u,{r:m,g:c,b:g}=Za(d);f.backgroundColor=`rgba(${m}, ${c}, ${g}, ${l})`}v&&v.length>0&&(f.fontFamily=`'${v}'`);for(const l of h){let d;l.key.startsWith("webkit")||l.key.startsWith("moz")||l.key.startsWith("ms")||/^o[A-Z].*/.test(l.key)?d=l.key.charAt(0).toUpperCase()+l.key.slice(1):d=l.key,Wa(d)||(f[d]=l.value)}return f}function Wa(i){return!isNaN(Number(i))}function Ga(i){const e=i.replace(/[A-Z]+(?![a-z])|[A-Z]/g,(t,r)=>(r?"-":"")+t.toLowerCase());return e.startsWith("webkit-")||e.startsWith("moz-")||e.startsWith("ms-")||e.startsWith("o-")?`-${e}`:e}function Ka(i){const e=qa(i),t=[];for(const[r,n]of Object.entries(e))t.push(`${Ga(r)}: ${n} !important`);return t.join(";")}function Za(i){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:255,g:255,b:255}}function hr(i,e){return e===0?i:`${i} (${Ua(e)})`}function Ja(i,e){return i.currentTime=e,i.currentTime<e&&(i.currentTime=Math.min(i.duration,i.currentTime+.01)),i.currentTime}var pr=(i=>(i[i.noActiveTabPermission=1]="noActiveTabPermission",i[i.drmProtected=2]="drmProtected",i[i.other=3]="other",i))(pr||{}),gr=(i=>(i[i.timedAudioRecordingInProgress=1]="timedAudioRecordingInProgress",i[i.other=2]="other",i))(gr||{});class Xa{constructor(){A(this,"lastStartedShowing");A(this,"lastWillStopShowing");A(this,"onStartedShowing");A(this,"onWillStopShowing");A(this,"onNextToShow")}willStopShowing(e){var t,r;e.end!==((t=this.lastWillStopShowing)==null?void 0:t.end)&&((r=this.onWillStopShowing)==null||r.call(this,e),this.lastWillStopShowing=e)}startedShowing(e){var t,r;e.start!==((t=this.lastStartedShowing)==null?void 0:t.start)&&((r=this.onStartedShowing)==null||r.call(this),this.lastStartedShowing=e)}clear(){this.lastStartedShowing=void 0,this.lastWillStopShowing=void 0}}class Ya{constructor(){A(this,"offscreenElement");A(this,"_cachedContentElements",{});A(this,"_empty",!0)}get empty(){return this._empty}clear(){var e;(e=this.offscreenElement)==null||e.remove(),this.offscreenElement=void 0,this._cachedContentElements={},this._empty=!0}add(e,t){const r=document.createElement("div");r.innerHTML=`${t}
`,this._cachedContentElements[e]=r,this._offscreenElement().appendChild(r),this._empty=!1}return(e){this._offscreenElement().appendChild(e)}get(e,t){let r=this._cachedContentElements[e];if(!r){if(t===void 0)throw new Error(`Cached html not found for key ${e}`);r=document.createElement("div"),r.innerHTML=t(),this._cachedContentElements[e]=r,this._offscreenElement().appendChild(r)}return r}_offscreenElement(){if(this.offscreenElement)return this.offscreenElement;const e=document.createElement("div");return e.className="asbplayer-offscreen",document.body.append(e),this.offscreenElement=e,e}}class mr{static async encode(e,t){return new Promise(async(r,n)=>{var s=new FileReader;s.onload=async a=>{try{const o=new AudioContext;if(a.target===null){n(new Error("Could not obtain buffer to encode"));return}const u=await o.decodeAudioData(a.target.result),v=[];for(let l=0;l<u.numberOfChannels;++l)v.push(u.getChannelData(l));const h=t(),f=h instanceof Worker?h:await h;f.postMessage({command:"encode",audioBuffer:{channels:v,numberOfChannels:u.numberOfChannels,length:u.length,sampleRate:u.sampleRate}}),f.onmessage=l=>{r(new Blob(l.data.buffer,{type:"audio/mp3"})),f.terminate()},f.onerror=l=>{const d=(l==null?void 0:l.error)??new Error("MP3 encoding failed: "+(l==null?void 0:l.message));n(d),f.terminate()}}catch(o){n(o)}},s.readAsArrayBuffer(e)})}}var yr=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function vr(i,e,t,r){i.addEventListener?i.addEventListener(e,t,r):i.attachEvent&&i.attachEvent("on".concat(e),function(){t(window.event)})}function ui(i,e){for(var t=e.slice(0,e.length-1),r=0;r<t.length;r++)t[r]=i[t[r].toLowerCase()];return t}function ci(i){typeof i!="string"&&(i=""),i=i.replace(/\s/g,"");for(var e=i.split(","),t=e.lastIndexOf("");t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function Qa(i,e){for(var t=i.length>=e.length?i:e,r=i.length>=e.length?e:i,n=!0,s=0;s<t.length;s++)r.indexOf(t[s])===-1&&(n=!1);return n}for(var at={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":yr?173:189,"=":yr?61:187,";":yr?59:186,"'":222,"[":219,"]":221,"\\":220},xe={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},br={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},fe={16:!1,18:!1,17:!1,91:!1},ce={},wt=1;wt<20;wt++)at["f".concat(wt)]=111+wt;var ae=[],fi=!1,di="all",hi=[],_t=function(e){return at[e.toLowerCase()]||xe[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)},eo=function(e){return Object.keys(at).find(function(t){return at[t]===e})},to=function(e){return Object.keys(xe).find(function(t){return xe[t]===e})};function pi(i){di=i||"all"}function ot(){return di||"all"}function ro(){return ae.slice(0)}function no(){return ae.map(function(i){return eo(i)||to(i)||String.fromCharCode(i)})}function io(i){var e=i.target||i.srcElement,t=e.tagName,r=!0;return(e.isContentEditable||(t==="INPUT"||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(r=!1),r}function so(i){return typeof i=="string"&&(i=_t(i)),ae.indexOf(i)!==-1}function ao(i,e){var t,r;i||(i=ot());for(var n in ce)if(Object.prototype.hasOwnProperty.call(ce,n))for(t=ce[n],r=0;r<t.length;)t[r].scope===i?t.splice(r,1):r++;ot()===i&&pi(e||"all")}function oo(i){var e=i.keyCode||i.which||i.charCode,t=ae.indexOf(e);if(t>=0&&ae.splice(t,1),i.key&&i.key.toLowerCase()==="meta"&&ae.splice(0,ae.length),(e===93||e===224)&&(e=91),e in fe){fe[e]=!1;for(var r in xe)xe[r]===e&&(Ae[r]=!1)}}function lo(i){if(typeof i>"u")Object.keys(ce).forEach(function(a){return delete ce[a]});else if(Array.isArray(i))i.forEach(function(a){a.key&&Sr(a)});else if(typeof i=="object")i.key&&Sr(i);else if(typeof i=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];var n=t[0],s=t[1];typeof n=="function"&&(s=n,n=""),Sr({key:i,scope:n,method:s,splitKey:"+"})}}var Sr=function(e){var t=e.key,r=e.scope,n=e.method,s=e.splitKey,a=s===void 0?"+":s,o=ci(t);o.forEach(function(u){var v=u.split(a),h=v.length,f=v[h-1],l=f==="*"?"*":_t(f);if(ce[l]){r||(r=ot());var d=h>1?ui(xe,v):[];ce[l]=ce[l].filter(function(m){var c=n?m.method===n:!0;return!(c&&m.scope===r&&Qa(m.mods,d))})}})};function gi(i,e,t,r){if(e.element===r){var n;if(e.scope===t||e.scope==="all"){n=e.mods.length>0;for(var s in fe)Object.prototype.hasOwnProperty.call(fe,s)&&(!fe[s]&&e.mods.indexOf(+s)>-1||fe[s]&&e.mods.indexOf(+s)===-1)&&(n=!1);(e.mods.length===0&&!fe[16]&&!fe[18]&&!fe[17]&&!fe[91]||n||e.shortcut==="*")&&e.method(i,e)===!1&&(i.preventDefault?i.preventDefault():i.returnValue=!1,i.stopPropagation&&i.stopPropagation(),i.cancelBubble&&(i.cancelBubble=!0))}}}function mi(i,e){var t=ce["*"],r=i.keyCode||i.which||i.charCode;if(Ae.filter.call(this,i)){if((r===93||r===224)&&(r=91),ae.indexOf(r)===-1&&r!==229&&ae.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(m){var c=br[m];i[m]&&ae.indexOf(c)===-1?ae.push(c):!i[m]&&ae.indexOf(c)>-1?ae.splice(ae.indexOf(c),1):m==="metaKey"&&i[m]&&ae.length===3&&(i.ctrlKey||i.shiftKey||i.altKey||(ae=ae.slice(ae.indexOf(c))))}),r in fe){fe[r]=!0;for(var n in xe)xe[n]===r&&(Ae[n]=!0);if(!t)return}for(var s in fe)Object.prototype.hasOwnProperty.call(fe,s)&&(fe[s]=i[br[s]]);i.getModifierState&&!(i.altKey&&!i.ctrlKey)&&i.getModifierState("AltGraph")&&(ae.indexOf(17)===-1&&ae.push(17),ae.indexOf(18)===-1&&ae.push(18),fe[17]=!0,fe[18]=!0);var a=ot();if(t)for(var o=0;o<t.length;o++)t[o].scope===a&&(i.type==="keydown"&&t[o].keydown||i.type==="keyup"&&t[o].keyup)&&gi(i,t[o],a,e);if(r in ce){for(var u=0;u<ce[r].length;u++)if((i.type==="keydown"&&ce[r][u].keydown||i.type==="keyup"&&ce[r][u].keyup)&&ce[r][u].key){for(var v=ce[r][u],h=v.splitKey,f=v.key.split(h),l=[],d=0;d<f.length;d++)l.push(_t(f[d]));l.sort().join("")===ae.sort().join("")&&gi(i,v,a,e)}}}}function uo(i){return hi.indexOf(i)>-1}function Ae(i,e,t){ae=[];var r=ci(i),n=[],s="all",a=document,o=0,u=!1,v=!0,h="+",f=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(s=e.scope),e.element&&(a=e.element),e.keyup&&(u=e.keyup),e.keydown!==void 0&&(v=e.keydown),e.capture!==void 0&&(f=e.capture),typeof e.splitKey=="string"&&(h=e.splitKey)),typeof e=="string"&&(s=e);o<r.length;o++)i=r[o].split(h),n=[],i.length>1&&(n=ui(xe,i)),i=i[i.length-1],i=i==="*"?"*":_t(i),i in ce||(ce[i]=[]),ce[i].push({keyup:u,keydown:v,scope:s,mods:n,shortcut:r[o],method:t,key:r[o],splitKey:h,element:a});typeof a<"u"&&!uo(a)&&window&&(hi.push(a),vr(a,"keydown",function(l){mi(l,a)},f),fi||(fi=!0,vr(window,"focus",function(){ae=[]},f)),vr(a,"keyup",function(l){mi(l,a),oo(l)},f))}function co(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(ce).forEach(function(t){var r=ce[t].find(function(n){return n.scope===e&&n.shortcut===i});r&&r.method&&r.method()})}var wr={getPressedKeyString:no,setScope:pi,getScope:ot,deleteScope:ao,getPressedKeyCodes:ro,isPressed:so,filter:io,trigger:co,unbind:lo,keyMap:at,modifier:xe,modifierMap:br};for(var _r in wr)Object.prototype.hasOwnProperty.call(wr,_r)&&(Ae[_r]=wr[_r]);if(typeof window<"u"){var fo=window.hotkeys;Ae.noConflict=function(i){return i&&window.hotkeys===Ae&&(window.hotkeys=fo),Ae},window.hotkeys=Ae}function lt(i,e,t){const r=e;let n=-1,s=Number.MAX_SAFE_INTEGER;for(let a=0;a<t.length;++a){const o=t[a],u=i?o.start-r:r-o.start;s<=u||(i&&r<o.start?(s=u,n=a):!i&&r>o.start&&(s=u,n=r<o.end?Math.max(0,a-1):a))}return n!==-1?t[n]:null}class yi{constructor(e){A(this,"keyBindSet");this.keyBindSet=e}bindCopy(e,t,r,n=!1){const s=this.keyBindSet.copySubtitle.keys;if(!s)return()=>{};const a=this.copyHandler(e,t,r);return this._bind(s,n,a)}copyHandler(e,t,r){return n=>{if(t())return!1;const s=r();return s?(e(n,s),!0):!1}}bindAnkiExport(e,t,r=!1){const n=this.keyBindSet.ankiExport.keys;if(!n)return()=>{};const s=this.ankiExportHandler(e,t);return this._bind(n,r,s)}ankiExportHandler(e,t){return r=>t()?!1:(e(r),!0)}bindUpdateLastCard(e,t,r=!1){const n=this.keyBindSet.updateLastCard.keys;if(!n)return()=>{};const s=this.updateLastCardHandler(e,t);return this._bind(n,r,s)}updateLastCardHandler(e,t){return r=>t()?!1:(e(r),!0)}bindExportCard(e,t,r=!1){const n=this.keyBindSet.exportCard.keys;if(!n)return()=>{};const s=this.exportCardHandler(e,t);return this._bind(n,r,s)}exportCardHandler(e,t){return r=>t()?!1:(e(r),!0)}bindTakeScreenshot(e,t,r=!1){const n=this.keyBindSet.takeScreenshot.keys;if(!n)return()=>{};const s=this.takeScreenshotHandler(e,t);return this._bind(n,r,s)}takeScreenshotHandler(e,t){return r=>t()?!1:(e(r),!0)}bindToggleRecording(e,t,r=!1){const n=this.keyBindSet.toggleRecording.keys;if(!n)return()=>{};const s=this.takeScreenshotHandler(e,t);return this._bind(n,r,s)}toggleRecordingHandler(e,t){return r=>t()?!1:(e(r),!0)}bindSeekToSubtitle(e,t,r,n,s=!1){const a=(d,m)=>{if(t())return!1;const c=n();if(!c||c.length===0)return!1;const g=lt(m,r(),c);return g!==null&&g.start>=0&&g.end>=0?(e(d,g),!0):!1},o=this.keyBindSet.seekToPreviousSubtitle.keys,u=this.keyBindSet.seekToNextSubtitle.keys,v=d=>a(d,!1),h=d=>a(d,!0);let f,l;return o&&(f=this._bind(o,s,v)),u&&(l=this._bind(u,s,h)),()=>{f==null||f(),l==null||l()}}bindSeekToBeginningOfCurrentSubtitle(e,t,r,n,s=!1){const a=this.keyBindSet.seekToBeginningOfCurrentSubtitle.keys;if(!a)return()=>{};const o=u=>{if(t())return!1;const v=n();if(!v||v.length===0)return!1;const h=this._currentOrPreviousSubtitle(r(),v);return h!==void 0&&h.start>=0&&h.end>=0?(e(u,h),!0):!1};return this._bind(a,s,o)}_currentOrPreviousSubtitle(e,t){const r=e;let n,s,a=Number.MAX_SAFE_INTEGER;for(let o=0;o<t.length;++o){const u=t[o];if(u.start<0||u.end<0)continue;const v=r-u.start;r>=u.start&&r<u.end?v<a&&(n=u,a=v):r>u.end&&(s=u)}return n||s}bindSeekBackwardOrForward(e,t,r=!1){const n=(f,l)=>t()?!1:(e(f,l),!0),s=this.keyBindSet.seekBackward.keys,a=this.keyBindSet.seekForward.keys,o=f=>n(f,!1),u=f=>n(f,!0);let v,h;return s&&(v=this._bind(s,r,o)),a&&(h=this._bind(a,r,u)),()=>{v==null||v(),h==null||h()}}bindOffsetToSubtitle(e,t,r,n,s=!1){const a=(d,m)=>{if(t())return!1;const c=n();if(!c||c.length===0)return!1;const g=r(),p=lt(m,g,c);if(p!==null){const y=p.originalStart,b=g-y;return e(d,b),!0}return!1},o=this.keyBindSet.adjustOffsetToPreviousSubtitle.keys,u=this.keyBindSet.adjustOffsetToNextSubtitle.keys,v=d=>a(d,!1),h=d=>a(d,!0);let f,l;return o&&(f=this._bind(o,s,v)),u&&(l=this._bind(u,s,h)),()=>{f==null||f(),l==null||l()}}bindAdjustOffset(e,t,r,n=!1){const s=(l,d)=>{if(t())return!1;const m=r();if(!m||m.length===0)return!1;const g=m[0].start-m[0].originalStart+(d?100:-100);return e(l,g),!0},a=this.keyBindSet.decreaseOffset.keys,o=this.keyBindSet.increaseOffset.keys,u=l=>s(l,!1),v=l=>s(l,!0),h=a?this._bind(a,n,u):()=>{},f=o?this._bind(o,n,v):()=>{};return()=>{h(),f()}}bindResetOffet(e,t,r){const n=this.keyBindSet.resetOffset.keys;if(!n)return()=>{};const s=a=>t()?!1:(e(a),!0);return this._bind(n,r??!1,s)}bindAdjustPlaybackRate(e,t,r=!1){const n=(f,l)=>t()?!1:(e(f,l),!0),s=this.keyBindSet.increasePlaybackRate.keys,a=this.keyBindSet.decreasePlaybackRate.keys,o=f=>n(f,!1),u=f=>n(f,!0);let v,h;return a&&(v=this._bind(a,r,o)),s&&(h=this._bind(s,r,u)),()=>{v==null||v(),h==null||h()}}bindToggleSubtitles(e,t,r=!1){const n=this.keyBindSet.toggleSubtitles.keys;if(!n)return()=>{};const s=a=>t()?!1:(e(a),!0);return this._bind(n,r,s)}bindToggleSubtitleTrackInVideo(e,t,r=!1){const n=[this.keyBindSet.toggleVideoSubtitleTrack1.keys,this.keyBindSet.toggleVideoSubtitleTrack2.keys,this.keyBindSet.toggleVideoSubtitleTrack3.keys].filter(o=>o);if(n.length===0)return()=>{};const s=(o,u)=>t()?!1:(e(o,u),!0);let a=[];for(let o=0;o<n.length;++o){const u=h=>s(h,o),v=n[o]?this._bind(n[o],r,u):()=>{};a.push(v)}return()=>{for(let o=0;o<n.length;++o){const u=a[o];u()}}}bindToggleSubtitleTrackInList(e,t,r=!1){const n=[this.keyBindSet.toggleAsbplayerSubtitleTrack1.keys,this.keyBindSet.toggleAsbplayerSubtitleTrack2.keys,this.keyBindSet.toggleAsbplayerSubtitleTrack3.keys].filter(o=>o);if(n.length===0)return()=>{};const s=(o,u)=>t()?!1:(e(o,u),!0);let a=[];for(let o=0;o<9;++o){const u=h=>s(h,o),v=n[o]?this._bind(n[o],r,u):()=>{};a.push(v)}return()=>{for(let o=0;o<9;++o){const u=a[o];u()}}}bindUnblurTrack(e,t,r=!1){const n=[this.keyBindSet.unblurAsbplayerTrack1.keys,this.keyBindSet.unblurAsbplayerTrack2.keys,this.keyBindSet.unblurAsbplayerTrack3.keys].filter(o=>o);if(n.length===0)return()=>{};const s=(o,u)=>t()?!1:(e(o,u),!0);let a=[];for(let o=0;o<n.length;++o){const u=h=>s(h,o),v=n[o]?this._bind(n[o],r,u):()=>{};a.push(v)}return()=>{for(let o=0;o<n.length;++o){const u=a[o];u()}}}bindPlay(e,t,r=!1){const n=this.keyBindSet.togglePlay.keys;if(!n)return()=>{};const s=a=>t()?!1:(e(a),!0);return this._bind(n,r,s)}bindAutoPause(e,t,r=!1){const n=this.keyBindSet.toggleAutoPause.keys;if(!n)return()=>{};const s=a=>t()?!1:(e(a),!0);return this._bind(n,r,s)}bindCondensedPlayback(e,t,r=!1){const n=this.keyBindSet.toggleCondensedPlayback.keys;if(!n)return()=>{};const s=a=>t()?!1:(e(a),!0);return this._bind(n,r,s)}bindFastForwardPlayback(e,t,r=!1){const n=this.keyBindSet.toggleFastForwardPlayback.keys;if(!n)return()=>{};const s=a=>t()?!1:(e(a),!0);return this._bind(n,r,s)}bindToggleSidePanel(e,t,r=!1){const n=this.keyBindSet.toggleSidePanel.keys;if(!n)return()=>{};const s=a=>t()?!1:(e(a),!0);return this._bind(n,r,s)}bindToggleRepeat(e,t,r=!1){const n=this.keyBindSet.toggleRepeat.keys,s=a=>t()?!1:(e(a),!0);return this._bind(n,r,s)}_bind(e,t,r){let n;const s=a=>{a.type==="keydown"?n=r(a):a.type==="keyup"&&(n&&(a.preventDefault(),a.stopImmediatePropagation()),n=void 0)};return Ae(e,{capture:t,keydown:!0,keyup:!0},s),()=>Ae.unbind(e,s)}}var Et=(i=>(i[i.disabled=0]="disabled",i[i.inAndOut=1]="inAndOut",i[i.inNotOut=2]="inNotOut",i))(Et||{});const Er=Object.keys({ankiConnectUrl:!0,deck:!0,noteType:!0,sentenceField:!0,definitionField:!0,audioField:!0,imageField:!0,wordField:!0,sourceField:!0,urlField:!0,track1Field:!0,track2Field:!0,track3Field:!0,customAnkiFields:!0,tags:!0,recordWithAudioPlayback:!0,preferMp3:!0,audioPaddingStart:!0,audioPaddingEnd:!0,maxImageWidth:!0,maxImageHeight:!0,surroundingSubtitlesCountRadius:!0,surroundingSubtitlesTimeRadius:!0,ankiFieldSettings:!0,customAnkiFieldSettings:!0}),vi=Object.keys({subtitleColor:!0,subtitleSize:!0,subtitleThickness:!0,subtitleOutlineThickness:!0,subtitleOutlineColor:!0,subtitleShadowThickness:!0,subtitleShadowColor:!0,subtitleBackgroundOpacity:!0,subtitleBackgroundColor:!0,subtitleFontFamily:!0,subtitleCustomStyles:!0,subtitleBlur:!0,subtitleAlignment:!0}),ho=i=>Object.fromEntries(Er.map(e=>[e,i[e]]));var xt=(i=>(i.noSubtitleList="noSubtitleList",i.app="app",i))(xt||{});((va=(ya=globalThis.browser)==null?void 0:ya.runtime)==null?void 0:va.id)==null?globalThis.chrome:globalThis.browser;const pe=((wa=(Sa=((ba=navigator.userAgentData)==null?void 0:ba.platform)??navigator.platform)==null?void 0:Sa.toUpperCase())==null?void 0:wa.indexOf("MAC"))>-1,ye={ankiConnectUrl:"http://127.0.0.1:8765",deck:"",noteType:"",sentenceField:"",definitionField:"",audioField:"",imageField:"",wordField:"",sourceField:"",urlField:"",track1Field:"",track2Field:"",track3Field:"",ankiFieldSettings:{sentence:{order:1,display:!0},definition:{order:2,display:!0},word:{order:3,display:!0},audio:{order:4,display:!0},image:{order:5,display:!0},source:{order:6,display:!0},url:{order:7,display:!0},track1:{order:8,display:!1},track2:{order:9,display:!1},track3:{order:10,display:!1}},customAnkiFieldSettings:{},...{subtitleSize:36,subtitleColor:"#ffffff",subtitleThickness:700,subtitleOutlineThickness:0,subtitleOutlineColor:"#000000",subtitleShadowThickness:3,subtitleShadowColor:"#000000",subtitleBackgroundColor:"#000000",subtitleBackgroundOpacity:0,subtitleFontFamily:"",subtitlePreview:"アあ安Aa",subtitleCustomStyles:[],subtitleBlur:!1},subtitlePositionOffset:75,topSubtitlePositionOffset:75,subtitleAlignment:"bottom",subtitleTracksV2:[],subtitlesWidth:-1,audioPaddingStart:0,audioPaddingEnd:500,maxImageWidth:0,maxImageHeight:0,surroundingSubtitlesCountRadius:2,surroundingSubtitlesTimeRadius:1e4,autoPausePreference:st.atEnd,subtitleHtml:or.remove,speedChangeStep:.1,fastForwardModePlaybackRate:2.7,keyBindSet:{togglePlay:{keys:"space"},toggleAutoPause:{keys:pe?"⇧+P":"shift+P"},toggleCondensedPlayback:{keys:pe?"⇧+O":"shift+O"},toggleFastForwardPlayback:{keys:pe?"⇧+F":"shift+F"},toggleSubtitles:{keys:"down"},toggleVideoSubtitleTrack1:{keys:"1"},toggleVideoSubtitleTrack2:{keys:"2"},toggleVideoSubtitleTrack3:{keys:"3"},toggleAsbplayerSubtitleTrack1:{keys:"W+1"},toggleAsbplayerSubtitleTrack2:{keys:"W+2"},toggleAsbplayerSubtitleTrack3:{keys:"W+3"},unblurAsbplayerTrack1:{keys:"B+1"},unblurAsbplayerTrack2:{keys:"B+2"},unblurAsbplayerTrack3:{keys:"B+3"},seekBackward:{keys:"A"},seekForward:{keys:"D"},seekToPreviousSubtitle:{keys:"left"},seekToNextSubtitle:{keys:"right"},seekToBeginningOfCurrentSubtitle:{keys:"up"},adjustOffsetToPreviousSubtitle:{keys:pe?"⇧+left":"ctrl+left"},adjustOffsetToNextSubtitle:{keys:pe?"⇧+right":"ctrl+right"},decreaseOffset:{keys:pe?"⇧+⌃+right":"ctrl+shift+right"},increaseOffset:{keys:pe?"⇧+⌃+left":"ctrl+shift+left"},resetOffset:{keys:pe?"⇧+⌃+down":"ctrl+shift+down"},copySubtitle:{keys:pe?"⇧+⌃+Z":"ctrl+shift+Z"},ankiExport:{keys:pe?"⇧+⌃+X":"ctrl+shift+X"},updateLastCard:{keys:pe?"⇧+⌃+U":"ctrl+shift+U"},exportCard:{keys:""},takeScreenshot:{keys:pe?"⇧+⌃+V":"ctrl+shift+V"},toggleRecording:{keys:pe?"⇧+⌃+R":"ctrl+shift+R"},decreasePlaybackRate:{keys:pe?"⇧+⌃+[":"ctrl+shift+["},increasePlaybackRate:{keys:pe?"⇧+⌃+]":"ctrl+shift+]"},toggleSidePanel:{keys:"`"},toggleRepeat:{keys:pe?"⇧+R":"shift+R"}},recordWithAudioPlayback:!0,preferMp3:!0,tabName:"asbplayer",miningHistoryStorageLimit:25,clickToMineDefaultAction:ar.showAnkiDialog,postMiningPlaybackState:Ee.remember,themeType:"dark",copyToClipboardOnMine:!1,rememberSubtitleOffset:!0,lastSubtitleOffset:0,autoCopyCurrentSubtitle:!1,alwaysPlayOnSubtitleRepeat:!0,subtitleRegexFilter:"",subtitleRegexFilterTextReplacement:"",language:"en",customAnkiFields:{},tags:[],imageBasedSubtitleScaleFactor:1,streamingAppUrl:"https://app.asbplayer.dev",streamingDisplaySubtitles:!0,streamingRecordMedia:!0,streamingTakeScreenshot:!0,streamingCleanScreenshot:!0,streamingCropScreenshot:!0,streamingSubsDragAndDrop:!0,streamingAutoSync:!1,streamingAutoSyncPromptOnFailure:!1,streamingLastLanguagesSynced:{},streamingCondensedPlaybackMinimumSkipIntervalMs:1e3,streamingScreenshotDelay:1e3,streamingSubtitleListPreference:xt.noSubtitleList,streamingEnableOverlay:!0,webSocketClientEnabled:!1,webSocketServerUrl:"ws://127.0.0.1:8766/ws",pauseOnHoverMode:0,lastSelectedAnkiExportMode:"default"},xr=i=>{const e=[];for(let t=0;t<=i.subtitleTracksV2.length;++t)e.push(po(i,t));return e},po=(i,e)=>{if(e===void 0){const t=n=>{const s=i[n];for(const a of i.subtitleTracksV2)if(!At(a[n],s))return!1;return!0};let r={};for(const n of vi)t(n)?r[n]=i[n]:r[n]=void 0;return r}return e===0||e>i.subtitleTracksV2.length?Object.fromEntries(vi.map(t=>[t,i[t]])):i.subtitleTracksV2[e-1]};Object.fromEntries(Object.entries(ye).map(([i,e])=>{if(typeof e=="string")return[i,t=>t];if(typeof e=="boolean")return[i,t=>t==="true"];if(typeof e=="number")return[i,t=>Number(t)];if(typeof e=="object")return[i,t=>JSON.parse(t)];throw new Error("Could not determine deserializer for setting")}));const At=(i,e)=>{if(typeof i!=typeof e)return!1;if(typeof i!="object")return i===e;const t=Object.keys(i),r=Object.keys(e);if(i.length!==e.length)return!1;for(const n of t)if(!At(i[n],e[n]))return!1;for(const n of r)if(!At(i[n],e[n]))return!1;return!0},go=i=>{let e=!1,t={},r=!1,n={};if(i.keyBindSet!==void 0){const s=i.keyBindSet;for(const a of Object.keys(ye.keyBindSet)){const o=a;s[o]===void 0?(t[o]=ye.keyBindSet[o],e=!0):t[o]=s[o]}}if(i.ankiFieldSettings!==void 0){const s=i.ankiFieldSettings;for(const a of Object.keys(ye.ankiFieldSettings)){const o=a;s[o]===void 0?(n[o]=ye.ankiFieldSettings[o],r=!0):n[o]=s[o]}}return!r&&!e?i:{...i,ankiFieldSettings:n,keyBindSet:t}},mo=Object.fromEntries(Object.keys(ye).filter(i=>typeof ye[i]=="object").map(i=>[i,!0]));class ut{constructor(e){A(this,"_storage");A(this,"_complexValues",{});this._storage=e}async getAll(){return this.get(Object.keys(ye))}async getSingle(e){return(await this.get([e]))[e]}async get(e){let t={};for(const s of e)t[s]=ye[s];const r=await this._storage.get(t),n={};for(const s in t){const a=(r&&r[s])??ye[s];if(mo[s]){const o=this._complexValues[s];o!==void 0&&At(o,a)?n[s]=o:(this._complexValues[s]=a,n[s]=a)}else n[s]=a}return go(n)}async set(e){await this._storage.set(await this._ensureConsistencyOnWrite(e))}async _ensureConsistencyOnWrite(e){if(e.customAnkiFields===void 0)return e;const t=e.customAnkiFieldSettings??(await this._storage.get({customAnkiFieldSettings:ye.customAnkiFieldSettings})).customAnkiFieldSettings;let r=!1;for(const n of Object.keys(t))n in e.customAnkiFields||(delete t[n],r=!0);return r?{...e,customAnkiFieldSettings:t}:e}async activeProfile(){return await this._storage.activeProfile()}async setActiveProfile(e){await this._storage.setActiveProfile(e)}async profiles(){return await this._storage.profiles()}async addProfile(e){await this._storage.addProfile(e)}async removeProfile(e){await this._storage.removeProfile(e)}}const yo=i=>`_prof_${i}_`,vo=(i,e)=>`${yo(e)}${i}`,bo=(i,e)=>i.substring(e.length+7),Pt=(i,e)=>{const t={};for(const r of Object.keys(i))t[vo(r,e)]=i[r];return t},So=(i,e)=>{const t={};for(const r of Object.keys(i)){const n=bo(r,e);t[n]=i[r]}return t};var Pe={},Ve={},ct={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var wo=ct.exports,bi;function _o(){return bi||(bi=1,function(i,e){(function(t){var r=e&&!e.nodeType&&e,n=i&&!i.nodeType&&i,s=typeof lr=="object"&&lr;(s.global===s||s.window===s||s.self===s)&&(t=s);var a,o=2147483647,u=36,v=1,h=26,f=38,l=700,d=72,m=128,c="-",g=/^xn--/,p=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=u-v,S=Math.floor,_=String.fromCharCode,w;function I(C){throw new RangeError(b[C])}function V(C,T){for(var R=C.length,F=[];R--;)F[R]=T(C[R]);return F}function M(C,T){var R=C.split("@"),F="";R.length>1&&(F=R[0]+"@",C=R[1]),C=C.replace(y,".");var N=C.split("."),z=V(N,T).join(".");return F+z}function j(C){for(var T=[],R=0,F=C.length,N,z;R<F;)N=C.charCodeAt(R++),N>=55296&&N<=56319&&R<F?(z=C.charCodeAt(R++),(z&64512)==56320?T.push(((N&1023)<<10)+(z&1023)+65536):(T.push(N),R--)):T.push(N);return T}function O(C){return V(C,function(T){var R="";return T>65535&&(T-=65536,R+=_(T>>>10&1023|55296),T=56320|T&1023),R+=_(T),R}).join("")}function E(C){return C-48<10?C-22:C-65<26?C-65:C-97<26?C-97:u}function P(C,T){return C+22+75*(C<26)-((T!=0)<<5)}function $(C,T,R){var F=0;for(C=R?S(C/l):C>>1,C+=S(C/T);C>x*h>>1;F+=u)C=S(C/x);return S(F+(x+1)*C/(C+f))}function H(C){var T=[],R=C.length,F,N=0,z=m,q=d,G,Z,K,X,J,Y,oe,ee,ie;for(G=C.lastIndexOf(c),G<0&&(G=0),Z=0;Z<G;++Z)C.charCodeAt(Z)>=128&&I("not-basic"),T.push(C.charCodeAt(Z));for(K=G>0?G+1:0;K<R;){for(X=N,J=1,Y=u;K>=R&&I("invalid-input"),oe=E(C.charCodeAt(K++)),(oe>=u||oe>S((o-N)/J))&&I("overflow"),N+=oe*J,ee=Y<=q?v:Y>=q+h?h:Y-q,!(oe<ee);Y+=u)ie=u-ee,J>S(o/ie)&&I("overflow"),J*=ie;F=T.length+1,q=$(N-X,F,X==0),S(N/F)>o-z&&I("overflow"),z+=S(N/F),N%=F,T.splice(N++,0,z)}return O(T)}function D(C){var T,R,F,N,z,q,G,Z,K,X,J,Y=[],oe,ee,ie,Le;for(C=j(C),oe=C.length,T=m,R=0,z=d,q=0;q<oe;++q)J=C[q],J<128&&Y.push(_(J));for(F=N=Y.length,N&&Y.push(c);F<oe;){for(G=o,q=0;q<oe;++q)J=C[q],J>=T&&J<G&&(G=J);for(ee=F+1,G-T>S((o-R)/ee)&&I("overflow"),R+=(G-T)*ee,T=G,q=0;q<oe;++q)if(J=C[q],J<T&&++R>o&&I("overflow"),J==T){for(Z=R,K=u;X=K<=z?v:K>=z+h?h:K-z,!(Z<X);K+=u)Le=Z-X,ie=u-X,Y.push(_(P(X+Le%ie,0))),Z=S(Le/ie);Y.push(_(P(Z,0))),z=$(R,ee,F==N),R=0,++F}++R,++T}return Y.join("")}function k(C){return M(C,function(T){return g.test(T)?H(T.slice(4).toLowerCase()):T})}function U(C){return M(C,function(T){return p.test(T)?"xn--"+D(T):T})}if(a={version:"1.4.1",ucs2:{decode:j,encode:O},decode:H,encode:D,toASCII:U,toUnicode:k},r&&n)if(i.exports==r)n.exports=a;else for(w in a)a.hasOwnProperty(w)&&(r[w]=a[w]);else t.punycode=a})(wo)}(ct,ct.exports)),ct.exports}var Ar,Si;function Pr(){return Si||(Si=1,Ar=Error),Ar}var Or,wi;function kr(){return wi||(wi=1,Or=EvalError),Or}var Cr,_i;function Tr(){return _i||(_i=1,Cr=RangeError),Cr}var Fr,Ei;function Rr(){return Ei||(Ei=1,Fr=ReferenceError),Fr}var Lr,xi;function Ot(){return xi||(xi=1,Lr=SyntaxError),Lr}var Ir,Ai;function He(){return Ai||(Ai=1,Ir=TypeError),Ir}var Nr,Pi;function Mr(){return Pi||(Pi=1,Nr=URIError),Nr}var $r,Oi;function Eo(){return Oi||(Oi=1,$r=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var n=42;e[t]=n;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var s=Object.getOwnPropertySymbols(e);if(s.length!==1||s[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==n||a.enumerable!==!0)return!1}return!0}),$r}var Br,ki;function kt(){if(ki)return Br;ki=1;var i=typeof Symbol<"u"&&Symbol,e=Eo();return Br=function(){return typeof i!="function"||typeof Symbol!="function"||typeof i("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Br}var Ur,Ci;function Ct(){if(Ci)return Ur;Ci=1;var i={foo:{}},e=Object;return Ur=function(){return{__proto__:i}.foo===i.foo&&!({__proto__:null}instanceof e)},Ur}var jr,Ti;function xo(){if(Ti)return jr;Ti=1;var i="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",n=function(u,v){for(var h=[],f=0;f<u.length;f+=1)h[f]=u[f];for(var l=0;l<v.length;l+=1)h[l+u.length]=v[l];return h},s=function(u,v){for(var h=[],f=v,l=0;f<u.length;f+=1,l+=1)h[l]=u[f];return h},a=function(o,u){for(var v="",h=0;h<o.length;h+=1)v+=o[h],h+1<o.length&&(v+=u);return v};return jr=function(u){var v=this;if(typeof v!="function"||e.apply(v)!==r)throw new TypeError(i+v);for(var h=s(arguments,1),f,l=function(){if(this instanceof f){var p=v.apply(this,n(h,arguments));return Object(p)===p?p:this}return v.apply(u,n(h,arguments))},d=t(0,v.length-h.length),m=[],c=0;c<d;c++)m[c]="$"+c;if(f=Function("binder","return function ("+a(m,",")+"){ return binder.apply(this,arguments); }")(l),v.prototype){var g=function(){};g.prototype=v.prototype,f.prototype=new g,g.prototype=null}return f},jr}var Dr,Fi;function Ze(){if(Fi)return Dr;Fi=1;var i=xo();return Dr=Function.prototype.bind||i,Dr}var Vr,Ri;function Tt(){if(Ri)return Vr;Ri=1;var i=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Ze();return Vr=t.call(i,e),Vr}var Hr,Li;function zr(){if(Li)return Hr;Li=1;var i,e=Pr(),t=kr(),r=Tr(),n=Rr(),s=Ot(),a=He(),o=Mr(),u=Function,v=function(D){try{return u('"use strict"; return ('+D+").constructor;")()}catch{}},h=Object.getOwnPropertyDescriptor;if(h)try{h({},"")}catch{h=null}var f=function(){throw new a},l=h?function(){try{return arguments.callee,f}catch{try{return h(arguments,"callee").get}catch{return f}}}():f,d=kt()(),m=Ct()(),c=Object.getPrototypeOf||(m?function(D){return D.__proto__}:null),g={},p=typeof Uint8Array>"u"||!c?i:c(Uint8Array),y={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":d&&c?c([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":g,"%AsyncGenerator%":g,"%AsyncGeneratorFunction%":g,"%AsyncIteratorPrototype%":g,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":t,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":u,"%GeneratorFunction%":g,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d&&c?c(c([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!d||!c?i:c(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":r,"%ReferenceError%":n,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!d||!c?i:c(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d&&c?c(""[Symbol.iterator]()):i,"%Symbol%":d?Symbol:i,"%SyntaxError%":s,"%ThrowTypeError%":l,"%TypedArray%":p,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":o,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet};if(c)try{null.error}catch(D){var b=c(c(D));y["%Error.prototype%"]=b}var x=function D(k){var U;if(k==="%AsyncFunction%")U=v("async function () {}");else if(k==="%GeneratorFunction%")U=v("function* () {}");else if(k==="%AsyncGeneratorFunction%")U=v("async function* () {}");else if(k==="%AsyncGenerator%"){var C=D("%AsyncGeneratorFunction%");C&&(U=C.prototype)}else if(k==="%AsyncIteratorPrototype%"){var T=D("%AsyncGenerator%");T&&c&&(U=c(T.prototype))}return y[k]=U,U},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},_=Ze(),w=Tt(),I=_.call(Function.call,Array.prototype.concat),V=_.call(Function.apply,Array.prototype.splice),M=_.call(Function.call,String.prototype.replace),j=_.call(Function.call,String.prototype.slice),O=_.call(Function.call,RegExp.prototype.exec),E=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,P=/\\(\\)?/g,$=function(k){var U=j(k,0,1),C=j(k,-1);if(U==="%"&&C!=="%")throw new s("invalid intrinsic syntax, expected closing `%`");if(C==="%"&&U!=="%")throw new s("invalid intrinsic syntax, expected opening `%`");var T=[];return M(k,E,function(R,F,N,z){T[T.length]=N?M(z,P,"$1"):F||R}),T},H=function(k,U){var C=k,T;if(w(S,C)&&(T=S[C],C="%"+T[0]+"%"),w(y,C)){var R=y[C];if(R===g&&(R=x(C)),typeof R>"u"&&!U)throw new a("intrinsic "+k+" exists, but is not available. Please file an issue!");return{alias:T,name:C,value:R}}throw new s("intrinsic "+k+" does not exist!")};return Hr=function(k,U){if(typeof k!="string"||k.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof U!="boolean")throw new a('"allowMissing" argument must be a boolean');if(O(/^%?[^%]*%?$/,k)===null)throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var C=$(k),T=C.length>0?C[0]:"",R=H("%"+T+"%",U),F=R.name,N=R.value,z=!1,q=R.alias;q&&(T=q[0],V(C,I([0,1],q)));for(var G=1,Z=!0;G<C.length;G+=1){var K=C[G],X=j(K,0,1),J=j(K,-1);if((X==='"'||X==="'"||X==="`"||J==='"'||J==="'"||J==="`")&&X!==J)throw new s("property names with quotes must have matching quotes");if((K==="constructor"||!Z)&&(z=!0),T+="."+K,F="%"+T+"%",w(y,F))N=y[F];else if(N!=null){if(!(K in N)){if(!U)throw new a("base intrinsic for "+k+" exists, but the property is not available.");return}if(h&&G+1>=C.length){var Y=h(N,K);Z=!!Y,Z&&"get"in Y&&!("originalValue"in Y.get)?N=Y.get:N=N[K]}else Z=w(N,K),N=N[K];Z&&!z&&(y[F]=N)}}return N},Hr}var qr={exports:{}},Wr,Ii;function Ao(){if(Ii)return Wr;Ii=1;var i,e=Pr(),t=kr(),r=Tr(),n=Rr(),s=Ot(),a=He(),o=Mr(),u=Function,v=function(D){try{return u('"use strict"; return ('+D+").constructor;")()}catch{}},h=Object.getOwnPropertyDescriptor;if(h)try{h({},"")}catch{h=null}var f=function(){throw new a},l=h?function(){try{return arguments.callee,f}catch{try{return h(arguments,"callee").get}catch{return f}}}():f,d=kt()(),m=Ct()(),c=Object.getPrototypeOf||(m?function(D){return D.__proto__}:null),g={},p=typeof Uint8Array>"u"||!c?i:c(Uint8Array),y={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":d&&c?c([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":g,"%AsyncGenerator%":g,"%AsyncGeneratorFunction%":g,"%AsyncIteratorPrototype%":g,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":t,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":u,"%GeneratorFunction%":g,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d&&c?c(c([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!d||!c?i:c(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":r,"%ReferenceError%":n,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!d||!c?i:c(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d&&c?c(""[Symbol.iterator]()):i,"%Symbol%":d?Symbol:i,"%SyntaxError%":s,"%ThrowTypeError%":l,"%TypedArray%":p,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":o,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet};if(c)try{null.error}catch(D){var b=c(c(D));y["%Error.prototype%"]=b}var x=function D(k){var U;if(k==="%AsyncFunction%")U=v("async function () {}");else if(k==="%GeneratorFunction%")U=v("function* () {}");else if(k==="%AsyncGeneratorFunction%")U=v("async function* () {}");else if(k==="%AsyncGenerator%"){var C=D("%AsyncGeneratorFunction%");C&&(U=C.prototype)}else if(k==="%AsyncIteratorPrototype%"){var T=D("%AsyncGenerator%");T&&c&&(U=c(T.prototype))}return y[k]=U,U},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},_=Ze(),w=Tt(),I=_.call(Function.call,Array.prototype.concat),V=_.call(Function.apply,Array.prototype.splice),M=_.call(Function.call,String.prototype.replace),j=_.call(Function.call,String.prototype.slice),O=_.call(Function.call,RegExp.prototype.exec),E=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,P=/\\(\\)?/g,$=function(k){var U=j(k,0,1),C=j(k,-1);if(U==="%"&&C!=="%")throw new s("invalid intrinsic syntax, expected closing `%`");if(C==="%"&&U!=="%")throw new s("invalid intrinsic syntax, expected opening `%`");var T=[];return M(k,E,function(R,F,N,z){T[T.length]=N?M(z,P,"$1"):F||R}),T},H=function(k,U){var C=k,T;if(w(S,C)&&(T=S[C],C="%"+T[0]+"%"),w(y,C)){var R=y[C];if(R===g&&(R=x(C)),typeof R>"u"&&!U)throw new a("intrinsic "+k+" exists, but is not available. Please file an issue!");return{alias:T,name:C,value:R}}throw new s("intrinsic "+k+" does not exist!")};return Wr=function(k,U){if(typeof k!="string"||k.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof U!="boolean")throw new a('"allowMissing" argument must be a boolean');if(O(/^%?[^%]*%?$/,k)===null)throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var C=$(k),T=C.length>0?C[0]:"",R=H("%"+T+"%",U),F=R.name,N=R.value,z=!1,q=R.alias;q&&(T=q[0],V(C,I([0,1],q)));for(var G=1,Z=!0;G<C.length;G+=1){var K=C[G],X=j(K,0,1),J=j(K,-1);if((X==='"'||X==="'"||X==="`"||J==='"'||J==="'"||J==="`")&&X!==J)throw new s("property names with quotes must have matching quotes");if((K==="constructor"||!Z)&&(z=!0),T+="."+K,F="%"+T+"%",w(y,F))N=y[F];else if(N!=null){if(!(K in N)){if(!U)throw new a("base intrinsic for "+k+" exists, but the property is not available.");return}if(h&&G+1>=C.length){var Y=h(N,K);Z=!!Y,Z&&"get"in Y&&!("originalValue"in Y.get)?N=Y.get:N=N[K]}else Z=w(N,K),N=N[K];Z&&!z&&(y[F]=N)}}return N},Wr}var Gr,Ni;function Po(){if(Ni)return Gr;Ni=1;var i,e=Pr(),t=kr(),r=Tr(),n=Rr(),s=Ot(),a=He(),o=Mr(),u=Function,v=function(D){try{return u('"use strict"; return ('+D+").constructor;")()}catch{}},h=Object.getOwnPropertyDescriptor;if(h)try{h({},"")}catch{h=null}var f=function(){throw new a},l=h?function(){try{return arguments.callee,f}catch{try{return h(arguments,"callee").get}catch{return f}}}():f,d=kt()(),m=Ct()(),c=Object.getPrototypeOf||(m?function(D){return D.__proto__}:null),g={},p=typeof Uint8Array>"u"||!c?i:c(Uint8Array),y={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":d&&c?c([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":g,"%AsyncGenerator%":g,"%AsyncGeneratorFunction%":g,"%AsyncIteratorPrototype%":g,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":t,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":u,"%GeneratorFunction%":g,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d&&c?c(c([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!d||!c?i:c(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":r,"%ReferenceError%":n,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!d||!c?i:c(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d&&c?c(""[Symbol.iterator]()):i,"%Symbol%":d?Symbol:i,"%SyntaxError%":s,"%ThrowTypeError%":l,"%TypedArray%":p,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":o,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet};if(c)try{null.error}catch(D){var b=c(c(D));y["%Error.prototype%"]=b}var x=function D(k){var U;if(k==="%AsyncFunction%")U=v("async function () {}");else if(k==="%GeneratorFunction%")U=v("function* () {}");else if(k==="%AsyncGeneratorFunction%")U=v("async function* () {}");else if(k==="%AsyncGenerator%"){var C=D("%AsyncGeneratorFunction%");C&&(U=C.prototype)}else if(k==="%AsyncIteratorPrototype%"){var T=D("%AsyncGenerator%");T&&c&&(U=c(T.prototype))}return y[k]=U,U},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},_=Ze(),w=Tt(),I=_.call(Function.call,Array.prototype.concat),V=_.call(Function.apply,Array.prototype.splice),M=_.call(Function.call,String.prototype.replace),j=_.call(Function.call,String.prototype.slice),O=_.call(Function.call,RegExp.prototype.exec),E=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,P=/\\(\\)?/g,$=function(k){var U=j(k,0,1),C=j(k,-1);if(U==="%"&&C!=="%")throw new s("invalid intrinsic syntax, expected closing `%`");if(C==="%"&&U!=="%")throw new s("invalid intrinsic syntax, expected opening `%`");var T=[];return M(k,E,function(R,F,N,z){T[T.length]=N?M(z,P,"$1"):F||R}),T},H=function(k,U){var C=k,T;if(w(S,C)&&(T=S[C],C="%"+T[0]+"%"),w(y,C)){var R=y[C];if(R===g&&(R=x(C)),typeof R>"u"&&!U)throw new a("intrinsic "+k+" exists, but is not available. Please file an issue!");return{alias:T,name:C,value:R}}throw new s("intrinsic "+k+" does not exist!")};return Gr=function(k,U){if(typeof k!="string"||k.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof U!="boolean")throw new a('"allowMissing" argument must be a boolean');if(O(/^%?[^%]*%?$/,k)===null)throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var C=$(k),T=C.length>0?C[0]:"",R=H("%"+T+"%",U),F=R.name,N=R.value,z=!1,q=R.alias;q&&(T=q[0],V(C,I([0,1],q)));for(var G=1,Z=!0;G<C.length;G+=1){var K=C[G],X=j(K,0,1),J=j(K,-1);if((X==='"'||X==="'"||X==="`"||J==='"'||J==="'"||J==="`")&&X!==J)throw new s("property names with quotes must have matching quotes");if((K==="constructor"||!Z)&&(z=!0),T+="."+K,F="%"+T+"%",w(y,F))N=y[F];else if(N!=null){if(!(K in N)){if(!U)throw new a("base intrinsic for "+k+" exists, but the property is not available.");return}if(h&&G+1>=C.length){var Y=h(N,K);Z=!!Y,Z&&"get"in Y&&!("originalValue"in Y.get)?N=Y.get:N=N[K]}else Z=w(N,K),N=N[K];Z&&!z&&(y[F]=N)}}return N},Gr}var Kr,Mi;function Zr(){if(Mi)return Kr;Mi=1;var i=Po(),e=i("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return Kr=e,Kr}var Jr,$i;function Oo(){if($i)return Jr;$i=1;var i,e=SyntaxError,t=Function,r=TypeError,n=function(O){try{return t('"use strict"; return ('+O+").constructor;")()}catch{}},s=Object.getOwnPropertyDescriptor;if(s)try{s({},"")}catch{s=null}var a=function(){throw new r},o=s?function(){try{return arguments.callee,a}catch{try{return s(arguments,"callee").get}catch{return a}}}():a,u=kt()(),v=Ct()(),h=Object.getPrototypeOf||(v?function(O){return O.__proto__}:null),f={},l=typeof Uint8Array>"u"||!h?i:h(Uint8Array),d={"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":u&&h?h([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":t,"%GeneratorFunction%":f,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u&&h?h(h([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!u||!h?i:h(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!u||!h?i:h(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u&&h?h(""[Symbol.iterator]()):i,"%Symbol%":u?Symbol:i,"%SyntaxError%":e,"%ThrowTypeError%":o,"%TypedArray%":l,"%TypeError%":r,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet};if(h)try{null.error}catch(O){var m=h(h(O));d["%Error.prototype%"]=m}var c=function O(E){var P;if(E==="%AsyncFunction%")P=n("async function () {}");else if(E==="%GeneratorFunction%")P=n("function* () {}");else if(E==="%AsyncGeneratorFunction%")P=n("async function* () {}");else if(E==="%AsyncGenerator%"){var $=O("%AsyncGeneratorFunction%");$&&(P=$.prototype)}else if(E==="%AsyncIteratorPrototype%"){var H=O("%AsyncGenerator%");H&&h&&(P=h(H.prototype))}return d[E]=P,P},g={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},p=Ze(),y=Tt(),b=p.call(Function.call,Array.prototype.concat),x=p.call(Function.apply,Array.prototype.splice),S=p.call(Function.call,String.prototype.replace),_=p.call(Function.call,String.prototype.slice),w=p.call(Function.call,RegExp.prototype.exec),I=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,V=/\\(\\)?/g,M=function(E){var P=_(E,0,1),$=_(E,-1);if(P==="%"&&$!=="%")throw new e("invalid intrinsic syntax, expected closing `%`");if($==="%"&&P!=="%")throw new e("invalid intrinsic syntax, expected opening `%`");var H=[];return S(E,I,function(D,k,U,C){H[H.length]=U?S(C,V,"$1"):k||D}),H},j=function(E,P){var $=E,H;if(y(g,$)&&(H=g[$],$="%"+H[0]+"%"),y(d,$)){var D=d[$];if(D===f&&(D=c($)),typeof D>"u"&&!P)throw new r("intrinsic "+E+" exists, but is not available. Please file an issue!");return{alias:H,name:$,value:D}}throw new e("intrinsic "+E+" does not exist!")};return Jr=function(E,P){if(typeof E!="string"||E.length===0)throw new r("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof P!="boolean")throw new r('"allowMissing" argument must be a boolean');if(w(/^%?[^%]*%?$/,E)===null)throw new e("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var $=M(E),H=$.length>0?$[0]:"",D=j("%"+H+"%",P),k=D.name,U=D.value,C=!1,T=D.alias;T&&(H=T[0],x($,b([0,1],T)));for(var R=1,F=!0;R<$.length;R+=1){var N=$[R],z=_(N,0,1),q=_(N,-1);if((z==='"'||z==="'"||z==="`"||q==='"'||q==="'"||q==="`")&&z!==q)throw new e("property names with quotes must have matching quotes");if((N==="constructor"||!F)&&(C=!0),H+="."+N,k="%"+H+"%",y(d,k))U=d[k];else if(U!=null){if(!(N in U)){if(!P)throw new r("base intrinsic for "+E+" exists, but the property is not available.");return}if(s&&R+1>=$.length){var G=s(U,N);F=!!G,F&&"get"in G&&!("originalValue"in G.get)?U=G.get:U=U[N]}else F=y(U,N),U=U[N];F&&!C&&(d[k]=U)}}return U},Jr}var Xr,Bi;function Ui(){if(Bi)return Xr;Bi=1;var i=Oo(),e=i("%Object.getOwnPropertyDescriptor%",!0);if(e)try{e([],"length")}catch{e=null}return Xr=e,Xr}var Yr,ji;function ko(){if(ji)return Yr;ji=1;var i=Zr(),e=Ot(),t=He(),r=Ui();return Yr=function(s,a,o){if(!s||typeof s!="object"&&typeof s!="function")throw new t("`obj` must be an object or a function`");if(typeof a!="string"&&typeof a!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var u=arguments.length>3?arguments[3]:null,v=arguments.length>4?arguments[4]:null,h=arguments.length>5?arguments[5]:null,f=arguments.length>6?arguments[6]:!1,l=!!r&&r(s,a);if(i)i(s,a,{configurable:h===null&&l?l.configurable:!h,enumerable:u===null&&l?l.enumerable:!u,value:o,writable:v===null&&l?l.writable:!v});else if(f||!u&&!v&&!h)s[a]=o;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Yr}var Qr,Di;function Co(){if(Di)return Qr;Di=1;var i=Zr(),e=function(){return!!i};return e.hasArrayLengthDefineBug=function(){if(!i)return null;try{return i([],"length",{value:1}).length!==1}catch{return!0}},Qr=e,Qr}var en,Vi;function To(){if(Vi)return en;Vi=1;var i=Ao(),e=ko(),t=Co()(),r=Ui(),n=He(),s=i("%Math.floor%");return en=function(o,u){if(typeof o!="function")throw new n("`fn` is not a function");if(typeof u!="number"||u<0||u>4294967295||s(u)!==u)throw new n("`length` must be a positive 32-bit integer");var v=arguments.length>2&&!!arguments[2],h=!0,f=!0;if("length"in o&&r){var l=r(o,"length");l&&!l.configurable&&(h=!1),l&&!l.writable&&(f=!1)}return(h||f||!v)&&(t?e(o,"length",u,!0,!0):e(o,"length",u)),o},en}var Hi;function Fo(){return Hi||(Hi=1,function(i){var e=Ze(),t=zr(),r=To(),n=He(),s=t("%Function.prototype.apply%"),a=t("%Function.prototype.call%"),o=t("%Reflect.apply%",!0)||e.call(a,s),u=Zr(),v=t("%Math.max%");i.exports=function(l){if(typeof l!="function")throw new n("a function is required");var d=o(e,a,arguments);return r(d,1+v(0,l.length-(arguments.length-1)),!0)};var h=function(){return o(e,s,arguments)};u?u(i.exports,"apply",{value:h}):i.exports.apply=h}(qr)),qr.exports}var tn,zi;function Ro(){if(zi)return tn;zi=1;var i=zr(),e=Fo(),t=e(i("String.prototype.indexOf"));return tn=function(n,s){var a=i(n,!!s);return typeof a=="function"&&t(n,".prototype.")>-1?e(a):a},tn}const Lo=Ia(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var rn,qi;function Io(){if(qi)return rn;qi=1;var i=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=i&&e&&typeof e.get=="function"?e.get:null,r=i&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=n&&s&&typeof s.get=="function"?s.get:null,o=n&&Set.prototype.forEach,u=typeof WeakMap=="function"&&WeakMap.prototype,v=u?WeakMap.prototype.has:null,h=typeof WeakSet=="function"&&WeakSet.prototype,f=h?WeakSet.prototype.has:null,l=typeof WeakRef=="function"&&WeakRef.prototype,d=l?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,c=Object.prototype.toString,g=Function.prototype.toString,p=String.prototype.match,y=String.prototype.slice,b=String.prototype.replace,x=String.prototype.toUpperCase,S=String.prototype.toLowerCase,_=RegExp.prototype.test,w=Array.prototype.concat,I=Array.prototype.join,V=Array.prototype.slice,M=Math.floor,j=typeof BigInt=="function"?BigInt.prototype.valueOf:null,O=Object.getOwnPropertySymbols,E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,P=typeof Symbol=="function"&&typeof Symbol.iterator=="object",$=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===P||!0)?Symbol.toStringTag:null,H=Object.prototype.propertyIsEnumerable,D=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(L){return L.__proto__}:null);function k(L,B){if(L===1/0||L===-1/0||L!==L||L&&L>-1e3&&L<1e3||_.call(/e/,B))return B;var re=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof L=="number"){var se=L<0?-M(-L):M(L);if(se!==L){var ue=String(se),Q=y.call(B,ue.length+1);return b.call(ue,re,"$&_")+"."+b.call(b.call(Q,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(B,re,"$&_")}var U=Lo,C=U.custom,T=J(C)?C:null;rn=function L(B,re,se,ue){var Q=re||{};if(ee(Q,"quoteStyle")&&Q.quoteStyle!=="single"&&Q.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ee(Q,"maxStringLength")&&(typeof Q.maxStringLength=="number"?Q.maxStringLength<0&&Q.maxStringLength!==1/0:Q.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var je=ee(Q,"customInspect")?Q.customInspect:!0;if(typeof je!="boolean"&&je!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ee(Q,"indent")&&Q.indent!==null&&Q.indent!=="	"&&!(parseInt(Q.indent,10)===Q.indent&&Q.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ee(Q,"numericSeparator")&&typeof Q.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Ge=Q.numericSeparator;if(typeof B>"u")return"undefined";if(B===null)return"null";if(typeof B=="boolean")return B?"true":"false";if(typeof B=="string")return Ea(B,Q);if(typeof B=="number"){if(B===0)return 1/0/B>0?"0":"-0";var be=String(B);return Ge?k(B,be):be}if(typeof B=="bigint"){var De=String(B)+"n";return Ge?k(B,De):De}var Gn=typeof Q.depth>"u"?5:Q.depth;if(typeof se>"u"&&(se=0),se>=Gn&&Gn>0&&typeof B=="object")return N(B)?"[Array]":"[Object]";var nt=hc(Q,se);if(typeof ue>"u")ue=[];else if(We(ue,B)>=0)return"[Circular]";function _e(it,sr,gc){if(sr&&(ue=V.call(ue),ue.push(sr)),gc){var Ra={depth:Q.depth};return ee(Q,"quoteStyle")&&(Ra.quoteStyle=Q.quoteStyle),L(it,Ra,se+1,ue)}return L(it,Q,se+1,ue)}if(typeof B=="function"&&!q(B)){var Aa=Le(B),Pa=nr(B,_e);return"[Function"+(Aa?": "+Aa:" (anonymous)")+"]"+(Pa.length>0?" { "+I.call(Pa,", ")+" }":"")}if(J(B)){var Oa=P?b.call(String(B),/^(Symbol\(.*\))_[^)]*$/,"$1"):E.call(B);return typeof B=="object"&&!P?vt(Oa):Oa}if(cc(B)){for(var bt="<"+S.call(String(B.nodeName)),Kn=B.attributes||[],ir=0;ir<Kn.length;ir++)bt+=" "+Kn[ir].name+"="+R(F(Kn[ir].value),"double",Q);return bt+=">",B.childNodes&&B.childNodes.length&&(bt+="..."),bt+="</"+S.call(String(B.nodeName))+">",bt}if(N(B)){if(B.length===0)return"[]";var Zn=nr(B,_e);return nt&&!dc(Zn)?"["+Wn(Zn,nt)+"]":"[ "+I.call(Zn,", ")+" ]"}if(G(B)){var Jn=nr(B,_e);return!("cause"in Error.prototype)&&"cause"in B&&!H.call(B,"cause")?"{ ["+String(B)+"] "+I.call(w.call("[cause]: "+_e(B.cause),Jn),", ")+" }":Jn.length===0?"["+String(B)+"]":"{ ["+String(B)+"] "+I.call(Jn,", ")+" }"}if(typeof B=="object"&&je){if(T&&typeof B[T]=="function"&&U)return U(B,{depth:Gn-se});if(je!=="symbol"&&typeof B.inspect=="function")return B.inspect()}if(zn(B)){var ka=[];return r&&r.call(B,function(it,sr){ka.push(_e(sr,B,!0)+" => "+_e(it,B))}),xa("Map",t.call(B),ka,nt)}if(lc(B)){var Ca=[];return o&&o.call(B,function(it){Ca.push(_e(it,B))}),xa("Set",a.call(B),Ca,nt)}if(ac(B))return qn("WeakMap");if(uc(B))return qn("WeakSet");if(oc(B))return qn("WeakRef");if(K(B))return vt(_e(Number(B)));if(Y(B))return vt(_e(j.call(B)));if(X(B))return vt(m.call(B));if(Z(B))return vt(_e(String(B)));if(typeof window<"u"&&B===window)return"{ [object Window] }";if(B===lr)return"{ [object globalThis] }";if(!z(B)&&!q(B)){var Xn=nr(B,_e),Ta=D?D(B)===Object.prototype:B instanceof Object||B.constructor===Object,Yn=B instanceof Object?"":"null prototype",Fa=!Ta&&$&&Object(B)===B&&$ in B?y.call(ie(B),8,-1):Yn?"Object":"",pc=Ta||typeof B.constructor!="function"?"":B.constructor.name?B.constructor.name+" ":"",Qn=pc+(Fa||Yn?"["+I.call(w.call([],Fa||[],Yn||[]),": ")+"] ":"");return Xn.length===0?Qn+"{}":nt?Qn+"{"+Wn(Xn,nt)+"}":Qn+"{ "+I.call(Xn,", ")+" }"}return String(B)};function R(L,B,re){var se=(re.quoteStyle||B)==="double"?'"':"'";return se+L+se}function F(L){return b.call(String(L),/"/g,"&quot;")}function N(L){return ie(L)==="[object Array]"&&(!$||!(typeof L=="object"&&$ in L))}function z(L){return ie(L)==="[object Date]"&&(!$||!(typeof L=="object"&&$ in L))}function q(L){return ie(L)==="[object RegExp]"&&(!$||!(typeof L=="object"&&$ in L))}function G(L){return ie(L)==="[object Error]"&&(!$||!(typeof L=="object"&&$ in L))}function Z(L){return ie(L)==="[object String]"&&(!$||!(typeof L=="object"&&$ in L))}function K(L){return ie(L)==="[object Number]"&&(!$||!(typeof L=="object"&&$ in L))}function X(L){return ie(L)==="[object Boolean]"&&(!$||!(typeof L=="object"&&$ in L))}function J(L){if(P)return L&&typeof L=="object"&&L instanceof Symbol;if(typeof L=="symbol")return!0;if(!L||typeof L!="object"||!E)return!1;try{return E.call(L),!0}catch{}return!1}function Y(L){if(!L||typeof L!="object"||!j)return!1;try{return j.call(L),!0}catch{}return!1}var oe=Object.prototype.hasOwnProperty||function(L){return L in this};function ee(L,B){return oe.call(L,B)}function ie(L){return c.call(L)}function Le(L){if(L.name)return L.name;var B=p.call(g.call(L),/^function\s*([\w$]+)/);return B?B[1]:null}function We(L,B){if(L.indexOf)return L.indexOf(B);for(var re=0,se=L.length;re<se;re++)if(L[re]===B)return re;return-1}function zn(L){if(!t||!L||typeof L!="object")return!1;try{t.call(L);try{a.call(L)}catch{return!0}return L instanceof Map}catch{}return!1}function ac(L){if(!v||!L||typeof L!="object")return!1;try{v.call(L,v);try{f.call(L,f)}catch{return!0}return L instanceof WeakMap}catch{}return!1}function oc(L){if(!d||!L||typeof L!="object")return!1;try{return d.call(L),!0}catch{}return!1}function lc(L){if(!a||!L||typeof L!="object")return!1;try{a.call(L);try{t.call(L)}catch{return!0}return L instanceof Set}catch{}return!1}function uc(L){if(!f||!L||typeof L!="object")return!1;try{f.call(L,f);try{v.call(L,v)}catch{return!0}return L instanceof WeakSet}catch{}return!1}function cc(L){return!L||typeof L!="object"?!1:typeof HTMLElement<"u"&&L instanceof HTMLElement?!0:typeof L.nodeName=="string"&&typeof L.getAttribute=="function"}function Ea(L,B){if(L.length>B.maxStringLength){var re=L.length-B.maxStringLength,se="... "+re+" more character"+(re>1?"s":"");return Ea(y.call(L,0,B.maxStringLength),B)+se}var ue=b.call(b.call(L,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,fc);return R(ue,"single",B)}function fc(L){var B=L.charCodeAt(0),re={8:"b",9:"t",10:"n",12:"f",13:"r"}[B];return re?"\\"+re:"\\x"+(B<16?"0":"")+x.call(B.toString(16))}function vt(L){return"Object("+L+")"}function qn(L){return L+" { ? }"}function xa(L,B,re,se){var ue=se?Wn(re,se):I.call(re,", ");return L+" ("+B+") {"+ue+"}"}function dc(L){for(var B=0;B<L.length;B++)if(We(L[B],`
`)>=0)return!1;return!0}function hc(L,B){var re;if(L.indent==="	")re="	";else if(typeof L.indent=="number"&&L.indent>0)re=I.call(Array(L.indent+1)," ");else return null;return{base:re,prev:I.call(Array(B+1),re)}}function Wn(L,B){if(L.length===0)return"";var re=`
`+B.prev+B.base;return re+I.call(L,","+re)+`
`+B.prev}function nr(L,B){var re=N(L),se=[];if(re){se.length=L.length;for(var ue=0;ue<L.length;ue++)se[ue]=ee(L,ue)?B(L[ue],L):""}var Q=typeof O=="function"?O(L):[],je;if(P){je={};for(var Ge=0;Ge<Q.length;Ge++)je["$"+Q[Ge]]=Q[Ge]}for(var be in L)ee(L,be)&&(re&&String(Number(be))===be&&be<L.length||P&&je["$"+be]instanceof Symbol||(_.call(/[^\w$]/,be)?se.push(B(be,L)+": "+B(L[be],L)):se.push(be+": "+B(L[be],L))));if(typeof O=="function")for(var De=0;De<Q.length;De++)H.call(L,Q[De])&&se.push("["+B(Q[De])+"]: "+B(L[Q[De]],L));return se}return rn}var nn,Wi;function No(){if(Wi)return nn;Wi=1;var i=zr(),e=Ro(),t=Io(),r=He(),n=i("%WeakMap%",!0),s=i("%Map%",!0),a=e("WeakMap.prototype.get",!0),o=e("WeakMap.prototype.set",!0),u=e("WeakMap.prototype.has",!0),v=e("Map.prototype.get",!0),h=e("Map.prototype.set",!0),f=e("Map.prototype.has",!0),l=function(g,p){for(var y=g,b;(b=y.next)!==null;y=b)if(b.key===p)return y.next=b.next,b.next=g.next,g.next=b,b},d=function(g,p){var y=l(g,p);return y&&y.value},m=function(g,p,y){var b=l(g,p);b?b.value=y:g.next={key:p,next:g.next,value:y}},c=function(g,p){return!!l(g,p)};return nn=function(){var p,y,b,x={assert:function(S){if(!x.has(S))throw new r("Side channel does not contain "+t(S))},get:function(S){if(n&&S&&(typeof S=="object"||typeof S=="function")){if(p)return a(p,S)}else if(s){if(y)return v(y,S)}else if(b)return d(b,S)},has:function(S){if(n&&S&&(typeof S=="object"||typeof S=="function")){if(p)return u(p,S)}else if(s){if(y)return f(y,S)}else if(b)return c(b,S);return!1},set:function(S,_){n&&S&&(typeof S=="object"||typeof S=="function")?(p||(p=new n),o(p,S,_)):s?(y||(y=new s),h(y,S,_)):(b||(b={key:{},next:null}),m(b,S,_))}};return x},nn}var sn,Gi;function an(){if(Gi)return sn;Gi=1;var i=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return sn={default:t.RFC3986,formatters:{RFC1738:function(r){return i.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},sn}var on,Ki;function Zi(){if(Ki)return on;Ki=1;var i=an(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r=function(){for(var g=[],p=0;p<256;++p)g.push("%"+((p<16?"0":"")+p.toString(16)).toUpperCase());return g}(),n=function(p){for(;p.length>1;){var y=p.pop(),b=y.obj[y.prop];if(t(b)){for(var x=[],S=0;S<b.length;++S)typeof b[S]<"u"&&x.push(b[S]);y.obj[y.prop]=x}}},s=function(p,y){for(var b=y&&y.plainObjects?Object.create(null):{},x=0;x<p.length;++x)typeof p[x]<"u"&&(b[x]=p[x]);return b},a=function g(p,y,b){if(!y)return p;if(typeof y!="object"){if(t(p))p.push(y);else if(p&&typeof p=="object")(b&&(b.plainObjects||b.allowPrototypes)||!e.call(Object.prototype,y))&&(p[y]=!0);else return[p,y];return p}if(!p||typeof p!="object")return[p].concat(y);var x=p;return t(p)&&!t(y)&&(x=s(p,b)),t(p)&&t(y)?(y.forEach(function(S,_){if(e.call(p,_)){var w=p[_];w&&typeof w=="object"&&S&&typeof S=="object"?p[_]=g(w,S,b):p.push(S)}else p[_]=S}),p):Object.keys(y).reduce(function(S,_){var w=y[_];return e.call(S,_)?S[_]=g(S[_],w,b):S[_]=w,S},x)},o=function(p,y){return Object.keys(y).reduce(function(b,x){return b[x]=y[x],b},p)},u=function(g,p,y){var b=g.replace(/\+/g," ");if(y==="iso-8859-1")return b.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(b)}catch{return b}},v=1024,h=function(p,y,b,x,S){if(p.length===0)return p;var _=p;if(typeof p=="symbol"?_=Symbol.prototype.toString.call(p):typeof p!="string"&&(_=String(p)),b==="iso-8859-1")return escape(_).replace(/%u[0-9a-f]{4}/gi,function(E){return"%26%23"+parseInt(E.slice(2),16)+"%3B"});for(var w="",I=0;I<_.length;I+=v){for(var V=_.length>=v?_.slice(I,I+v):_,M=[],j=0;j<V.length;++j){var O=V.charCodeAt(j);if(O===45||O===46||O===95||O===126||O>=48&&O<=57||O>=65&&O<=90||O>=97&&O<=122||S===i.RFC1738&&(O===40||O===41)){M[M.length]=V.charAt(j);continue}if(O<128){M[M.length]=r[O];continue}if(O<2048){M[M.length]=r[192|O>>6]+r[128|O&63];continue}if(O<55296||O>=57344){M[M.length]=r[224|O>>12]+r[128|O>>6&63]+r[128|O&63];continue}j+=1,O=65536+((O&1023)<<10|V.charCodeAt(j)&1023),M[M.length]=r[240|O>>18]+r[128|O>>12&63]+r[128|O>>6&63]+r[128|O&63]}w+=M.join("")}return w},f=function(p){for(var y=[{obj:{o:p},prop:"o"}],b=[],x=0;x<y.length;++x)for(var S=y[x],_=S.obj[S.prop],w=Object.keys(_),I=0;I<w.length;++I){var V=w[I],M=_[V];typeof M=="object"&&M!==null&&b.indexOf(M)===-1&&(y.push({obj:_,prop:V}),b.push(M))}return n(y),p},l=function(p){return Object.prototype.toString.call(p)==="[object RegExp]"},d=function(p){return!p||typeof p!="object"?!1:!!(p.constructor&&p.constructor.isBuffer&&p.constructor.isBuffer(p))},m=function(p,y){return[].concat(p,y)},c=function(p,y){if(t(p)){for(var b=[],x=0;x<p.length;x+=1)b.push(y(p[x]));return b}return y(p)};return on={arrayToObject:s,assign:o,combine:m,compact:f,decode:u,encode:h,isBuffer:d,isRegExp:l,maybeMap:c,merge:a},on}var ln,Ji;function Mo(){if(Ji)return ln;Ji=1;var i=No(),e=Zi(),t=an(),r=Object.prototype.hasOwnProperty,n={brackets:function(g){return g+"[]"},comma:"comma",indices:function(g,p){return g+"["+p+"]"},repeat:function(g){return g}},s=Array.isArray,a=Array.prototype.push,o=function(c,g){a.apply(c,s(g)?g:[g])},u=Date.prototype.toISOString,v=t.default,h={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,format:v,formatter:t.formatters[v],indices:!1,serializeDate:function(g){return u.call(g)},skipNulls:!1,strictNullHandling:!1},f=function(g){return typeof g=="string"||typeof g=="number"||typeof g=="boolean"||typeof g=="symbol"||typeof g=="bigint"},l={},d=function c(g,p,y,b,x,S,_,w,I,V,M,j,O,E,P,$,H,D){for(var k=g,U=D,C=0,T=!1;(U=U.get(l))!==void 0&&!T;){var R=U.get(g);if(C+=1,typeof R<"u"){if(R===C)throw new RangeError("Cyclic object value");T=!0}typeof U.get(l)>"u"&&(C=0)}if(typeof V=="function"?k=V(p,k):k instanceof Date?k=O(k):y==="comma"&&s(k)&&(k=e.maybeMap(k,function(ie){return ie instanceof Date?O(ie):ie})),k===null){if(S)return I&&!$?I(p,h.encoder,H,"key",E):p;k=""}if(f(k)||e.isBuffer(k)){if(I){var F=$?p:I(p,h.encoder,H,"key",E);return[P(F)+"="+P(I(k,h.encoder,H,"value",E))]}return[P(p)+"="+P(String(k))]}var N=[];if(typeof k>"u")return N;var z;if(y==="comma"&&s(k))$&&I&&(k=e.maybeMap(k,I)),z=[{value:k.length>0?k.join(",")||null:void 0}];else if(s(V))z=V;else{var q=Object.keys(k);z=M?q.sort(M):q}var G=w?p.replace(/\./g,"%2E"):p,Z=b&&s(k)&&k.length===1?G+"[]":G;if(x&&s(k)&&k.length===0)return Z+"[]";for(var K=0;K<z.length;++K){var X=z[K],J=typeof X=="object"&&typeof X.value<"u"?X.value:k[X];if(!(_&&J===null)){var Y=j&&w?X.replace(/\./g,"%2E"):X,oe=s(k)?typeof y=="function"?y(Z,Y):Z:Z+(j?"."+Y:"["+Y+"]");D.set(g,C);var ee=i();ee.set(l,D),o(N,c(J,oe,y,b,x,S,_,w,y==="comma"&&$&&s(k)?null:I,V,M,j,O,E,P,$,H,ee))}}return N},m=function(g){if(!g)return h;if(typeof g.allowEmptyArrays<"u"&&typeof g.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof g.encodeDotInKeys<"u"&&typeof g.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(g.encoder!==null&&typeof g.encoder<"u"&&typeof g.encoder!="function")throw new TypeError("Encoder has to be a function.");var p=g.charset||h.charset;if(typeof g.charset<"u"&&g.charset!=="utf-8"&&g.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var y=t.default;if(typeof g.format<"u"){if(!r.call(t.formatters,g.format))throw new TypeError("Unknown format option provided.");y=g.format}var b=t.formatters[y],x=h.filter;(typeof g.filter=="function"||s(g.filter))&&(x=g.filter);var S;if(g.arrayFormat in n?S=g.arrayFormat:"indices"in g?S=g.indices?"indices":"repeat":S=h.arrayFormat,"commaRoundTrip"in g&&typeof g.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var _=typeof g.allowDots>"u"?g.encodeDotInKeys===!0?!0:h.allowDots:!!g.allowDots;return{addQueryPrefix:typeof g.addQueryPrefix=="boolean"?g.addQueryPrefix:h.addQueryPrefix,allowDots:_,allowEmptyArrays:typeof g.allowEmptyArrays=="boolean"?!!g.allowEmptyArrays:h.allowEmptyArrays,arrayFormat:S,charset:p,charsetSentinel:typeof g.charsetSentinel=="boolean"?g.charsetSentinel:h.charsetSentinel,commaRoundTrip:g.commaRoundTrip,delimiter:typeof g.delimiter>"u"?h.delimiter:g.delimiter,encode:typeof g.encode=="boolean"?g.encode:h.encode,encodeDotInKeys:typeof g.encodeDotInKeys=="boolean"?g.encodeDotInKeys:h.encodeDotInKeys,encoder:typeof g.encoder=="function"?g.encoder:h.encoder,encodeValuesOnly:typeof g.encodeValuesOnly=="boolean"?g.encodeValuesOnly:h.encodeValuesOnly,filter:x,format:y,formatter:b,serializeDate:typeof g.serializeDate=="function"?g.serializeDate:h.serializeDate,skipNulls:typeof g.skipNulls=="boolean"?g.skipNulls:h.skipNulls,sort:typeof g.sort=="function"?g.sort:null,strictNullHandling:typeof g.strictNullHandling=="boolean"?g.strictNullHandling:h.strictNullHandling}};return ln=function(c,g){var p=c,y=m(g),b,x;typeof y.filter=="function"?(x=y.filter,p=x("",p)):s(y.filter)&&(x=y.filter,b=x);var S=[];if(typeof p!="object"||p===null)return"";var _=n[y.arrayFormat],w=_==="comma"&&y.commaRoundTrip;b||(b=Object.keys(p)),y.sort&&b.sort(y.sort);for(var I=i(),V=0;V<b.length;++V){var M=b[V];y.skipNulls&&p[M]===null||o(S,d(p[M],M,_,w,y.allowEmptyArrays,y.strictNullHandling,y.skipNulls,y.encodeDotInKeys,y.encode?y.encoder:null,y.filter,y.sort,y.allowDots,y.serializeDate,y.format,y.formatter,y.encodeValuesOnly,y.charset,I))}var j=S.join(y.delimiter),O=y.addQueryPrefix===!0?"?":"";return y.charsetSentinel&&(y.charset==="iso-8859-1"?O+="utf8=%26%2310003%3B&":O+="utf8=%E2%9C%93&"),j.length>0?O+j:""},ln}var un,Xi;function $o(){if(Xi)return un;Xi=1;var i=Zi(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:i.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},n=function(l){return l.replace(/&#(\d+);/g,function(d,m){return String.fromCharCode(parseInt(m,10))})},s=function(l,d){return l&&typeof l=="string"&&d.comma&&l.indexOf(",")>-1?l.split(","):l},a="utf8=%26%2310003%3B",o="utf8=%E2%9C%93",u=function(d,m){var c={__proto__:null},g=m.ignoreQueryPrefix?d.replace(/^\?/,""):d;g=g.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var p=m.parameterLimit===1/0?void 0:m.parameterLimit,y=g.split(m.delimiter,p),b=-1,x,S=m.charset;if(m.charsetSentinel)for(x=0;x<y.length;++x)y[x].indexOf("utf8=")===0&&(y[x]===o?S="utf-8":y[x]===a&&(S="iso-8859-1"),b=x,x=y.length);for(x=0;x<y.length;++x)if(x!==b){var _=y[x],w=_.indexOf("]="),I=w===-1?_.indexOf("="):w+1,V,M;I===-1?(V=m.decoder(_,r.decoder,S,"key"),M=m.strictNullHandling?null:""):(V=m.decoder(_.slice(0,I),r.decoder,S,"key"),M=i.maybeMap(s(_.slice(I+1),m),function(O){return m.decoder(O,r.decoder,S,"value")})),M&&m.interpretNumericEntities&&S==="iso-8859-1"&&(M=n(M)),_.indexOf("[]=")>-1&&(M=t(M)?[M]:M);var j=e.call(c,V);j&&m.duplicates==="combine"?c[V]=i.combine(c[V],M):(!j||m.duplicates==="last")&&(c[V]=M)}return c},v=function(l,d,m,c){for(var g=c?d:s(d,m),p=l.length-1;p>=0;--p){var y,b=l[p];if(b==="[]"&&m.parseArrays)y=m.allowEmptyArrays&&(g===""||m.strictNullHandling&&g===null)?[]:[].concat(g);else{y=m.plainObjects?Object.create(null):{};var x=b.charAt(0)==="["&&b.charAt(b.length-1)==="]"?b.slice(1,-1):b,S=m.decodeDotInKeys?x.replace(/%2E/g,"."):x,_=parseInt(S,10);!m.parseArrays&&S===""?y={0:g}:!isNaN(_)&&b!==S&&String(_)===S&&_>=0&&m.parseArrays&&_<=m.arrayLimit?(y=[],y[_]=g):S!=="__proto__"&&(y[S]=g)}g=y}return g},h=function(d,m,c,g){if(d){var p=c.allowDots?d.replace(/\.([^.[]+)/g,"[$1]"):d,y=/(\[[^[\]]*])/,b=/(\[[^[\]]*])/g,x=c.depth>0&&y.exec(p),S=x?p.slice(0,x.index):p,_=[];if(S){if(!c.plainObjects&&e.call(Object.prototype,S)&&!c.allowPrototypes)return;_.push(S)}for(var w=0;c.depth>0&&(x=b.exec(p))!==null&&w<c.depth;){if(w+=1,!c.plainObjects&&e.call(Object.prototype,x[1].slice(1,-1))&&!c.allowPrototypes)return;_.push(x[1])}if(x){if(c.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+c.depth+" and strictDepth is true");_.push("["+p.slice(x.index)+"]")}return v(_,m,c,g)}},f=function(d){if(!d)return r;if(typeof d.allowEmptyArrays<"u"&&typeof d.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof d.decodeDotInKeys<"u"&&typeof d.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(d.decoder!==null&&typeof d.decoder<"u"&&typeof d.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof d.charset<"u"&&d.charset!=="utf-8"&&d.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var m=typeof d.charset>"u"?r.charset:d.charset,c=typeof d.duplicates>"u"?r.duplicates:d.duplicates;if(c!=="combine"&&c!=="first"&&c!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var g=typeof d.allowDots>"u"?d.decodeDotInKeys===!0?!0:r.allowDots:!!d.allowDots;return{allowDots:g,allowEmptyArrays:typeof d.allowEmptyArrays=="boolean"?!!d.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof d.allowPrototypes=="boolean"?d.allowPrototypes:r.allowPrototypes,allowSparse:typeof d.allowSparse=="boolean"?d.allowSparse:r.allowSparse,arrayLimit:typeof d.arrayLimit=="number"?d.arrayLimit:r.arrayLimit,charset:m,charsetSentinel:typeof d.charsetSentinel=="boolean"?d.charsetSentinel:r.charsetSentinel,comma:typeof d.comma=="boolean"?d.comma:r.comma,decodeDotInKeys:typeof d.decodeDotInKeys=="boolean"?d.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof d.decoder=="function"?d.decoder:r.decoder,delimiter:typeof d.delimiter=="string"||i.isRegExp(d.delimiter)?d.delimiter:r.delimiter,depth:typeof d.depth=="number"||d.depth===!1?+d.depth:r.depth,duplicates:c,ignoreQueryPrefix:d.ignoreQueryPrefix===!0,interpretNumericEntities:typeof d.interpretNumericEntities=="boolean"?d.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof d.parameterLimit=="number"?d.parameterLimit:r.parameterLimit,parseArrays:d.parseArrays!==!1,plainObjects:typeof d.plainObjects=="boolean"?d.plainObjects:r.plainObjects,strictDepth:typeof d.strictDepth=="boolean"?!!d.strictDepth:r.strictDepth,strictNullHandling:typeof d.strictNullHandling=="boolean"?d.strictNullHandling:r.strictNullHandling}};return un=function(l,d){var m=f(d);if(l===""||l===null||typeof l>"u")return m.plainObjects?Object.create(null):{};for(var c=typeof l=="string"?u(l,m):l,g=m.plainObjects?Object.create(null):{},p=Object.keys(c),y=0;y<p.length;++y){var b=p[y],x=h(b,c[b],m,typeof l=="string");g=i.merge(g,x,m)}return m.allowSparse===!0?g:i.compact(g)},un}var cn,Yi;function Bo(){if(Yi)return cn;Yi=1;var i=Mo(),e=$o(),t=an();return cn={formats:t,parse:e,stringify:i},cn}var Qi;function fn(){if(Qi)return Ve;Qi=1;var i=_o();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,n=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],a=["{","}","|","\\","^","`"].concat(s),o=["'"].concat(a),u=["%","/","?",";","#"].concat(o),v=["/","?","#"],h=255,f=/^[+a-z0-9A-Z_-]{0,63}$/,l=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,d={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},c={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=Bo();function p(S,_,w){if(S&&typeof S=="object"&&S instanceof e)return S;var I=new e;return I.parse(S,_,w),I}e.prototype.parse=function(S,_,w){if(typeof S!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof S);var I=S.indexOf("?"),V=I!==-1&&I<S.indexOf("#")?"?":"#",M=S.split(V),j=/\\/g;M[0]=M[0].replace(j,"/"),S=M.join(V);var O=S;if(O=O.trim(),!w&&S.split("#").length===1){var E=n.exec(O);if(E)return this.path=O,this.href=O,this.pathname=E[1],E[2]?(this.search=E[2],_?this.query=g.parse(this.search.substr(1)):this.query=this.search.substr(1)):_&&(this.search="",this.query={}),this}var P=t.exec(O);if(P){P=P[0];var $=P.toLowerCase();this.protocol=$,O=O.substr(P.length)}if(w||P||O.match(/^\/\/[^@/]+@[^@/]+/)){var H=O.substr(0,2)==="//";H&&!(P&&m[P])&&(O=O.substr(2),this.slashes=!0)}if(!m[P]&&(H||P&&!c[P])){for(var D=-1,k=0;k<v.length;k++){var U=O.indexOf(v[k]);U!==-1&&(D===-1||U<D)&&(D=U)}var C,T;D===-1?T=O.lastIndexOf("@"):T=O.lastIndexOf("@",D),T!==-1&&(C=O.slice(0,T),O=O.slice(T+1),this.auth=decodeURIComponent(C)),D=-1;for(var k=0;k<u.length;k++){var U=O.indexOf(u[k]);U!==-1&&(D===-1||U<D)&&(D=U)}D===-1&&(D=O.length),this.host=O.slice(0,D),O=O.slice(D),this.parseHost(),this.hostname=this.hostname||"";var R=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!R)for(var F=this.hostname.split(/\./),k=0,N=F.length;k<N;k++){var z=F[k];if(z&&!z.match(f)){for(var q="",G=0,Z=z.length;G<Z;G++)z.charCodeAt(G)>127?q+="x":q+=z[G];if(!q.match(f)){var K=F.slice(0,k),X=F.slice(k+1),J=z.match(l);J&&(K.push(J[1]),X.unshift(J[2])),X.length&&(O="/"+X.join(".")+O),this.hostname=K.join(".");break}}}this.hostname.length>h?this.hostname="":this.hostname=this.hostname.toLowerCase(),R||(this.hostname=i.toASCII(this.hostname));var Y=this.port?":"+this.port:"",oe=this.hostname||"";this.host=oe+Y,this.href+=this.host,R&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),O[0]!=="/"&&(O="/"+O))}if(!d[$])for(var k=0,N=o.length;k<N;k++){var ee=o[k];if(O.indexOf(ee)!==-1){var ie=encodeURIComponent(ee);ie===ee&&(ie=escape(ee)),O=O.split(ee).join(ie)}}var Le=O.indexOf("#");Le!==-1&&(this.hash=O.substr(Le),O=O.slice(0,Le));var We=O.indexOf("?");if(We!==-1?(this.search=O.substr(We),this.query=O.substr(We+1),_&&(this.query=g.parse(this.query)),O=O.slice(0,We)):_&&(this.search="",this.query={}),O&&(this.pathname=O),c[$]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var Y=this.pathname||"",zn=this.search||"";this.path=Y+zn}return this.href=this.format(),this};function y(S){return typeof S=="string"&&(S=p(S)),S instanceof e?S.format():e.prototype.format.call(S)}e.prototype.format=function(){var S=this.auth||"";S&&(S=encodeURIComponent(S),S=S.replace(/%3A/i,":"),S+="@");var _=this.protocol||"",w=this.pathname||"",I=this.hash||"",V=!1,M="";this.host?V=S+this.host:this.hostname&&(V=S+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(V+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(M=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var j=this.search||M&&"?"+M||"";return _&&_.substr(-1)!==":"&&(_+=":"),this.slashes||(!_||c[_])&&V!==!1?(V="//"+(V||""),w&&w.charAt(0)!=="/"&&(w="/"+w)):V||(V=""),I&&I.charAt(0)!=="#"&&(I="#"+I),j&&j.charAt(0)!=="?"&&(j="?"+j),w=w.replace(/[?#]/g,function(O){return encodeURIComponent(O)}),j=j.replace("#","%23"),_+V+w+j+I};function b(S,_){return p(S,!1,!0).resolve(_)}e.prototype.resolve=function(S){return this.resolveObject(p(S,!1,!0)).format()};function x(S,_){return S?p(S,!1,!0).resolveObject(_):_}return e.prototype.resolveObject=function(S){if(typeof S=="string"){var _=new e;_.parse(S,!1,!0),S=_}for(var w=new e,I=Object.keys(this),V=0;V<I.length;V++){var M=I[V];w[M]=this[M]}if(w.hash=S.hash,S.href==="")return w.href=w.format(),w;if(S.slashes&&!S.protocol){for(var j=Object.keys(S),O=0;O<j.length;O++){var E=j[O];E!=="protocol"&&(w[E]=S[E])}return c[w.protocol]&&w.hostname&&!w.pathname&&(w.pathname="/",w.path=w.pathname),w.href=w.format(),w}if(S.protocol&&S.protocol!==w.protocol){if(!c[S.protocol]){for(var P=Object.keys(S),$=0;$<P.length;$++){var H=P[$];w[H]=S[H]}return w.href=w.format(),w}if(w.protocol=S.protocol,!S.host&&!m[S.protocol]){for(var N=(S.pathname||"").split("/");N.length&&!(S.host=N.shift()););S.host||(S.host=""),S.hostname||(S.hostname=""),N[0]!==""&&N.unshift(""),N.length<2&&N.unshift(""),w.pathname=N.join("/")}else w.pathname=S.pathname;if(w.search=S.search,w.query=S.query,w.host=S.host||"",w.auth=S.auth,w.hostname=S.hostname||S.host,w.port=S.port,w.pathname||w.search){var D=w.pathname||"",k=w.search||"";w.path=D+k}return w.slashes=w.slashes||S.slashes,w.href=w.format(),w}var U=w.pathname&&w.pathname.charAt(0)==="/",C=S.host||S.pathname&&S.pathname.charAt(0)==="/",T=C||U||w.host&&S.pathname,R=T,F=w.pathname&&w.pathname.split("/")||[],N=S.pathname&&S.pathname.split("/")||[],z=w.protocol&&!c[w.protocol];if(z&&(w.hostname="",w.port=null,w.host&&(F[0]===""?F[0]=w.host:F.unshift(w.host)),w.host="",S.protocol&&(S.hostname=null,S.port=null,S.host&&(N[0]===""?N[0]=S.host:N.unshift(S.host)),S.host=null),T=T&&(N[0]===""||F[0]==="")),C)w.host=S.host||S.host===""?S.host:w.host,w.hostname=S.hostname||S.hostname===""?S.hostname:w.hostname,w.search=S.search,w.query=S.query,F=N;else if(N.length)F||(F=[]),F.pop(),F=F.concat(N),w.search=S.search,w.query=S.query;else if(S.search!=null){if(z){w.host=F.shift(),w.hostname=w.host;var q=w.host&&w.host.indexOf("@")>0?w.host.split("@"):!1;q&&(w.auth=q.shift(),w.hostname=q.shift(),w.host=w.hostname)}return w.search=S.search,w.query=S.query,(w.pathname!==null||w.search!==null)&&(w.path=(w.pathname?w.pathname:"")+(w.search?w.search:"")),w.href=w.format(),w}if(!F.length)return w.pathname=null,w.search?w.path="/"+w.search:w.path=null,w.href=w.format(),w;for(var G=F.slice(-1)[0],Z=(w.host||S.host||F.length>1)&&(G==="."||G==="..")||G==="",K=0,X=F.length;X>=0;X--)G=F[X],G==="."?F.splice(X,1):G===".."?(F.splice(X,1),K++):K&&(F.splice(X,1),K--);if(!T&&!R)for(;K--;K)F.unshift("..");T&&F[0]!==""&&(!F[0]||F[0].charAt(0)!=="/")&&F.unshift(""),Z&&F.join("/").substr(-1)!=="/"&&F.push("");var J=F[0]===""||F[0]&&F[0].charAt(0)==="/";if(z){w.hostname=J?"":F.length?F.shift():"",w.host=w.hostname;var q=w.host&&w.host.indexOf("@")>0?w.host.split("@"):!1;q&&(w.auth=q.shift(),w.hostname=q.shift(),w.host=w.hostname)}return T=T||w.host&&F.length,T&&!J&&F.unshift(""),F.length>0?w.pathname=F.join("/"):(w.pathname=null,w.path=null),(w.pathname!==null||w.search!==null)&&(w.path=(w.pathname?w.pathname:"")+(w.search?w.search:"")),w.auth=S.auth||w.auth,w.slashes=w.slashes||S.slashes,w.href=w.format(),w},e.prototype.parseHost=function(){var S=this.host,_=r.exec(S);_&&(_=_[0],_!==":"&&(this.port=_.substr(1)),S=S.substr(0,S.length-_.length)),S&&(this.hostname=S)},Ve.parse=p,Ve.resolve=b,Ve.resolveObject=x,Ve.format=y,Ve.Url=e,Ve}var ge={},es;function ze(){if(es)return ge;es=1;var i=fn(),e=ge.ValidationError=function(c,g,p,y,b,x){if(Array.isArray(y)?(this.path=y,this.property=y.reduce(function(_,w){return _+u(w)},"instance")):y!==void 0&&(this.property=y),c&&(this.message=c),p){var S=p.$id||p.id;this.schema=S||p}g!==void 0&&(this.instance=g),this.name=b,this.argument=x,this.stack=this.toString()};e.prototype.toString=function(){return this.property+" "+this.message};var t=ge.ValidatorResult=function(c,g,p,y){this.instance=c,this.schema=g,this.options=p,this.path=y.path,this.propertyPath=y.propertyPath,this.errors=[],this.throwError=p&&p.throwError,this.throwFirst=p&&p.throwFirst,this.throwAll=p&&p.throwAll,this.disableFormat=p&&p.disableFormat===!0};t.prototype.addError=function(c){var g;if(typeof c=="string")g=new e(c,this.instance,this.schema,this.path);else{if(!c)throw new Error("Missing error detail");if(!c.message)throw new Error("Missing error message");if(!c.name)throw new Error("Missing validator type");g=new e(c.message,this.instance,this.schema,this.path,c.name,c.argument)}if(this.errors.push(g),this.throwFirst)throw new n(this);if(this.throwError)throw g;return g},t.prototype.importErrors=function(c){typeof c=="string"||c&&c.validatorType?this.addError(c):c&&c.errors&&(this.errors=this.errors.concat(c.errors))};function r(m,c){return c+": "+m.toString()+`
`}t.prototype.toString=function(c){return this.errors.map(r).join("")},Object.defineProperty(t.prototype,"valid",{get:function(){return!this.errors.length}}),ge.ValidatorResultError=n;function n(m){Error.captureStackTrace&&Error.captureStackTrace(this,n),this.instance=m.instance,this.schema=m.schema,this.options=m.options,this.errors=m.errors}n.prototype=new Error,n.prototype.constructor=n,n.prototype.name="Validation Error";var s=ge.SchemaError=function m(c,g){this.message=c,this.schema=g,Error.call(this,c),Error.captureStackTrace(this,m)};s.prototype=Object.create(Error.prototype,{constructor:{value:s,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var a=ge.SchemaContext=function(c,g,p,y,b){this.schema=c,this.options=g,Array.isArray(p)?(this.path=p,this.propertyPath=p.reduce(function(x,S){return x+u(S)},"instance")):this.propertyPath=p,this.base=y,this.schemas=b};a.prototype.resolve=function(c){return i.resolve(this.base,c)},a.prototype.makeChild=function(c,g){var p=g===void 0?this.path:this.path.concat([g]),y=c.$id||c.id,b=i.resolve(this.base,y||""),x=new a(c,this.options,p,b,Object.create(this.schemas));return y&&!x.schemas[b]&&(x.schemas[b]=c),x};var o=ge.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,duration:/P(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S)|\d+(D|M(\d+D)?|Y(\d+M(\d+D)?)?)(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S))?|\d+W)/i,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"idn-email":/^("(?:[!#-\[\]-\u{10FFFF}]|\\[\t -\u{10FFFF}])*"|[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*)@([!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*|\[[!-Z\^-\u{10FFFF}]*\])$/u,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"uri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/,iri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"iri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~-\u{10FFFF}]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~-\u{10FFFF}])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/u,uuid:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,"uri-template":/(%[0-9a-f]{2}|[!#$&(-;=?@\[\]_a-z~]|\{[!#&+,./;=?@|]?(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?(,(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?)*\})*/iu,"json-pointer":/^(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*$/iu,"relative-json-pointer":/^\d+(#|(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*)$/iu,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"utc-millisec":function(m){return typeof m=="string"&&parseFloat(m)===parseInt(m,10)&&!isNaN(m)},regex:function(m){var c=!0;try{new RegExp(m)}catch{c=!1}return c},style:/[\r\n\t ]*[^\r\n\t ][^:]*:[\r\n\t ]*[^\r\n\t ;]*[\r\n\t ]*;?/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/};o.regexp=o.regex,o.pattern=o.regex,o.ipv4=o["ip-address"],ge.isFormat=function(c,g,p){if(typeof c=="string"&&o[g]!==void 0){if(o[g]instanceof RegExp)return o[g].test(c);if(typeof o[g]=="function")return o[g](c)}else if(p&&p.customFormats&&typeof p.customFormats[g]=="function")return p.customFormats[g](c);return!0};var u=ge.makeSuffix=function(c){return c=c.toString(),!c.match(/[.\s\[\]]/)&&!c.match(/^[\d]/)?"."+c:c.match(/^\d+$/)?"["+c+"]":"["+JSON.stringify(c)+"]"};ge.deepCompareStrict=function m(c,g){if(typeof c!=typeof g)return!1;if(Array.isArray(c))return!Array.isArray(g)||c.length!==g.length?!1:c.every(function(b,x){return m(c[x],g[x])});if(typeof c=="object"){if(!c||!g)return c===g;var p=Object.keys(c),y=Object.keys(g);return p.length!==y.length?!1:p.every(function(b){return m(c[b],g[b])})}return c===g};function v(m,c,g,p){typeof g=="object"?c[p]=l(m[p],g):m.indexOf(g)===-1&&c.push(g)}function h(m,c,g){c[g]=m[g]}function f(m,c,g,p){typeof c[p]!="object"||!c[p]?g[p]=c[p]:m[p]?g[p]=l(m[p],c[p]):g[p]=c[p]}function l(m,c){var g=Array.isArray(c),p=g&&[]||{};return g?(m=m||[],p=p.concat(m),c.forEach(v.bind(null,m,p))):(m&&typeof m=="object"&&Object.keys(m).forEach(h.bind(null,m,p)),Object.keys(c).forEach(f.bind(null,m,c,p))),p}ge.deepMerge=l,ge.objectGetPath=function(c,g){for(var p=g.split("/").slice(1),y;typeof(y=p.shift())=="string";){var b=decodeURIComponent(y.replace(/~0/,"~").replace(/~1/g,"/"));if(!(b in c))return;c=c[b]}return c};function d(m){return"/"+encodeURIComponent(m).replace(/~/g,"%7E")}return ge.encodePath=function(c){return c.map(d).join("")},ge.getDecimalPlaces=function(c){var g=0;if(isNaN(c))return g;typeof c!="number"&&(c=Number(c));var p=c.toString().split("e");if(p.length===2){if(p[1][0]!=="-")return g;g=Number(p[1].slice(1))}var y=p[0].split(".");return y.length===2&&(g+=y[1].length),g},ge.isSchema=function(c){return typeof c=="object"&&c||typeof c=="boolean"},ge}var dn,ts;function Uo(){if(ts)return dn;ts=1;var i=ze(),e=i.ValidatorResult,t=i.SchemaError,r={};r.ignoreProperties={id:!0,default:!0,description:!0,title:!0,additionalItems:!0,then:!0,else:!0,$schema:!0,$ref:!0,extends:!0};var n=r.validators={};n.type=function(f,l,d,m){if(f===void 0)return null;var c=new e(f,l,d,m),g=Array.isArray(l.type)?l.type:[l.type];if(!g.some(this.testType.bind(this,f,l,d,m))){var p=g.map(function(y){if(y){var b=y.$id||y.id;return b?"<"+b+">":y+""}});c.addError({name:"type",argument:p,message:"is not of a type(s) "+p})}return c};function s(h,f,l,d,m){var c=f.throwError,g=f.throwAll;f.throwError=!1,f.throwAll=!1;var p=this.validateSchema(h,m,f,l);return f.throwError=c,f.throwAll=g,!p.valid&&d instanceof Function&&d(p),p.valid}n.anyOf=function(f,l,d,m){if(f===void 0)return null;var c=new e(f,l,d,m),g=new e(f,l,d,m);if(!Array.isArray(l.anyOf))throw new t("anyOf must be an array");if(!l.anyOf.some(s.bind(this,f,d,m,function(y){g.importErrors(y)}))){var p=l.anyOf.map(function(y,b){var x=y.$id||y.id;return x?"<"+x+">":y.title&&JSON.stringify(y.title)||y.$ref&&"<"+y.$ref+">"||"[subschema "+b+"]"});d.nestedErrors&&c.importErrors(g),c.addError({name:"anyOf",argument:p,message:"is not any of "+p.join(",")})}return c},n.allOf=function(f,l,d,m){if(f===void 0)return null;if(!Array.isArray(l.allOf))throw new t("allOf must be an array");var c=new e(f,l,d,m),g=this;return l.allOf.forEach(function(p,y){var b=g.validateSchema(f,p,d,m);if(!b.valid){var x=p.$id||p.id,S=x||p.title&&JSON.stringify(p.title)||p.$ref&&"<"+p.$ref+">"||"[subschema "+y+"]";c.addError({name:"allOf",argument:{id:S,length:b.errors.length,valid:b},message:"does not match allOf schema "+S+" with "+b.errors.length+" error[s]:"}),c.importErrors(b)}}),c},n.oneOf=function(f,l,d,m){if(f===void 0)return null;if(!Array.isArray(l.oneOf))throw new t("oneOf must be an array");var c=new e(f,l,d,m),g=new e(f,l,d,m),p=l.oneOf.filter(s.bind(this,f,d,m,function(b){g.importErrors(b)})).length,y=l.oneOf.map(function(b,x){var S=b.$id||b.id;return S||b.title&&JSON.stringify(b.title)||b.$ref&&"<"+b.$ref+">"||"[subschema "+x+"]"});return p!==1&&(d.nestedErrors&&c.importErrors(g),c.addError({name:"oneOf",argument:y,message:"is not exactly one from "+y.join(",")})),c},n.if=function(f,l,d,m){if(f===void 0)return null;if(!i.isSchema(l.if))throw new Error('Expected "if" keyword to be a schema');var c=s.call(this,f,d,m,null,l.if),g=new e(f,l,d,m),p;if(c){if(l.then===void 0)return;if(!i.isSchema(l.then))throw new Error('Expected "then" keyword to be a schema');p=this.validateSchema(f,l.then,d,m.makeChild(l.then)),g.importErrors(p)}else{if(l.else===void 0)return;if(!i.isSchema(l.else))throw new Error('Expected "else" keyword to be a schema');p=this.validateSchema(f,l.else,d,m.makeChild(l.else)),g.importErrors(p)}return g};function a(h,f){if(Object.hasOwnProperty.call(h,f))return h[f];if(f in h){for(;h=Object.getPrototypeOf(h);)if(Object.propertyIsEnumerable.call(h,f))return h[f]}}n.propertyNames=function(f,l,d,m){if(this.types.object(f)){var c=new e(f,l,d,m),g=l.propertyNames!==void 0?l.propertyNames:{};if(!i.isSchema(g))throw new t('Expected "propertyNames" to be a schema (object or boolean)');for(var p in f)if(a(f,p)!==void 0){var y=this.validateSchema(p,g,d,m.makeChild(g));c.importErrors(y)}return c}},n.properties=function(f,l,d,m){if(this.types.object(f)){var c=new e(f,l,d,m),g=l.properties||{};for(var p in g){var y=g[p];if(y!==void 0){if(y===null)throw new t('Unexpected null, expected schema in "properties"');typeof d.preValidateProperty=="function"&&d.preValidateProperty(f,p,y,d,m);var b=a(f,p),x=this.validateSchema(b,y,d,m.makeChild(y,p));x.instance!==c.instance[p]&&(c.instance[p]=x.instance),c.importErrors(x)}}return c}};function o(h,f,l,d,m,c){if(this.types.object(h)&&!(f.properties&&f.properties[m]!==void 0))if(f.additionalProperties===!1)c.addError({name:"additionalProperties",argument:m,message:"is not allowed to have the additional property "+JSON.stringify(m)});else{var g=f.additionalProperties||{};typeof l.preValidateProperty=="function"&&l.preValidateProperty(h,m,g,l,d);var p=this.validateSchema(h[m],g,l,d.makeChild(g,m));p.instance!==c.instance[m]&&(c.instance[m]=p.instance),c.importErrors(p)}}n.patternProperties=function(f,l,d,m){if(this.types.object(f)){var c=new e(f,l,d,m),g=l.patternProperties||{};for(var p in f){var y=!0;for(var b in g){var x=g[b];if(x!==void 0){if(x===null)throw new t('Unexpected null, expected schema in "patternProperties"');try{var S=new RegExp(b,"u")}catch{S=new RegExp(b)}if(S.test(p)){y=!1,typeof d.preValidateProperty=="function"&&d.preValidateProperty(f,p,x,d,m);var _=this.validateSchema(f[p],x,d,m.makeChild(x,p));_.instance!==c.instance[p]&&(c.instance[p]=_.instance),c.importErrors(_)}}}y&&o.call(this,f,l,d,m,p,c)}return c}},n.additionalProperties=function(f,l,d,m){if(this.types.object(f)){if(l.patternProperties)return null;var c=new e(f,l,d,m);for(var g in f)o.call(this,f,l,d,m,g,c);return c}},n.minProperties=function(f,l,d,m){if(this.types.object(f)){var c=new e(f,l,d,m),g=Object.keys(f);return g.length>=l.minProperties||c.addError({name:"minProperties",argument:l.minProperties,message:"does not meet minimum property length of "+l.minProperties}),c}},n.maxProperties=function(f,l,d,m){if(this.types.object(f)){var c=new e(f,l,d,m),g=Object.keys(f);return g.length<=l.maxProperties||c.addError({name:"maxProperties",argument:l.maxProperties,message:"does not meet maximum property length of "+l.maxProperties}),c}},n.items=function(f,l,d,m){var c=this;if(this.types.array(f)&&l.items!==void 0){var g=new e(f,l,d,m);return f.every(function(p,y){if(Array.isArray(l.items))var b=l.items[y]===void 0?l.additionalItems:l.items[y];else var b=l.items;if(b===void 0)return!0;if(b===!1)return g.addError({name:"items",message:"additionalItems not permitted"}),!1;var x=c.validateSchema(p,b,d,m.makeChild(b,y));return x.instance!==g.instance[y]&&(g.instance[y]=x.instance),g.importErrors(x),!0}),g}},n.contains=function(f,l,d,m){var c=this;if(this.types.array(f)&&l.contains!==void 0){if(!i.isSchema(l.contains))throw new Error('Expected "contains" keyword to be a schema');var g=new e(f,l,d,m),p=f.some(function(y,b){var x=c.validateSchema(y,l.contains,d,m.makeChild(l.contains,b));return x.errors.length===0});return p===!1&&g.addError({name:"contains",argument:l.contains,message:"must contain an item matching given schema"}),g}},n.minimum=function(f,l,d,m){if(this.types.number(f)){var c=new e(f,l,d,m);return l.exclusiveMinimum&&l.exclusiveMinimum===!0?f>l.minimum||c.addError({name:"minimum",argument:l.minimum,message:"must be greater than "+l.minimum}):f>=l.minimum||c.addError({name:"minimum",argument:l.minimum,message:"must be greater than or equal to "+l.minimum}),c}},n.maximum=function(f,l,d,m){if(this.types.number(f)){var c=new e(f,l,d,m);return l.exclusiveMaximum&&l.exclusiveMaximum===!0?f<l.maximum||c.addError({name:"maximum",argument:l.maximum,message:"must be less than "+l.maximum}):f<=l.maximum||c.addError({name:"maximum",argument:l.maximum,message:"must be less than or equal to "+l.maximum}),c}},n.exclusiveMinimum=function(f,l,d,m){if(typeof l.exclusiveMinimum!="boolean"&&this.types.number(f)){var c=new e(f,l,d,m),g=f>l.exclusiveMinimum;return g||c.addError({name:"exclusiveMinimum",argument:l.exclusiveMinimum,message:"must be strictly greater than "+l.exclusiveMinimum}),c}},n.exclusiveMaximum=function(f,l,d,m){if(typeof l.exclusiveMaximum!="boolean"&&this.types.number(f)){var c=new e(f,l,d,m),g=f<l.exclusiveMaximum;return g||c.addError({name:"exclusiveMaximum",argument:l.exclusiveMaximum,message:"must be strictly less than "+l.exclusiveMaximum}),c}};var u=function(f,l,d,m,c,g){if(this.types.number(f)){var p=l[c];if(p==0)throw new t(c+" cannot be zero");var y=new e(f,l,d,m),b=i.getDecimalPlaces(f),x=i.getDecimalPlaces(p),S=Math.max(b,x),_=Math.pow(10,S);return Math.round(f*_)%Math.round(p*_)!==0&&y.addError({name:c,argument:p,message:g+JSON.stringify(p)}),y}};n.multipleOf=function(f,l,d,m){return u.call(this,f,l,d,m,"multipleOf","is not a multiple of (divisible by) ")},n.divisibleBy=function(f,l,d,m){return u.call(this,f,l,d,m,"divisibleBy","is not divisible by (multiple of) ")},n.required=function(f,l,d,m){var c=new e(f,l,d,m);return f===void 0&&l.required===!0?c.addError({name:"required",message:"is required"}):this.types.object(f)&&Array.isArray(l.required)&&l.required.forEach(function(g){a(f,g)===void 0&&c.addError({name:"required",argument:g,message:"requires property "+JSON.stringify(g)})}),c},n.pattern=function(f,l,d,m){if(this.types.string(f)){var c=new e(f,l,d,m),g=l.pattern;try{var p=new RegExp(g,"u")}catch{p=new RegExp(g)}return f.match(p)||c.addError({name:"pattern",argument:l.pattern,message:"does not match pattern "+JSON.stringify(l.pattern.toString())}),c}},n.format=function(f,l,d,m){if(f!==void 0){var c=new e(f,l,d,m);return!c.disableFormat&&!i.isFormat(f,l.format,this)&&c.addError({name:"format",argument:l.format,message:"does not conform to the "+JSON.stringify(l.format)+" format"}),c}},n.minLength=function(f,l,d,m){if(this.types.string(f)){var c=new e(f,l,d,m),g=f.match(/[\uDC00-\uDFFF]/g),p=f.length-(g?g.length:0);return p>=l.minLength||c.addError({name:"minLength",argument:l.minLength,message:"does not meet minimum length of "+l.minLength}),c}},n.maxLength=function(f,l,d,m){if(this.types.string(f)){var c=new e(f,l,d,m),g=f.match(/[\uDC00-\uDFFF]/g),p=f.length-(g?g.length:0);return p<=l.maxLength||c.addError({name:"maxLength",argument:l.maxLength,message:"does not meet maximum length of "+l.maxLength}),c}},n.minItems=function(f,l,d,m){if(this.types.array(f)){var c=new e(f,l,d,m);return f.length>=l.minItems||c.addError({name:"minItems",argument:l.minItems,message:"does not meet minimum length of "+l.minItems}),c}},n.maxItems=function(f,l,d,m){if(this.types.array(f)){var c=new e(f,l,d,m);return f.length<=l.maxItems||c.addError({name:"maxItems",argument:l.maxItems,message:"does not meet maximum length of "+l.maxItems}),c}};function v(h,f,l){var d,m=l.length;for(d=f+1,m;d<m;d++)if(i.deepCompareStrict(h,l[d]))return!1;return!0}return n.uniqueItems=function(f,l,d,m){if(l.uniqueItems===!0&&this.types.array(f)){var c=new e(f,l,d,m);return f.every(v)||c.addError({name:"uniqueItems",message:"contains duplicate item"}),c}},n.dependencies=function(f,l,d,m){if(this.types.object(f)){var c=new e(f,l,d,m);for(var g in l.dependencies)if(f[g]!==void 0){var p=l.dependencies[g],y=m.makeChild(p,g);if(typeof p=="string"&&(p=[p]),Array.isArray(p))p.forEach(function(x){f[x]===void 0&&c.addError({name:"dependencies",argument:y.propertyPath,message:"property "+x+" not found, required by "+y.propertyPath})});else{var b=this.validateSchema(f,p,d,y);c.instance!==b.instance&&(c.instance=b.instance),b&&b.errors.length&&(c.addError({name:"dependencies",argument:y.propertyPath,message:"does not meet dependency required by "+y.propertyPath}),c.importErrors(b))}}return c}},n.enum=function(f,l,d,m){if(f===void 0)return null;if(!Array.isArray(l.enum))throw new t("enum expects an array",l);var c=new e(f,l,d,m);return l.enum.some(i.deepCompareStrict.bind(null,f))||c.addError({name:"enum",argument:l.enum,message:"is not one of enum values: "+l.enum.map(String).join(",")}),c},n.const=function(f,l,d,m){if(f===void 0)return null;var c=new e(f,l,d,m);return i.deepCompareStrict(l.const,f)||c.addError({name:"const",argument:l.const,message:"does not exactly match expected constant: "+l.const}),c},n.not=n.disallow=function(f,l,d,m){var c=this;if(f===void 0)return null;var g=new e(f,l,d,m),p=l.not||l.disallow;return p?(Array.isArray(p)||(p=[p]),p.forEach(function(y){if(c.testType(f,l,d,m,y)){var b=y&&(y.$id||y.id),x=b||y;g.addError({name:"not",argument:x,message:"is of prohibited type "+x})}}),g):null},dn=r,dn}var Ft={},rs;function hn(){if(rs)return Ft;rs=1;var i=fn(),e=ze();Ft.SchemaScanResult=t;function t(r,n){this.id=r,this.ref=n}return Ft.scan=function(n,s){function a(f,l){if(!(!l||typeof l!="object")){if(l.$ref){var d=i.resolve(f,l.$ref);h[d]=h[d]?h[d]+1:0;return}var m=l.$id||l.id,c=m?i.resolve(f,m):f;if(c){if(c.indexOf("#")<0&&(c+="#"),v[c]){if(!e.deepCompareStrict(v[c],l))throw new Error("Schema <"+c+"> already exists with different definition");return v[c]}v[c]=l,c[c.length-1]=="#"&&(v[c.substring(0,c.length-1)]=l)}o(c+"/items",Array.isArray(l.items)?l.items:[l.items]),o(c+"/extends",Array.isArray(l.extends)?l.extends:[l.extends]),a(c+"/additionalItems",l.additionalItems),u(c+"/properties",l.properties),a(c+"/additionalProperties",l.additionalProperties),u(c+"/definitions",l.definitions),u(c+"/patternProperties",l.patternProperties),u(c+"/dependencies",l.dependencies),o(c+"/disallow",l.disallow),o(c+"/allOf",l.allOf),o(c+"/anyOf",l.anyOf),o(c+"/oneOf",l.oneOf),a(c+"/not",l.not)}}function o(f,l){if(Array.isArray(l))for(var d=0;d<l.length;d++)a(f+"/"+d,l[d])}function u(f,l){if(!(!l||typeof l!="object"))for(var d in l)a(f+"/"+d,l[d])}var v={},h={};return a(n,s),new t(v,h)},Ft}var pn,ns;function jo(){if(ns)return pn;ns=1;var i=fn(),e=Uo(),t=ze(),r=hn().scan,n=t.ValidatorResult,s=t.ValidatorResultError,a=t.SchemaError,o=t.SchemaContext,u="/",v=function l(){this.customFormats=Object.create(l.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(f),this.attributes=Object.create(e.validators)};v.prototype.customFormats={},v.prototype.schemas=null,v.prototype.types=null,v.prototype.attributes=null,v.prototype.unresolvedRefs=null,v.prototype.addSchema=function(d,m){var c=this;if(!d)return null;var g=r(m||u,d),p=m||d.$id||d.id;for(var y in g.id)this.schemas[y]=g.id[y];for(var y in g.ref)this.unresolvedRefs.push(y);return this.unresolvedRefs=this.unresolvedRefs.filter(function(b){return typeof c.schemas[b]>"u"}),this.schemas[p]},v.prototype.addSubSchemaArray=function(d,m){if(Array.isArray(m))for(var c=0;c<m.length;c++)this.addSubSchema(d,m[c])},v.prototype.addSubSchemaObject=function(d,m){if(!(!m||typeof m!="object"))for(var c in m)this.addSubSchema(d,m[c])},v.prototype.setSchemas=function(d){this.schemas=d},v.prototype.getSchema=function(d){return this.schemas[d]},v.prototype.validate=function(d,m,c,g){if(typeof m!="boolean"&&typeof m!="object"||m===null)throw new a("Expected `schema` to be an object or boolean");c||(c={});var p=m.$id||m.id,y=i.resolve(c.base||u,p||"");if(!g){g=new o(m,c,[],y,Object.create(this.schemas)),g.schemas[y]||(g.schemas[y]=m);var b=r(y,m);for(var x in b.id){var S=b.id[x];g.schemas[x]=S}}if(c.required&&d===void 0){var _=new n(d,m,c,g);return _.addError("is required, but is undefined"),_}var _=this.validateSchema(d,m,c,g);if(_){if(c.throwAll&&_.errors.length)throw new s(_)}else throw new Error("Result undefined");return _};function h(l){var d=typeof l=="string"?l:l.$ref;return typeof d=="string"?d:!1}v.prototype.validateSchema=function(d,m,c,g){var p=new n(d,m,c,g);if(typeof m=="boolean")m===!0?m={}:m===!1&&(m={type:[]});else if(!m)throw new Error("schema is undefined");if(m.extends)if(Array.isArray(m.extends)){var y={schema:m,ctx:g};m.extends.forEach(this.schemaTraverser.bind(this,y)),m=y.schema,y.schema=null,y.ctx=null,y=null}else m=t.deepMerge(m,this.superResolve(m.extends,g));var b=h(m);if(b){var x=this.resolve(m,b,g),S=new o(x.subschema,c,g.path,x.switchSchema,g.schemas);return this.validateSchema(d,x.subschema,c,S)}var _=c&&c.skipAttributes||[];for(var w in m)if(!e.ignoreProperties[w]&&_.indexOf(w)<0){var I=null,V=this.attributes[w];if(V)I=V.call(this,d,m,c,g);else if(c.allowUnknownAttributes===!1)throw new a("Unsupported attribute: "+w,m);I&&p.importErrors(I)}if(typeof c.rewrite=="function"){var M=c.rewrite.call(this,d,m,c,g);p.instance=M}return p},v.prototype.schemaTraverser=function(d,m){d.schema=t.deepMerge(d.schema,this.superResolve(m,d.ctx))},v.prototype.superResolve=function(d,m){var c=h(d);return c?this.resolve(d,c,m).subschema:d},v.prototype.resolve=function(d,m,c){if(m=c.resolve(m),c.schemas[m])return{subschema:c.schemas[m],switchSchema:m};var g=i.parse(m),p=g&&g.hash,y=p&&p.length&&m.substr(0,m.length-p.length);if(!y||!c.schemas[y])throw new a("no such schema <"+m+">",d);var b=t.objectGetPath(c.schemas[y],p.substr(1));if(b===void 0)throw new a("no such schema "+p+" located in <"+y+">",d);return{subschema:b,switchSchema:m}},v.prototype.testType=function(d,m,c,g,p){if(p!==void 0){if(p===null)throw new a('Unexpected null in "type" keyword');if(typeof this.types[p]=="function")return this.types[p].call(this,d);if(p&&typeof p=="object"){var y=this.validateSchema(d,p,c,g);return y===void 0||!(y&&y.errors.length)}return!0}};var f=v.prototype.types={};return f.string=function(d){return typeof d=="string"},f.number=function(d){return typeof d=="number"&&isFinite(d)},f.integer=function(d){return typeof d=="number"&&d%1===0},f.boolean=function(d){return typeof d=="boolean"},f.array=function(d){return Array.isArray(d)},f.null=function(d){return d===null},f.date=function(d){return d instanceof Date},f.any=function(d){return!0},f.object=function(d){return d&&typeof d=="object"&&!Array.isArray(d)&&!(d instanceof Date)},pn=v,pn}var is;function Do(){if(is)return Pe;is=1;var i=Pe.Validator=jo();return Pe.ValidatorResult=ze().ValidatorResult,Pe.ValidatorResultError=ze().ValidatorResultError,Pe.ValidationError=ze().ValidationError,Pe.SchemaError=ze().SchemaError,Pe.SchemaScanResult=hn().SchemaScanResult,Pe.scan=hn().scan,Pe.validate=function(e,t,r){var n=new i;return n.validate(e,t,r)},Pe}Do();function Je(i){const e=new Uint8Array(i);return Vo(e)}function Vo(i){let e="";const t=i.byteLength;for(let r=0;r<t;++r)e+=String.fromCharCode(i[r]);return window.btoa(e)}const ss=i=>new Promise(async(e,t)=>{try{var r=new FileReader;r.readAsDataURL(i),r.onloadend=()=>{const n=r.result,s=n.substring(n.indexOf(",")+1);e(s)}}catch(n){t(n)}}),Ho=i=>{const e=atob(i),t=new Uint8Array(e.length);for(let r=0;r<t.length;++r)t[r]=e.charCodeAt(r);return t},gn=(i,e)=>{const t=Ho(i);return new Blob([t.buffer],{type:e})},zo=["en","es","de","ja","pl","pt_BR","zh_CN","ru","fi","fr","ko"];function qo(i){const e=i.toLowerCase().trim().split(/\s*;\s*/);return e[0]==="banner"?{name:e[0],delay:e[1]*1||0,leftToRight:e[2]*1||0,fadeAwayWidth:e[3]*1||0}:/^scroll\s/.test(e[0])?{name:e[0],y1:Math.min(e[1]*1,e[2]*1),y2:Math.max(e[1]*1,e[2]*1),delay:e[3]*1||0,fadeAwayHeight:e[4]*1||0}:null}function mn(i){return i?i.toLowerCase().replace(/([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?)/g," $1 ").replace(/([mnlbspc])/g," $1 ").trim().replace(/\s+/g," ").split(/\s(?=[mnlbspc])/).map(e=>e.split(" ").filter((t,r)=>!(r&&Number.isNaN(t*1)))):[]}const as=["b","i","u","s","fsp","k","K","kf","ko","kt","fe","q","p","pbo","a","an","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"].map(i=>({name:i,regex:new RegExp(`^${i}-?\\d`)}));function os(i){const e={};for(let t=0;t<as.length;t++){const{name:r,regex:n}=as[t];if(n.test(i))return e[r]=i.slice(r.length)*1,e}if(/^fn/.test(i))e.fn=i.slice(2);else if(/^r/.test(i))e.r=i.slice(1);else if(/^fs[\d+-]/.test(i))e.fs=i.slice(2);else if(/^\d?c&?H?[0-9a-f]+|^\d?c$/i.test(i)){const[,t,r]=i.match(/^(\d?)c&?H?(\w*)/);e[`c${t||1}`]=r&&`000000${r}`.slice(-6)}else if(/^\da&?H?[0-9a-f]+/i.test(i)){const[,t,r]=i.match(/^(\d)a&?H?(\w\w)/);e[`a${t}`]=r}else if(/^alpha&?H?[0-9a-f]+/i.test(i))[,e.alpha]=i.match(/^alpha&?H?([0-9a-f]+)/i),e.alpha=`00${e.alpha}`.slice(-2);else if(/^(?:pos|org|move|fad|fade)\(/.test(i)){const[,t,r]=i.match(/^(\w+)\((.*?)\)?$/);e[t]=r.trim().split(/\s*,\s*/).map(Number)}else if(/^i?clip/.test(i)){const t=i.match(/^i?clip\((.*?)\)?$/)[1].trim().split(/\s*,\s*/);e.clip={inverse:/iclip/.test(i),scale:1,drawing:null,dots:null},t.length===1&&(e.clip.drawing=mn(t[0])),t.length===2&&(e.clip.scale=t[0]*1,e.clip.drawing=mn(t[1])),t.length===4&&(e.clip.dots=t.map(Number))}else if(/^t\(/.test(i)){const t=i.match(/^t\((.*?)\)?$/)[1].trim().replace(/\\.*/,r=>r.replace(/,/g,`
`)).split(/\s*,\s*/);if(!t[0])return e;e.t={t1:0,t2:0,accel:1,tags:t[t.length-1].replace(/\n/g,",").split("\\").slice(1).map(os)},t.length===2&&(e.t.accel=t[0]*1),t.length===3&&(e.t.t1=t[0]*1,e.t.t2=t[1]*1),t.length===4&&(e.t.t1=t[0]*1,e.t.t2=t[1]*1,e.t.accel=t[2]*1)}return e}function Wo(i){const e=[];let t=0,r="";for(let n=0;n<i.length;n++){const s=i[n];s==="("&&t++,s===")"&&t--,t<0&&(t=0),!t&&s==="\\"?(r&&e.push(r),r=""):r+=s}return e.push(r),e.map(os)}function Go(i){const e=i.split(/{([^{}]*?)}/),t=[];e[0].length&&t.push({tags:[],text:e[0],drawing:[]});for(let r=1;r<e.length;r+=2){const n=Wo(e[r]),s=n.reduce((a,o)=>o.p===void 0?a:!!o.p,!1);t.push({tags:n,text:s?"":e[r+1],drawing:s?mn(e[r+1]):[]})}return{raw:i,combined:t.map(r=>r.text).join(""),parsed:t}}function Ko(i){const e=i.split(":");return e[0]*3600+e[1]*60+e[2]*1}function Zo(i,e){let t=i.split(",");if(t.length>e.length){const n=t.slice(e.length-1).join();t=t.slice(0,e.length-1),t.push(n)}const r={};for(let n=0;n<t.length;n++){const s=e[n],a=t[n].trim();switch(s){case"Layer":case"MarginL":case"MarginR":case"MarginV":r[s]=a*1;break;case"Start":case"End":r[s]=Ko(a);break;case"Effect":r[s]=qo(a);break;case"Text":r[s]=Go(a);break;default:r[s]=a}}return r}function ls(i){return i.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/)}const Ne=Object.assign||function(e,...t){for(let r=0;r<t.length;r++){if(!t[r])continue;const n=Object.keys(t[r]);for(let s=0;s<n.length;s++)e[n[s]]=t[r][n[s]]}return e};function Jo(i,e){const t=i.match(/Style\s*:\s*(.*)/i)[1].split(/\s*,\s*/);return Ne({},...e.map((r,n)=>({[r]:t[n]})))}function Xo(i){const e={info:{},styles:{format:[],style:[]},events:{format:[],comment:[],dialogue:[]}},t=i.split(/\r?\n/);let r=0;for(let n=0;n<t.length;n++){const s=t[n].trim();if(!/^;/.test(s)&&(/^\[Script Info\]/i.test(s)?r=1:/^\[V4\+? Styles\]/i.test(s)?r=2:/^\[Events\]/i.test(s)?r=3:/^\[.*\]/.test(s)&&(r=0),r!==0)){if(r===1&&/:/.test(s)){const[,a,o]=s.match(/(.*?)\s*:\s*(.*)/);e.info[a]=o}if(r===2&&(/^Format\s*:/i.test(s)&&(e.styles.format=ls(s)),/^Style\s*:/i.test(s)&&e.styles.style.push(Jo(s,e.styles.format))),r===3&&(/^Format\s*:/i.test(s)&&(e.events.format=ls(s)),/^(?:Comment|Dialogue)\s*:/i.test(s))){const[,a,o]=s.match(/^(\w+?)\s*:\s*(.*)/i);e.events[a.toLowerCase()].push(Zo(o,e.events.format))}}}return e}function Yo(i){const e={type:null,prev:null,next:null,points:[]};/[mnlbs]/.test(i[0])&&(e.type=i[0].toUpperCase().replace("N","L").replace("B","C"));for(let t=i.length-!(i.length&1),r=1;r<t;r+=2)e.points.push({x:i[r]*1,y:i[r+1]*1});return e}function Qo(i){return!(!i.points.length||!i.type||/C|S/.test(i.type)&&i.points.length<3)}function el(i){let e=1/0,t=1/0,r=-1/0,n=-1/0;return[].concat(...i.map(({points:s})=>s)).forEach(({x:s,y:a})=>{e=Math.min(e,s),t=Math.min(t,a),r=Math.max(r,s),n=Math.max(n,a)}),{minX:e,minY:t,width:r-e,height:n-t}}function tl(i,e,t){const r=[],n=[0,.6666666666666666,.3333333333333333,0],s=[0,1/3,2/3,0],a=[0,1/6,2/3,1/6],o=(h,f)=>h[0]*f[0]+h[1]*f[1]+h[2]*f[2]+h[3]*f[3];let u=[i[i.length-1].x,i[0].x,i[1].x,i[2].x],v=[i[i.length-1].y,i[0].y,i[1].y,i[2].y];r.push({type:e==="M"?"M":"L",points:[{x:o(a,u),y:o(a,v)}]});for(let h=3;h<i.length;h++)u=[i[h-3].x,i[h-2].x,i[h-1].x,i[h].x],v=[i[h-3].y,i[h-2].y,i[h-1].y,i[h].y],r.push({type:"C",points:[{x:o(n,u),y:o(n,v)},{x:o(s,u),y:o(s,v)},{x:o(a,u),y:o(a,v)}]});if(t==="L"||t==="C"){const h=i[i.length-1];r.push({type:"L",points:[{x:h.x,y:h.y}]})}return r}function rl(i){return i.map(({type:e,points:t})=>e+t.map(({x:r,y:n})=>`${r},${n}`).join(",")).join("")}function us(i){const e=[];let t=0;for(;t<i.length;){const n=i[t],s=Yo(n);if(Qo(s)){if(s.type==="S"){const{x:a,y:o}=(e[t-1]||{points:[{x:0,y:0}]}).points.slice(-1)[0];s.points.unshift({x:a,y:o})}t&&(s.prev=e[t-1].type,e[t-1].next=s.type),e.push(s),t++}else{if(t&&e[t-1].type==="S"){const a={p:s.points,c:e[t-1].points.slice(0,3)};e[t-1].points=e[t-1].points.concat((a[n[0]]||[]).map(({x:o,y:u})=>({x:o,y:u})))}i.splice(t,1)}}const r=[].concat(...e.map(({type:n,points:s,prev:a,next:o})=>n==="S"?tl(s,a,o):{type:n,points:s}));return Ne({instructions:r,d:rl(r)},el(e))}const nl=["fs","clip","c1","c2","c3","c4","a1","a2","a3","a4","alpha","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"];function Me(i,e,t={}){let r=i[e];if(r===void 0)return null;if(e==="pos"||e==="org")return r.length===2?{[e]:{x:r[0],y:r[1]}}:null;if(e==="move"){const[n,s,a,o,u=0,v=0]=r;return r.length===4||r.length===6?{move:{x1:n,y1:s,x2:a,y2:o,t1:u,t2:v}}:null}if(e==="fad"||e==="fade"){if(r.length===2){const[n,s]=r;return{fade:{type:"fad",t1:n,t2:s}}}if(r.length===7){const[n,s,a,o,u,v,h]=r;return{fade:{type:"fade",a1:n,a2:s,a3:a,t1:o,t2:u,t3:v,t4:h}}}return null}if(e==="clip"){const{inverse:n,scale:s,drawing:a,dots:o}=r;if(a)return{clip:{inverse:n,scale:s,drawing:us(a),dots:o}};if(o){const[u,v,h,f]=o;return{clip:{inverse:n,scale:s,drawing:a,dots:{x1:u,y1:v,x2:h,y2:f}}}}return null}if(/^[xy]?(bord|shad)$/.test(e)&&(r=Math.max(r,0)),e==="bord")return{xbord:r,ybord:r};if(e==="shad")return{xshad:r,yshad:r};if(/^c\d$/.test(e))return{[e]:r||t[e]};if(e==="alpha")return{a1:r,a2:r,a3:r,a4:r};if(e==="fr")return{frz:r};if(e==="fs")return{fs:/^\+|-/.test(r)?(r*1>-10?1+r/10:1)*t.fs:r*1};if(e==="K")return{kf:r};if(e==="t"){const{t1:n,accel:s,tags:a}=r,o=r.t2||(t.end-t.start)*1e3,u={};return a.forEach(v=>{const h=Object.keys(v)[0];~nl.indexOf(h)&&!(h==="clip"&&!v[h].dots)&&Ne(u,Me(v,h,t))}),{t:{t1:n,t2:o,accel:s,tag:u}}}return{[e]:r}}const il=[null,1,2,3,null,7,8,9,null,4,5,6],sl=["r","a","an","pos","org","move","fade","fad","clip"];function al(i){return JSON.parse(JSON.stringify(Ne({},i,{k:void 0,kf:void 0,ko:void 0,kt:void 0})))}function ol({styles:i,style:e,parsed:t,start:r,end:n}){let s,a,o,u,v,h;const f=[];let l={style:e,fragments:[]},d={};for(let m=0;m<t.length;m++){const{tags:c,text:g,drawing:p}=t[m];let y;for(let x=0;x<c.length;x++){const S=c[x];y=S.r===void 0?y:S.r}const b={tag:y===void 0?al(d):{},text:g,drawing:p.length?us(p):null};for(let x=0;x<c.length;x++){const S=c[x];s=s||il[S.a||0]||S.an,a=a||Me(S,"pos"),o=o||Me(S,"org"),u=u||Me(S,"move"),v=v||Me(S,"fade")||Me(S,"fad"),h=Me(S,"clip")||h;const _=Object.keys(S)[0];if(_&&!~sl.indexOf(_)){const w=i[e].tag,{c1:I,c2:V,c3:M,c4:j}=w,O=d.fs||w.fs,E=Me(S,_,{start:r,end:n,c1:I,c2:V,c3:M,c4:j,fs:O});_==="t"?(b.tag.t=b.tag.t||[],b.tag.t.push(E.t)):Ne(b.tag,E)}}if(d=b.tag,y!==void 0&&(f.push(l),l={style:i[y]?y:e,fragments:[]}),b.text||b.drawing){const x=l.fragments[l.fragments.length-1]||{};x.text&&b.text&&!Object.keys(b.tag).length?x.text+=b.text:l.fragments.push(b)}}return f.push(l),Ne({alignment:s,slices:f},a,o,u,v,h)}function ll({styles:i,dialogues:e}){let t=1/0;const r=[];for(let n=0;n<e.length;n++){const s=e[n];if(s.Start>=s.End)continue;i[s.Style]||(s.Style="Default");const a=i[s.Style].style,o=ol({styles:i,style:s.Style,parsed:s.Text.parsed,start:s.Start,end:s.End}),u=o.alignment||a.Alignment;t=Math.min(t,s.Layer),r.push(Ne({layer:s.Layer,start:s.Start,end:s.End,style:s.Style,name:s.Name,margin:{left:s.MarginL||a.MarginL,right:s.MarginR||a.MarginR,vertical:s.MarginV||a.MarginV},effect:s.Effect},o,{alignment:u}))}for(let n=0;n<r.length;n++)r[n].layer-=t;return r.sort((n,s)=>n.start-s.start||n.end-s.end)}const ul={Name:"Default",Fontname:"Arial",Fontsize:"20",PrimaryColour:"&H00FFFFFF&",SecondaryColour:"&H000000FF&",OutlineColour:"&H00000000&",BackColour:"&H00000000&",Bold:"0",Italic:"0",Underline:"0",StrikeOut:"0",ScaleX:"100",ScaleY:"100",Spacing:"0",Angle:"0",BorderStyle:"1",Outline:"2",Shadow:"2",Alignment:"2",MarginL:"10",MarginR:"10",MarginV:"10",Encoding:"1"};function Rt(i){if(/^(&|H|&H)[0-9a-f]{6,}/i.test(i)){const[,t,r]=i.match(/&?H?([0-9a-f]{2})?([0-9a-f]{6})/i);return[t||"00",r]}const e=parseInt(i,10);if(!Number.isNaN(e)){if(e<-2147483648)return["00","000000"];const n=-2147483648<=e&&e<=2147483647?`00000000${(e<0?e+4294967296:e).toString(16)}`.slice(-8):String(e).slice(0,8);return[n.slice(0,2),n.slice(2)]}return["00","000000"]}function cl({info:i,style:e,defaultStyle:t}){const r={},n=[Ne({},ul,t,{Name:"Default"})].concat(e);for(let s=0;s<n.length;s++){const a=n[s];/^(\*+)Default$/.test(a.Name)&&(a.Name="Default"),Object.keys(a).forEach(g=>{g!=="Name"&&g!=="Fontname"&&!/Colour/.test(g)&&(a[g]*=1)});const[o,u]=Rt(a.PrimaryColour),[v,h]=Rt(a.SecondaryColour),[f,l]=Rt(a.OutlineColour),[d,m]=Rt(a.BackColour),c={fn:a.Fontname,fs:a.Fontsize,c1:u,a1:o,c2:h,a2:v,c3:l,a3:f,c4:m,a4:d,b:Math.abs(a.Bold),i:Math.abs(a.Italic),u:Math.abs(a.Underline),s:Math.abs(a.StrikeOut),fscx:a.ScaleX,fscy:a.ScaleY,fsp:a.Spacing,frz:a.Angle,xbord:a.Outline,ybord:a.Outline,xshad:a.Shadow,yshad:a.Shadow,fe:a.Encoding,q:/^[0-3]$/.test(i.WrapStyle)?i.WrapStyle*1:2};r[a.Name]={style:a,tag:c}}return r}function fl(i,e={}){const t=Xo(i),r=cl({info:t.info,style:t.styles.style,defaultStyle:e.defaultStyle||{}});return{info:t.info,width:t.info.PlayResX*1||null,height:t.info.PlayResY*1||null,collisions:t.info.Collisions||"Normal",styles:r,dialogues:ll({styles:r,dialogues:t.events.dialogue})}}class cs{constructor(e){A(this,"endOfLine",`\r
`);A(this,"numericTimestamps",!1);e!=null&&(this.endOfLine=e.endOfLine??`\r
`,this.numericTimestamps=e.numericTimestamps??!1)}timestampToSeconds(e){const[t,r]=e.split(","),n=parseInt(r),[s,a,o]=t.split(":").map(v=>parseInt(v)),u=n*.001+o+60*a+3600*s;return Math.round(u*1e3)/1e3}secondsToTimestamp(e){const t=new Date(0,0,0,0,0,0,e),r=t.getHours(),n=t.getMinutes(),s=t.getSeconds(),a=Math.floor(e-(r*36e5+n*6e4+s*1e3));function o(u,v=2){return u.toString().padStart(v,"0")}return`${o(r)}:${o(n)}:${o(s)},${o(a,3)}`}correctFormat(e){const t=e.replace(".",","),[r,n]=t.split(","),s=this.fixedStrDigit(3,n),[a,o,u]=r.split(":"),v=this.fixedStrDigit(2,a,!1),h=this.fixedStrDigit(2,o,!1),f=this.fixedStrDigit(2,u,!1);return`${v}:${h}:${f},${s}`}fixedStrDigit(e,t,r=!0){return t.length===e?t:t.length>e?t.slice(0,e):r?t.padEnd(e,"0"):t.padStart(e,"0")}tryComma(e){e=e.replace(/\r/g,"");const t=/(\d+)\n(\d{1,2}:\d{2}:\d{2},\d{1,3}) --> (\d{1,2}:\d{2}:\d{2},\d{1,3})/g,r=e.split(t);return r.shift(),r}tryDot(e){e=e.replace(/\r/g,"");const t=/(\d+)\n(\d{1,2}:\d{2}:\d{2}\.\d{1,3}) --> (\d{1,2}:\d{2}:\d{2}\.\d{1,3})/g,r=e.split(t);return r.shift(),r}fromSrt(e){const t=e;let r=this.tryComma(t);r.length===0&&(r=this.tryDot(t));const n=[];for(let s=0;s<r.length;s+=4){let a=this.correctFormat(r[s+1].trim()),o=this.correctFormat(r[s+2].trim());this.numericTimestamps&&(a=this.timestampToSeconds(a),o=this.timestampToSeconds(o));const u={id:r[s].trim(),startTime:a,endTime:o,text:r[s+3].trim()};n.push(u)}return n}toSrt(e){const t=this.endOfLine;let r="";for(let n=0;n<e.length;n++){const s=e[n];let a=s.startTime,o=s.endTime;typeof a=="number"&&(a=this.secondsToTimestamp(a)),typeof o=="number"&&(o=this.secondsToTimestamp(o)),r+=s.id+t+a+" --> "+o+t+s.text.replace(`
`,t)+t+t}return r}}var yn={},fs;function dl(){return fs||(fs=1,function(i){function e(E,P){return P===void 0&&(P=1),"rgba("+[parseInt(E.substring(0,2),16),parseInt(E.substring(2,4),16),parseInt(E.substring(4,6),16),P].join(",")+")"}var t=["webvtt.font.color","webvtt.font.opacity","webvtt.font.scale","webvtt.bg.color","webvtt.bg.opacity","webvtt.edge.color","webvtt.edge.type"],r=1;function n(E,P,$){switch($){case"webvtt.font.color":case"webvtt.font.opacity":var H=Services.prefs.getCharPref("webvtt.font.color"),D=Services.prefs.getIntPref("webvtt.font.opacity")/100;s.fontSet=e(H,D);break;case"webvtt.font.scale":r=Services.prefs.getIntPref("webvtt.font.scale")/100;break;case"webvtt.bg.color":case"webvtt.bg.opacity":var k=Services.prefs.getCharPref("webvtt.bg.color"),U=Services.prefs.getIntPref("webvtt.bg.opacity")/100;s.backgroundSet=e(k,U);break;case"webvtt.edge.color":case"webvtt.edge.type":var C=["","0px 0px ","4px 4px 4px ","-2px -2px ","2px 2px "],T=Services.prefs.getIntPref("webvtt.edge.type"),R=Services.prefs.getCharPref("webvtt.edge.color");s.edgeSet=C[T]+e(R);break}}if(typeof Services<"u"){var s={};t.forEach(function(E){n(void 0,void 0,E),Services.prefs.addObserver(E,n,!1)})}var a=Object.create||function(){function E(){}return function(P){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return E.prototype=P,new E}}();function o(E,P){this.name="ParsingError",this.code=E.code,this.message=P||E.message}o.prototype=a(Error.prototype),o.prototype.constructor=o,o.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function u(E){function P(H,D,k,U){return(H|0)*3600+(D|0)*60+(k|0)+(U|0)/1e3}var $=E.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return $?$[3]?P($[1],$[2],$[3].replace(":",""),$[4]):$[1]>59?P($[1],$[2],0,$[4]):P(0,$[1],$[2],$[4]):null}function v(){this.values=a(null)}v.prototype={set:function(E,P){!this.get(E)&&P!==""&&(this.values[E]=P)},get:function(E,P,$){return $?this.has(E)?this.values[E]:P[$]:this.has(E)?this.values[E]:P},has:function(E){return E in this.values},alt:function(E,P,$){for(var H=0;H<$.length;++H)if(P===$[H]){this.set(E,P);break}},integer:function(E,P){/^-?\d+$/.test(P)&&this.set(E,parseInt(P,10))},percent:function(E,P){return P.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(P=parseFloat(P),P>=0&&P<=100)?(this.set(E,P),!0):!1}};function h(E,P,$,H){var D=H?E.split(H):[E];for(var k in D)if(typeof D[k]=="string"){var U=D[k].split($);if(U.length===2){var C=U[0],T=U[1];P(C,T)}}}function f(E,P,$){var H=E;function D(){var C=u(E);if(C===null)throw new o(o.Errors.BadTimeStamp,"Malformed timestamp: "+H);return E=E.replace(/^[^\sa-zA-Z-]+/,""),C}function k(C,T){var R=new v;h(C,function(F,N){switch(F){case"region":for(var z=$.length-1;z>=0;z--)if($[z].id===N){R.set(F,$[z].region);break}break;case"vertical":R.alt(F,N,["rl","lr"]);break;case"line":var q=N.split(","),G=q[0];R.integer(F,G),R.percent(F,G)&&R.set("snapToLines",!1),R.alt(F,G,["auto"]),q.length===2&&R.alt("lineAlign",q[1],["start","middle","end"]);break;case"position":q=N.split(","),R.percent(F,q[0]),q.length===2&&R.alt("positionAlign",q[1],["start","middle","end"]);break;case"size":R.percent(F,N);break;case"align":R.alt(F,N,["start","middle","end","left","right"]);break}},/:/,/\s/),T.region=R.get("region",null),T.vertical=R.get("vertical",""),T.line=R.get("line","auto"),T.lineAlign=R.get("lineAlign","start"),T.snapToLines=R.get("snapToLines",!0),T.size=R.get("size",100),T.align=R.get("align","middle"),T.position=R.get("position","auto"),T.positionAlign=R.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},T.align)}function U(){E=E.replace(/^\s+/,"")}if(U(),P.startTime=D(),U(),E.substr(0,3)!=="-->")throw new o(o.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+H);E=E.substr(3),U(),P.endTime=D(),U(),k(E,P)}var l={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},d={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},m={v:"title",lang:"lang"},c={rt:"ruby"};function g(E,P){function $(){if(!P)return null;function G(K){return P=P.substr(K.length),K}var Z=P.match(/^([^<]*)(<[^>]+>?)?/);return G(Z[1]?Z[1]:Z[2])}function H(G){return l[G]}function D(G){for(;q=G.match(/&(amp|lt|gt|lrm|rlm|nbsp);/);)G=G.replace(q[0],H);return G}function k(G,Z){return!c[Z.localName]||c[Z.localName]===G.localName}function U(G,Z){var K=d[G];if(!K)return null;var X=E.document.createElement(K);X.localName=K;var J=m[G];return J&&Z&&(X[J]=Z.trim()),X}for(var C=E.document.createElement("div"),T=C,R,F=[];(R=$())!==null;){if(R[0]==="<"){if(R[1]==="/"){F.length&&F[F.length-1]===R.substr(2).replace(">","")&&(F.pop(),T=T.parentNode);continue}var N=u(R.substr(1,R.length-2)),z;if(N){z=E.document.createProcessingInstruction("timestamp",N),T.appendChild(z);continue}var q=R.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!q||(z=U(q[1],q[3]),!z)||!k(T,z))continue;q[2]&&(z.className=q[2].substr(1).replace("."," ")),F.push(q[1]),T.appendChild(z),T=z;continue}T.appendChild(E.document.createTextNode(D(R)))}return C}var p=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function y(E){for(var P=0;P<p.length;P++){var $=p[P];if(E>=$[0]&&E<=$[1])return!0}return!1}function b(E){var P=[],$="",H;if(!E||!E.childNodes)return"ltr";function D(C,T){for(var R=T.childNodes.length-1;R>=0;R--)C.push(T.childNodes[R])}function k(C){if(!C||!C.length)return null;var T=C.pop(),R=T.textContent||T.innerText;if(R){var F=R.match(/^.*(\n|\r)/);return F?(C.length=0,F[0]):R}if(T.tagName==="ruby")return k(C);if(T.childNodes)return D(C,T),k(C)}for(D(P,E);$=k(P);)for(var U=0;U<$.length;U++)if(H=$.charCodeAt(U),y(H))return"rtl";return"ltr"}function x(E){if(typeof E.line=="number"&&(E.snapToLines||E.line>=0&&E.line<=100))return E.line;if(!E.track||!E.track.textTrackList||!E.track.textTrackList.mediaElement)return-1;for(var P=E.track,$=P.textTrackList,H=0,D=0;D<$.length&&$[D]!==P;D++)$[D].mode==="showing"&&H++;return++H*-1}function S(){}S.prototype.applyStyles=function(E,P){P=P||this.div;for(var $ in E)E.hasOwnProperty($)&&(P.style[$]=E[$])},S.prototype.formatStyle=function(E,P){return E===0?0:E+P};function _(E,P,$){var H=typeof navigator<"u"&&/MSIE\s8\.0/.test(navigator.userAgent),D="rgba(255, 255, 255, 1)",k="rgba(0, 0, 0, 0.8)",U="";typeof s<"u"&&(D=s.fontSet,k=s.backgroundSet,U=s.edgeSet),H&&(D="rgb(255, 255, 255)",k="rgb(0, 0, 0)"),S.call(this),this.cue=P,this.cueDiv=g(E,P.text);var C={color:D,backgroundColor:k,textShadow:U,position:"relative",left:0,right:0,top:0,bottom:0,display:"inline"};H||(C.writingMode=P.vertical===""?"horizontal-tb":P.vertical==="lr"?"vertical-lr":"vertical-rl",C.unicodeBidi="plaintext"),this.applyStyles(C,this.cueDiv),this.div=E.document.createElement("div"),C={textAlign:P.align==="middle"?"center":P.align,font:$.font,whiteSpace:"pre-line",position:"absolute"},H||(C.direction=b(this.cueDiv),C.writingMode=P.vertical===""?"horizontal-tb":P.vertical==="lr"?"vertical-lr":"vertical-rl".stylesunicodeBidi="plaintext"),this.applyStyles(C),this.div.appendChild(this.cueDiv);var T=0;switch(P.positionAlign){case"start":T=P.position;break;case"middle":T=P.position-P.size/2;break;case"end":T=P.position-P.size;break}P.vertical===""?this.applyStyles({left:this.formatStyle(T,"%"),width:this.formatStyle(P.size,"%")}):this.applyStyles({top:this.formatStyle(T,"%"),height:this.formatStyle(P.size,"%")}),this.move=function(R){this.applyStyles({top:this.formatStyle(R.top,"px"),bottom:this.formatStyle(R.bottom,"px"),left:this.formatStyle(R.left,"px"),right:this.formatStyle(R.right,"px"),height:this.formatStyle(R.height,"px"),width:this.formatStyle(R.width,"px")})}}_.prototype=a(S.prototype),_.prototype.constructor=_;function w(E){var P=typeof navigator<"u"&&/MSIE\s8\.0/.test(navigator.userAgent),$,H,D,k;if(E.div){H=E.div.offsetHeight,D=E.div.offsetWidth,k=E.div.offsetTop;var U=(U=E.div.childNodes)&&(U=U[0])&&U.getClientRects&&U.getClientRects();E=E.div.getBoundingClientRect(),$=U?Math.max(U[0]&&U[0].height||0,E.height/U.length):0}this.left=E.left,this.right=E.right,this.top=E.top||k,this.height=E.height||H,this.bottom=E.bottom||k+(E.height||H),this.width=E.width||D,this.lineHeight=$!==void 0?$:E.lineHeight,P&&!this.lineHeight&&(this.lineHeight=13)}w.prototype.move=function(E,P){switch(P=P!==void 0?P:this.lineHeight,E){case"+x":this.left+=P,this.right+=P;break;case"-x":this.left-=P,this.right-=P;break;case"+y":this.top+=P,this.bottom+=P;break;case"-y":this.top-=P,this.bottom-=P;break}},w.prototype.overlaps=function(E){return this.left<E.right&&this.right>E.left&&this.top<E.bottom&&this.bottom>E.top},w.prototype.overlapsAny=function(E){for(var P=0;P<E.length;P++)if(this.overlaps(E[P]))return!0;return!1},w.prototype.within=function(E){return this.top>=E.top&&this.bottom<=E.bottom&&this.left>=E.left&&this.right<=E.right},w.prototype.overlapsOppositeAxis=function(E,P){switch(P){case"+x":return this.left<E.left;case"-x":return this.right>E.right;case"+y":return this.top<E.top;case"-y":return this.bottom>E.bottom}},w.prototype.intersectPercentage=function(E){var P=Math.max(0,Math.min(this.right,E.right)-Math.max(this.left,E.left)),$=Math.max(0,Math.min(this.bottom,E.bottom)-Math.max(this.top,E.top)),H=P*$;return H/(this.height*this.width)},w.prototype.toCSSCompatValues=function(E){return{top:this.top-E.top,bottom:E.bottom-this.bottom,left:this.left-E.left,right:E.right-this.right,height:this.height,width:this.width}},w.getSimpleBoxPosition=function(E){var P=E.div?E.div.offsetHeight:E.tagName?E.offsetHeight:0,$=E.div?E.div.offsetWidth:E.tagName?E.offsetWidth:0,H=E.div?E.div.offsetTop:E.tagName?E.offsetTop:0;E=E.div?E.div.getBoundingClientRect():E.tagName?E.getBoundingClientRect():E;var D={left:E.left,right:E.right,top:E.top||H,height:E.height||P,bottom:E.bottom||H+(E.height||P),width:E.width||$};return D};function I(E,P,$,H){function D(K,X){for(var J,Y=new w(K),oe=1,ee=0;ee<X.length;ee++){for(;K.overlapsOppositeAxis($,X[ee])||K.within($)&&K.overlapsAny(H);)K.move(X[ee]);if(K.within($))return K;var ie=K.intersectPercentage($);oe>ie&&(J=new w(K),oe=ie),K=new w(Y)}return J||Y}var k=new w(P),U=P.cue,C=x(U),T=[];if(U.snapToLines){var R;switch(U.vertical){case"":T=["+y","-y"],R="height";break;case"rl":T=["+x","-x"],R="width";break;case"lr":T=["-x","+x"],R="width";break}var F=k.lineHeight,N=F*Math.round(C),z=$[R]+F,q=T[0];Math.abs(N)>z&&(N=N<0?-1:1,N*=Math.ceil(z/F)*F),C<0&&(N+=U.vertical===""?$.height:$.width,T=T.reverse()),k.move(q,N)}else{var G=k.lineHeight/$.height*100;switch(U.lineAlign){case"middle":C-=G/2;break;case"end":C-=G;break}switch(U.vertical){case"":P.applyStyles({top:P.formatStyle(C,"%")});break;case"rl":P.applyStyles({left:P.formatStyle(C,"%")});break;case"lr":P.applyStyles({right:P.formatStyle(C,"%")});break}T=["+y","-x","+x","-y"],k=new w(P)}var Z=D(k,T);P.move(Z.toCSSCompatValues($))}function V(){}V.StringDecoder=function(){return{decode:function(E){if(!E)return"";if(typeof E!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(E))}}},V.convertCueToDOMTree=function(E,P){return!E||!P?null:g(E,P)};var M=.05,j="sans-serif",O="1.5%";V.processCues=function(E,P,$){if(!E||!P||!$)return null;for(;$.firstChild;)$.removeChild($.firstChild);var H=E.document.createElement("div");H.style.position="absolute",H.style.left="0",H.style.right="0",H.style.top="0",H.style.bottom="0",H.style.margin=O,$.appendChild(H);function D(F){for(var N=0;N<F.length;N++)if(F[N].hasBeenReset||!F[N].displayState)return!0;return!1}if(!D(P)){for(var k=0;k<P.length;k++)H.appendChild(P[k].displayState);return}var U=[],C=w.getSimpleBoxPosition(H),T=Math.round(C.height*M*100)/100,R={font:T*r+"px "+j};(function(){for(var F,N,z=0;z<P.length;z++)N=P[z],F=new _(E,N,R),H.appendChild(F.div),I(E,F,C,U),N.displayState=F.div,U.push(w.getSimpleBoxPosition(F))})()},V.Parser=function(E,P){this.window=E,this.state="INITIAL",this.buffer="",this.decoder=P||new TextDecoder("utf8"),this.regionList=[]},V.Parser.prototype={reportOrThrowError:function(E){if(E instanceof o)this.onparsingerror&&this.onparsingerror(E);else throw E},parse:function(E){var P=this;E&&(P.buffer+=P.decoder.decode(E,{stream:!0}));function $(){for(var R=P.buffer,F=0;F<R.length&&R[F]!=="\r"&&R[F]!==`
`;)++F;var N=R.substr(0,F);return R[F]==="\r"&&++F,R[F]===`
`&&++F,P.buffer=R.substr(F),N}function H(R){var F=new v;if(h(R,function(z,q){switch(z){case"id":F.set(z,q);break;case"width":F.percent(z,q);break;case"lines":F.integer(z,q);break;case"regionanchor":case"viewportanchor":var G=q.split(",");if(G.length!==2)break;var Z=new v;if(Z.percent("x",G[0]),Z.percent("y",G[1]),!Z.has("x")||!Z.has("y"))break;F.set(z+"X",Z.get("x")),F.set(z+"Y",Z.get("y"));break;case"scroll":F.alt(z,q,["up"]);break}},/=/,/\s/),F.has("id")){var N=new P.window.VTTRegion;N.width=F.get("width",100),N.lines=F.get("lines",3),N.regionAnchorX=F.get("regionanchorX",0),N.regionAnchorY=F.get("regionanchorY",100),N.viewportAnchorX=F.get("viewportanchorX",0),N.viewportAnchorY=F.get("viewportanchorY",100),N.scroll=F.get("scroll",""),P.onregion&&P.onregion(N),P.regionList.push({id:F.get("id"),region:N})}}function D(R){h(R,function(F,N){switch(F){case"Region":H(N);break}},/:/)}try{var k;if(P.state==="INITIAL"){if(!/\r\n|\n/.test(P.buffer))return this;k=$();var U=k.match(/^WEBVTT([ \t].*)?$/);if(!U||!U[0])throw new o(o.Errors.BadSignature);P.state="HEADER"}for(var C=!1;P.buffer;){if(!/\r\n|\n/.test(P.buffer))return this;switch(C?C=!1:k=$(),P.state){case"HEADER":/:/.test(k)?D(k):k||(P.state="ID");continue;case"NOTE":k||(P.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(k)){P.state="NOTE";break}if(!k)continue;if(P.cue=new P.window.VTTCue(0,0,""),P.state="CUE",k.indexOf("-->")===-1){P.cue.id=k;continue}case"CUE":try{f(k,P.cue,P.regionList)}catch(R){P.reportOrThrowError(R),P.cue=null,P.state="BADCUE";continue}P.state="CUETEXT";continue;case"CUETEXT":var T=k.indexOf("-->")!==-1;if(!k||T&&(C=!0)){P.oncue&&P.oncue(P.cue),P.cue=null,P.state="ID";continue}P.cue.text&&(P.cue.text+=`
`),P.cue.text+=k;continue;case"BADCUE":k||(P.state="ID");continue}}}catch(R){P.reportOrThrowError(R),P.state==="CUETEXT"&&P.cue&&P.oncue&&P.oncue(P.cue),P.cue=null,P.state=P.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var E=this;try{if(E.buffer+=E.decoder.decode(),(E.cue||E.state==="HEADER")&&(E.buffer+=`

`,E.parse()),E.state==="INITIAL")throw new o(o.Errors.BadSignature)}catch(P){E.reportOrThrowError(P)}return E.onflush&&E.onflush(),this}},i.WebVTT=V}(yn)),yn}var Lt={exports:{}},vn={},ds;function hl(){return ds||(ds=1,function(i){var e="auto",t={"":!0,lr:!0,rl:!0},r={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(u){if(typeof u!="string")return!1;var v=t[u.toLowerCase()];return v?u.toLowerCase():!1}function s(u){if(typeof u!="string")return!1;var v=r[u.toLowerCase()];return v?u.toLowerCase():!1}function a(u){for(var v=1;v<arguments.length;v++){var h=arguments[v];for(var f in h)u[f]=h[f]}return u}function o(u,v,h){var f=this,l=/MSIE\s8\.0/.test(navigator.userAgent),d={};l?f=document.createElement("custom"):d.enumerable=!0,f.hasBeenReset=!1;var m="",c=!1,g=u,p=v,y=h,b=null,x="",S=!0,_="auto",w="start",I=50,V="middle",M=50,j="middle";if(Object.defineProperty(f,"id",a({},d,{get:function(){return m},set:function(O){m=""+O}})),Object.defineProperty(f,"pauseOnExit",a({},d,{get:function(){return c},set:function(O){c=!!O}})),Object.defineProperty(f,"startTime",a({},d,{get:function(){return g},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");g=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",a({},d,{get:function(){return p},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");p=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",a({},d,{get:function(){return y},set:function(O){y=""+O,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",a({},d,{get:function(){return b},set:function(O){b=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",a({},d,{get:function(){return x},set:function(O){var E=n(O);if(E===!1)throw new SyntaxError("An invalid or illegal string was specified.");x=E,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",a({},d,{get:function(){return S},set:function(O){S=!!O,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",a({},d,{get:function(){return _},set:function(O){if(typeof O!="number"&&O!==e)throw new SyntaxError("An invalid number or illegal string was specified.");_=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",a({},d,{get:function(){return w},set:function(O){var E=s(O);if(!E)throw new SyntaxError("An invalid or illegal string was specified.");w=E,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",a({},d,{get:function(){return I},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");I=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",a({},d,{get:function(){return V},set:function(O){var E=s(O);if(!E)throw new SyntaxError("An invalid or illegal string was specified.");V=E,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",a({},d,{get:function(){return M},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");M=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",a({},d,{get:function(){return j},set:function(O){var E=s(O);if(!E)throw new SyntaxError("An invalid or illegal string was specified.");j=E,this.hasBeenReset=!0}})),f.displayState=void 0,l)return f}o.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},i.VTTCue=i.VTTCue||o}(vn)),vn}var bn=Lt.exports,hs;function pl(){return hs||(hs=1,function(i){i.exports&&(bn.VTTCue=bn.VTTCue||hl().VTTCue),function(e){e.VTTCue.prototype.toJSON=function(){var t={},r=this;return Object.keys(this).forEach(function(n){n!=="getCueAsHTML"&&n!=="hasBeenReset"&&n!=="displayState"&&(t[n]=r[n])}),t},e.VTTCue.create=function(t){if(!t.hasOwnProperty("startTime")||!t.hasOwnProperty("endTime")||!t.hasOwnProperty("text"))throw new Error("You must at least have start time, end time, and text.");var r=new e.VTTCue(t.startTime,t.endTime,t.text);for(var n in t)r.hasOwnProperty(n)&&(r[n]=t[n]);return r},e.VTTCue.fromJSON=function(t){return this.create(JSON.parse(t))}}(bn)}(Lt)),Lt.exports}var It={exports:{}},Sn={},ps;function gl(){return ps||(ps=1,function(i){var e={"":!0,up:!0};function t(s){if(typeof s!="string")return!1;var a=e[s.toLowerCase()];return a?s.toLowerCase():!1}function r(s){return typeof s=="number"&&s>=0&&s<=100}function n(){var s=100,a=3,o=0,u=100,v=0,h=100,f="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return s},set:function(l){if(!r(l))throw new Error("Width must be between 0 and 100.");s=l}},lines:{enumerable:!0,get:function(){return a},set:function(l){if(typeof l!="number")throw new TypeError("Lines must be set to a number.");a=l}},regionAnchorY:{enumerable:!0,get:function(){return u},set:function(l){if(!r(l))throw new Error("RegionAnchorX must be between 0 and 100.");u=l}},regionAnchorX:{enumerable:!0,get:function(){return o},set:function(l){if(!r(l))throw new Error("RegionAnchorY must be between 0 and 100.");o=l}},viewportAnchorY:{enumerable:!0,get:function(){return h},set:function(l){if(!r(l))throw new Error("ViewportAnchorY must be between 0 and 100.");h=l}},viewportAnchorX:{enumerable:!0,get:function(){return v},set:function(l){if(!r(l))throw new Error("ViewportAnchorX must be between 0 and 100.");v=l}},scroll:{enumerable:!0,get:function(){return f},set:function(l){var d=t(l);if(d===!1)throw new SyntaxError("An invalid or illegal string was specified.");f=d}}})}i.VTTRegion=i.VTTRegion||n}(Sn)),Sn}var gs=It.exports,ms;function ml(){return ms||(ms=1,function(i){i.exports&&(gs.VTTRegion=gl().VTTRegion),function(e){e.VTTRegion.create=function(t){var r=new e.VTTRegion;for(var n in t)r.hasOwnProperty(n)&&(r[n]=t[n]);return r},e.VTTRegion.fromJSON=function(t){return this.create(JSON.parse(t))}}(gs)}(It)),It.exports}var wn,ys;function yl(){return ys||(ys=1,wn={WebVTT:dl().WebVTT,VTTCue:pl().VTTCue,VTTRegion:ml().VTTRegion}),wn}var vs=yl(),_n={},En={},bs;function Ss(){return bs||(bs=1,function(i){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",r="["+e+"]["+t+"]*",n=new RegExp("^"+r+"$"),s=function(o,u){const v=[];let h=u.exec(o);for(;h;){const f=[];f.startIndex=u.lastIndex-h[0].length;const l=h.length;for(let d=0;d<l;d++)f.push(h[d]);v.push(f),h=u.exec(o)}return v},a=function(o){const u=n.exec(o);return!(u===null||typeof u>"u")};i.isExist=function(o){return typeof o<"u"},i.isEmptyObject=function(o){return Object.keys(o).length===0},i.merge=function(o,u,v){if(u){const h=Object.keys(u),f=h.length;for(let l=0;l<f;l++)v==="strict"?o[h[l]]=[u[h[l]]]:o[h[l]]=u[h[l]]}},i.getValue=function(o){return i.isExist(o)?o:""},i.isName=a,i.getAllMatches=s,i.nameRegexp=r}(En)),En}var ws;function _s(){if(ws)return _n;ws=1;const i=Ss(),e={allowBooleanAttributes:!1,unpairedTags:[]};_n.validate=function(p,y){y=Object.assign({},e,y);const b=[];let x=!1,S=!1;p[0]==="\uFEFF"&&(p=p.substr(1));for(let _=0;_<p.length;_++)if(p[_]==="<"&&p[_+1]==="?"){if(_+=2,_=r(p,_),_.err)return _}else if(p[_]==="<"){let w=_;if(_++,p[_]==="!"){_=n(p,_);continue}else{let I=!1;p[_]==="/"&&(I=!0,_++);let V="";for(;_<p.length&&p[_]!==">"&&p[_]!==" "&&p[_]!=="	"&&p[_]!==`
`&&p[_]!=="\r";_++)V+=p[_];if(V=V.trim(),V[V.length-1]==="/"&&(V=V.substring(0,V.length-1),_--),!m(V)){let O;return V.trim().length===0?O="Invalid space after '<'.":O="Tag '"+V+"' is an invalid name.",l("InvalidTag",O,c(p,_))}const M=o(p,_);if(M===!1)return l("InvalidAttr","Attributes for '"+V+"' have open quote.",c(p,_));let j=M.value;if(_=M.index,j[j.length-1]==="/"){const O=_-j.length;j=j.substring(0,j.length-1);const E=v(j,y);if(E===!0)x=!0;else return l(E.err.code,E.err.msg,c(p,O+E.err.line))}else if(I)if(M.tagClosed){if(j.trim().length>0)return l("InvalidTag","Closing tag '"+V+"' can't have attributes or invalid starting.",c(p,w));{const O=b.pop();if(V!==O.tagName){let E=c(p,O.tagStartPos);return l("InvalidTag","Expected closing tag '"+O.tagName+"' (opened in line "+E.line+", col "+E.col+") instead of closing tag '"+V+"'.",c(p,w))}b.length==0&&(S=!0)}}else return l("InvalidTag","Closing tag '"+V+"' doesn't have proper closing.",c(p,_));else{const O=v(j,y);if(O!==!0)return l(O.err.code,O.err.msg,c(p,_-j.length+O.err.line));if(S===!0)return l("InvalidXml","Multiple possible root nodes found.",c(p,_));y.unpairedTags.indexOf(V)!==-1||b.push({tagName:V,tagStartPos:w}),x=!0}for(_++;_<p.length;_++)if(p[_]==="<")if(p[_+1]==="!"){_++,_=n(p,_);continue}else if(p[_+1]==="?"){if(_=r(p,++_),_.err)return _}else break;else if(p[_]==="&"){const O=f(p,_);if(O==-1)return l("InvalidChar","char '&' is not expected.",c(p,_));_=O}else if(S===!0&&!t(p[_]))return l("InvalidXml","Extra text at the end",c(p,_));p[_]==="<"&&_--}}else{if(t(p[_]))continue;return l("InvalidChar","char '"+p[_]+"' is not expected.",c(p,_))}if(x){if(b.length==1)return l("InvalidTag","Unclosed tag '"+b[0].tagName+"'.",c(p,b[0].tagStartPos));if(b.length>0)return l("InvalidXml","Invalid '"+JSON.stringify(b.map(_=>_.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return l("InvalidXml","Start tag expected.",1);return!0};function t(p){return p===" "||p==="	"||p===`
`||p==="\r"}function r(p,y){const b=y;for(;y<p.length;y++)if(p[y]=="?"||p[y]==" "){const x=p.substr(b,y-b);if(y>5&&x==="xml")return l("InvalidXml","XML declaration allowed only at the start of the document.",c(p,y));if(p[y]=="?"&&p[y+1]==">"){y++;break}else continue}return y}function n(p,y){if(p.length>y+5&&p[y+1]==="-"&&p[y+2]==="-"){for(y+=3;y<p.length;y++)if(p[y]==="-"&&p[y+1]==="-"&&p[y+2]===">"){y+=2;break}}else if(p.length>y+8&&p[y+1]==="D"&&p[y+2]==="O"&&p[y+3]==="C"&&p[y+4]==="T"&&p[y+5]==="Y"&&p[y+6]==="P"&&p[y+7]==="E"){let b=1;for(y+=8;y<p.length;y++)if(p[y]==="<")b++;else if(p[y]===">"&&(b--,b===0))break}else if(p.length>y+9&&p[y+1]==="["&&p[y+2]==="C"&&p[y+3]==="D"&&p[y+4]==="A"&&p[y+5]==="T"&&p[y+6]==="A"&&p[y+7]==="["){for(y+=8;y<p.length;y++)if(p[y]==="]"&&p[y+1]==="]"&&p[y+2]===">"){y+=2;break}}return y}const s='"',a="'";function o(p,y){let b="",x="",S=!1;for(;y<p.length;y++){if(p[y]===s||p[y]===a)x===""?x=p[y]:x!==p[y]||(x="");else if(p[y]===">"&&x===""){S=!0;break}b+=p[y]}return x!==""?!1:{value:b,index:y,tagClosed:S}}const u=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function v(p,y){const b=i.getAllMatches(p,u),x={};for(let S=0;S<b.length;S++){if(b[S][1].length===0)return l("InvalidAttr","Attribute '"+b[S][2]+"' has no space in starting.",g(b[S]));if(b[S][3]!==void 0&&b[S][4]===void 0)return l("InvalidAttr","Attribute '"+b[S][2]+"' is without value.",g(b[S]));if(b[S][3]===void 0&&!y.allowBooleanAttributes)return l("InvalidAttr","boolean attribute '"+b[S][2]+"' is not allowed.",g(b[S]));const _=b[S][2];if(!d(_))return l("InvalidAttr","Attribute '"+_+"' is an invalid name.",g(b[S]));if(!x.hasOwnProperty(_))x[_]=1;else return l("InvalidAttr","Attribute '"+_+"' is repeated.",g(b[S]))}return!0}function h(p,y){let b=/\d/;for(p[y]==="x"&&(y++,b=/[\da-fA-F]/);y<p.length;y++){if(p[y]===";")return y;if(!p[y].match(b))break}return-1}function f(p,y){if(y++,p[y]===";")return-1;if(p[y]==="#")return y++,h(p,y);let b=0;for(;y<p.length;y++,b++)if(!(p[y].match(/\w/)&&b<20)){if(p[y]===";")break;return-1}return y}function l(p,y,b){return{err:{code:p,msg:y,line:b.line||b,col:b.col}}}function d(p){return i.isName(p)}function m(p){return i.isName(p)}function c(p,y){const b=p.substring(0,y).split(/\r?\n/);return{line:b.length,col:b[b.length-1].length+1}}function g(p){return p.startIndex+p[1].length}return _n}var Nt={},Es;function vl(){if(Es)return Nt;Es=1;const i={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0},tagValueProcessor:function(t,r){return r},attributeValueProcessor:function(t,r){return r},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1},e=function(t){return Object.assign({},i,t)};return Nt.buildOptions=e,Nt.defaultOptions=i,Nt}var xn,xs;function bl(){if(xs)return xn;xs=1;class i{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,r){this.child.push({[t]:r})}addChild(t){t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}return xn=i,xn}var An,As;function Sl(){if(As)return An;As=1;function i(r,n){const s={};if(r[n+3]==="O"&&r[n+4]==="C"&&r[n+5]==="T"&&r[n+6]==="Y"&&r[n+7]==="P"&&r[n+8]==="E"){n=n+9;let a=1,o=!1,u=!1,v=!1,h="";for(;n<r.length;n++)if(r[n]==="<"){if(o&&r[n+1]==="!"&&r[n+2]==="E"&&r[n+3]==="N"&&r[n+4]==="T"&&r[n+5]==="I"&&r[n+6]==="T"&&r[n+7]==="Y")n+=7,u=!0;else if(o&&r[n+1]==="!"&&r[n+2]==="E"&&r[n+3]==="L"&&r[n+4]==="E"&&r[n+5]==="M"&&r[n+6]==="E"&&r[n+7]==="N"&&r[n+8]==="T")n+=8;else if(r[n+1]==="!"&&r[n+2]==="-"&&r[n+3]==="-")v=!0;else throw new Error("Invalid DOCTYPE");a++,h=""}else if(r[n]===">"){if(v)if(r[n-1]==="-"&&r[n-2]==="-")v=!1;else throw new Error("Invalid XML comment in DOCTYPE");else u&&(t(h,s),u=!1);if(a--,a===0)break}else r[n]==="["?o=!0:h+=r[n];if(a!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:s,i:n}}const e=RegExp(`^\\s([a-zA-z0-0]+)[ 	](['"])([^&]+)\\2`);function t(r,n){const s=e.exec(r);s&&(n[s[1]]={regx:RegExp(`&${s[1]};`,"g"),val:s[3]})}return An=i,An}var Pn,Ps;function wl(){if(Ps)return Pn;Ps=1;const i=/^[-+]?0x[a-fA-F0-9]+$/,e=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const t={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function r(s,a={}){if(a=Object.assign({},t,a),!s||typeof s!="string")return s;let o=s.trim();if(a.skipLike!==void 0&&a.skipLike.test(o))return s;if(a.hex&&i.test(o))return Number.parseInt(o,16);{const u=e.exec(o);if(u){const v=u[1],h=u[2];let f=n(u[3]);const l=u[4]||u[6];if(!a.leadingZeros&&h.length>0&&v&&o[2]!==".")return s;if(!a.leadingZeros&&h.length>0&&!v&&o[1]!==".")return s;{const d=Number(o),m=""+d;return m.search(/[eE]/)!==-1||l?a.eNotation?d:s:o.indexOf(".")!==-1?m==="0"&&f===""||m===f||v&&m==="-"+f?d:s:h?f===m||v+f===m?d:s:o===m||o===v+m?d:s}}else return s}}function n(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}return Pn=r,Pn}var On,Os;function _l(){if(Os)return On;Os=1;const i=Ss(),e=bl(),t=Sl(),r=wl();"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,i.nameRegexp);class n{constructor(x){this.options=x,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={amp:{regex:/&(amp|#38|#x26);/g,val:"&"},apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=s,this.parseXml=h,this.parseTextData=a,this.resolveNameSpace=o,this.buildAttributesMap=v,this.isItStopNode=d,this.replaceEntitiesValue=f,this.readStopNodeData=p,this.saveTextToParentTag=l}}function s(b){const x=Object.keys(b);for(let S=0;S<x.length;S++){const _=x[S];this.lastEntities[_]={regex:new RegExp("&"+_+";","g"),val:b[_]}}}function a(b,x,S,_,w,I,V){if(b!==void 0&&(this.options.trimValues&&!_&&(b=b.trim()),b.length>0)){V||(b=this.replaceEntitiesValue(b));const M=this.options.tagValueProcessor(x,b,S,w,I);return M==null?b:typeof M!=typeof b||M!==b?M:this.options.trimValues?y(b,this.options.parseTagValue,this.options.numberParseOptions):b.trim()===b?y(b,this.options.parseTagValue,this.options.numberParseOptions):b}}function o(b){if(this.options.removeNSPrefix){const x=b.split(":"),S=b.charAt(0)==="/"?"/":"";if(x[0]==="xmlns")return"";x.length===2&&(b=S+x[1])}return b}const u=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function v(b,x){if(!this.options.ignoreAttributes&&typeof b=="string"){const S=i.getAllMatches(b,u),_=S.length,w={};for(let I=0;I<_;I++){const V=this.resolveNameSpace(S[I][1]);let M=S[I][4];const j=this.options.attributeNamePrefix+V;if(V.length)if(M!==void 0){this.options.trimValues&&(M=M.trim()),M=this.replaceEntitiesValue(M);const O=this.options.attributeValueProcessor(V,M,x);O==null?w[j]=M:typeof O!=typeof M||O!==M?w[j]=O:w[j]=y(M,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(w[j]=!0)}if(!Object.keys(w).length)return;if(this.options.attributesGroupName){const I={};return I[this.options.attributesGroupName]=w,I}return w}}const h=function(b){b=b.replace(/\r\n?/g,`
`);const x=new e("!xml");let S=x,_="",w="";for(let I=0;I<b.length;I++)if(b[I]==="<")if(b[I+1]==="/"){const M=c(b,">",I,"Closing Tag is not closed.");let j=b.substring(I+2,M).trim();if(this.options.removeNSPrefix){const O=j.indexOf(":");O!==-1&&(j=j.substr(O+1))}S&&(_=this.saveTextToParentTag(_,S,w)),w=w.substr(0,w.lastIndexOf(".")),S=this.tagsNodeStack.pop(),_="",I=M}else if(b[I+1]==="?"){let M=g(b,I,!1,"?>");if(!M)throw new Error("Pi Tag is not closed.");if(_=this.saveTextToParentTag(_,S,w),!(this.options.ignoreDeclaration&&M.tagName==="?xml"||this.options.ignorePiTags)){const j=new e(M.tagName);j.add(this.options.textNodeName,""),M.tagName!==M.tagExp&&M.attrExpPresent&&(j[":@"]=this.buildAttributesMap(M.tagExp,w)),S.addChild(j)}I=M.closeIndex+1}else if(b.substr(I+1,3)==="!--"){const M=c(b,"-->",I+4,"Comment is not closed.");if(this.options.commentPropName){const j=b.substring(I+4,M-2);_=this.saveTextToParentTag(_,S,w),S.add(this.options.commentPropName,[{[this.options.textNodeName]:j}])}I=M}else if(b.substr(I+1,2)==="!D"){const M=t(b,I);this.docTypeEntities=M.entities,I=M.i}else if(b.substr(I+1,2)==="!["){const M=c(b,"]]>",I,"CDATA is not closed.")-2,j=b.substring(I+9,M);if(_=this.saveTextToParentTag(_,S,w),this.options.cdataPropName)S.add(this.options.cdataPropName,[{[this.options.textNodeName]:j}]);else{let O=this.parseTextData(j,S.tagname,w,!0,!1,!0);O||(O=""),S.add(this.options.textNodeName,O)}I=M+2}else{let M=g(b,I,this.options.removeNSPrefix),j=M.tagName,O=M.tagExp,E=M.attrExpPresent,P=M.closeIndex;S&&_&&S.tagname!=="!xml"&&(_=this.saveTextToParentTag(_,S,w,!1)),j!==x.tagname&&(w+=w?"."+j:j);const $=S;if($&&this.options.unpairedTags.indexOf($.tagname)!==-1&&(S=this.tagsNodeStack.pop()),this.isItStopNode(this.options.stopNodes,w,j)){let H="";if(O.length>0&&O.lastIndexOf("/")===O.length-1)I=M.closeIndex;else if(this.options.unpairedTags.indexOf(j)!==-1)I=M.closeIndex;else{const k=this.readStopNodeData(b,j,P+1);if(!k)throw new Error(`Unexpected end of ${j}`);I=k.i,H=k.tagContent}const D=new e(j);j!==O&&E&&(D[":@"]=this.buildAttributesMap(O,w)),H&&(H=this.parseTextData(H,j,w,!0,E,!0,!0)),w=w.substr(0,w.lastIndexOf(".")),D.add(this.options.textNodeName,H),S.addChild(D)}else{if(O.length>0&&O.lastIndexOf("/")===O.length-1){j[j.length-1]==="/"?(j=j.substr(0,j.length-1),O=j):O=O.substr(0,O.length-1);const H=new e(j);j!==O&&E&&(H[":@"]=this.buildAttributesMap(O,w)),w=w.substr(0,w.lastIndexOf(".")),S.addChild(H)}else{const H=new e(j);this.tagsNodeStack.push(S),j!==O&&E&&(H[":@"]=this.buildAttributesMap(O,w)),S.addChild(H),S=H}_="",I=P}}else _+=b[I];return x.child},f=function(b){if(this.options.processEntities){for(let x in this.docTypeEntities){const S=this.docTypeEntities[x];b=b.replace(S.regx,S.val)}for(let x in this.lastEntities){const S=this.lastEntities[x];b=b.replace(S.regex,S.val)}if(this.options.htmlEntities)for(let x in this.htmlEntities){const S=this.htmlEntities[x];b=b.replace(S.regex,S.val)}}return b};function l(b,x,S,_){return b&&(_===void 0&&(_=Object.keys(x.child).length===0),b=this.parseTextData(b,x.tagname,S,!1,x[":@"]?Object.keys(x[":@"]).length!==0:!1,_),b!==void 0&&b!==""&&x.add(this.options.textNodeName,b),b=""),b}function d(b,x,S){const _="*."+S;for(const w in b){const I=b[w];if(_===I||x===I)return!0}return!1}function m(b,x,S=">"){let _,w="";for(let I=x;I<b.length;I++){let V=b[I];if(_)V===_&&(_="");else if(V==='"'||V==="'")_=V;else if(V===S[0])if(S[1]){if(b[I+1]===S[1])return{data:w,index:I}}else return{data:w,index:I};else V==="	"&&(V=" ");w+=V}}function c(b,x,S,_){const w=b.indexOf(x,S);if(w===-1)throw new Error(_);return w+x.length-1}function g(b,x,S,_=">"){const w=m(b,x+1,_);if(!w)return;let I=w.data;const V=w.index,M=I.search(/\s/);let j=I,O=!0;if(M!==-1&&(j=I.substr(0,M).replace(/\s\s*$/,""),I=I.substr(M+1)),S){const E=j.indexOf(":");E!==-1&&(j=j.substr(E+1),O=j!==w.data.substr(E+1))}return{tagName:j,tagExp:I,closeIndex:V,attrExpPresent:O}}function p(b,x,S){const _=S;for(;S<b.length;S++)if(b[S]==="<"&&b[S+1]==="/"){const w=c(b,">",S,`${x} is not closed`);if(b.substring(S+2,w).trim()===x)return{tagContent:b.substring(_,S),i:w};S=w}}function y(b,x,S){if(x&&typeof b=="string"){const _=b.trim();return _==="true"?!0:_==="false"?!1:r(b,S)}else return i.isExist(b)?b:""}return On=n,On}var kn={},ks;function El(){if(ks)return kn;ks=1;function i(s,a){return e(s,a)}function e(s,a,o){let u;const v={};for(let h=0;h<s.length;h++){const f=s[h],l=t(f);let d="";if(o===void 0?d=l:d=o+"."+l,l===a.textNodeName)u===void 0?u=f[l]:u+=""+f[l];else{if(l===void 0)continue;if(f[l]){let m=e(f[l],a,d);const c=n(m,a);f[":@"]?r(m,f[":@"],d,a):Object.keys(m).length===1&&m[a.textNodeName]!==void 0&&!a.alwaysCreateTextNode?m=m[a.textNodeName]:Object.keys(m).length===0&&(a.alwaysCreateTextNode?m[a.textNodeName]="":m=""),v[l]!==void 0?(Array.isArray(v[l])||(v[l]=[v[l]]),v[l].push(m)):a.isArray(l,d,c)?v[l]=[m]:v[l]=m}}}return typeof u=="string"?u.length>0&&(v[a.textNodeName]=u):u!==void 0&&(v[a.textNodeName]=u),v}function t(s){const a=Object.keys(s);for(let o=0;o<a.length;o++){const u=a[o];if(u!==":@")return u}}function r(s,a,o,u){if(a){const v=Object.keys(a),h=v.length;for(let f=0;f<h;f++){const l=v[f];u.isArray(l,o+"."+l,!0,!0)?s[l]=[a[l]]:s[l]=a[l]}}}function n(s,a){const o=Object.keys(s).length;return!!(o===0||o===1&&s[a.textNodeName])}return kn.prettify=i,kn}var Cn,Cs;function xl(){if(Cs)return Cn;Cs=1;const{buildOptions:i}=vl(),e=_l(),{prettify:t}=El(),r=_s();class n{constructor(a){this.externalEntities={},this.options=i(a)}parse(a,o){if(typeof a!="string")if(a.toString)a=a.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(o){o===!0&&(o={});const h=r.validate(a,o);if(h!==!0)throw Error(`${h.err.msg}:${h.err.line}:${h.err.col}`)}const u=new e(this.options);u.addExternalEntities(this.externalEntities);const v=u.parseXml(a);return this.options.preserveOrder||v===void 0?v:t(v,this.options)}addEntity(a,o){if(o.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(a.indexOf("&")!==-1||a.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");this.externalEntities[a]=o}}return Cn=n,Cn}var Tn,Ts;function Al(){if(Ts)return Tn;Ts=1;const i=`
`;function e(o,u){return t(o,u,"",0)}function t(o,u,v,h){let f="",l="";u.format&&u.indentBy.length>0&&(l=i+""+u.indentBy.repeat(h));for(let d=0;d<o.length;d++){const m=o[d],c=r(m);let g="";if(v.length===0?g=c:g=`${v}.${c}`,c===u.textNodeName){let x=m[c];s(g,u)||(x=u.tagValueProcessor(c,x),x=a(x,u)),f+=l+x;continue}else if(c===u.cdataPropName){f+=l+`<![CDATA[${m[c][0][u.textNodeName]}]]>`;continue}else if(c===u.commentPropName){f+=l+`<!--${m[c][0][u.textNodeName]}-->`;continue}else if(c[0]==="?"){const x=n(m[":@"],u),S=c==="?xml"?"":l;let _=m[c][0][u.textNodeName];_=_.length!==0?" "+_:"",f+=S+`<${c}${_}${x}?>`;continue}const p=n(m[":@"],u);let y=l+`<${c}${p}`,b=t(m[c],u,g,h+1);u.unpairedTags.indexOf(c)!==-1?u.suppressUnpairedNode?f+=y+">":f+=y+"/>":(!b||b.length===0)&&u.suppressEmptyNode?f+=y+"/>":f+=y+`>${b}${l}</${c}>`}return f}function r(o){const u=Object.keys(o);for(let v=0;v<u.length;v++){const h=u[v];if(h!==":@")return h}}function n(o,u){let v="";if(o&&!u.ignoreAttributes)for(let h in o){let f=u.attributeValueProcessor(h,o[h]);f=a(f,u),f===!0&&u.suppressBooleanAttributes?v+=` ${h.substr(u.attributeNamePrefix.length)}`:v+=` ${h.substr(u.attributeNamePrefix.length)}="${f}"`}return v}function s(o,u){o=o.substr(0,o.length-u.textNodeName.length-1);let v=o.substr(o.lastIndexOf(".")+1);for(let h in u.stopNodes)if(u.stopNodes[h]===o||u.stopNodes[h]==="*."+v)return!0;return!1}function a(o,u){if(o&&o.length>0&&u.processEntities)for(let v=0;v<u.entities.length;v++){const h=u.entities[v];o=o.replace(h.regex,h.val)}return o}return Tn=e,Tn}var Fn,Fs;function Pl(){if(Fs)return Fn;Fs=1;const i=Al(),e={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(l,d){return d},attributeValueProcessor:function(l,d){return d},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[]};function t(l){this.options=Object.assign({},e,l),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=f),this.processTextOrObjNode=n,this.options.format?(this.indentate=h,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.suppressEmptyNode?(this.buildTextNode=v,this.buildObjNode=a):(this.buildTextNode=o,this.buildObjNode=s),this.buildTextValNode=o,this.buildObjectNode=s,this.replaceEntitiesValue=u,this.buildAttrPairStr=r}t.prototype.build=function(l){return this.options.preserveOrder?i(l,this.options):(Array.isArray(l)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(l={[this.options.arrayNodeName]:l}),this.j2x(l,0).val)},t.prototype.j2x=function(l,d){let m="",c="";for(let g in l)if(!(typeof l[g]>"u"))if(l[g]===null)g[0]==="?"?c+=this.indentate(d)+"<"+g+"?"+this.tagEndChar:c+=this.indentate(d)+"<"+g+"/"+this.tagEndChar;else if(l[g]instanceof Date)c+=this.buildTextNode(l[g],g,"",d);else if(typeof l[g]!="object"){const p=this.isAttribute(g);if(p)m+=this.buildAttrPairStr(p,""+l[g]);else if(g===this.options.textNodeName){let y=this.options.tagValueProcessor(g,""+l[g]);c+=this.replaceEntitiesValue(y)}else c+=this.buildTextNode(l[g],g,"",d)}else if(Array.isArray(l[g])){const p=l[g].length;for(let y=0;y<p;y++){const b=l[g][y];typeof b>"u"||(b===null?g[0]==="?"?c+=this.indentate(d)+"<"+g+"?"+this.tagEndChar:c+=this.indentate(d)+"<"+g+"/"+this.tagEndChar:typeof b=="object"?c+=this.processTextOrObjNode(b,g,d):c+=this.buildTextNode(b,g,"",d))}}else if(this.options.attributesGroupName&&g===this.options.attributesGroupName){const p=Object.keys(l[g]),y=p.length;for(let b=0;b<y;b++)m+=this.buildAttrPairStr(p[b],""+l[g][p[b]])}else c+=this.processTextOrObjNode(l[g],g,d);return{attrStr:m,val:c}};function r(l,d){return d=this.options.attributeValueProcessor(l,""+d),d=this.replaceEntitiesValue(d),this.options.suppressBooleanAttributes&&d==="true"?" "+l:" "+l+'="'+d+'"'}function n(l,d,m){const c=this.j2x(l,m+1);return l[this.options.textNodeName]!==void 0&&Object.keys(l).length===1?this.buildTextNode(l[this.options.textNodeName],d,c.attrStr,m):this.buildObjNode(c.val,d,c.attrStr,m)}function s(l,d,m,c){let g="</"+d+this.tagEndChar,p="";return d[0]==="?"&&(p="?",g=""),m&&l.indexOf("<")===-1?this.indentate(c)+"<"+d+m+p+">"+l+g:this.options.commentPropName!==!1&&d===this.options.commentPropName&&p.length===0?this.indentate(c)+`<!--${l}-->`+this.newLine:this.indentate(c)+"<"+d+m+p+this.tagEndChar+l+this.indentate(c)+g}function a(l,d,m,c){return l!==""?this.buildObjectNode(l,d,m,c):d[0]==="?"?this.indentate(c)+"<"+d+m+"?"+this.tagEndChar:this.indentate(c)+"<"+d+m+"/"+this.tagEndChar}function o(l,d,m,c){if(this.options.cdataPropName!==!1&&d===this.options.cdataPropName)return this.indentate(c)+`<![CDATA[${l}]]>`+this.newLine;if(this.options.commentPropName!==!1&&d===this.options.commentPropName)return this.indentate(c)+`<!--${l}-->`+this.newLine;{let g=this.options.tagValueProcessor(d,l);return g=this.replaceEntitiesValue(g),g===""&&this.options.unpairedTags.indexOf(d)!==-1?this.options.suppressUnpairedNode?this.indentate(c)+"<"+d+this.tagEndChar:this.indentate(c)+"<"+d+"/"+this.tagEndChar:this.indentate(c)+"<"+d+m+">"+g+"</"+d+this.tagEndChar}}function u(l){if(l&&l.length>0&&this.options.processEntities)for(let d=0;d<this.options.entities.length;d++){const m=this.options.entities[d];l=l.replace(m.regex,m.val)}return l}function v(l,d,m,c){return l===""&&this.options.unpairedTags.indexOf(d)!==-1?this.options.suppressUnpairedNode?this.indentate(c)+"<"+d+this.tagEndChar:this.indentate(c)+"<"+d+"/"+this.tagEndChar:l!==""?this.buildTextValNode(l,d,m,c):d[0]==="?"?this.indentate(c)+"<"+d+m+"?"+this.tagEndChar:this.indentate(c)+"<"+d+m+"/"+this.tagEndChar}function h(l){return this.options.indentBy.repeat(l)}function f(l){return l.startsWith(this.options.attributeNamePrefix)?l.substr(this.attrPrefixLen):!1}return Fn=t,Fn}var Rn,Rs;function Ol(){if(Rs)return Rn;Rs=1;const i=_s(),e=xl(),t=Pl();return Rn={XMLParser:e,XMLValidator:i,XMLBuilder:t},Rn}var kl=Ol();const Cl=/<(\/)?c(\.[^>]*)?>/g,Tl=RegExp(/\\[nN]/,"ig"),Mt=document.createElement("div"),Fl=(i,e)=>{if(typeof i.line=="number"&&typeof e.line=="number"){if(i.line<e.line)return-1;if(i.line>e.line)return 1;if(typeof i.position=="number"&&typeof e.position=="number")return i.position<e.position?-1:i.position>e.position?1:0}return 0},Ls=i=>i.length<=1?i:i.sort(Fl);class Rl{constructor({regexFilter:e,regexFilterTextReplacement:t,subtitleHtml:r,pgsParserWorkerFactory:n}){A(this,"_textFilter");A(this,"_removeXml");A(this,"_pgsWorkerFactory");A(this,"xmlParser");let s;try{s=e.trim()===""?void 0:new RegExp(e,"gv")}catch{s=void 0}s===void 0?this._textFilter=void 0:this._textFilter={regex:s,replacement:t},this._removeXml=r===or.remove,this._pgsWorkerFactory=n}async subtitles(e,t){const r=(await Promise.all(e.map((n,s)=>this._subtitles(n,t===!0?0:s)))).flatMap(n=>n).filter(n=>n.textImage!==void 0||n.text!=="").sort((n,s)=>n.start-s.start);return t?this._deduplicate(r):r}_deduplicate(e){const t=[];for(const r of e)(t.length==0||!this._isSame(r,t[t.length-1]))&&t.push(r);return t}_isSame(e,t){return e.textImage||t.textImage?!1:e.start===t.start&&e.end===t.end&&e.text===t.text}async _subtitles(e,t){if(e.name.endsWith(".srt")||e.name.endsWith(".subrip"))return new cs({numericTimestamps:!0}).fromSrt(await e.text()).map(s=>({start:Math.floor(s.startTime*1e3),end:Math.floor(s.endTime*1e3),text:this._filterText(s.text),track:t}));if(e.name.endsWith(".vtt")||e.name.endsWith(".nfvtt"))return new Promise(async(r,n)=>{const s=e.name.endsWith(".nfvtt"),a=new vs.WebVTT.Parser(window,vs.WebVTT.StringDecoder()),o=[];let u,v=[];a.oncue=h=>{if(h.text=this._filterText(h.text.replaceAll(Cl,"")),s){const l=h.text.split(`
`),d=[];for(const m of l)d.push(this._fixRTL(m));h.text=d.join(`
`)}const f=Math.floor(h.startTime*1e3);u===void 0||u===f?v.push(h):(v=Ls(v),o.push(v),v=[h]),u=f},a.onflush=()=>{v=Ls(v),o.push(v);const h=[];for(const f of o)for(const l of f)h.push({start:Math.floor(l.startTime*1e3),end:Math.floor(l.endTime*1e3),text:l.text,track:t});r(h)},a.parse(await e.text()),a.flush()});if(e.name.endsWith(".ass"))return fl(await e.text(),{}).dialogues.map(n=>({start:Math.round(n.start*1e3),end:Math.round(n.end*1e3),text:this._filterText(n.slices.flatMap(s=>s.fragments.map(a=>a.text)).join("")).replace(Tl,`
`),track:t}));if(e.name.endsWith(".ytsrv3")){const r=await e.text(),s=this._xmlParser().parse(r).timedtext.body.p,a=[];for(let o=0;o<s.length;o++){const u=s[o];if(typeof u["@_t"]!="string"||typeof u["@_d"]!="string")continue;const v=Number(u["@_t"]);let h=Number(u["@_d"]);if(Number.isNaN(v)||Number.isNaN(h))continue;let f=[];typeof u["#text"]=="string"&&f.push(u["#text"]);const l=u.s;if(l!==void 0)if(typeof l=="object"&&Array.isArray(l))for(const m of u.s)typeof m=="string"?f.push(m):typeof m["#text"]=="string"&&f.push(m["#text"]);else typeof l["#text"]=="string"&&f.push(l["#text"]);const d=f.join("").trim();if(d){let m=s[o+1];if((m==null?void 0:m["#text"])===`
`&&typeof m["@_t"]=="string"){const c=Number(m["@_t"]);Number.isNaN(c)||(h=Math.min(h,c-v))}a.push({start:v,end:v+h,text:this._filterText(d),track:t})}}return a}if(e.name.endsWith(".ytxml")){const r=await e.text(),n=this._xmlParser().parse(r);if(Object.keys(n).length===0)return[];const s=n.transcript.text,a=[];let o=0,u;for(let h=0,f=s.length;h<f;h++){const l=s[h];if(!("#text"in l)||!("@_dur"in l)||!("@_start"in l))continue;const d=parseFloat(l["@_start"]),m={start:Math.floor(d*1e3),end:Math.floor((d+parseFloat(l["@_dur"]))*1e3),text:this._filterText(this._decodeHTML(String(l["#text"]))),track:t};u!==void 0&&u.end>m.start&&++o,a.push(m),u=m}return a.length>0&&o/a.length>.5?a.map((h,f)=>f<a.length-1?{...h,end:Math.max(h.start,Math.min(a[f+1].start-1,h.end))}:h):a}if(e.name.endsWith(".sup"))return await this._parsePgs(e,t);if(e.name.endsWith(".dfxp")||e.name.endsWith("ttml2")){const r=await e.text(),s=new DOMParser().parseFromString(r,"application/xml"),a=this._xmlNodePath(s.documentElement,["body","div"]),o=[];for(let u=0,v=a.length;u<v;u++){const h=a[u],f=h.getAttribute("begin"),l=h.getAttribute("end");if(f===null||l===null)continue;const d=this._decodeHTML(h.innerHTML.replaceAll(/<br(\s[^\s]+)?(\/)?>/g,`
`));o.push({text:this._filterText(d),start:this._parseTtmlTimestamp(f),end:this._parseTtmlTimestamp(l),track:t})}return o}if(e.name.endsWith(".bbjson"))return JSON.parse(await e.text()).body.map(n=>({text:n.content,start:n.from*1e3,end:n.to*1e3,track:t}));throw new Error("Unsupported subtitle file format")}_parsePgs(e,t){const r=[];return new Promise(async(n,s)=>{const a=await this._pgsWorkerFactory();a.onmessage=async h=>{switch(h.data.command){case"subtitle":const f={...h.data.subtitle,track:t},l=h.data.imageBlob;f.textImage.dataUrl=await this._blobToDataUrl(l),r.push(f);break;case"finished":a.terminate(),n(r);break;case"error":a.terminate(),s(h.data.error);break}},a.onerror=h=>{const f=(h==null?void 0:h.error)??new Error("PGS decoding failed: "+(h==null?void 0:h.message));s(f),a.terminate()};const u=document.createElement("canvas").transferControlToOffscreen(),v=await e.stream();a.postMessage({fileStream:v,canvas:u},[v,u])})}_blobToDataUrl(e){return new Promise((t,r)=>{var n=new FileReader;n.readAsDataURL(e),n.onloadend=()=>{t(n.result)}})}_parseTtmlTimestamp(e){const t=e.split(":"),r=Math.floor(parseFloat(t[t.length-1])*1e3),n=t.length<2?0:Number(t[t.length-2]),s=t.length<3?0:Number(t[t.length-3]);return r+n*6e4+s*36e5}_xmlNodePath(e,t){if(t.length===0){const r=[];for(let n=0;n<e.children.length;++n){const s=e.children[n];r.push(s)}return r}for(let r=0;r<e.children.length;++r){const n=e.children[r];if(this._dropTagNamespace(n.tagName)===t[0])return this._xmlNodePath(n,t.slice(1))}throw new Error("Failied to parse XML path")}_dropTagNamespace(e){const t=e.lastIndexOf(":");return t!==-1?e.substring(t+1):e}_fixRTL(e){const t=e.indexOf("&lrm;"),r=e.indexOf("&rlm;");let n="";return t>-1?(n=e.substring(0,t)+"‪"+e.substring(t+5)+"‬",this._fixRTL(n)):r>-1?(n=e.substring(0,r)+"‫"+e.substring(r+5)+"‬",this._fixRTL(n)):e}_decodeHTML(e){Mt.innerHTML=e;const t=[...Mt.getElementsByTagName("rt")];for(const r of t)r.remove();return Mt.textContent??Mt.innerText}_xmlParser(){return this.xmlParser===void 0&&(this.xmlParser=new kl.XMLParser({ignoreAttributes:!1,trimValues:!1})),this.xmlParser}_filterText(e){return e=this._textFilter===void 0?e:e.replace(this._textFilter.regex,this._textFilter.replacement).trim(),this._removeXml&&(e=this._decodeHTML(e)),e}subtitlesToSrt(e){const t=new cs({numericTimestamps:!0}),r=e.map((n,s)=>({id:String(s),startTime:n.start,endTime:n.end,text:n.text}));return t.toSrt(r)}async filesToSrt(e){return this.subtitlesToSrt(await this.subtitles(e))}}const $t="activeSettingsProfile",Bt="settingsProfiles";class ft{constructor(e){A(this,"_storage");this._storage=e??W.storage.local}async get(e){const t=await this.activeProfile();return t===void 0?await this._storage.get(e):So(await this._storage.get(Pt(e,t.name)),t.name)}async set(e){const t=await this.activeProfile();t===void 0?await this._storage.set(e):await this._storage.set(Pt(e,t.name))}async activeProfile(){const e=await this._storage.get($t),t=e&&e[$t];return t===void 0?void 0:(await this.profiles()).find(n=>n.name===t)}async setActiveProfile(e){if(e===void 0)await this._storage.remove($t);else{if(!((await this.profiles()).find(n=>n.name===e)!==void 0))throw new Error(`Cannot set active profile to non-existant profile ${e}`);await this._storage.set({[$t]:e})}}async profiles(){const e=await this._storage.get({[Bt]:[]});return e?e[Bt]??[]:[]}async addProfile(e){const t=await this.profiles();t.find(s=>s.name===e)===void 0&&t.push({name:e}),await this._storage.set({[Bt]:t});const n=await this._storage.get(Object.keys(ye));await this._storage.set(Pt(n,e))}async removeProfile(e){const t=await this.profiles(),r=await this.activeProfile();if(e===(r==null?void 0:r.name))throw new Error("Cannot remove active profile");const n=t.filter(a=>a.name!==e),s=Object.keys(Pt(ye,e));await this._storage.remove(s),await this._storage.set({[Bt]:n})}async clear(){await this._storage.clear()}}new ut(new ft),W.storage.session;const Ll=i=>`locStrings-${i}`;new ut(new ft);const qe=async i=>await Il(i)??await Is(i)??await Is("en"),Is=async i=>{for(const e of zo)if(i===e)return{lang:i,strings:await(await fetch(W.runtime.getURL(`/asbplayer-locales/${i}.json`))).json()}},Il=async i=>{const e=Ll(i),t=await W.storage.local.get(e),r=t?t[e]:void 0;if(r!==void 0)return{lang:i,strings:r}};class Nl{constructor(e,t){A(this,"frame");A(this,"fetchOptions");A(this,"frameId");A(this,"windowMessageListener");A(this,"bindPromise");A(this,"serverMessageListener");this.frame=e,this.fetchOptions=t,this.bindPromise=void 0}async bind(){return this.bindPromise=this.bindPromise||this._bindClient(),this.bindPromise}updateState(e){var t;if(!this.frameId)throw new Error("Attempted to update state when frame is not ready");(t=this.frame.contentWindow)==null||t.postMessage({sender:"asbplayer-video",message:{command:"sendClientMessage",message:{command:"updateState",state:e},frameId:this.frameId}},"*")}sendMessage(e){var t;if(!this.frameId)throw new Error("Attempted to send message when frame is not ready");(t=this.frame.contentWindow)==null||t.postMessage({sender:"asbplayer-video",message:{command:"sendClientMessage",message:e,frameId:this.frameId}},"*")}onMessage(e){this.serverMessageListener=e}unbind(){this.windowMessageListener&&(window.removeEventListener("message",this.windowMessageListener),this.windowMessageListener=void 0),this.serverMessageListener=void 0}_bindClient(){return new Promise((e,t)=>{let r=!1;this.windowMessageListener=n=>{if(n.source!==this.frame.contentWindow||n.data.sender!=="asbplayer-frame")return;const s=n.data.message;switch(s.command){case"ready":this.frameId=n.data.message.frameId,r=!0,e();break;case"onServerMessage":if(s.message.command==="http-post")this._resolveHttpPost(s.message);else if(this.serverMessageListener){const a=this.serverMessageListener(s.message);a instanceof Promise&&a.catch(console.error)}break}},setTimeout(()=>{r||(t(new Error("Timed out waiting for frame to be ready")),this.windowMessageListener&&(window.removeEventListener("message",this.windowMessageListener),this.windowMessageListener=void 0))},1e4),window.addEventListener("message",this.windowMessageListener)})}_resolveHttpPost(e){if(this.fetchOptions===void 0||this.fetchOptions.allowedFetchUrl===void 0||e.url!==this.fetchOptions.allowedFetchUrl)return;let t;const r={command:"http-post",url:e.url,body:e.body,messageId:e.messageId};this.fetchOptions.videoSrc===void 0?t={sender:"asbplayer-video-tab",message:r}:t={sender:"asbplayer-video",message:r,src:this.fetchOptions.videoSrc},W.runtime.sendMessage(t,n=>{var a,o;const s=n?{...n,messageId:e.messageId}:{error:(a=W.runtime.lastError)==null?void 0:a.message,messageId:e.messageId};(o=this.frame.contentWindow)==null||o.postMessage({sender:"asbplayer-video",message:{command:"sendClientMessage",message:s,frameId:this.frameId}},"*")})}}const Ml=()=>{const i=document.querySelector('meta[name="color-scheme"]');if(i===null)return"normal";const e=i.content,t=e.includes("light"),r=e.includes("dark");return t&&r?"none":t?"light":r?"dark":"normal"};class dt{constructor(e){A(this,"_html");A(this,"_fetchOptions");A(this,"_client");A(this,"_frame");A(this,"_language","en");A(this,"_dirty",!0);A(this,"_bound",!1);this._html=e}set fetchOptions(e){var t,r;this._dirty=this._dirty||((t=this._fetchOptions)==null?void 0:t.allowedFetchUrl)!==e.allowedFetchUrl||((r=this._fetchOptions)==null?void 0:r.videoSrc)!==e.videoSrc,this._fetchOptions=e}set language(e){this._dirty=this._dirty||this._language!==e,this._language=e}get hidden(){return this._frame===void 0||this._frame.classList.contains("asbplayer-hide")}get bound(){return this._bound}get frame(){return this._frame}get clientIfLoaded(){return this._client}async bind(){return await this._init()}async client(){return await this._init(),this._client}async _init(){var e,t;if(!this._dirty)return!1;this._dirty=!1,this._bound=!0,(e=this._client)==null||e.unbind(),(t=this._frame)==null||t.remove(),this._frame=document.createElement("iframe"),this._frame.className="asbplayer-ui-frame",this._frame.style.colorScheme=Ml(),this._frame.setAttribute("allowtransparency","true"),this._client=new Nl(this._frame,this._fetchOptions),document.body.appendChild(this._frame);{const r=this._frame.contentDocument;r.open(),r.write(await this._html(this._language)),r.close()}return await this._client.bind(),!0}show(){var e;(e=this._frame)==null||e.classList.remove("asbplayer-hide")}hide(){var e,t;(e=this._frame)==null||e.classList.add("asbplayer-hide"),(t=this._frame)==null||t.blur()}unbind(){var e,t;this._dirty=!0,(e=this._client)==null||e.unbind(),(t=this._frame)==null||t.remove()}}const Ln=async()=>{const i=await(await fetch(W.runtime.getURL("/mp3-encoder-worker.js"))).text(),e=new Blob([i],{type:"application/javascript"});return new Worker(URL.createObjectURL(e))},Ns={ftueHasSeenAnkiDialogQuickSelectV2:!1,ftueHasSeenSubtitleTrackSelector:!1};class In{constructor(e){A(this,"_storage");this._storage=e??W.storage.local}async getAll(){return await this._storage.get(Ns)}async get(e){const t={};for(const r of e)t[r]=Ns[r];return await this._storage.get(t)}async set(e){await this._storage.set(e)}}const Ut=()=>window.location.href.startsWith(W.runtime.getURL("/ftue-ui.html"));async function $l(i){return`<!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="utf-8" />
                    <meta name="viewport" content="width=device-width, initial-scale=1" />
                    <title>asbplayer - Anki</title>
                    <style>
                        @import url(${W.runtime.getURL("/fonts/fonts.css")});
                    </style>
                </head>
                <body>
                    <div id="root" style="width:100%;height:100vh;"></div>
                    <script type="application/json" id="loc">${JSON.stringify(await qe(i))}<\/script>
                    <script type="module" src="${W.runtime.getURL("/anki-ui.js")}"><\/script>
                </body>
            </html>`}const Ms=new In;class Bl{constructor(){A(this,"frame");A(this,"fullscreenElement");A(this,"activeElement");A(this,"focusInListener");A(this,"_settings");A(this,"_inTutorial");this.frame=new dt($l),this._inTutorial=Ut()}get settings(){return this._settings}updateSettings(e,t){var r;this._settings=e,(r=this.frame)!=null&&r.bound&&this.frame.client().then(async n=>{var u;const s=t.profiles(),a=t.activeProfile(),o={command:"settings",settings:e,profiles:await s,activeProfile:(u=await a)==null?void 0:u.name};n.sendMessage(o)})}get showing(){return!this.frame.hidden}async show(e,{subtitle:t,surroundingSubtitles:r,image:n,audio:s,text:a,definition:o,word:u,customFieldValues:v}){if(!this._settings)throw new Error("Unable to show Anki UI because settings are missing.");this._prepareShow(e);const h=await this._client(e),f=e.url(t.start,t.end),l={type:"initial",open:!0,canRerecord:!0,settings:this._settings,source:hr(e.subtitleFileName(),t.start),url:f,subtitle:t,surroundingSubtitles:r,image:n,audio:s,dialogRequestedTimestamp:e.video.currentTime*1e3,text:a,word:u,definition:o,customFieldValues:v,inTutorial:this._inTutorial,...await this._additionalUiState(e)};h.updateState(l)}async showAfterRerecord(e,t){if(!this._settings)throw new Error("Unable to show Anki UI after rerecording because anki settings are undefined");this._prepareShow(e);const r=await this._client(e),n={...t,type:"resume",open:!0,canRerecord:!0,settings:this._settings,dialogRequestedTimestamp:e.video.currentTime*1e3,inTutorial:this._inTutorial,...await this._additionalUiState(e)};r.updateState(n)}async showAfterRetakingScreenshot(e,t){if(!this._settings)throw new Error("Unable to show Anki UI after retaking screenshot because anki settings are undefined");this._prepareShow(e);const r=await this._client(e),n={...t,type:"resume",open:!0,canRerecord:!0,settings:this._settings,inTutorial:this._inTutorial,...await this._additionalUiState(e)};r.updateState(n)}async requestRewind(e){(await this._client(e)).sendMessage({command:"rewind"})}_prepareShow(e){e.pause(),document.activeElement&&(this.activeElement=document.activeElement),document.fullscreenElement&&(this.fullscreenElement=document.fullscreenElement,document.exitFullscreen()),e.keyBindings.unbind(),e.subtitleController.forceHideSubtitles=!0,e.mobileVideoOverlayController.forceHide=!0}async _client(e){this.frame.fetchOptions={videoSrc:e.video.src,allowedFetchUrl:this._settings.ankiConnectUrl},this.frame.language=await e.settings.getSingle("language");const t=await this.frame.bind(),r=await this.frame.client();return t&&(this.focusInListener=n=>{this.frame===void 0||this.frame.hidden||r.sendMessage({command:"focus"})},window.addEventListener("focusin",this.focusInListener),r.onMessage(async n=>{var s;switch(n.command){case"openSettings":const a={sender:"asbplayer-video",message:{command:"open-asbplayer-settings",tutorial:this._inTutorial},src:e.video.src};W.runtime.sendMessage(a);return;case"copy-to-clipboard":const u={sender:"asbplayer-video",message:{command:"copy-to-clipboard",dataUrl:n.dataUrl},src:e.video.src};W.runtime.sendMessage(u);return;case"encode-mp3":const{base64:v,messageId:h,extension:f}=n,l=await mr.encode(await gn(v,`audio/${f}`),Ln);r.sendMessage({messageId:h,base64:await ss(l)});return;case"activeProfile":const d=n;e.settings.setActiveProfile(d.profile).then(()=>{const c={sender:"asbplayer-video",message:{command:"settings-updated"},src:e.video.src};W.runtime.sendMessage(c)});return;case"dismissedQuickSelectFtue":Ms.set({ftueHasSeenAnkiDialogQuickSelectV2:!0}).catch(console.error);return;case"exported":const m=n;e.settings.set({lastSelectedAnkiExportMode:m.mode}).then(()=>{const c={sender:"asbplayer-video",message:{command:"settings-updated"},src:e.video.src};W.runtime.sendMessage(c)});return}if(e.keyBindings.bind(e),e.subtitleController.forceHideSubtitles=!1,e.mobileVideoOverlayController.forceHide=!1,(s=this.frame)==null||s.hide(),this.fullscreenElement&&(this.fullscreenElement.requestFullscreen(),this.fullscreenElement=void 0),this.activeElement){const a=this.activeElement;typeof a.focus=="function"&&a.focus(),this.activeElement=void 0}else window.focus();switch(n.command){case"resume":const a=n;if(e.ankiUiSavedState=a.uiState,a.cardExported&&a.uiState.dialogRequestedTimestamp!==0){const v=a.uiState.dialogRequestedTimestamp/1e3;e.video.currentTime!==v&&e.seek(v)}switch(e.postMinePlayback){case Ee.remember:e.wasPlayingBeforeRecordingMedia&&e.play();break;case Ee.play:e.play();break;case Ee.pause:break}break;case"rewind":const o=n;e.ankiUiSavedState=o.uiState,e.pause(),e.seek(o.uiState.subtitle.start/1e3);break;case"rerecord":const u=n;e.rerecord(u.recordStart,u.recordEnd,u.uiState);break;default:console.error("Unknown message received from bridge: "+n.command)}})),this.frame.show(),r}async _additionalUiState(e){var s;const t=e.settings.profiles(),r=e.settings.activeProfile(),n=Ms.getAll();return{profiles:await t,activeProfile:(s=await r)==null?void 0:s.name,ftueHasSeenAnkiDialogQuickSelect:(await n).ftueHasSeenAnkiDialogQuickSelectV2}}unbind(){this.frame.unbind(),this.focusInListener&&(window.removeEventListener("focusin",this.focusInListener),this.focusInListener=void 0)}}class Ul{constructor(e){A(this,"video");A(this,"elements");this.video=e,this.elements=[]}show(){for(const e of this.elements)e.classList.remove("asbplayer-hide")}hide(){this._garbageCollectElements(),this._findElements();for(const e of this.elements)e.classList.add("asbplayer-hide");return new Promise((e,t)=>{setTimeout(()=>e(void 0),0)})}_garbageCollectElements(){this.elements=this.elements.filter(e=>this.video.getRootNode().contains(e))}_findElements(){const e=this.video.getRootNode();if(typeof e.elementFromPoint=="function")for(const t of this._samplePoints())for(const r of this._path(e.elementFromPoint(t.x,t.y),e))r&&!this._contains(this.elements,r)&&!r.classList.contains("asbplayer-ui-frame")&&this.elements.push(r)}*_samplePoints(){const e=this.video.getBoundingClientRect(),t=e.width/12,r=e.height/12,n=e.width+e.x,s=e.height+e.y;for(let a=e.x;a<=n;a+=t)for(let o=e.y;o<=s;o+=r)yield{x:this._withNoise(a,t/2,e.x,n),y:this._withNoise(o,r/2,e.y,s)}}_withNoise(e,t,r,n){return Math.min(n,Math.max(r,e+(Math.random()*t*2-t)))}*_path(e,t){if(!e||e.contains(this.video))return;const r=t.host;let n=e;for(yield n;;){const s=n.parentElement;if(!s||s.contains(this.video)||r!==void 0&&s.contains(r))break;n=s,yield n}}_contains(e,t){for(const r of e)if(r.isSameNode(t))return!0;return!1}}const $s=300,Bs=300;class jl{constructor(e){A(this,"video");A(this,"imageElement");A(this,"imageElementStylesInterval");this.video=e}element(){if(this.imageElement)return this.imageElement;const e=document.createElement("div");e.classList.add("asbplayer-image-container"),e.classList.add("asbplayer-hide");const t=document.createElement("img");return t.classList.add("asbplayer-image"),t.src=W.runtime.getURL("/icon/image.png"),this._applyImageContainerStyles(t,e),e.appendChild(t),document.body.appendChild(e),this.imageElementStylesInterval=setInterval(()=>this._applyImageContainerStyles(t,e),1e3),this.imageElement=e,this.imageElement}_applyImageContainerStyles(e,t){const r=this.video.getBoundingClientRect(),n=Math.min(window.innerWidth,r.width)*.9,s=Math.min(window.innerHeight,r.height)*.9;t.style.top=r.top+window.scrollY+r.height*.05+"px",t.style.left=r.left+r.width*.05+"px",t.style.width=n+"px",t.style.height=s+"px";const a=Math.min(1,Math.min(n/$s,s/Bs)),o=$s*a,u=Bs*a,v=(s-u)/2,h=(n-o)/2;e.style.top=v+"px",e.style.left=h+"px",e.style.width=o+"px",e.style.height=u+"px"}remove(){this.imageElementStylesInterval&&(clearInterval(this.imageElementStylesInterval),this.imageElementStylesInterval=void 0),this.imageElement&&(this.imageElement.remove(),this.imageElement=void 0)}}class Dl{constructor(e){A(this,"video");A(this,"imageElement");A(this,"bound");A(this,"dragEnterElement",null);A(this,"bodyDragEnterElement",null);A(this,"dragElement");A(this,"dropListener");A(this,"dragOverListener");A(this,"dragEnterListener");A(this,"dragLeaveListener");A(this,"bodyDropListener");A(this,"bodyDragOverListener");A(this,"bodyDragEnterListener");A(this,"bodyDragLeaveListener");A(this,"dragElementStylesInterval");this.video=e,this.imageElement=new jl(e),this.bound=!1}bind(e){if(this.bound)return;this.dropListener=async r=>{var s,a;if(r.preventDefault(),this.dragEnterElement=null,this.imageElement.element().classList.add("asbplayer-hide"),this.imageElement.element().classList.remove("asbplayer-image-fade-in"),this._dragElement().classList.remove("asbplayer-drag-zone-dragging"),this._dragElement().classList.add("asbplayer-hide"),!((s=r.dataTransfer)!=null&&s.files)||((a=r.dataTransfer)==null?void 0:a.files.length)===0)return;const n=[];for(let o=0;o<r.dataTransfer.files.length;++o){const u=r.dataTransfer.files[o],v=u.name.lastIndexOf(".");if(v===-1)return!1;const h=u.name.substring(v+1,u.name.length);(h==="ass"||h==="srt"||h==="vtt"||h==="sup"||h==="dfxp"||h==="ttml2")&&n.push(u)}e.loadSubtitles(n,!1)},this.dragOverListener=r=>r.preventDefault(),this.dragEnterListener=r=>{r.preventDefault(),this.dragEnterElement=r.target,this.imageElement.element().classList.add("asbplayer-drag-image"),this.imageElement.element().classList.remove("asbplayer-hide"),this.imageElement.element().classList.add("asbplayer-image-fade-in")},this.dragLeaveListener=r=>{r.preventDefault(),this.dragEnterElement===r.target&&(this.imageElement.element().classList.add("asbplayer-hide"),this.imageElement.element().classList.remove("asbplayer-image-fade-in"),this._dragElement().classList.remove("asbplayer-drag-zone-dragging"),this._dragElement().classList.add("asbplayer-hide"))},this.bodyDropListener=r=>{r.preventDefault(),this.imageElement.element().classList.add("asbplayer-hide"),this.imageElement.element().classList.remove("asbplayer-image-fade-in"),this._dragElement().classList.remove("asbplayer-drag-zone-dragging"),this._dragElement().classList.add("asbplayer-hide")},this.bodyDragOverListener=r=>r.preventDefault(),this.bodyDragEnterListener=r=>{r.preventDefault(),this.bodyDragEnterElement=r.target,this._dragElement().classList.add("asbplayer-drag-zone-dragging"),this._dragElement().classList.remove("asbplayer-hide")},this.bodyDragLeaveListener=r=>{r.preventDefault(),this.bodyDragEnterElement===r.target&&(this.imageElement.element().classList.add("asbplayer-hide"),this.imageElement.element().classList.remove("asbplayer-image-fade-in"),this._dragElement().classList.remove("asbplayer-drag-zone-dragging"),this._dragElement().classList.add("asbplayer-hide"))};const t=this._dragElement();t.addEventListener("drop",this.dropListener),t.addEventListener("dragover",this.dragOverListener),t.addEventListener("dragenter",this.dragEnterListener),t.addEventListener("dragleave",this.dragLeaveListener),document.body.addEventListener("drop",this.bodyDropListener),document.body.addEventListener("dragover",this.bodyDragOverListener),document.body.addEventListener("dragenter",this.bodyDragEnterListener),document.body.addEventListener("dragleave",this.bodyDragLeaveListener),this.bound=!0}_dragElement(){if(this.dragElement)return this.dragElement;const e=document.createElement("div");return e.classList.add("asbplayer-drag-zone-initial"),this.dragElement=e,this._applyDragElementStyles(e),document.body.appendChild(e),this.dragElementStylesInterval=setInterval(()=>this._applyDragElementStyles(e),1e3),this.dragElement}_applyDragElementStyles(e){const t=this.video.getBoundingClientRect();e.style.top=t.top+window.scrollY+t.height*.05+"px",e.style.left=t.left+t.width*.05+"px",e.style.height=Math.min(window.innerHeight,t.height)*.9+"px",e.style.width=Math.min(window.innerWidth,t.width)*.9+"px"}unbind(){var e,t,r,n;this.dropListener&&((e=this.dragElement)==null||e.removeEventListener("drop",this.dropListener,!0),this.dropListener=void 0),this.dragOverListener&&((t=this.dragElement)==null||t.removeEventListener("dragover",this.dragOverListener,!0),this.dragOverListener=void 0),this.dragEnterListener&&((r=this.dragElement)==null||r.removeEventListener("dragenter",this.dragEnterListener,!0),this.dragEnterListener=void 0),this.dragLeaveListener&&((n=this.dragElement)==null||n.removeEventListener("dragleave",this.dragLeaveListener,!0),this.dragLeaveListener=void 0),this.bodyDropListener&&(document.body.removeEventListener("drop",this.bodyDropListener),this.bodyDropListener=void 0),this.bodyDragOverListener&&(document.body.removeEventListener("dragover",this.bodyDragOverListener),this.bodyDragOverListener=void 0),this.bodyDragEnterListener&&(document.body.removeEventListener("dragenter",this.bodyDragEnterListener),this.bodyDragEnterListener=void 0),this.bodyDragLeaveListener&&(document.body.removeEventListener("dragleave",this.bodyDragLeaveListener),this.bodyDragLeaveListener=void 0),this.dragElementStylesInterval&&(clearInterval(this.dragElementStylesInterval),this.dragElementStylesInterval=void 0),this.dragElement&&(this.dragElement.remove(),this.dragElement=void 0),this.imageElement.remove(),this.dragEnterElement=null,this.bound=!1}}const Vl=500,Us=50;class Hl{constructor(e){A(this,"_context");A(this,"_bound",!1);A(this,"_startTouch");A(this,"_startTouchListener");A(this,"_endTouchListener");A(this,"onSwipeRight");A(this,"onSwipeLeft");this._context=e}bind(){this._bound||(this._startTouchListener=e=>{this._startTouch={x:e.changedTouches[0].clientX,timestamp:Date.now()}},this._endTouchListener=e=>{var n,s;if(!this._startTouch)return;const t=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY;this._insideRect(t,r)&&Date.now()-this._startTouch.timestamp<Vl&&(this._startTouch.x>=t+Us?(n=this.onSwipeLeft)==null||n.call(this):this._startTouch.x<=t-Us&&((s=this.onSwipeRight)==null||s.call(this))),this._startTouch=void 0},document.addEventListener("touchstart",this._startTouchListener,!0),document.addEventListener("touchend",this._endTouchListener,!0),this._bound=!0)}_insideRect(e,t){const r=this._context.video.getBoundingClientRect();return e>=r.left&&e<=r.right&&t>=r.top&&t<=r.bottom}unbind(){this._startTouchListener&&(document.removeEventListener("touchstart",this._startTouchListener,!0),this._startTouchListener=void 0),this._endTouchListener&&(document.removeEventListener("touchend",this._endTouchListener,!0),this._endTouchListener=void 0),this.onSwipeLeft=void 0,this.onSwipeRight=void 0,this._startTouch=void 0,this._bound=!1}}var ve=(i=>(i[i.bottom=0]="bottom",i[i.top=1]="top",i))(ve||{});class Xe{constructor({targetElement:e,nonFullscreenContainerClassName:t,nonFullscreenContentClassName:r,fullscreenContainerClassName:n,fullscreenContentClassName:s,offsetAnchor:a,contentPositionOffset:o,contentWidthPercentage:u,onMouseOver:v}){A(this,"targetElement");A(this,"domCache",new Ya);A(this,"fullscreenContainerElement");A(this,"defaultContentElement");A(this,"nonFullscreenContainerElement");A(this,"nonFullscreenElementFullscreenChangeListener");A(this,"nonFullscreenStylesInterval");A(this,"nonFullscreenElementFullscreenPollingInterval");A(this,"fullscreenElementFullscreenChangeListener");A(this,"fullscreenElementFullscreenPollingInterval");A(this,"fullscreenStylesInterval");A(this,"onMouseOver");A(this,"nonFullscreenContainerClassName");A(this,"nonFullscreenContentClassName");A(this,"fullscreenContainerClassName");A(this,"fullscreenContentClassName");A(this,"offsetAnchor",0);A(this,"contentPositionOffset");A(this,"contentWidthPercentage");this.targetElement=e,this.nonFullscreenContainerClassName=t,this.nonFullscreenContentClassName=r,this.fullscreenContainerClassName=n,this.fullscreenContentClassName=s,this.offsetAnchor=a,this.contentPositionOffset=o??75,this.contentWidthPercentage=u,this.onMouseOver=v}*displayingElements(){function*e(r){for(const n of r.childNodes)for(const s of n.childNodes)s instanceof HTMLElement&&(yield s)}const t=this.containerElement;if(t!==void 0)for(const r of e(t))yield r}get containerElement(){if(document.fullscreenElement&&this.fullscreenContainerElement!==void 0)return this.fullscreenContainerElement;if(!document.fullscreenElement&&this.nonFullscreenContainerElement!==void 0)return this.nonFullscreenContainerElement}uncacheHtml(){this.domCache.clear()}cacheHtml(e,t){this.domCache.add(e,t)}setHtml(e){document.fullscreenElement?this._displayFullscreenContentElementsWithHtml(e):this._displayNonFullscreenContentElementsWithHtml(e)}_displayNonFullscreenContentElementsWithHtml(e){this._displayNonFullscreenContentElements(e.map(t=>this._cachedContentElement(t.html,t.key)))}_displayNonFullscreenContentElements(e){for(const t of e)t.className=this.nonFullscreenContentClassName;this._setChildren(this._nonFullscreenContainerElement(),e)}_displayFullscreenContentElementsWithHtml(e){this._displayFullscreenContentElements(e.map(t=>this._cachedContentElement(t.html,t.key)))}_displayFullscreenContentElements(e){for(const t of e)t.className=this.fullscreenContentClassName;this._setChildren(this._fullscreenContainerElement(),e)}_nonFullscreenContainerElement(){if(this.nonFullscreenContainerElement)return this.nonFullscreenContainerElement;const e=document.createElement("div");e.className=this.nonFullscreenContainerClassName,e.onmouseover=this.onMouseOver,this._applyContainerStyles(e),document.body.appendChild(e);const t=()=>{document.fullscreenElement?e.style.setProperty("display","none","important"):(e.style.display="",this.fullscreenContainerElement&&this._transferChildren(this.fullscreenContainerElement,e))};return t(),this.nonFullscreenElementFullscreenChangeListener=r=>t(),this.nonFullscreenStylesInterval=setInterval(()=>this._applyContainerStyles(e),1e3),this.nonFullscreenElementFullscreenPollingInterval=setInterval(()=>t(),1e3),document.addEventListener("fullscreenchange",this.nonFullscreenElementFullscreenChangeListener),this.nonFullscreenContainerElement=e,e}_fullscreenContainerElement(){if(this.fullscreenContainerElement)return this.fullscreenContainerElement;const e=document.createElement("div");e.className=this.fullscreenContainerClassName,e.onmouseover=this.onMouseOver,this._applyContainerStyles(e),this._findFullscreenParentElement(e).appendChild(e),e.style.setProperty("display","none","important");const t=this,r=()=>{document.fullscreenElement?(e.style.display==="none"&&(e.style.display="",e.remove(),t._findFullscreenParentElement(e).appendChild(e)),this.nonFullscreenContainerElement&&this._transferChildren(this.nonFullscreenContainerElement,e)):document.fullscreenElement||e.style.setProperty("display","none","important")};return r(),this.fullscreenElementFullscreenChangeListener=n=>r(),this.fullscreenStylesInterval=setInterval(()=>this._applyContainerStyles(e),1e3),this.fullscreenElementFullscreenPollingInterval=setInterval(()=>r(),1e3),document.addEventListener("fullscreenchange",this.fullscreenElementFullscreenChangeListener),this.fullscreenContainerElement=e,this.fullscreenContainerElement}_findFullscreenParentElement(e){const t=e.cloneNode(!0);t.innerHTML="&nbsp;";let r=this.targetElement.parentElement;if(!r)return document.body;let n;do{const s=r.getBoundingClientRect();if(s.height>0&&(typeof n>"u"||s.height>=n.getBoundingClientRect().height)&&this._clickable(r,t)){n=r;break}r=r.parentElement}while(r&&!r.isSameNode(document.body.parentElement));return n||document.body}_transferChildren(e,t){if(e)for(;e.firstChild;)t.appendChild(e.firstChild)}_setChildren(e,t){for(;e.firstChild;)this.domCache.return(e.lastChild);for(const r of t)e.appendChild(r)}_cachedContentElement(e,t){return t===void 0?(this.defaultContentElement||(this.defaultContentElement=document.createElement("div")),this.defaultContentElement.innerHTML=e(),this.defaultContentElement):this.domCache.get(t,e)}appendHtml(e){document.fullscreenElement?this._appendHtml(`${e}
`,this.fullscreenContentClassName,this._fullscreenContainerElement()):this._appendHtml(`${e}
`,this.nonFullscreenContentClassName,this._nonFullscreenContainerElement())}_appendHtml(e,t,r){const n=document.createElement("br"),s=document.createElement("div");s.innerHTML=e,s.className=t,r.appendChild(n),r.appendChild(s)}refresh(){this.fullscreenContainerElement&&this._applyContainerStyles(this.fullscreenContainerElement),this.nonFullscreenContainerElement&&this._applyContainerStyles(this.nonFullscreenContainerElement)}hide(){var e,t,r;this.nonFullscreenElementFullscreenChangeListener&&document.removeEventListener("fullscreenchange",this.nonFullscreenElementFullscreenChangeListener),this.nonFullscreenStylesInterval&&clearInterval(this.nonFullscreenStylesInterval),this.nonFullscreenElementFullscreenPollingInterval&&clearInterval(this.nonFullscreenElementFullscreenPollingInterval),this.fullscreenElementFullscreenChangeListener&&document.removeEventListener("fullscreenchange",this.fullscreenElementFullscreenChangeListener),this.fullscreenStylesInterval&&clearInterval(this.fullscreenStylesInterval),this.fullscreenElementFullscreenPollingInterval&&clearInterval(this.fullscreenElementFullscreenPollingInterval),(e=this.defaultContentElement)==null||e.remove(),this.defaultContentElement=void 0,(t=this.nonFullscreenContainerElement)==null||t.remove(),this.nonFullscreenContainerElement=void 0,(r=this.fullscreenContainerElement)==null||r.remove(),this.fullscreenContainerElement=void 0}_applyContainerStyles(e){const t=this.targetElement.getBoundingClientRect();e.style.left=t.left+t.width/2+"px",this.contentWidthPercentage===-1?(e.style.maxWidth=t.width+"px",e.style.width=""):(e.style.maxWidth="",e.style.width=Math.min(window.innerWidth,t.width*this.contentWidthPercentage/100)+"px");const r=Math.max(t.top+window.scrollY,0);if(this.offsetAnchor===0){const n=Math.min(r+t.height,window.innerHeight+window.scrollY);e.style.top=n-this.contentPositionOffset+"px",e.style.bottom=""}else e.style.top=r+this.contentPositionOffset+"px",e.style.bottom=""}_clickable(e,t){e.appendChild(t);const r=t.getBoundingClientRect(),n=document.elementFromPoint(r.x,r.y),s=t.isSameNode(n)||t.contains(n);return t.remove(),s}dispose(){this.hide(),this.domCache.clear()}}const zl=300;class Ye{constructor(e,t){A(this,"_context");A(this,"_overlay");A(this,"_pauseListener");A(this,"_playListener");A(this,"_seekedListener");A(this,"_forceHiding",!1);A(this,"_showing",!1);A(this,"_uiInitialized",!1);A(this,"_messageListener");A(this,"_bound",!1);A(this,"_frameParams");this._context=e,this._overlay=Ye._elementOverlay(e.video,t)}static _elementOverlay(e,t){const r=t===ve.top?"asbplayer-mobile-video-overlay-container-top":"asbplayer-mobile-video-overlay-container-bottom";return new Xe({targetElement:e,nonFullscreenContainerClassName:r,fullscreenContainerClassName:r,nonFullscreenContentClassName:"asbplayer-mobile-video-overlay",fullscreenContentClassName:"asbplayer-mobile-video-overlay",offsetAnchor:t,contentPositionOffset:8,contentWidthPercentage:-1,onMouseOver:()=>{}})}set offsetAnchor(e){this._overlay.offsetAnchor!==e&&(this._overlay.dispose(),this._overlay=Ye._elementOverlay(this._context.video,e),this._showing&&this._doShow())}set forceHide(e){this._bound&&(e?(this._showing&&this._doHide(),this._forceHiding=!0):this._forceHiding&&(this._forceHiding=!1,this._show()))}bind(){this._bound||(this._pauseListener=()=>{this._show()},this._playListener=()=>{this._hide()},this._seekedListener=()=>{this.updateModel()},this._context.video.addEventListener("pause",this._pauseListener),this._context.video.addEventListener("play",this._playListener),this._context.video.addEventListener("seeked",this._seekedListener),this._messageListener=(e,t,r)=>{if(!(e.sender!=="asbplayer-mobile-overlay-to-video"||e.src!==this._context.video.src)){if(e.message.command==="request-mobile-overlay-model")return this._model().then(r),this._uiInitialized=!0,!0;if(e.message.command==="playMode"){const n=e;this._context.playMode=n.message.playMode}else e.message.command==="hidden"&&this._doHide()}},W.runtime.onMessage.addListener(this._messageListener),this._bound=!0,this._context.video.paused&&this._show())}async updateModel(){if(!this._bound||!this._uiInitialized)return;const t={sender:"asbplayer-video",message:{command:"update-mobile-overlay-model",model:await this._model()},src:this._context.video.src};W.runtime.sendMessage(t)}async _model(){var v,h;const e=this._context.subtitleController.subtitles,t=e.length>0&&this._context.subtitleController.currentSubtitle()[0]!==null,r=this._context.video.currentTime*1e3,{language:n,clickToMineDefaultAction:s,themeType:a,streamingDisplaySubtitles:o}=await this._context.settings.get(["language","clickToMineDefaultAction","themeType","streamingDisplaySubtitles"]);return{offset:e.length===0?0:e[0].start-e[0].originalStart,playbackRate:this._context.video.playbackRate,emptySubtitleTrack:e.length===0,recordingEnabled:this._context.recordMedia,recording:this._context.recordingMedia,previousSubtitleTimestamp:((v=lt(!1,r,e))==null?void 0:v.originalStart)??void 0,nextSubtitleTimestamp:((h=lt(!0,r,e))==null?void 0:h.originalStart)??void 0,currentTimestamp:r,language:n,postMineAction:s,subtitleDisplaying:t,subtitlesAreVisible:o,playMode:this._context.playMode,themeType:a}}show(){this._bound&&this._show()}disposeOverlay(){this._overlay.dispose(),this._overlay=Ye._elementOverlay(this._context.video,this._overlay.offsetAnchor)}_show(){!this._context.synced||this._forceHiding||this._doShow()}_doShow(){const e=this._getFrameParams(),{width:t,height:r,anchor:n,src:s,tooltips:a}=e;this._frameParams!==void 0&&this._differentFrameParams(e,this._frameParams)&&this._overlay.uncacheHtml(),this._overlay.setHtml([{key:"ui",html:()=>`<iframe style="border: 0; color-scheme: normal; width: ${t}px; height: ${r}px" src="${W.runtime.getURL("/mobile-video-overlay-ui.html")}?src=${s}&anchor=${n}&tooltips=${a}"/>`}]),this._frameParams=e,this._showing=!0}_getFrameParams(){const e=this._overlay.offsetAnchor===ve.bottom?"bottom":"top",r=this._context.video.getBoundingClientRect().height<zl,n=r?64:108,s=!r,a=Math.min(window.innerWidth,410),o=encodeURIComponent(this._context.video.src);return{width:a,height:n,anchor:e,src:o,tooltips:s}}_differentFrameParams(e,t){return e.width!==t.width||e.height!==t.height||e.anchor!==t.anchor||e.src!==t.src||e.tooltips!==t.tooltips}hide(){this._bound&&this._hide()}_hide(){!this._context.synced||this._context.recordingMedia||this._doHide()}_doHide(){this._overlay.hide(),this._showing=!1}unbind(){this._pauseListener&&(this._context.video.removeEventListener("pause",this._pauseListener),this._pauseListener=void 0),this._playListener&&(this._context.video.removeEventListener("play",this._playListener),this._playListener=void 0),this._seekedListener&&(this._context.video.removeEventListener("seeked",this._seekedListener),this._seekedListener=void 0),this._messageListener&&(W.runtime.onMessage.removeListener(this._messageListener),this._messageListener=void 0),this._overlay.dispose(),this._overlay=Ye._elementOverlay(this._context.video,this._overlay.offsetAnchor),this._showing=!1,this._bound=!1}}class ql{constructor(e){A(this,"onClose");A(this,"_context");A(this,"_frame");A(this,"_client");this._context=e,this._frame=new dt(async t=>`<!DOCTYPE html>
                    <html lang="en">
                    <head>
                        <meta charset="utf-8" />
                        <meta name="viewport" content="width=device-width, initial-scale=1" />
                        <title>asbplayer</title>
                        <style>
                        @import url(${W.runtime.getURL("/fonts/fonts.css")});
                        </style>
                    </head>
                    <body>
                        <div id="root" style="width:100%;height:100vh;"></div>
                        <script type="application/json" id="loc">${JSON.stringify(await qe(t))}<\/script>
                        <script type="module" src="${W.runtime.getURL("/notification-ui.js")}"><\/script>
                    </body>
                </html>`)}get showing(){return!this._frame.hidden}hide(){this._frame.hide()}async show(e,t){await this._prepareAndShowFrame("asbplayer-ui-frame"),document.fullscreenElement&&document.exitFullscreen(),this._client.updateState({themeType:await this._context.settings.getSingle("themeType"),titleLocKey:e,messageLocKey:t,alertLocKey:""}),this._context.pause()}async updateAlert(e){await this._prepareAndShowFrame("asbplayer-alert"),this._client.updateState({themeType:await this._context.settings.getSingle("themeType"),titleLocKey:"",messageLocKey:"",newVersion:e})}async _prepareAndShowFrame(e){this._frame.language=await this._context.settings.getSingle("language");const t=await this._frame.bind();this._frame.frame.className=e,this._client=await this._frame.client(),t&&this._client.onMessage(r=>{var n;r.command==="close"&&(this._context.subtitleController.forceHideSubtitles=!1,this._context.mobileVideoOverlayController.forceHide=!1,this._context.controlsController.show(),this._frame.hide(),(n=this.onClose)==null||n.call(this))}),this._frame.show()}unbind(){var e;(e=this._frame)==null||e.unbind()}}const Wl=class ei{constructor(e,t){this.low=e,this.high=t}clone(){return new ei(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low==e.low&&this.high<e.high}equal_to(e){return this.low==e.low&&this.high==e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(e){return new ei(this.low===void 0?e.low:Math.min(this.low,e.low),this.high===void 0?e.high:Math.max(this.high,e.high))}output(){return[this.low,this.high]}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e<t}},de=0,ne=1;class Qe{constructor(e=void 0,t=void 0,r=null,n=null,s=null,a=ne){this.left=r,this.right=n,this.parent=s,this.color=a,this.item={key:e,value:t},e&&e instanceof Array&&e.length==2&&!Number.isNaN(e[0])&&!Number.isNaN(e[1])&&(this.item.key=new Wl(Math.min(e[0],e[1]),Math.max(e[0],e[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===ne}less_than(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.less_than(e.item.key);{let t=this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value;return this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&t}}equal_to(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.equal_to(e.item.key);{let t=this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value==e.item.value;return this.item.key.equal_to(e.item.key)&&t}}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key,this.item.value=e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){const e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){const e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){const t=this.item.key.constructor.comparable_less_than;let r=this.left.max.high!==void 0?this.left.max.high:this.left.max;return t(r,e.item.key.low)}not_intersect_right_subtree(e){const t=this.item.key.constructor.comparable_less_than;let r=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return t(e.item.key.high,r)}}class jt{constructor(){this.root=null,this.nil_node=new Qe}get size(){let e=0;return this.tree_walk(this.root,()=>e++),e}get keys(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.key.output?t.item.key.output():t.item.key)),e}get values(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.value)),e}get items(){let e=[];return this.tree_walk(this.root,t=>e.push({key:t.item.key.output?t.item.key.output():t.item.key,value:t.item.value})),e}isEmpty(){return this.root==null||this.root==this.nil_node}clear(){this.root=null}insert(e,t=e){if(e===void 0)return;let r=new Qe(e,t,this.nil_node,this.nil_node,null,de);return this.tree_insert(r),this.recalc_max(r),r}exist(e,t=e){let r=new Qe(e,t);return!!this.tree_search(this.root,r)}remove(e,t=e){let r=new Qe(e,t),n=this.tree_search(this.root,r);return n&&this.tree_delete(n),n}search(e,t=(r,n)=>r===n?n.output():r){let r=new Qe(e),n=[];return this.tree_search_interval(this.root,r,n),n.map(s=>t(s.item.value,s.item.key))}intersect_any(e){let t=new Qe(e);return this.tree_find_any_interval(this.root,t)}forEach(e){this.tree_walk(this.root,t=>e(t.item.key,t.item.value))}map(e){const t=new jt;return this.tree_walk(this.root,r=>t.insert(r.item.key,e(r.item.value,r.item.key))),t}recalc_max(e){let t=e;for(;t.parent!=null;)t.parent.update_max(),t=t.parent}tree_insert(e){let t=this.root,r=null;if(this.root==null||this.root==this.nil_node)this.root=e;else{for(;t!=this.nil_node;)r=t,e.less_than(t)?t=t.left:t=t.right;e.parent=r,e.less_than(r)?r.left=e:r.right=e}this.insert_fixup(e)}insert_fixup(e){let t,r;for(t=e;t!=this.root&&t.parent.color==de;)t.parent==t.parent.parent.left?(r=t.parent.parent.right,r.color==de?(t.parent.color=ne,r.color=ne,t.parent.parent.color=de,t=t.parent.parent):(t==t.parent.right&&(t=t.parent,this.rotate_left(t)),t.parent.color=ne,t.parent.parent.color=de,this.rotate_right(t.parent.parent))):(r=t.parent.parent.left,r.color==de?(t.parent.color=ne,r.color=ne,t.parent.parent.color=de,t=t.parent.parent):(t==t.parent.left&&(t=t.parent,this.rotate_right(t)),t.parent.color=ne,t.parent.parent.color=de,this.rotate_left(t.parent.parent)));this.root.color=ne}tree_delete(e){let t,r;e.left==this.nil_node||e.right==this.nil_node?t=e:t=this.tree_successor(e),t.left!=this.nil_node?r=t.left:r=t.right,r.parent=t.parent,t==this.root?this.root=r:(t==t.parent.left?t.parent.left=r:t.parent.right=r,t.parent.update_max()),this.recalc_max(r),t!=e&&(e.copy_data(t),e.update_max(),this.recalc_max(e)),t.color==ne&&this.delete_fixup(r)}delete_fixup(e){let t=e,r;for(;t!=this.root&&t.parent!=null&&t.color==ne;)t==t.parent.left?(r=t.parent.right,r.color==de&&(r.color=ne,t.parent.color=de,this.rotate_left(t.parent),r=t.parent.right),r.left.color==ne&&r.right.color==ne?(r.color=de,t=t.parent):(r.right.color==ne&&(r.color=de,r.left.color=ne,this.rotate_right(r),r=t.parent.right),r.color=t.parent.color,t.parent.color=ne,r.right.color=ne,this.rotate_left(t.parent),t=this.root)):(r=t.parent.left,r.color==de&&(r.color=ne,t.parent.color=de,this.rotate_right(t.parent),r=t.parent.left),r.left.color==ne&&r.right.color==ne?(r.color=de,t=t.parent):(r.left.color==ne&&(r.color=de,r.right.color=ne,this.rotate_left(r),r=t.parent.left),r.color=t.parent.color,t.parent.color=ne,r.left.color=ne,this.rotate_right(t.parent),t=this.root));t.color=ne}tree_search(e,t){if(!(e==null||e==this.nil_node))return t.equal_to(e)?e:t.less_than(e)?this.tree_search(e.left,t):this.tree_search(e.right,t)}tree_search_interval(e,t,r){e!=null&&e!=this.nil_node&&(e.left!=this.nil_node&&!e.not_intersect_left_subtree(t)&&this.tree_search_interval(e.left,t,r),e.intersect(t)&&r.push(e),e.right!=this.nil_node&&!e.not_intersect_right_subtree(t)&&this.tree_search_interval(e.right,t,r))}tree_find_any_interval(e,t){let r=!1;return e!=null&&e!=this.nil_node&&(e.left!=this.nil_node&&!e.not_intersect_left_subtree(t)&&(r=this.tree_find_any_interval(e.left,t)),r||(r=e.intersect(t)),!r&&e.right!=this.nil_node&&!e.not_intersect_right_subtree(t)&&(r=this.tree_find_any_interval(e.right,t))),r}local_minimum(e){let t=e;for(;t.left!=null&&t.left!=this.nil_node;)t=t.left;return t}local_maximum(e){let t=e;for(;t.right!=null&&t.right!=this.nil_node;)t=t.right;return t}tree_successor(e){let t,r,n;if(e.right!=this.nil_node)t=this.local_minimum(e.right);else{for(r=e,n=e.parent;n!=null&&n.right==r;)r=n,n=n.parent;t=n}return t}rotate_left(e){let t=e.right;e.right=t.left,t.left!=this.nil_node&&(t.left.parent=e),t.parent=e.parent,e==this.root?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,e!=null&&e!=this.nil_node&&e.update_max(),t=e.parent,t!=null&&t!=this.nil_node&&t.update_max()}rotate_right(e){let t=e.left;e.left=t.right,t.right!=this.nil_node&&(t.right.parent=e),t.parent=e.parent,e==this.root?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,e!=null&&e!=this.nil_node&&e.update_max(),t=e.parent,t!=null&&t!=this.nil_node&&t.update_max()}tree_walk(e,t){e!=null&&e!=this.nil_node&&(this.tree_walk(e.left,t),t(e),this.tree_walk(e.right,t))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,function(t){t.color==de&&(t.left.color==ne&&t.right.color==ne||(e=!1))}),e}testBlackHeightProperty(e){let t=0,r=0,n=0;if(e.color==ne&&t++,e.left!=this.nil_node?r=this.testBlackHeightProperty(e.left):r=1,e.right!=this.nil_node?n=this.testBlackHeightProperty(e.right):n=1,r!=n)throw new Error("Red-black height property violated");return t+=r,t}}const mt=class mt{constructor(e,t={}){A(this,"tree");A(this,"gapsTree");A(this,"options");if(this.tree=new jt,this.options=t,t.returnLastShown||t.returnNextToShow){let r;this.gapsTree=new jt,e.length>0&&e[0].start>0&&this.gapsTree.insert([0,e[0].start-1],e[0]);for(const n of e)n.start<n.end&&this.tree.insert([n.start,n.end-1],n),r!==void 0&&r.end<n.start&&this.gapsTree.insert([r.end,n.start-1],r),r=n}else for(const r of e)this.tree.insert([r.start,r.end-1],r)}static empty(){return mt.emptySubtitleCollection}subtitlesAt(e){const t=[e,e],r=this.tree.search(t);let n,s,a,o;if(r.length===0){if(this.gapsTree!==void 0){const u=[];if(n=this.gapsTree.search(t,(v,h)=>(u.push(h),v)),n.length>0&&this.options.returnNextToShow){const v=u[0].high+1;s=this.tree.search([v,v])}}}else if(this.options.showingCheckRadiusMs!==void 0){for(const u of r)if(o===void 0&&u.end<=e+this.options.showingCheckRadiusMs&&(o=u),a===void 0&&e-this.options.showingCheckRadiusMs<u.start&&(a=u),a!==void 0&&o!==void 0)break}return{showing:r,lastShown:n,nextToShow:s,startedShowing:a,willStopShowing:o}}};A(mt,"emptySubtitleCollection",new mt([]));let Dt=mt;function Se(i){"@babel/helpers - typeof";return Se=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(i)}function Oe(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Gl(i,e){if(Se(i)!=="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e);if(Se(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function js(i){var e=Gl(i,"string");return Se(e)==="symbol"?e:String(e)}function Ds(i,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,js(r.key),r)}}function ke(i,e,t){return e&&Ds(i.prototype,e),t&&Ds(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}function $e(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Nn(i,e){return Nn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},Nn(i,e)}function Vt(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&Nn(i,e)}function ht(i,e){if(e&&(Se(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $e(i)}function Ce(i){return Ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ce(i)}function Be(i,e,t){return e=js(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Kl(i){if(Array.isArray(i))return i}function Zl(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function Vs(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=i[t];return r}function Jl(i,e){if(i){if(typeof i=="string")return Vs(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Vs(i,e)}}function Xl(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yl(i){return Kl(i)||Zl(i)||Jl(i)||Xl()}function Hs(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function zs(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Hs(Object(t),!0).forEach(function(r){Be(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Hs(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}var Ql={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},eu=function(){function i(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Oe(this,i),this.init(e,t)}return ke(i,[{key:"init",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=r.prefix||"i18next:",this.logger=t||Ql,this.options=r,this.debug=r.debug}},{key:"setDebug",value:function(t){this.debug=t}},{key:"log",value:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.forward(r,"log","",!0)}},{key:"warn",value:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.forward(r,"warn","",!0)}},{key:"error",value:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.forward(r,"error","")}},{key:"deprecate",value:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.forward(r,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(t,r,n,s){return s&&!this.debug?null:(typeof t[0]=="string"&&(t[0]="".concat(n).concat(this.prefix," ").concat(t[0])),this.logger[r](t))}},{key:"create",value:function(t){return new i(this.logger,zs(zs({},{prefix:"".concat(this.prefix,":").concat(t,":")}),this.options))}},{key:"clone",value:function(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new i(this.logger,t)}}]),i}(),Te=new eu,Ue=function(){function i(){Oe(this,i),this.observers={}}return ke(i,[{key:"on",value:function(t,r){var n=this;return t.split(" ").forEach(function(s){n.observers[s]=n.observers[s]||[],n.observers[s].push(r)}),this}},{key:"off",value:function(t,r){if(this.observers[t]){if(!r){delete this.observers[t];return}this.observers[t]=this.observers[t].filter(function(n){return n!==r})}}},{key:"emit",value:function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];if(this.observers[t]){var a=[].concat(this.observers[t]);a.forEach(function(u){u.apply(void 0,n)})}if(this.observers["*"]){var o=[].concat(this.observers["*"]);o.forEach(function(u){u.apply(u,[t].concat(n))})}}}]),i}();function pt(){var i,e,t=new Promise(function(r,n){i=r,e=n});return t.resolve=i,t.reject=e,t}function qs(i){return i==null?"":""+i}function tu(i,e,t){i.forEach(function(r){e[r]&&(t[r]=e[r])})}function Mn(i,e,t){function r(o){return o&&o.indexOf("###")>-1?o.replace(/###/g,"."):o}function n(){return!i||typeof i=="string"}for(var s=typeof e!="string"?[].concat(e):e.split(".");s.length>1;){if(n())return{};var a=r(s.shift());!i[a]&&t&&(i[a]=new t),Object.prototype.hasOwnProperty.call(i,a)?i=i[a]:i={}}return n()?{}:{obj:i,k:r(s.shift())}}function Ws(i,e,t){var r=Mn(i,e,Object),n=r.obj,s=r.k;n[s]=t}function ru(i,e,t,r){var n=Mn(i,e,Object),s=n.obj,a=n.k;s[a]=s[a]||[],s[a].push(t)}function Ht(i,e){var t=Mn(i,e),r=t.obj,n=t.k;if(r)return r[n]}function nu(i,e,t){var r=Ht(i,t);return r!==void 0?r:Ht(e,t)}function Gs(i,e,t){for(var r in e)r!=="__proto__"&&r!=="constructor"&&(r in i?typeof i[r]=="string"||i[r]instanceof String||typeof e[r]=="string"||e[r]instanceof String?t&&(i[r]=e[r]):Gs(i[r],e[r],t):i[r]=e[r]);return i}function et(i){return i.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var iu={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function su(i){return typeof i=="string"?i.replace(/[&<>"'\/]/g,function(e){return iu[e]}):i}var zt=typeof window<"u"&&window.navigator&&typeof window.navigator.userAgentData>"u"&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,au=[" ",",","?","!",";"];function ou(i,e,t){e=e||"",t=t||"";var r=au.filter(function(o){return e.indexOf(o)<0&&t.indexOf(o)<0});if(r.length===0)return!0;var n=new RegExp("(".concat(r.map(function(o){return o==="?"?"\\?":o}).join("|"),")")),s=!n.test(i);if(!s){var a=i.indexOf(t);a>0&&!n.test(i.substring(0,a))&&(s=!0)}return s}function qt(i,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(i){if(i[e])return i[e];for(var r=e.split(t),n=i,s=0;s<r.length;++s){if(!n||typeof n[r[s]]=="string"&&s+1<r.length)return;if(n[r[s]]===void 0){for(var a=2,o=r.slice(s,s+a).join(t),u=n[o];u===void 0&&r.length>s+a;)a++,o=r.slice(s,s+a).join(t),u=n[o];if(u===void 0)return;if(u===null)return null;if(e.endsWith(o)){if(typeof u=="string")return u;if(o&&typeof u[o]=="string")return u[o]}var v=r.slice(s+a).join(t);return v?qt(u,v,t):void 0}n=n[r[s]]}return n}}function Ks(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function Wt(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ks(Object(t),!0).forEach(function(r){Be(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Ks(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function lu(i){var e=uu();return function(){var r=Ce(i),n;if(e){var s=Ce(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return ht(this,n)}}function uu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cu=function(i){Vt(t,i);var e=lu(t);function t(r){var n,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};return Oe(this,t),n=e.call(this),zt&&Ue.call($e(n)),n.data=r||{},n.options=s,n.options.keySeparator===void 0&&(n.options.keySeparator="."),n.options.ignoreJSONStructure===void 0&&(n.options.ignoreJSONStructure=!0),n}return ke(t,[{key:"addNamespaces",value:function(n){this.options.ns.indexOf(n)<0&&this.options.ns.push(n)}},{key:"removeNamespaces",value:function(n){var s=this.options.ns.indexOf(n);s>-1&&this.options.ns.splice(s,1)}},{key:"getResource",value:function(n,s,a){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},u=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator,v=o.ignoreJSONStructure!==void 0?o.ignoreJSONStructure:this.options.ignoreJSONStructure,h=[n,s];a&&typeof a!="string"&&(h=h.concat(a)),a&&typeof a=="string"&&(h=h.concat(u?a.split(u):a)),n.indexOf(".")>-1&&(h=n.split("."));var f=Ht(this.data,h);return f||!v||typeof a!="string"?f:qt(this.data&&this.data[n]&&this.data[n][s],a,u)}},{key:"addResource",value:function(n,s,a,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1},v=this.options.keySeparator;v===void 0&&(v=".");var h=[n,s];a&&(h=h.concat(v?a.split(v):a)),n.indexOf(".")>-1&&(h=n.split("."),o=s,s=h[1]),this.addNamespaces(s),Ws(this.data,h,o),u.silent||this.emit("added",n,s,a,o)}},{key:"addResources",value:function(n,s,a){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(var u in a)(typeof a[u]=="string"||Object.prototype.toString.apply(a[u])==="[object Array]")&&this.addResource(n,s,u,a[u],{silent:!0});o.silent||this.emit("added",n,s,a)}},{key:"addResourceBundle",value:function(n,s,a,o,u){var v=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1},h=[n,s];n.indexOf(".")>-1&&(h=n.split("."),o=a,a=s,s=h[1]),this.addNamespaces(s);var f=Ht(this.data,h)||{};o?Gs(f,a,u):f=Wt(Wt({},f),a),Ws(this.data,h,f),v.silent||this.emit("added",n,s,a)}},{key:"removeResourceBundle",value:function(n,s){this.hasResourceBundle(n,s)&&delete this.data[n][s],this.removeNamespaces(s),this.emit("removed",n,s)}},{key:"hasResourceBundle",value:function(n,s){return this.getResource(n,s)!==void 0}},{key:"getResourceBundle",value:function(n,s){return s||(s=this.options.defaultNS),this.options.compatibilityAPI==="v1"?Wt(Wt({},{}),this.getResource(n,s)):this.getResource(n,s)}},{key:"getDataByLanguage",value:function(n){return this.data[n]}},{key:"hasLanguageSomeTranslations",value:function(n){var s=this.getDataByLanguage(n),a=s&&Object.keys(s)||[];return!!a.find(function(o){return s[o]&&Object.keys(s[o]).length>0})}},{key:"toJSON",value:function(){return this.data}}]),t}(Ue),Zs={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,r,n,s){var a=this;return e.forEach(function(o){a.processors[o]&&(t=a.processors[o].process(t,r,n,s))}),t}};function Js(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function me(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Js(Object(t),!0).forEach(function(r){Be(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Js(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function fu(i){var e=du();return function(){var r=Ce(i),n;if(e){var s=Ce(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return ht(this,n)}}function du(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Xs={},Ys=function(i){Vt(t,i);var e=fu(t);function t(r){var n,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Oe(this,t),n=e.call(this),zt&&Ue.call($e(n)),tu(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],r,$e(n)),n.options=s,n.options.keySeparator===void 0&&(n.options.keySeparator="."),n.logger=Te.create("translator"),n}return ke(t,[{key:"changeLanguage",value:function(n){n&&(this.language=n)}},{key:"exists",value:function(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(n==null)return!1;var a=this.resolve(n,s);return a&&a.res!==void 0}},{key:"extractFromKey",value:function(n,s){var a=s.nsSeparator!==void 0?s.nsSeparator:this.options.nsSeparator;a===void 0&&(a=":");var o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,u=s.ns||this.options.defaultNS||[],v=a&&n.indexOf(a)>-1,h=!this.options.userDefinedKeySeparator&&!s.keySeparator&&!this.options.userDefinedNsSeparator&&!s.nsSeparator&&!ou(n,a,o);if(v&&!h){var f=n.match(this.interpolator.nestingRegexp);if(f&&f.length>0)return{key:n,namespaces:u};var l=n.split(a);(a!==o||a===o&&this.options.ns.indexOf(l[0])>-1)&&(u=l.shift()),n=l.join(o)}return typeof u=="string"&&(u=[u]),{key:n,namespaces:u}}},{key:"translate",value:function(n,s,a){var o=this;if(Se(s)!=="object"&&this.options.overloadTranslationOptionHandler&&(s=this.options.overloadTranslationOptionHandler(arguments)),s||(s={}),n==null)return"";Array.isArray(n)||(n=[String(n)]);var u=s.returnDetails!==void 0?s.returnDetails:this.options.returnDetails,v=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,h=this.extractFromKey(n[n.length-1],s),f=h.key,l=h.namespaces,d=l[l.length-1],m=s.lng||this.language,c=s.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(m&&m.toLowerCase()==="cimode"){if(c){var g=s.nsSeparator||this.options.nsSeparator;return u?{res:"".concat(d).concat(g).concat(f),usedKey:f,exactUsedKey:f,usedLng:m,usedNS:d}:"".concat(d).concat(g).concat(f)}return u?{res:f,usedKey:f,exactUsedKey:f,usedLng:m,usedNS:d}:f}var p=this.resolve(n,s),y=p&&p.res,b=p&&p.usedKey||f,x=p&&p.exactUsedKey||f,S=Object.prototype.toString.apply(y),_=["[object Number]","[object Function]","[object RegExp]"],w=s.joinArrays!==void 0?s.joinArrays:this.options.joinArrays,I=!this.i18nFormat||this.i18nFormat.handleAsObject,V=typeof y!="string"&&typeof y!="boolean"&&typeof y!="number";if(I&&y&&V&&_.indexOf(S)<0&&!(typeof w=="string"&&S==="[object Array]")){if(!s.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var M=this.options.returnedObjectHandler?this.options.returnedObjectHandler(b,y,me(me({},s),{},{ns:l})):"key '".concat(f," (").concat(this.language,")' returned an object instead of string.");return u?(p.res=M,p):M}if(v){var j=S==="[object Array]",O=j?[]:{},E=j?x:b;for(var P in y)if(Object.prototype.hasOwnProperty.call(y,P)){var $="".concat(E).concat(v).concat(P);O[P]=this.translate($,me(me({},s),{joinArrays:!1,ns:l})),O[P]===$&&(O[P]=y[P])}y=O}}else if(I&&typeof w=="string"&&S==="[object Array]")y=y.join(w),y&&(y=this.extendTranslation(y,n,s,a));else{var H=!1,D=!1,k=s.count!==void 0&&typeof s.count!="string",U=t.hasDefaultValue(s),C=k?this.pluralResolver.getSuffix(m,s.count,s):"",T=s["defaultValue".concat(C)]||s.defaultValue;!this.isValidLookup(y)&&U&&(H=!0,y=T),this.isValidLookup(y)||(D=!0,y=f);var R=s.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey,F=R&&D?void 0:y,N=U&&T!==y&&this.options.updateMissing;if(D||H||N){if(this.logger.log(N?"updateKey":"missingKey",m,d,f,N?T:y),v){var z=this.resolve(f,me(me({},s),{},{keySeparator:!1}));z&&z.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var q=[],G=this.languageUtils.getFallbackCodes(this.options.fallbackLng,s.lng||this.language);if(this.options.saveMissingTo==="fallback"&&G&&G[0])for(var Z=0;Z<G.length;Z++)q.push(G[Z]);else this.options.saveMissingTo==="all"?q=this.languageUtils.toResolveHierarchy(s.lng||this.language):q.push(s.lng||this.language);var K=function(J,Y,oe){var ee=U&&oe!==y?oe:F;o.options.missingKeyHandler?o.options.missingKeyHandler(J,d,Y,ee,N,s):o.backendConnector&&o.backendConnector.saveMissing&&o.backendConnector.saveMissing(J,d,Y,ee,N,s),o.emit("missingKey",J,d,Y,y)};this.options.saveMissing&&(this.options.saveMissingPlurals&&k?q.forEach(function(X){o.pluralResolver.getSuffixes(X,s).forEach(function(J){K([X],f+J,s["defaultValue".concat(J)]||T)})}):K(q,f,T))}y=this.extendTranslation(y,n,s,p,a),D&&y===f&&this.options.appendNamespaceToMissingKey&&(y="".concat(d,":").concat(f)),(D||H)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?y=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(d,":").concat(f):f,H?y:void 0):y=this.options.parseMissingKeyHandler(y))}return u?(p.res=y,p):y}},{key:"extendTranslation",value:function(n,s,a,o,u){var v=this;if(this.i18nFormat&&this.i18nFormat.parse)n=this.i18nFormat.parse(n,me(me({},this.options.interpolation.defaultVariables),a),o.usedLng,o.usedNS,o.usedKey,{resolved:o});else if(!a.skipInterpolation){a.interpolation&&this.interpolator.init(me(me({},a),{interpolation:me(me({},this.options.interpolation),a.interpolation)}));var h=typeof n=="string"&&(a&&a.interpolation&&a.interpolation.skipOnVariables!==void 0?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables),f;if(h){var l=n.match(this.interpolator.nestingRegexp);f=l&&l.length}var d=a.replace&&typeof a.replace!="string"?a.replace:a;if(this.options.interpolation.defaultVariables&&(d=me(me({},this.options.interpolation.defaultVariables),d)),n=this.interpolator.interpolate(n,d,a.lng||this.language,a),h){var m=n.match(this.interpolator.nestingRegexp),c=m&&m.length;f<c&&(a.nest=!1)}!a.lng&&this.options.compatibilityAPI!=="v1"&&o&&o.res&&(a.lng=o.usedLng),a.nest!==!1&&(n=this.interpolator.nest(n,function(){for(var y=arguments.length,b=new Array(y),x=0;x<y;x++)b[x]=arguments[x];return u&&u[0]===b[0]&&!a.context?(v.logger.warn("It seems you are nesting recursively key: ".concat(b[0]," in key: ").concat(s[0])),null):v.translate.apply(v,b.concat([s]))},a)),a.interpolation&&this.interpolator.reset()}var g=a.postProcess||this.options.postProcess,p=typeof g=="string"?[g]:g;return n!=null&&p&&p.length&&a.applyPostProcessor!==!1&&(n=Zs.handle(p,n,s,this.options&&this.options.postProcessPassResolved?me({i18nResolved:o},a):a,this)),n}},{key:"resolve",value:function(n){var s=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o,u,v,h,f;return typeof n=="string"&&(n=[n]),n.forEach(function(l){if(!s.isValidLookup(o)){var d=s.extractFromKey(l,a),m=d.key;u=m;var c=d.namespaces;s.options.fallbackNS&&(c=c.concat(s.options.fallbackNS));var g=a.count!==void 0&&typeof a.count!="string",p=g&&!a.ordinal&&a.count===0&&s.pluralResolver.shouldUseIntlApi(),y=a.context!==void 0&&(typeof a.context=="string"||typeof a.context=="number")&&a.context!=="",b=a.lngs?a.lngs:s.languageUtils.toResolveHierarchy(a.lng||s.language,a.fallbackLng);c.forEach(function(x){s.isValidLookup(o)||(f=x,!Xs["".concat(b[0],"-").concat(x)]&&s.utils&&s.utils.hasLoadedNamespace&&!s.utils.hasLoadedNamespace(f)&&(Xs["".concat(b[0],"-").concat(x)]=!0,s.logger.warn('key "'.concat(u,'" for languages "').concat(b.join(", "),`" won't get resolved as namespace "`).concat(f,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),b.forEach(function(S){if(!s.isValidLookup(o)){h=S;var _=[m];if(s.i18nFormat&&s.i18nFormat.addLookupKeys)s.i18nFormat.addLookupKeys(_,m,S,x,a);else{var w;g&&(w=s.pluralResolver.getSuffix(S,a.count,a));var I="".concat(s.options.pluralSeparator,"zero");if(g&&(_.push(m+w),p&&_.push(m+I)),y){var V="".concat(m).concat(s.options.contextSeparator).concat(a.context);_.push(V),g&&(_.push(V+w),p&&_.push(V+I))}}for(var M;M=_.pop();)s.isValidLookup(o)||(v=M,o=s.getResource(S,x,M,a))}}))})}}),{res:o,usedKey:u,exactUsedKey:v,usedLng:h,usedNS:f}}},{key:"isValidLookup",value:function(n){return n!==void 0&&!(!this.options.returnNull&&n===null)&&!(!this.options.returnEmptyString&&n==="")}},{key:"getResource",value:function(n,s,a){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(n,s,a,o):this.resourceStore.getResource(n,s,a,o)}}],[{key:"hasDefaultValue",value:function(n){var s="defaultValue";for(var a in n)if(Object.prototype.hasOwnProperty.call(n,a)&&s===a.substring(0,s.length)&&n[a]!==void 0)return!0;return!1}}]),t}(Ue);function $n(i){return i.charAt(0).toUpperCase()+i.slice(1)}var Qs=function(){function i(e){Oe(this,i),this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Te.create("languageUtils")}return ke(i,[{key:"getScriptPartFromCode",value:function(t){if(!t||t.indexOf("-")<0)return null;var r=t.split("-");return r.length===2||(r.pop(),r[r.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(r.join("-"))}},{key:"getLanguagePartFromCode",value:function(t){if(!t||t.indexOf("-")<0)return t;var r=t.split("-");return this.formatLanguageCode(r[0])}},{key:"formatLanguageCode",value:function(t){if(typeof t=="string"&&t.indexOf("-")>-1){var r=["hans","hant","latn","cyrl","cans","mong","arab"],n=t.split("-");return this.options.lowerCaseLng?n=n.map(function(s){return s.toLowerCase()}):n.length===2?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),r.indexOf(n[1].toLowerCase())>-1&&(n[1]=$n(n[1].toLowerCase()))):n.length===3&&(n[0]=n[0].toLowerCase(),n[1].length===2&&(n[1]=n[1].toUpperCase()),n[0]!=="sgn"&&n[2].length===2&&(n[2]=n[2].toUpperCase()),r.indexOf(n[1].toLowerCase())>-1&&(n[1]=$n(n[1].toLowerCase())),r.indexOf(n[2].toLowerCase())>-1&&(n[2]=$n(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}},{key:"isSupportedCode",value:function(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}},{key:"getBestMatchFromCodes",value:function(t){var r=this;if(!t)return null;var n;return t.forEach(function(s){if(!n){var a=r.formatLanguageCode(s);(!r.options.supportedLngs||r.isSupportedCode(a))&&(n=a)}}),!n&&this.options.supportedLngs&&t.forEach(function(s){if(!n){var a=r.getLanguagePartFromCode(s);if(r.isSupportedCode(a))return n=a;n=r.options.supportedLngs.find(function(o){if(o===a)return o;if(!(o.indexOf("-")<0&&a.indexOf("-")<0)&&o.indexOf(a)===0)return o})}}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}},{key:"getFallbackCodes",value:function(t,r){if(!t)return[];if(typeof t=="function"&&(t=t(r)),typeof t=="string"&&(t=[t]),Object.prototype.toString.apply(t)==="[object Array]")return t;if(!r)return t.default||[];var n=t[r];return n||(n=t[this.getScriptPartFromCode(r)]),n||(n=t[this.formatLanguageCode(r)]),n||(n=t[this.getLanguagePartFromCode(r)]),n||(n=t.default),n||[]}},{key:"toResolveHierarchy",value:function(t,r){var n=this,s=this.getFallbackCodes(r||this.options.fallbackLng||[],t),a=[],o=function(v){v&&(n.isSupportedCode(v)?a.push(v):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(v)))};return typeof t=="string"&&t.indexOf("-")>-1?(this.options.load!=="languageOnly"&&o(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&o(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&o(this.getLanguagePartFromCode(t))):typeof t=="string"&&o(this.formatLanguageCode(t)),s.forEach(function(u){a.indexOf(u)<0&&o(n.formatLanguageCode(u))}),a}}]),i}(),hu=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],pu={1:function(e){return+(e>1)},2:function(e){return+(e!=1)},3:function(e){return 0},4:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2},5:function(e){return e==0?0:e==1?1:e==2?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5},6:function(e){return e==1?0:e>=2&&e<=4?1:2},7:function(e){return e==1?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2},8:function(e){return e==1?0:e==2?1:e!=8&&e!=11?2:3},9:function(e){return+(e>=2)},10:function(e){return e==1?0:e==2?1:e<7?2:e<11?3:4},11:function(e){return e==1||e==11?0:e==2||e==12?1:e>2&&e<20?2:3},12:function(e){return+(e%10!=1||e%100==11)},13:function(e){return+(e!==0)},14:function(e){return e==1?0:e==2?1:e==3?2:3},15:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2},16:function(e){return e%10==1&&e%100!=11?0:e!==0?1:2},17:function(e){return e==1||e%10==1&&e%100!=11?0:1},18:function(e){return e==0?0:e==1?1:2},19:function(e){return e==1?0:e==0||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3},20:function(e){return e==1?0:e==0||e%100>0&&e%100<20?1:2},21:function(e){return e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0},22:function(e){return e==1?0:e==2?1:(e<0||e>10)&&e%10==0?2:3}},gu=["v1","v2","v3"],ea={zero:0,one:1,two:2,few:3,many:4,other:5};function mu(){var i={};return hu.forEach(function(e){e.lngs.forEach(function(t){i[t]={numbers:e.nr,plurals:pu[e.fc]}})}),i}var yu=function(){function i(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Oe(this,i),this.languageUtils=e,this.options=t,this.logger=Te.create("pluralResolver"),(!this.options.compatibilityJSON||this.options.compatibilityJSON==="v4")&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=mu()}return ke(i,[{key:"addRule",value:function(t,r){this.rules[t]=r}},{key:"getRule",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(t,{type:r.ordinal?"ordinal":"cardinal"})}catch{return}return this.rules[t]||this.rules[this.languageUtils.getLanguagePartFromCode(t)]}},{key:"needsPlural",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=this.getRule(t,r);return this.shouldUseIntlApi()?n&&n.resolvedOptions().pluralCategories.length>1:n&&n.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(t,n).map(function(s){return"".concat(r).concat(s)})}},{key:"getSuffixes",value:function(t){var r=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.getRule(t,n);return s?this.shouldUseIntlApi()?s.resolvedOptions().pluralCategories.sort(function(a,o){return ea[a]-ea[o]}).map(function(a){return"".concat(r.options.prepend).concat(a)}):s.numbers.map(function(a){return r.getSuffix(t,a,n)}):[]}},{key:"getSuffix",value:function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=this.getRule(t,n);return s?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(s.select(r)):this.getSuffixRetroCompatible(s,r):(this.logger.warn("no plural rule found for: ".concat(t)),"")}},{key:"getSuffixRetroCompatible",value:function(t,r){var n=this,s=t.noAbs?t.plurals(r):t.plurals(Math.abs(r)),a=t.numbers[s];this.options.simplifyPluralSuffix&&t.numbers.length===2&&t.numbers[0]===1&&(a===2?a="plural":a===1&&(a=""));var o=function(){return n.options.prepend&&a.toString()?n.options.prepend+a.toString():a.toString()};return this.options.compatibilityJSON==="v1"?a===1?"":typeof a=="number"?"_plural_".concat(a.toString()):o():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&t.numbers.length===2&&t.numbers[0]===1?o():this.options.prepend&&s.toString()?this.options.prepend+s.toString():s.toString()}},{key:"shouldUseIntlApi",value:function(){return!gu.includes(this.options.compatibilityJSON)}}]),i}();function ta(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function we(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ta(Object(t),!0).forEach(function(r){Be(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):ta(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function ra(i,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=nu(i,e,t);return!s&&n&&typeof t=="string"&&(s=qt(i,t,r),s===void 0&&(s=qt(e,t,r))),s}var vu=function(){function i(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Oe(this,i),this.logger=Te.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||function(t){return t},this.init(e)}return ke(i,[{key:"init",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t.interpolation||(t.interpolation={escapeValue:!0});var r=t.interpolation;this.escape=r.escape!==void 0?r.escape:su,this.escapeValue=r.escapeValue!==void 0?r.escapeValue:!0,this.useRawValueToEscape=r.useRawValueToEscape!==void 0?r.useRawValueToEscape:!1,this.prefix=r.prefix?et(r.prefix):r.prefixEscaped||"{{",this.suffix=r.suffix?et(r.suffix):r.suffixEscaped||"}}",this.formatSeparator=r.formatSeparator?r.formatSeparator:r.formatSeparator||",",this.unescapePrefix=r.unescapeSuffix?"":r.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":r.unescapeSuffix||"",this.nestingPrefix=r.nestingPrefix?et(r.nestingPrefix):r.nestingPrefixEscaped||et("$t("),this.nestingSuffix=r.nestingSuffix?et(r.nestingSuffix):r.nestingSuffixEscaped||et(")"),this.nestingOptionsSeparator=r.nestingOptionsSeparator?r.nestingOptionsSeparator:r.nestingOptionsSeparator||",",this.maxReplaces=r.maxReplaces?r.maxReplaces:1e3,this.alwaysFormat=r.alwaysFormat!==void 0?r.alwaysFormat:!1,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var t="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(t,"g");var r="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(r,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(t,r,n,s){var a=this,o,u,v,h=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function f(g){return g.replace(/\$/g,"$$$$")}var l=function(p){if(p.indexOf(a.formatSeparator)<0){var y=ra(r,h,p,a.options.keySeparator,a.options.ignoreJSONStructure);return a.alwaysFormat?a.format(y,void 0,n,we(we(we({},s),r),{},{interpolationkey:p})):y}var b=p.split(a.formatSeparator),x=b.shift().trim(),S=b.join(a.formatSeparator).trim();return a.format(ra(r,h,x,a.options.keySeparator,a.options.ignoreJSONStructure),S,n,we(we(we({},s),r),{},{interpolationkey:x}))};this.resetRegExp();var d=s&&s.missingInterpolationHandler||this.options.missingInterpolationHandler,m=s&&s.interpolation&&s.interpolation.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables,c=[{regex:this.regexpUnescape,safeValue:function(p){return f(p)}},{regex:this.regexp,safeValue:function(p){return a.escapeValue?f(a.escape(p)):f(p)}}];return c.forEach(function(g){for(v=0;o=g.regex.exec(t);){var p=o[1].trim();if(u=l(p),u===void 0)if(typeof d=="function"){var y=d(t,o,s);u=typeof y=="string"?y:""}else if(s&&Object.prototype.hasOwnProperty.call(s,p))u="";else if(m){u=o[0];continue}else a.logger.warn("missed to pass in variable ".concat(p," for interpolating ").concat(t)),u="";else typeof u!="string"&&!a.useRawValueToEscape&&(u=qs(u));var b=g.safeValue(u);if(t=t.replace(o[0],b),m?(g.regex.lastIndex+=u.length,g.regex.lastIndex-=o[0].length):g.regex.lastIndex=0,v++,v>=a.maxReplaces)break}}),t}},{key:"nest",value:function(t,r){var n=this,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,o,u;function v(d,m){var c=this.nestingOptionsSeparator;if(d.indexOf(c)<0)return d;var g=d.split(new RegExp("".concat(c,"[ ]*{"))),p="{".concat(g[1]);d=g[0],p=this.interpolate(p,u);var y=p.match(/'/g),b=p.match(/"/g);(y&&y.length%2===0&&!b||b.length%2!==0)&&(p=p.replace(/'/g,'"'));try{u=JSON.parse(p),m&&(u=we(we({},m),u))}catch(x){return this.logger.warn("failed parsing options string in nesting for key ".concat(d),x),"".concat(d).concat(c).concat(p)}return delete u.defaultValue,d}for(;a=this.nestingRegexp.exec(t);){var h=[];u=we({},s),u=u.replace&&typeof u.replace!="string"?u.replace:u,u.applyPostProcessor=!1,delete u.defaultValue;var f=!1;if(a[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(a[1])){var l=a[1].split(this.formatSeparator).map(function(d){return d.trim()});a[1]=l.shift(),h=l,f=!0}if(o=r(v.call(this,a[1].trim(),u),u),o&&a[0]===t&&typeof o!="string")return o;typeof o!="string"&&(o=qs(o)),o||(this.logger.warn("missed to resolve ".concat(a[1]," for nesting ").concat(t)),o=""),f&&(o=h.reduce(function(d,m){return n.format(d,m,s.lng,we(we({},s),{},{interpolationkey:a[1].trim()}))},o.trim())),t=t.replace(a[0],o),this.regexp.lastIndex=0}return t}}]),i}();function na(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function Re(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?na(Object(t),!0).forEach(function(r){Be(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):na(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function bu(i){var e=i.toLowerCase().trim(),t={};if(i.indexOf("(")>-1){var r=i.split("(");e=r[0].toLowerCase().trim();var n=r[1].substring(0,r[1].length-1);if(e==="currency"&&n.indexOf(":")<0)t.currency||(t.currency=n.trim());else if(e==="relativetime"&&n.indexOf(":")<0)t.range||(t.range=n.trim());else{var s=n.split(";");s.forEach(function(a){if(a){var o=a.split(":"),u=Yl(o),v=u[0],h=u.slice(1),f=h.join(":").trim().replace(/^'+|'+$/g,"");t[v.trim()]||(t[v.trim()]=f),f==="false"&&(t[v.trim()]=!1),f==="true"&&(t[v.trim()]=!0),isNaN(f)||(t[v.trim()]=parseInt(f,10))}})}}return{formatName:e,formatOptions:t}}function tt(i){var e={};return function(r,n,s){var a=n+JSON.stringify(s),o=e[a];return o||(o=i(n,s),e[a]=o),o(r)}}var Su=function(){function i(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Oe(this,i),this.logger=Te.create("formatter"),this.options=e,this.formats={number:tt(function(t,r){var n=new Intl.NumberFormat(t,Re({},r));return function(s){return n.format(s)}}),currency:tt(function(t,r){var n=new Intl.NumberFormat(t,Re(Re({},r),{},{style:"currency"}));return function(s){return n.format(s)}}),datetime:tt(function(t,r){var n=new Intl.DateTimeFormat(t,Re({},r));return function(s){return n.format(s)}}),relativetime:tt(function(t,r){var n=new Intl.RelativeTimeFormat(t,Re({},r));return function(s){return n.format(s,r.range||"day")}}),list:tt(function(t,r){var n=new Intl.ListFormat(t,Re({},r));return function(s){return n.format(s)}})},this.init(e)}return ke(i,[{key:"init",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}},n=r.interpolation;this.formatSeparator=n.formatSeparator?n.formatSeparator:n.formatSeparator||","}},{key:"add",value:function(t,r){this.formats[t.toLowerCase().trim()]=r}},{key:"addCached",value:function(t,r){this.formats[t.toLowerCase().trim()]=tt(r)}},{key:"format",value:function(t,r,n){var s=this,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},o=r.split(this.formatSeparator),u=o.reduce(function(v,h){var f=bu(h),l=f.formatName,d=f.formatOptions;if(s.formats[l]){var m=v;try{var c=a&&a.formatParams&&a.formatParams[a.interpolationkey]||{},g=c.locale||c.lng||a.locale||a.lng||n;m=s.formats[l](v,g,Re(Re(Re({},d),a),c))}catch(p){s.logger.warn(p)}return m}else s.logger.warn("there was no format function for ".concat(l));return v},t);return u}}]),i}();function ia(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function sa(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ia(Object(t),!0).forEach(function(r){Be(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):ia(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function wu(i){var e=_u();return function(){var r=Ce(i),n;if(e){var s=Ce(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return ht(this,n)}}function _u(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Eu(i,e){i.pending[e]!==void 0&&(delete i.pending[e],i.pendingCount--)}var xu=function(i){Vt(t,i);var e=wu(t);function t(r,n,s){var a,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Oe(this,t),a=e.call(this),zt&&Ue.call($e(a)),a.backend=r,a.store=n,a.services=s,a.languageUtils=s.languageUtils,a.options=o,a.logger=Te.create("backendConnector"),a.waitingReads=[],a.maxParallelReads=o.maxParallelReads||10,a.readingCalls=0,a.maxRetries=o.maxRetries>=0?o.maxRetries:5,a.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,a.state={},a.queue=[],a.backend&&a.backend.init&&a.backend.init(s,o.backend,o),a}return ke(t,[{key:"queueLoad",value:function(n,s,a,o){var u=this,v={},h={},f={},l={};return n.forEach(function(d){var m=!0;s.forEach(function(c){var g="".concat(d,"|").concat(c);!a.reload&&u.store.hasResourceBundle(d,c)?u.state[g]=2:u.state[g]<0||(u.state[g]===1?h[g]===void 0&&(h[g]=!0):(u.state[g]=1,m=!1,h[g]===void 0&&(h[g]=!0),v[g]===void 0&&(v[g]=!0),l[c]===void 0&&(l[c]=!0)))}),m||(f[d]=!0)}),(Object.keys(v).length||Object.keys(h).length)&&this.queue.push({pending:h,pendingCount:Object.keys(h).length,loaded:{},errors:[],callback:o}),{toLoad:Object.keys(v),pending:Object.keys(h),toLoadLanguages:Object.keys(f),toLoadNamespaces:Object.keys(l)}}},{key:"loaded",value:function(n,s,a){var o=n.split("|"),u=o[0],v=o[1];s&&this.emit("failedLoading",u,v,s),a&&this.store.addResourceBundle(u,v,a),this.state[n]=s?-1:2;var h={};this.queue.forEach(function(f){ru(f.loaded,[u],v),Eu(f,n),s&&f.errors.push(s),f.pendingCount===0&&!f.done&&(Object.keys(f.loaded).forEach(function(l){h[l]||(h[l]={});var d=f.loaded[l];d.length&&d.forEach(function(m){h[l][m]===void 0&&(h[l][m]=!0)})}),f.done=!0,f.errors.length?f.callback(f.errors):f.callback())}),this.emit("loaded",h),this.queue=this.queue.filter(function(f){return!f.done})}},{key:"read",value:function(n,s,a){var o=this,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,h=arguments.length>5?arguments[5]:void 0;if(!n.length)return h(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:n,ns:s,fcName:a,tried:u,wait:v,callback:h});return}this.readingCalls++;var f=function(c,g){if(o.readingCalls--,o.waitingReads.length>0){var p=o.waitingReads.shift();o.read(p.lng,p.ns,p.fcName,p.tried,p.wait,p.callback)}if(c&&g&&u<o.maxRetries){setTimeout(function(){o.read.call(o,n,s,a,u+1,v*2,h)},v);return}h(c,g)},l=this.backend[a].bind(this.backend);if(l.length===2){try{var d=l(n,s);d&&typeof d.then=="function"?d.then(function(m){return f(null,m)}).catch(f):f(null,d)}catch(m){f(m)}return}return l(n,s,f)}},{key:"prepareLoading",value:function(n,s){var a=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),u&&u();typeof n=="string"&&(n=this.languageUtils.toResolveHierarchy(n)),typeof s=="string"&&(s=[s]);var v=this.queueLoad(n,s,o,u);if(!v.toLoad.length)return v.pending.length||u(),null;v.toLoad.forEach(function(h){a.loadOne(h)})}},{key:"load",value:function(n,s,a){this.prepareLoading(n,s,{},a)}},{key:"reload",value:function(n,s,a){this.prepareLoading(n,s,{reload:!0},a)}},{key:"loadOne",value:function(n){var s=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",o=n.split("|"),u=o[0],v=o[1];this.read(u,v,"read",void 0,void 0,function(h,f){h&&s.logger.warn("".concat(a,"loading namespace ").concat(v," for language ").concat(u," failed"),h),!h&&f&&s.logger.log("".concat(a,"loaded namespace ").concat(v," for language ").concat(u),f),s.loaded(n,h,f)})}},{key:"saveMissing",value:function(n,s,a,o,u){var v=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},h=arguments.length>6&&arguments[6]!==void 0?arguments[6]:function(){};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(s)){this.logger.warn('did not save key "'.concat(a,'" as the namespace "').concat(s,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(a==null||a==="")){if(this.backend&&this.backend.create){var f=sa(sa({},v),{},{isUpdate:u}),l=this.backend.create.bind(this.backend);if(l.length<6)try{var d;l.length===5?d=l(n,s,a,o,f):d=l(n,s,a,o),d&&typeof d.then=="function"?d.then(function(m){return h(null,m)}).catch(h):h(null,d)}catch(m){h(m)}else l(n,s,a,o,h,f)}!n||!n[0]||this.store.addResource(n[0],s,a,o)}}}]),t}(Ue);function aa(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if(Se(e[1])==="object"&&(t=e[1]),typeof e[1]=="string"&&(t.defaultValue=e[1]),typeof e[2]=="string"&&(t.tDescription=e[2]),Se(e[2])==="object"||Se(e[3])==="object"){var r=e[3]||e[2];Object.keys(r).forEach(function(n){t[n]=r[n]})}return t},interpolation:{escapeValue:!0,format:function(e,t,r,n){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function oa(i){return typeof i.ns=="string"&&(i.ns=[i.ns]),typeof i.fallbackLng=="string"&&(i.fallbackLng=[i.fallbackLng]),typeof i.fallbackNS=="string"&&(i.fallbackNS=[i.fallbackNS]),i.supportedLngs&&i.supportedLngs.indexOf("cimode")<0&&(i.supportedLngs=i.supportedLngs.concat(["cimode"])),i}function la(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function Fe(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?la(Object(t),!0).forEach(function(r){Be(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):la(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function Au(i){var e=Pu();return function(){var r=Ce(i),n;if(e){var s=Ce(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return ht(this,n)}}function Pu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Gt(){}function Ou(i){var e=Object.getOwnPropertyNames(Object.getPrototypeOf(i));e.forEach(function(t){typeof i[t]=="function"&&(i[t]=i[t].bind(i))})}var Kt=function(i){Vt(t,i);var e=Au(t);function t(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;if(Oe(this,t),r=e.call(this),zt&&Ue.call($e(r)),r.options=oa(n),r.services={},r.logger=Te,r.modules={external:[]},Ou($e(r)),s&&!r.isInitialized&&!n.isClone){if(!r.options.initImmediate)return r.init(n,s),ht(r,$e(r));setTimeout(function(){r.init(n,s)},0)}return r}return ke(t,[{key:"init",value:function(){var n=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;typeof s=="function"&&(a=s,s={}),!s.defaultNS&&s.defaultNS!==!1&&s.ns&&(typeof s.ns=="string"?s.defaultNS=s.ns:s.ns.indexOf("translation")<0&&(s.defaultNS=s.ns[0]));var o=aa();this.options=Fe(Fe(Fe({},o),this.options),oa(s)),this.options.compatibilityAPI!=="v1"&&(this.options.interpolation=Fe(Fe({},o.interpolation),this.options.interpolation)),s.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=s.keySeparator),s.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=s.nsSeparator);function u(p){return p?typeof p=="function"?new p:p:null}if(!this.options.isClone){this.modules.logger?Te.init(u(this.modules.logger),this.options):Te.init(null,this.options);var v;this.modules.formatter?v=this.modules.formatter:typeof Intl<"u"&&(v=Su);var h=new Qs(this.options);this.store=new cu(this.options.resources,this.options);var f=this.services;f.logger=Te,f.resourceStore=this.store,f.languageUtils=h,f.pluralResolver=new yu(h,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),v&&(!this.options.interpolation.format||this.options.interpolation.format===o.interpolation.format)&&(f.formatter=u(v),f.formatter.init(f,this.options),this.options.interpolation.format=f.formatter.format.bind(f.formatter)),f.interpolator=new vu(this.options),f.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},f.backendConnector=new xu(u(this.modules.backend),f.resourceStore,f,this.options),f.backendConnector.on("*",function(p){for(var y=arguments.length,b=new Array(y>1?y-1:0),x=1;x<y;x++)b[x-1]=arguments[x];n.emit.apply(n,[p].concat(b))}),this.modules.languageDetector&&(f.languageDetector=u(this.modules.languageDetector),f.languageDetector.init&&f.languageDetector.init(f,this.options.detection,this.options)),this.modules.i18nFormat&&(f.i18nFormat=u(this.modules.i18nFormat),f.i18nFormat.init&&f.i18nFormat.init(this)),this.translator=new Ys(this.services,this.options),this.translator.on("*",function(p){for(var y=arguments.length,b=new Array(y>1?y-1:0),x=1;x<y;x++)b[x-1]=arguments[x];n.emit.apply(n,[p].concat(b))}),this.modules.external.forEach(function(p){p.init&&p.init(n)})}if(this.format=this.options.interpolation.format,a||(a=Gt),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&l[0]!=="dev"&&(this.options.lng=l[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined");var d=["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"];d.forEach(function(p){n[p]=function(){var y;return(y=n.store)[p].apply(y,arguments)}});var m=["addResource","addResources","addResourceBundle","removeResourceBundle"];m.forEach(function(p){n[p]=function(){var y;return(y=n.store)[p].apply(y,arguments),n}});var c=pt(),g=function(){var y=function(x,S){n.isInitialized&&!n.initializedStoreOnce&&n.logger.warn("init: i18next is already initialized. You should call init just once!"),n.isInitialized=!0,n.options.isClone||n.logger.log("initialized",n.options),n.emit("initialized",n.options),c.resolve(S),a(x,S)};if(n.languages&&n.options.compatibilityAPI!=="v1"&&!n.isInitialized)return y(null,n.t.bind(n));n.changeLanguage(n.options.lng,y)};return this.options.resources||!this.options.initImmediate?g():setTimeout(g,0),c}},{key:"loadResources",value:function(n){var s=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gt,o=a,u=typeof n=="string"?n:this.language;if(typeof n=="function"&&(o=n),!this.options.resources||this.options.partialBundledLanguages){if(u&&u.toLowerCase()==="cimode")return o();var v=[],h=function(d){if(d){var m=s.services.languageUtils.toResolveHierarchy(d);m.forEach(function(c){v.indexOf(c)<0&&v.push(c)})}};if(u)h(u);else{var f=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);f.forEach(function(l){return h(l)})}this.options.preload&&this.options.preload.forEach(function(l){return h(l)}),this.services.backendConnector.load(v,this.options.ns,function(l){!l&&!s.resolvedLanguage&&s.language&&s.setResolvedLanguage(s.language),o(l)})}else o(null)}},{key:"reloadResources",value:function(n,s,a){var o=pt();return n||(n=this.languages),s||(s=this.options.ns),a||(a=Gt),this.services.backendConnector.reload(n,s,function(u){o.resolve(),a(u)}),o}},{key:"use",value:function(n){if(!n)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!n.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return n.type==="backend"&&(this.modules.backend=n),(n.type==="logger"||n.log&&n.warn&&n.error)&&(this.modules.logger=n),n.type==="languageDetector"&&(this.modules.languageDetector=n),n.type==="i18nFormat"&&(this.modules.i18nFormat=n),n.type==="postProcessor"&&Zs.addPostProcessor(n),n.type==="formatter"&&(this.modules.formatter=n),n.type==="3rdParty"&&this.modules.external.push(n),this}},{key:"setResolvedLanguage",value:function(n){if(!(!n||!this.languages)&&!(["cimode","dev"].indexOf(n)>-1))for(var s=0;s<this.languages.length;s++){var a=this.languages[s];if(!(["cimode","dev"].indexOf(a)>-1)&&this.store.hasLanguageSomeTranslations(a)){this.resolvedLanguage=a;break}}}},{key:"changeLanguage",value:function(n,s){var a=this;this.isLanguageChangingTo=n;var o=pt();this.emit("languageChanging",n);var u=function(l){a.language=l,a.languages=a.services.languageUtils.toResolveHierarchy(l),a.resolvedLanguage=void 0,a.setResolvedLanguage(l)},v=function(l,d){d?(u(d),a.translator.changeLanguage(d),a.isLanguageChangingTo=void 0,a.emit("languageChanged",d),a.logger.log("languageChanged",d)):a.isLanguageChangingTo=void 0,o.resolve(function(){return a.t.apply(a,arguments)}),s&&s(l,function(){return a.t.apply(a,arguments)})},h=function(l){!n&&!l&&a.services.languageDetector&&(l=[]);var d=typeof l=="string"?l:a.services.languageUtils.getBestMatchFromCodes(l);d&&(a.language||u(d),a.translator.language||a.translator.changeLanguage(d),a.services.languageDetector&&a.services.languageDetector.cacheUserLanguage&&a.services.languageDetector.cacheUserLanguage(d)),a.loadResources(d,function(m){v(m,d)})};return!n&&this.services.languageDetector&&!this.services.languageDetector.async?h(this.services.languageDetector.detect()):!n&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(h):this.services.languageDetector.detect(h):h(n),o}},{key:"getFixedT",value:function(n,s,a){var o=this,u=function v(h,f){var l;if(Se(f)!=="object"){for(var d=arguments.length,m=new Array(d>2?d-2:0),c=2;c<d;c++)m[c-2]=arguments[c];l=o.options.overloadTranslationOptionHandler([h,f].concat(m))}else l=Fe({},f);l.lng=l.lng||v.lng,l.lngs=l.lngs||v.lngs,l.ns=l.ns||v.ns,l.keyPrefix=l.keyPrefix||a||v.keyPrefix;var g=o.options.keySeparator||".",p;return l.keyPrefix&&Array.isArray(h)?p=h.map(function(y){return"".concat(l.keyPrefix).concat(g).concat(y)}):p=l.keyPrefix?"".concat(l.keyPrefix).concat(g).concat(h):h,o.t(p,l)};return typeof n=="string"?u.lng=n:u.lngs=n,u.ns=s,u.keyPrefix=a,u}},{key:"t",value:function(){var n;return this.translator&&(n=this.translator).translate.apply(n,arguments)}},{key:"exists",value:function(){var n;return this.translator&&(n=this.translator).exists.apply(n,arguments)}},{key:"setDefaultNamespace",value:function(n){this.options.defaultNS=n}},{key:"hasLoadedNamespace",value:function(n){var s=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var o=this.resolvedLanguage||this.languages[0],u=this.options?this.options.fallbackLng:!1,v=this.languages[this.languages.length-1];if(o.toLowerCase()==="cimode")return!0;var h=function(d,m){var c=s.services.backendConnector.state["".concat(d,"|").concat(m)];return c===-1||c===2};if(a.precheck){var f=a.precheck(this,h);if(f!==void 0)return f}return!!(this.hasResourceBundle(o,n)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||h(o,n)&&(!u||h(v,n)))}},{key:"loadNamespaces",value:function(n,s){var a=this,o=pt();return this.options.ns?(typeof n=="string"&&(n=[n]),n.forEach(function(u){a.options.ns.indexOf(u)<0&&a.options.ns.push(u)}),this.loadResources(function(u){o.resolve(),s&&s(u)}),o):(s&&s(),Promise.resolve())}},{key:"loadLanguages",value:function(n,s){var a=pt();typeof n=="string"&&(n=[n]);var o=this.options.preload||[],u=n.filter(function(v){return o.indexOf(v)<0});return u.length?(this.options.preload=o.concat(u),this.loadResources(function(v){a.resolve(),s&&s(v)}),a):(s&&s(),Promise.resolve())}},{key:"dir",value:function(n){if(n||(n=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!n)return"rtl";var s=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],a=this.services&&this.services.languageUtils||new Qs(aa());return s.indexOf(a.getLanguagePartFromCode(n))>-1||n.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var n=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gt,o=Fe(Fe(Fe({},this.options),s),{isClone:!0}),u=new t(o);(s.debug!==void 0||s.prefix!==void 0)&&(u.logger=u.logger.clone(s));var v=["store","services","language"];return v.forEach(function(h){u[h]=n[h]}),u.services=Fe({},this.services),u.services.utils={hasLoadedNamespace:u.hasLoadedNamespace.bind(u)},u.translator=new Ys(u.services,u.options),u.translator.on("*",function(h){for(var f=arguments.length,l=new Array(f>1?f-1:0),d=1;d<f;d++)l[d-1]=arguments[d];u.emit.apply(u,[h].concat(l))}),u.init(o,a),u.translator.options=u.options,u.translator.backendConnector.services.utils={hasLoadedNamespace:u.hasLoadedNamespace.bind(u)},u}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),t}(Ue);Be(Kt,"createInstance",function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;return new Kt(i,e)});var le=Kt.createInstance();le.createInstance=Kt.createInstance,le.createInstance,le.dir,le.init,le.loadResources,le.reloadResources,le.use,le.changeLanguage,le.getFixedT,le.t,le.exists,le.setDefaultNamespace,le.hasLoadedNamespace,le.loadNamespaces,le.loadLanguages;const Zt=25,ua=(i,e,t)=>{const r=t.getBoundingClientRect();return i>=r.x-Zt&&i<=r.x+r.width+Zt&&e>=r.y-Zt&&e<=r.y+r.height+Zt};class ku{constructor(e,t){A(this,"video");A(this,"settings");A(this,"showingSubtitles");A(this,"lastLoadedMessageTimestamp");A(this,"lastOffsetChangeTimestamp");A(this,"showingOffset");A(this,"subtitlesInterval");A(this,"showingLoadedMessage");A(this,"subtitleSettings");A(this,"subtitleStyles");A(this,"subtitleClasses");A(this,"notificationElementOverlayHideTimeout");A(this,"_subtitles");A(this,"subtitleCollection");A(this,"bottomSubtitlesElementOverlay");A(this,"topSubtitlesElementOverlay");A(this,"notificationElementOverlay");A(this,"shouldRenderBottomOverlay");A(this,"shouldRenderTopOverlay");A(this,"subtitleTrackAlignments");A(this,"unblurredSubtitleTracks");A(this,"disabledSubtitleTracks");A(this,"subtitleFileNames");A(this,"_forceHideSubtitles");A(this,"_displaySubtitles");A(this,"surroundingSubtitlesCountRadius");A(this,"surroundingSubtitlesTimeRadius");A(this,"autoCopyCurrentSubtitle");A(this,"_preCacheDom");A(this,"autoPauseContext",new Xa);A(this,"onNextToShow");A(this,"onSlice");A(this,"onOffsetChange");A(this,"onMouseOver");this.video=e,this.settings=t,this._preCacheDom=!1,this._subtitles=[],this.subtitleCollection=new Dt([]),this.showingSubtitles=[],this.shouldRenderBottomOverlay=!0,this.shouldRenderTopOverlay=!1,this.unblurredSubtitleTracks={},this.disabledSubtitleTracks={},this.subtitleTrackAlignments={0:"bottom"},this._forceHideSubtitles=!1,this._displaySubtitles=!0,this.lastLoadedMessageTimestamp=0,this.lastOffsetChangeTimestamp=0,this.showingOffset=void 0,this.surroundingSubtitlesCountRadius=1,this.surroundingSubtitlesTimeRadius=5e3,this.showingLoadedMessage=!1,this.autoCopyCurrentSubtitle=!1;const{subtitlesElementOverlay:r,topSubtitlesElementOverlay:n,notificationElementOverlay:s}=this._overlays();this.bottomSubtitlesElementOverlay=r,this.topSubtitlesElementOverlay=n,this.notificationElementOverlay=s}get subtitles(){return this._subtitles}set subtitles(e){this._subtitles=e,this.subtitleCollection=new Dt(e,{showingCheckRadiusMs:150,returnNextToShow:!0}),this.autoPauseContext.clear()}reset(){this.subtitles=[],this.subtitleFileNames=void 0,this.cacheHtml()}cacheHtml(){const e=this._buildSubtitlesHtml(this.subtitles);if(this.shouldRenderBottomOverlay&&this.bottomSubtitlesElementOverlay instanceof Xe){this.bottomSubtitlesElementOverlay.uncacheHtml();for(const t of e)this.bottomSubtitlesElementOverlay.cacheHtml(t.key,t.html())}if(this.shouldRenderTopOverlay&&this.topSubtitlesElementOverlay instanceof Xe){this.topSubtitlesElementOverlay.uncacheHtml();for(const t of e)this.topSubtitlesElementOverlay.cacheHtml(t.key,t.html())}}set bottomSubtitlePositionOffset(e){this.bottomSubtitlesElementOverlay.contentPositionOffset=e}set topSubtitlePositionOffset(e){this.topSubtitlesElementOverlay.contentPositionOffset=e}set subtitlesWidth(e){this.bottomSubtitlesElementOverlay.contentWidthPercentage=e,this.topSubtitlesElementOverlay.contentWidthPercentage=e}setSubtitleSettings(e){const t=this._computeStyles(e),r=this._computeClasses(e);(this.subtitleStyles===void 0||!this._arrayEquals(t,this.subtitleStyles,(s,a)=>s===a)||this.subtitleClasses===void 0||!this._arrayEquals(r,this.subtitleClasses,(s,a)=>s===a))&&(this.subtitleStyles=t,this.subtitleClasses=r,this.cacheHtml());const n=xr(e).map(s=>s.subtitleAlignment);if(!this._arrayEquals(n,Object.values(this.subtitleTrackAlignments),(s,a)=>s===a)){this.subtitleTrackAlignments=n,this.shouldRenderBottomOverlay=Object.values(this.subtitleTrackAlignments).includes("bottom"),this.shouldRenderTopOverlay=Object.values(this.subtitleTrackAlignments).includes("top");const{subtitleOverlayParams:s,topSubtitleOverlayParams:a,notificationOverlayParams:o}=this._elementOverlayParams();this._applyElementOverlayParams(this.bottomSubtitlesElementOverlay,s),this._applyElementOverlayParams(this.topSubtitlesElementOverlay,a),this._applyElementOverlayParams(this.notificationElementOverlay,o),this.bottomSubtitlesElementOverlay.hide(),this.topSubtitlesElementOverlay.hide(),this.notificationElementOverlay.hide()}this.unblurredSubtitleTracks={},this.subtitleSettings=e}_computeStyles(e){return xr(e).map(t=>Ka(t))}_computeClasses(e){return xr(e).map(t=>this._computeClassesForTrack(t))}_computeClassesForTrack(e){return e.subtitleBlur?"asbplayer-subtitles-blurred":""}_getSubtitleTrackAlignment(e){return this.subtitleTrackAlignments[e]||this.subtitleTrackAlignments[0]}_applyElementOverlayParams(e,t){e.offsetAnchor=t.offsetAnchor,e.fullscreenContainerClassName=t.fullscreenContainerClassName,e.fullscreenContentClassName=t.fullscreenContentClassName,e.nonFullscreenContainerClassName=t.nonFullscreenContainerClassName,e.nonFullscreenContentClassName=t.nonFullscreenContentClassName}set displaySubtitles(e){this._displaySubtitles=e,this.showingSubtitles=void 0}set forceHideSubtitles(e){this._forceHideSubtitles=e,this.showingSubtitles=void 0}_overlays(){const{subtitleOverlayParams:e,topSubtitleOverlayParams:t,notificationOverlayParams:r}=this._elementOverlayParams();return{subtitlesElementOverlay:new Xe(e),topSubtitlesElementOverlay:new Xe(t),notificationElementOverlay:new Xe(r)}}_elementOverlayParams(){const e={targetElement:this.video,nonFullscreenContainerClassName:"asbplayer-subtitles-container-bottom",nonFullscreenContentClassName:"asbplayer-subtitles",fullscreenContainerClassName:"asbplayer-subtitles-container-bottom",fullscreenContentClassName:"asbplayer-fullscreen-subtitles",offsetAnchor:ve.bottom,contentWidthPercentage:-1,onMouseOver:n=>{var s;return(s=this.onMouseOver)==null?void 0:s.call(this,n)}},t={targetElement:this.video,nonFullscreenContainerClassName:"asbplayer-subtitles-container-top",nonFullscreenContentClassName:"asbplayer-subtitles",fullscreenContainerClassName:"asbplayer-subtitles-container-top",fullscreenContentClassName:"asbplayer-fullscreen-subtitles",offsetAnchor:ve.top,contentWidthPercentage:-1,onMouseOver:n=>{var s;return(s=this.onMouseOver)==null?void 0:s.call(this,n)}},r=this._getSubtitleTrackAlignment(0)==="bottom"?{targetElement:this.video,nonFullscreenContainerClassName:"asbplayer-notification-container-top",nonFullscreenContentClassName:"asbplayer-notification",fullscreenContainerClassName:"asbplayer-notification-container-top",fullscreenContentClassName:"asbplayer-notification",offsetAnchor:ve.top,contentWidthPercentage:-1,onMouseOver:n=>{var s;return(s=this.onMouseOver)==null?void 0:s.call(this,n)}}:{targetElement:this.video,nonFullscreenContainerClassName:"asbplayer-notification-container-bottom",nonFullscreenContentClassName:"asbplayer-notification",fullscreenContainerClassName:"asbplayer-notification-container-bottom",fullscreenContentClassName:"asbplayer-notification",offsetAnchor:ve.bottom,contentWidthPercentage:-1,onMouseOver:n=>{var s;return(s=this.onMouseOver)==null?void 0:s.call(this,n)}};return{subtitleOverlayParams:e,topSubtitleOverlayParams:t,notificationOverlayParams:r}}bind(){this.subtitlesInterval=setInterval(()=>{var u,v;if(this.lastLoadedMessageTimestamp>0&&Date.now()-this.lastLoadedMessageTimestamp<1e3||(this.showingLoadedMessage&&(this._setSubtitlesHtml(this.bottomSubtitlesElementOverlay,[{html:()=>""}]),this._setSubtitlesHtml(this.topSubtitlesElementOverlay,[{html:()=>""}]),this.showingLoadedMessage=!1),this.subtitles.length===0))return;const e=this.lastOffsetChangeTimestamp>0&&Date.now()-this.lastOffsetChangeTimestamp<1e3,t=e?this._computeOffset():0,r=1e3*this.video.currentTime;let n=[];const s=this.subtitleCollection.subtitlesAt(r);n=s.showing.filter(h=>this._trackEnabled(h)).sort((h,f)=>h.track-f.track),(u=this.onSlice)==null||u.call(this,s),s.willStopShowing&&this._trackEnabled(s.willStopShowing)&&this.autoPauseContext.willStopShowing(s.willStopShowing),s.startedShowing&&this._trackEnabled(s.startedShowing)&&this.autoPauseContext.startedShowing(s.startedShowing),s.nextToShow&&s.nextToShow.length>0&&((v=this.onNextToShow)==null||v.call(this,s.nextToShow[0]));const a=this.showingSubtitles===void 0||!this._arrayEquals(n,this.showingSubtitles,(h,f)=>h.index===f.index);a&&(this.showingSubtitles=n,this._autoCopyToClipboard(n));const o=e&&t!==this.showingOffset||!e&&this.showingOffset!==void 0;if(!e&&!this._displaySubtitles||this._forceHideSubtitles)this.bottomSubtitlesElementOverlay.hide(),this.topSubtitlesElementOverlay.hide();else if(a||o){if(this._resetUnblurState(),this.shouldRenderBottomOverlay){const h=n.filter(f=>this._getSubtitleTrackAlignment(f.track)==="bottom");this._renderSubtitles(h,ve.bottom)}if(this.shouldRenderTopOverlay){const h=n.filter(f=>this._getSubtitleTrackAlignment(f.track)==="top");this._renderSubtitles(h,ve.top)}e?(this._appendSubtitlesHtml(this._buildTextHtml(this._formatOffset(t))),this.showingOffset=t):this.showingOffset=void 0}},100)}_renderSubtitles(e,t){t==ve.top?this._setSubtitlesHtml(this.topSubtitlesElementOverlay,this._buildSubtitlesHtml(e)):this._setSubtitlesHtml(this.bottomSubtitlesElementOverlay,this._buildSubtitlesHtml(e))}_resetUnblurState(){if(Object.keys(this.unblurredSubtitleTracks).length!==0){for(const e of[...this.bottomSubtitlesElementOverlay.displayingElements(),...this.topSubtitlesElementOverlay.displayingElements()]){const t=Number(e.dataset.track);this.unblurredSubtitleTracks[t]===!0&&e.classList.add("asbplayer-subtitles-blurred")}this.unblurredSubtitleTracks={}}}_autoCopyToClipboard(e){if(this.autoCopyCurrentSubtitle&&e.length>0&&document.hasFocus()){const t=e.map(r=>r.text).filter(r=>r!=="").join(`
`);if(t!==""){const r={sender:"asbplayer-video",message:{command:"copy-to-clipboard",dataUrl:`data:,${encodeURIComponent(t)}`},src:this.video.src};W.runtime.sendMessage(r)}}}_trackEnabled(e){return e.track===void 0||!this.disabledSubtitleTracks[e.track]}_buildSubtitlesHtml(e){return e.map(t=>({html:()=>{var r,n;if(t.textImage){const s=((r=this.subtitleClasses)==null?void 0:r[t.track])??"",o=(((n=this.subtitleSettings)==null?void 0:n.imageBasedSubtitleScaleFactor)??1)*this.video.getBoundingClientRect().width/t.textImage.screen.width*t.textImage.image.width;return`
                            <div data-track="${t.track??0}" style="max-width:${o}px;margin:auto;" class="${s}"}">
                                <img
                                    style="width:100%;"
                                    alt="subtitle"
                                    src="${t.textImage.dataUrl}"
                                />
                            </div>
                        `}else return this._buildTextHtml(t.text,t.track)},key:String(t.index)}))}_buildTextHtml(e,t){return`<span data-track="${t??0}" class="${this._subtitleClasses(t)}" style="${this._subtitleStyles(t)}">${e}</span>`}unbind(){this.subtitlesInterval&&(clearInterval(this.subtitlesInterval),this.subtitlesInterval=void 0),this.notificationElementOverlayHideTimeout&&(clearTimeout(this.notificationElementOverlayHideTimeout),this.notificationElementOverlayHideTimeout=void 0),this.bottomSubtitlesElementOverlay.dispose(),this.topSubtitlesElementOverlay.dispose(),this.notificationElementOverlay.dispose(),this.onNextToShow=void 0,this.onSlice=void 0,this.onOffsetChange=void 0,this.onMouseOver=void 0}refresh(){this.shouldRenderBottomOverlay&&this.bottomSubtitlesElementOverlay.refresh(),this.shouldRenderTopOverlay&&this.topSubtitlesElementOverlay.refresh(),this.notificationElementOverlay.refresh()}currentSubtitle(){const e=1e3*this.video.currentTime;let t=null,r=null;for(let n=0;n<this.subtitles.length;++n){const s=this.subtitles[n];if(e>=s.start&&e<s.end&&(typeof s.track>"u"||!this.disabledSubtitleTracks[s.track])){t=s,r=n;break}}return t===null||r===null?[null,null]:[t,ja(this.subtitles,r,this.surroundingSubtitlesCountRadius,this.surroundingSubtitlesTimeRadius)]}unblur(e){for(const t of[...this.bottomSubtitlesElementOverlay.displayingElements(),...this.topSubtitlesElementOverlay.displayingElements()]){const r=Number(t.dataset.track);e===r&&t.classList.contains("asbplayer-subtitles-blurred")&&(this.unblurredSubtitleTracks[e]=!0,t.classList.remove("asbplayer-subtitles-blurred"))}}offset(e,t=!1){var r;if(!(!this.subtitles||this.subtitles.length===0)){if(this.subtitles=this.subtitles.map(n=>({text:n.text,textImage:n.textImage,start:n.originalStart+e,originalStart:n.originalStart,end:n.originalEnd+e,originalEnd:n.originalEnd,track:n.track,index:n.index})),this.lastOffsetChangeTimestamp=Date.now(),!t){const n={sender:"asbplayer-video",message:{command:"offset",value:e},src:this.video.src};W.runtime.sendMessage(n)}(r=this.onOffsetChange)==null||r.call(this),this.settings.getSingle("rememberSubtitleOffset").then(n=>{n&&this.settings.set({lastSubtitleOffset:e})})}}_computeOffset(){if(!this.subtitles||this.subtitles.length===0)return 0;const e=this.subtitles[0];return e.start-e.originalStart}_formatOffset(e){const t=Math.floor(e);return t>=0?"+"+t+" ms":t+" ms"}notification(e,t){const r=le.t(e,t??{});this.notificationElementOverlay.setHtml([{html:()=>this._buildTextHtml(r)}]),this.notificationElementOverlayHideTimeout&&clearTimeout(this.notificationElementOverlayHideTimeout),this.notificationElementOverlayHideTimeout=setTimeout(()=>{this.notificationElementOverlay.hide(),this.notificationElementOverlayHideTimeout=void 0},3e3)}showLoadedMessage(e){if(!this.subtitleFileNames)return;let t;const r=this._nonEmptySubtitleNames(e);if(r.length===0?t=this.subtitleFileNames[0]:t=r.join("<br>"),this.subtitles.length>0){const s=this.subtitles[0].start-this.subtitles[0].originalStart;s!==0&&(t+=`<br>${this._formatOffset(s)}`)}const n=this._getSubtitleTrackAlignment(0)==="bottom"?this.bottomSubtitlesElementOverlay:this.topSubtitlesElementOverlay;this._setSubtitlesHtml(n,[{html:()=>this._buildTextHtml(t)}]),this.showingLoadedMessage=!0,this.lastLoadedMessageTimestamp=Date.now()}_nonEmptySubtitleNames(e){if(e.length===0)return[];const t=[];for(let r=0;r<e.length;r++)t.push(this.subtitleFileNames[e[r]]);return t}_setSubtitlesHtml(e,t){e.setHtml(t)}_appendSubtitlesHtml(e){this.shouldRenderBottomOverlay&&this.bottomSubtitlesElementOverlay.appendHtml(e),this.shouldRenderTopOverlay&&this.topSubtitlesElementOverlay.appendHtml(e)}_subtitleClasses(e){return e===void 0||this.subtitleClasses===void 0?"":this.subtitleClasses[e]??this.subtitleClasses}_subtitleStyles(e){return this.subtitleStyles===void 0?"":e===void 0?this.subtitleStyles[0]??"":this.subtitleStyles[e]??this.subtitleStyles[0]??""}_arrayEquals(e,t,r){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!r(e[n],t[n]))return!1;return!0}intersects(e,t){const r=this.bottomSubtitlesElementOverlay.containerElement;if(r!==void 0&&ua(e,t,r))return!0;const n=this.topSubtitlesElementOverlay.containerElement;return!!(n!==void 0&&ua(e,t,n))}}const Cu={pages:[{host:"www\\.netflix\\.com",script:"netflix-page.js",path:"watch",autoSync:{enabled:!0}},{host:"(m|www)\\.youtube\\.com",script:"youtube-page.js",path:"watch|shorts|embed",autoSync:{enabled:!0}},{host:"tver\\.jp",script:"tver-page.js",path:"episodes",autoSync:{enabled:!0}},{host:"www\\.b-ch\\.com",script:"bandai-channel-page.js",path:"titles",autoSync:{enabled:!0}},{host:"www\\.amazon\\..+|www\\.primevideo\\.com",script:"amazon-prime-page.js",path:".*",autoSync:{enabled:!0,videoSrc:"^blob:.+"},ignore:{class:"tst-video-overlay-player-html5",style:{display:"none"}}},{host:"www\\.hulu\\..+",script:"hulu-page.js",path:"watch",autoSync:{enabled:!0,elementId:"content-video-player"}},{host:"www\\.disneyplus\\..+",script:"disney-plus-page.js",path:"video|play",searchShadowRoots:!0,autoSync:{enabled:!0}},{host:"www\\.apps\\.disneyplus\\..+",script:"apps-disney-plus-page.js",path:"watch",searchShadowRoots:!0,autoSync:{enabled:!0}},{host:"video.unext.jp",script:"unext-page.js",path:"play",autoSync:{enabled:!1}},{host:".+\\.viki\\.(io|com)",script:"viki-page.js",path:"videos",autoSync:{enabled:!0}},{host:"(jellyfin.*)|(emby.*)|(:8096$)",script:"emby-jellyfin-page.js",hash:"#!/videoosd/videoosd.html|#/video",autoSync:{enabled:!0}},{host:"www.twitch.tv",allowBlankSrc:!0},{host:"osnplus.com",script:"osnplus-page.js",path:"watch",autoSync:{enabled:!0}},{host:"www.bilibili.tv",script:"bilibili-page.js",path:"play|video",autoSync:{enabled:!0}},{host:"tv.nrk.no",script:"nrk-tv-page.js",path:".*",autoSync:{enabled:!0}},{host:"(plex.*)|(:32400$)",script:"plex-page.js",path:".*",autoSync:{enabled:!0}},{host:"areena.yle.fi",script:"areena-yle-page.js",path:".*",autoSync:{enabled:!0}},{host:"play.max.com",script:"hbo-max-page.js",path:"watch",autoSync:{enabled:!0}}]};function Bn(){const i=new URL(window.location.href);for(const e of Cu.pages)if(new RegExp(e.host).test(i.host))return new ca(e,i);if(Ut())return new ca({host:window.location.host,script:"asbplayer-tutorial-page.js",path:".*",autoSync:{enabled:!1}},i)}class ca{constructor(e,t){A(this,"config");A(this,"url");this.config=e,this.url=t}loadScripts(){if(this.config.script===void 0)return;const e=document.createElement("script");e.src=W.runtime.getURL(`${this.config.script}`),e.onload=()=>e.remove(),(document.head||document.documentElement).appendChild(e)}shouldIgnore(e){if(this.config.ignore===void 0)return!1;if(this.config.ignore.class!==void 0&&e.classList.contains(this.config.ignore.class))return!0;if(this.config.ignore.style!==void 0){for(const t of Object.keys(this.config.ignore.style))if(e.style[t]===this.config.ignore.style[t])return!0}return!1}canAutoSync(e){return this.config.autoSync!==void 0&&this.config.autoSync.enabled&&(this.config.autoSync.elementId===void 0||e.id===this.config.autoSync.elementId)&&(this.config.autoSync.videoSrc===void 0||new RegExp(this.config.autoSync.videoSrc).test(e.src))}isVideoPage(){var e=!0,t=!0;return this.config.hash&&(e=new RegExp(this.config.hash).test(this.url.hash)),this.config.path&&(t=new RegExp(this.config.path).test(this.url.pathname)),e&&t}}async function Tu(i){return`<!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="utf-8" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <title>asbplayer - Video Data Sync</title>
                <style>
                    @import url(${W.runtime.getURL("/fonts/fonts.css")});
                </style>
            </head>
            <body>
                <div id="root" style="width:100%;height:100vh;"></div>
                <script type="application/json" id="loc">${JSON.stringify(await qe(i))}<\/script>
                <script type="module" src="${W.runtime.getURL("/video-data-sync-ui.js")}"><\/script>
            </body>
            </html>`}const Fu=i=>new Promise((e,t)=>{const r=n=>{const s=n.detail;e(s),document.removeEventListener("asbplayer-synced-language-data",r,!1)};document.addEventListener("asbplayer-synced-language-data",r,!1),document.dispatchEvent(new CustomEvent("asbplayer-get-synced-language-data",{detail:i}))}),fa=new In;class Ru{constructor(e,t){A(this,"_context");A(this,"_domain");A(this,"_frame");A(this,"_settings");A(this,"_autoSync");A(this,"_lastLanguagesSynced");A(this,"_emptySubtitle");A(this,"_syncedData");A(this,"_wasPaused");A(this,"_fullscreenElement");A(this,"_activeElement");A(this,"_autoSyncAttempted",!1);A(this,"_dataReceivedListener");A(this,"_isTutorial");this._context=e,this._settings=t,this._autoSync=!1,this._lastLanguagesSynced={},this._emptySubtitle={id:"-",language:"-",url:"-",label:le.t("extension.videoDataSync.emptySubtitleTrack"),extension:"srt"},this._domain=new URL(window.location.href).host,this._frame=new dt(Tu),this._isTutorial=Ut()}get lastLanguagesSynced(){return this._lastLanguagesSynced[this._domain]??[]}set lastLanguagesSynced(e){this._lastLanguagesSynced[this._domain]=e}unbind(){this._dataReceivedListener&&document.removeEventListener("asbplayer-synced-data",this._dataReceivedListener,!1),this._dataReceivedListener=void 0,this._syncedData=void 0}updateSettings({streamingAutoSync:e,streamingLastLanguagesSynced:t}){this._autoSync=e,this._lastLanguagesSynced=t,this._frame.clientIfLoaded!==void 0&&this._context.settings.getSingle("themeType").then(r=>{const n=this._context.settings.profiles(),s=this._context.settings.activeProfile();Promise.all([n,s]).then(([a,o])=>{var u;(u=this._frame.clientIfLoaded)==null||u.updateState({settings:{themeType:r,profiles:a,activeProfile:o==null?void 0:o.name}})})})}requestSubtitles(){var e;!this._context.hasPageScript||!((e=Bn())!=null&&e.isVideoPage())||(this._syncedData=void 0,this._autoSyncAttempted=!1,this._dataReceivedListener||(this._dataReceivedListener=t=>{const r=t.detail;this._setSyncedData(r)},document.addEventListener("asbplayer-synced-data",this._dataReceivedListener,!1)),document.dispatchEvent(new CustomEvent("asbplayer-get-synced-data")))}async show({reason:e,fromAsbplayerId:t}){const r=await this._client(),n={open:!0,openReason:e};t!==void 0&&(n.openedFromAsbplayerId=t);const s=await this._buildModel(n);this._prepareShow(),r.updateState(s)}async _buildModel(e){var f,l,d;const t=((f=this._syncedData)==null?void 0:f.subtitles)??[],r=this._matchLastSyncedWithAvailableTracks(),n=r.autoSelectedTracks,s=this._isTutorial?["1","-","-"]:n.map(m=>m.id||"-"),a=!this._isTutorial&&r.completeMatch,o=await this._context.settings.getSingle("themeType"),u=this._context.settings.profiles(),v=this._context.settings.activeProfile(),h=(await fa.get(["ftueHasSeenSubtitleTrackSelector"])).ftueHasSeenSubtitleTrackSelector;return this._syncedData?{isLoading:this._syncedData.subtitles===void 0,suggestedName:this._syncedData.basename,selectedSubtitle:s,subtitles:t,error:this._syncedData.error,defaultCheckboxState:a,openedFromAsbplayerId:"",settings:{themeType:o,profiles:await u,activeProfile:(l=await v)==null?void 0:l.name},hasSeenFtue:h,hideRememberTrackPreferenceToggle:this._isTutorial,...e}:{isLoading:this._context.hasPageScript,suggestedName:document.title,selectedSubtitle:s,error:"",showSubSelect:!0,subtitles:t,defaultCheckboxState:a,openedFromAsbplayerId:"",settings:{themeType:o,profiles:await u,activeProfile:(d=await v)==null?void 0:d.name},hasSeenFtue:h,hideRememberTrackPreferenceToggle:this._isTutorial,...e}}_matchLastSyncedWithAvailableTracks(){var n;const e=((n=this._syncedData)==null?void 0:n.subtitles)??[];let t={autoSelectedTracks:[this._emptySubtitle,this._emptySubtitle,this._emptySubtitle],completeMatch:!1};const r=this.lastLanguagesSynced.some(s=>s!=="-")===void 0;if(!e.length&&r)t.completeMatch=!0;else{let s=0;for(let a=0;a<this.lastLanguagesSynced.length;a++){const o=this.lastLanguagesSynced[a];for(let u=0;u<e.length;u++)if(o==="-"){s++;break}else if(o===e[u].language){t.autoSelectedTracks[a]=e[u],s++;break}}s===this.lastLanguagesSynced.length&&(t.completeMatch=!0)}return t}_defaultVideoName(e,t){return t.url==="-"?e??"":e?`${e} - ${t.label}`:t.label}async _setSyncedData(e){var t;if(this._syncedData=e,((t=this._syncedData)==null?void 0:t.subtitles)!==void 0&&this._canAutoSync()){if(!this._autoSyncAttempted){this._autoSyncAttempted=!0;const r=this._matchLastSyncedWithAvailableTracks();if(r.completeMatch){const n=r.autoSelectedTracks;await this._syncData(n),this._frame.hidden||this._hideAndResume()}else await this._settings.getSingle("streamingAutoSyncPromptOnFailure")&&await this.show({reason:St.failedToAutoLoadPreferredTrack})}}else this._frame.clientIfLoaded!==void 0&&this._frame.clientIfLoaded.updateState(await this._buildModel({}))}_canAutoSync(){const e=Bn();return e===void 0?this._autoSync??!1:this._autoSync===!0&&e.canAutoSync(this._context.video)}async _client(){this._frame.language=await this._settings.getSingle("language");const e=await this._frame.bind(),t=await this._frame.client();return e&&t.onMessage(async r=>{if(r.command==="openSettings"){const s={sender:"asbplayer-video",message:{command:"open-asbplayer-settings"},src:this._context.video.src};W.runtime.sendMessage(s);return}if(r.command==="activeProfile"){const s=r;await this._context.settings.setActiveProfile(s.profile);const a={sender:"asbplayer-video",message:{command:"settings-updated"},src:this._context.video.src};W.runtime.sendMessage(a);return}if(r.command==="dismissFtue"){fa.set({ftueHasSeenSubtitleTrackSelector:!0}).catch(console.error);return}let n=!0;if(r.command==="confirm"){const s=r;s.shouldRememberTrackChoices&&(this.lastLanguagesSynced=s.data.map(o=>o.language).filter(o=>o!==void 0),await this._context.settings.set({streamingLastLanguagesSynced:this._lastLanguagesSynced}).catch(()=>{}));const a=s.data;n=await this._syncDataArray(a,s.syncWithAsbplayerId)}else if(r.command==="openFile"){const a=r.subtitles;try{await this._syncSubtitles(a,!1),n=!0}catch(o){o instanceof Error&&await this._reportError(o.message)}}n&&this._hideAndResume()}),this._frame.show(),t}_prepareShow(){this._wasPaused=this._wasPaused??this._context.video.paused,this._context.pause(),document.fullscreenElement&&(this._fullscreenElement=document.fullscreenElement,document.exitFullscreen()),document.activeElement&&(this._activeElement=document.activeElement),this._context.keyBindings.unbind(),this._context.subtitleController.forceHideSubtitles=!0,this._context.mobileVideoOverlayController.forceHide=!0}_hideAndResume(){var e;this._context.keyBindings.bind(this._context),this._context.subtitleController.forceHideSubtitles=!1,this._context.mobileVideoOverlayController.forceHide=!1,(e=this._frame)==null||e.hide(),this._fullscreenElement&&(this._fullscreenElement.requestFullscreen(),this._fullscreenElement=void 0),this._activeElement?(typeof this._activeElement.focus=="function"&&this._activeElement.focus(),this._activeElement=void 0):window.focus(),this._wasPaused||this._context.play(),this._wasPaused=void 0}async _syncData(e){var t;try{let r=[];for(let n=0;n<e.length;n++){const{extension:s,url:a,language:o,localFile:u}=e[n],v=await this._subtitlesForUrl(this._defaultVideoName((t=this._syncedData)==null?void 0:t.basename,e[n]),o,s,a,u);v!==void 0&&r.push(...v)}return await this._syncSubtitles(r,e.some(n=>typeof n.url=="object")),!0}catch(r){return typeof r.message<"u"&&await this._reportError(`Data Sync failed: ${r.message}`),!1}}async _syncDataArray(e,t){try{let r=[];for(let n=0;n<e.length;n++){const{name:s,language:a,extension:o,url:u,localFile:v}=e[n],h=await this._subtitlesForUrl(s,a,o,u,v);h!==void 0&&r.push(...h)}return await this._syncSubtitles(r,e.some(n=>typeof n.url=="object"),t),!0}catch(r){return typeof r.message<"u"&&await this._reportError(`Data Sync failed: ${r.message}`),!1}}async _syncSubtitles(e,t,r){const n=await Promise.all(e.map(async s=>new File([gn(s.base64,"text/plain")],s.name)));this._context.loadSubtitles(n,t,r)}async _subtitlesForUrl(e,t,r,n,s){var d,m;if(n==="-")return[{name:`${e}.${r}`,base64:""}];if(n==="lazy"){if(t===void 0){await this._reportError("Unable to determine language");return}const c=await Fu(t);if(c.error){await this._reportError(c.error);return}const g=(m=(d=c.subtitles)==null?void 0:d.find(p=>p.language===t))==null?void 0:m.url;if(g===void 0){await this._reportError("Failed to fetch subtitles for specified language");return}n=g}if(typeof n=="string"){const c=await fetch(n).catch(g=>this._reportError(g.message)).finally(()=>{s&&URL.revokeObjectURL(n)});if(!c)return;if(!c.ok)throw new Error(`Subtitle Retrieval failed with Status ${c.status}/${c.statusText}...`);return[{name:`${e}.${r}`,base64:c?Je(await c.arrayBuffer()):""}]}const a=n[0],o=a.substring(a.lastIndexOf(".")+1),u=`${e}.${o}`,v=n.map(c=>fetch(c)),h=[];let f=v.length,l=0;for(const c of v){const g=await c;if(!g.ok)throw new Error(`Subtitle Retrieval failed with Status ${g.status}/${g.statusText}...`);++l,this._context.subtitleController.notification(`${u} (${Math.floor(l/f*100)}%)`),h.push({name:u,base64:Je(await g.arrayBuffer())})}return h}async _reportError(e){const t=await this._client(),r=await this._context.settings.getSingle("themeType");return this._prepareShow(),t.updateState({open:!0,isLoading:!1,showSubSelect:!0,error:e,themeType:r})}}class da extends Error{}class Lu{constructor(){A(this,"recording");A(this,"recorder");A(this,"stream");A(this,"blobPromise");A(this,"timeoutId");A(this,"timeoutResolve");this.recording=!1,this.recorder=null,this.stream=null,this.blobPromise=null}startWithTimeout(e,t,r,n=!1){return new Promise(async(s,a)=>{try{if(this.recording){console.error("Already recording, cannot start with timeout."),a("Already recording");return}await this.start(e,n),r(),this.timeoutResolve=s,this.timeoutId=setTimeout(async()=>{this.timeoutId=void 0,s(await this.stop(n))},t)}catch(o){a(o)}})}start(e,t=!1){return new Promise((r,n)=>{if(this.recording){n("Already recording, cannot start");return}try{const s=new MediaRecorder(e),a=[];if(s.ondataavailable=o=>{a.push(o.data)},this.blobPromise=new Promise((o,u)=>{s.onstop=v=>{o(new Blob(a))}}),s.start(),!t){const o=new AudioContext;o.createMediaStreamSource(e).connect(o.destination)}this.recorder=s,this.recording=!0,this.stream=e,r(void 0)}catch(s){n(s)}})}async stopSafely(e=!1){var t,r,n,s;if(this.recording=!1,(t=this.recorder)==null||t.stop(),this.recorder=null,e||((n=(r=this.stream)==null?void 0:r.getTracks())==null||n.forEach(a=>a.stop()),this.stream=null),this.blobPromise!==null){const a=await this.blobPromise;this.blobPromise=null;const o=await Je(await a.arrayBuffer());this.timeoutId!==void 0&&(clearTimeout(this.timeoutId),this.timeoutId=void 0,(s=this.timeoutResolve)==null||s.call(this,o),this.timeoutResolve=void 0)}}async stop(e=!1){var n,s,a,o;if(!this.recording)throw new Error("Not recording, unable to stop");this.recording=!1,(n=this.recorder)==null||n.stop(),this.recorder=null,e||((a=(s=this.stream)==null?void 0:s.getTracks())==null||a.forEach(u=>u.stop()),this.stream=null);const t=await this.blobPromise;this.blobPromise=null;const r=await Je(await t.arrayBuffer());if(this.timeoutId!==void 0)throw clearTimeout(this.timeoutId),this.timeoutId=void 0,(o=this.timeoutResolve)==null||o.call(this,r),this.timeoutResolve=void 0,new da;return r}}const Iu=navigator.userAgent.toLowerCase().includes("android")??((_a=navigator.userAgentData)==null?void 0:_a.mobile)??!1;let Jt;const Xt={},Nu=async i=>{if(Jt){if(await Jt,!(i in Xt)){const r=await qe(i);le.addResourceBundle(r.lang,"translation",r.strings),Xt[i]=r.lang}const t=Xt[i];le.language!==t&&le.changeLanguage(t);return}Jt=new Promise(async(e,t)=>{try{const r=await qe(i);le.init({resources:{[r.lang]:{translation:r.strings}},lng:r.lang,fallbackLng:r.lang,debug:!1,ns:"translation",defaultNS:"translation",interpolation:{escapeValue:!1}}),Xt[i]=r.lang,e()}catch(r){t(r)}}),await Jt};class Mu{constructor(){A(this,"_keyBinder");A(this,"_unbindPlay",!1);A(this,"_unbindAutoPause",!1);A(this,"_unbindCondensedPlayback",!1);A(this,"_unbindFastForwardPlayback",!1);A(this,"_unbindSeekToSubtitle",!1);A(this,"_unbindSeekToBeginningOfCurrentSubtitle",!1);A(this,"_unbindSeekBackwardOrForward",!1);A(this,"_unbindToggleSubtitles",!1);A(this,"_unbindToggleSubtitleTrackInVideo",!1);A(this,"_unbindToggleSubtitleTrackInList",!1);A(this,"_unbindUnblurTrack",!1);A(this,"_unbindOffsetToSubtitle",!1);A(this,"_unbindAdjustOffset",!1);A(this,"_unbindResetOffset",!1);A(this,"_unbindAdjustPlaybackRate",!1);A(this,"_unbindToggleRepeat",!1);A(this,"_bound");this._bound=!1}setKeyBindSet(e,t){this._keyBinder=new yi(t),this.unbind(),this.bind(e)}bind(e){this._keyBinder&&(this._bound&&this.unbind(),this._unbindPlay=this._keyBinder.bindPlay(t=>{t.preventDefault(),t.stopImmediatePropagation(),e.video.paused?e.play():e.pause()},()=>!e.synced,!0),this._unbindAutoPause=this._keyBinder.bindAutoPause(t=>{t.preventDefault(),t.stopImmediatePropagation(),e.playMode=e.playMode===te.autoPause?te.normal:te.autoPause},()=>e.subtitleController.subtitles.length===0,!0),this._unbindCondensedPlayback=this._keyBinder.bindCondensedPlayback(t=>{t.preventDefault(),t.stopImmediatePropagation(),e.playMode=e.playMode===te.condensed?te.normal:te.condensed},()=>e.subtitleController.subtitles.length===0,!0),this._unbindToggleRepeat=this._keyBinder.bindToggleRepeat(t=>{t.preventDefault(),t.stopImmediatePropagation();const[r]=e.subtitleController.currentSubtitle();r&&(e.playMode=e.playMode===te.repeat?te.normal:te.repeat)},()=>e.subtitleController.subtitles.length===0,!0),this._unbindFastForwardPlayback=this._keyBinder.bindFastForwardPlayback(t=>{t.preventDefault(),t.stopImmediatePropagation(),e.playMode=e.playMode===te.fastForward?te.normal:te.fastForward},()=>e.subtitleController.subtitles.length===0,!0),this._unbindSeekToSubtitle=this._keyBinder.bindSeekToSubtitle((t,r)=>{t.preventDefault(),t.stopImmediatePropagation(),e.seek(r.start/1e3)},()=>e.subtitleController.subtitles.length===0,()=>e.video.currentTime*1e3,()=>e.subtitleController.subtitles,!0),this._unbindSeekBackwardOrForward=this._keyBinder.bindSeekBackwardOrForward((t,r)=>{t.preventDefault(),t.stopImmediatePropagation(),r?e.seek(Math.min(e.video.duration,e.video.currentTime+10)):e.seek(Math.max(0,e.video.currentTime-10))},()=>!e.synced,!0),this._unbindSeekToBeginningOfCurrentSubtitle=this._keyBinder.bindSeekToBeginningOfCurrentSubtitle((t,r)=>{t.preventDefault(),t.stopImmediatePropagation(),e.seek(r.start/1e3),e.alwaysPlayOnSubtitleRepeat&&e.play()},()=>e.subtitleController.subtitles.length===0,()=>e.video.currentTime*1e3,()=>e.subtitleController.subtitles,!0),this._unbindToggleSubtitles=this._keyBinder.bindToggleSubtitles(t=>{t.preventDefault(),t.stopImmediatePropagation();const r={sender:"asbplayer-video",message:{command:"toggle-subtitles"},src:e.video.src};W.runtime.sendMessage(r)},()=>e.subtitleController.subtitles.length===0,!0),this._unbindToggleSubtitleTrackInVideo=this._keyBinder.bindToggleSubtitleTrackInVideo((t,r)=>{t.preventDefault(),t.stopImmediatePropagation(),e.subtitleController.disabledSubtitleTracks[r]=!e.subtitleController.disabledSubtitleTracks[r]},()=>e.subtitleController.subtitles.length===0,!0),this._unbindUnblurTrack=this._keyBinder.bindUnblurTrack((t,r)=>{t.preventDefault(),t.stopImmediatePropagation(),e.subtitleController.unblur(r)},()=>e.subtitleController.subtitles.length===0,!0),this._unbindToggleSubtitleTrackInList=this._keyBinder.bindToggleSubtitleTrackInList((t,r)=>{t.preventDefault(),t.stopImmediatePropagation();const n={sender:"asbplayer-video",message:{command:"toggleSubtitleTrackInList",track:r},src:e.video.src};W.runtime.sendMessage(n)},()=>e.subtitleController.subtitles.length===0,!0),this._unbindOffsetToSubtitle=this._keyBinder.bindOffsetToSubtitle((t,r)=>{t.preventDefault(),t.stopImmediatePropagation(),e.subtitleController.offset(r)},()=>e.subtitleController.subtitles.length===0,()=>e.video.currentTime*1e3,()=>e.subtitleController.subtitles,!0),this._unbindAdjustOffset=this._keyBinder.bindAdjustOffset((t,r)=>{t.preventDefault(),t.stopImmediatePropagation(),e.subtitleController.offset(r)},()=>e.subtitleController.subtitles.length===0,()=>e.subtitleController.subtitles,!0),this._unbindResetOffset=this._keyBinder.bindResetOffet(t=>{t.preventDefault(),t.stopImmediatePropagation(),e.subtitleController.offset(0)},()=>e.subtitleController.subtitles.length===0,!0),this._unbindAdjustPlaybackRate=this._keyBinder.bindAdjustPlaybackRate((t,r)=>{t.preventDefault(),t.stopImmediatePropagation();const n=e.video.playbackRate,s=e.speedChangeStep*10;e.playMode=te.normal,r?e.video.playbackRate=Math.min(5,Math.round(n*10+s)/10):e.video.playbackRate=Math.max(.1,Math.round(n*10-s)/10)},()=>!e.synced,!0),this._bound=!0)}unbind(){this._unbindPlay&&(this._unbindPlay(),this._unbindPlay=!1),this._unbindAutoPause&&(this._unbindAutoPause(),this._unbindAutoPause=!1),this._unbindCondensedPlayback&&(this._unbindCondensedPlayback(),this._unbindCondensedPlayback=!1),this._unbindFastForwardPlayback&&(this._unbindFastForwardPlayback(),this._unbindFastForwardPlayback=!1),this._unbindSeekToSubtitle&&(this._unbindSeekToSubtitle(),this._unbindSeekToSubtitle=!1),this._unbindSeekToBeginningOfCurrentSubtitle&&(this._unbindSeekToBeginningOfCurrentSubtitle(),this._unbindSeekToBeginningOfCurrentSubtitle=!1),this._unbindSeekBackwardOrForward&&(this._unbindSeekBackwardOrForward(),this._unbindSeekBackwardOrForward=!1),this._unbindToggleSubtitles&&(this._unbindToggleSubtitles(),this._unbindToggleSubtitles=!1),this._unbindToggleSubtitleTrackInVideo&&(this._unbindToggleSubtitleTrackInVideo(),this._unbindToggleSubtitleTrackInVideo=!1),this._unbindToggleSubtitleTrackInList&&(this._unbindToggleSubtitleTrackInList(),this._unbindToggleSubtitleTrackInList=!1),this._unbindUnblurTrack&&(this._unbindUnblurTrack(),this._unbindUnblurTrack=!1),this._unbindOffsetToSubtitle&&(this._unbindOffsetToSubtitle(),this._unbindOffsetToSubtitle=!1),this._unbindAdjustOffset&&(this._unbindAdjustOffset(),this._unbindAdjustOffset=!1),this._unbindResetOffset&&(this._unbindResetOffset(),this._unbindResetOffset=!1),this._unbindToggleRepeat&&(this._unbindToggleRepeat(),this._unbindToggleRepeat=!1),this._unbindAdjustPlaybackRate&&(this._unbindAdjustPlaybackRate(),this._unbindAdjustPlaybackRate=!1),this._bound=!1}}const Un="shouldShowUpdateAlert",$u="lastUpdateAlertVersion",Bu=async()=>{const i=await W.storage.local.get({[Un]:!1}),e=i?i[Un]:!1;return e&&(await W.storage.local.remove(Un),await W.storage.local.set({[$u]:W.runtime.getManifest().version})),e},Uu=async()=>{const i=await(await fetch(W.runtime.getURL("/pgs-parser-worker.js"))).text(),e=new Blob([i],{type:"application/javascript"});return new Worker(URL.createObjectURL(e))};let Yt=!1;document.addEventListener("asbplayer-netflix-enabled",i=>{Yt=i.detail}),document.dispatchEvent(new CustomEvent("asbplayer-query-netflix"));const ju=/(m|www)\.youtube\.com/.test(window.location.host),ha=i=>{let e;return i.name==="NS_ERROR_FAILURE"?e=pr.drmProtected:(console.error(i),e=pr.other),{started:!1,error:{code:e,message:i.message}}};class Du{constructor(e,t,r){A(this,"subscribed",!1);A(this,"ankiUiSavedState");A(this,"alwaysPlayOnSubtitleRepeat");A(this,"_synced");A(this,"_syncedTimestamp");A(this,"recordingState",2);A(this,"recordingPostMineAction");A(this,"wasPlayingBeforeRecordingMedia");A(this,"postMinePlayback",Ee.remember);A(this,"recordingMediaStartedTimestamp");A(this,"recordingMediaWithScreenshot");A(this,"pausedDueToHover",!1);A(this,"_playMode",te.normal);A(this,"_speedChangeStep",.1);A(this,"video");A(this,"hasPageScript");A(this,"subtitleController");A(this,"videoDataSyncController");A(this,"controlsController");A(this,"dragController");A(this,"ankiUiController");A(this,"notificationController");A(this,"mobileVideoOverlayController");A(this,"mobileGestureController");A(this,"keyBindings");A(this,"settings");A(this,"_audioRecorder",new Lu);A(this,"copyToClipboardOnMine");A(this,"takeScreenshot");A(this,"cleanScreenshot");A(this,"audioPaddingStart");A(this,"audioPaddingEnd");A(this,"maxImageWidth");A(this,"maxImageHeight");A(this,"autoPausePreference");A(this,"condensedPlaybackMinimumSkipIntervalMs",1e3);A(this,"fastForwardPlaybackMinimumGapMs",600);A(this,"fastForwardModePlaybackRate",2.7);A(this,"imageDelay",0);A(this,"pauseOnHoverMode",Et.disabled);A(this,"recordMedia");A(this,"playListener");A(this,"pauseListener");A(this,"seekedListener");A(this,"playbackRateListener");A(this,"videoChangeListener");A(this,"canPlayListener");A(this,"mouseMoveListener");A(this,"listener");A(this,"heartbeatInterval");A(this,"audioStream");A(this,"currentAudioRecordingRequestId");A(this,"frameId");this.video=e,this.hasPageScript=t,this.settings=new ut(new ft),this.subtitleController=new ku(e,this.settings),this.videoDataSyncController=new Ru(this,this.settings),this.controlsController=new Ul(e),this.dragController=new Dl(e),this.keyBindings=new Mu,this.ankiUiController=new Bl,this.notificationController=new ql(this),this.mobileVideoOverlayController=new Ye(this,ve.top),this.subtitleController.onOffsetChange=()=>this.mobileVideoOverlayController.updateModel(),this.mobileGestureController=new Hl(this),this.recordMedia=!0,this.takeScreenshot=!0,this.cleanScreenshot=!0,this.audioPaddingStart=0,this.audioPaddingEnd=500,this.maxImageWidth=0,this.maxImageHeight=0,this.autoPausePreference=st.atEnd,this.copyToClipboardOnMine=!1,this.alwaysPlayOnSubtitleRepeat=!0,this.postMinePlayback=Ee.remember,this._synced=!1,this.recordingMediaWithScreenshot=!1,this.frameId=r}get recordingMedia(){return this.recordingState!==2}get synced(){return this._synced}get speedChangeStep(){return this._speedChangeStep}get playMode(){return this._playMode}set playMode(e){if(this._playMode===e)return;switch(this._playMode){case te.autoPause:this.subtitleController.autoPauseContext.onStartedShowing=void 0,this.subtitleController.autoPauseContext.onWillStopShowing=void 0;break;case te.condensed:this.subtitleController.onNextToShow=void 0;break;case te.fastForward:this.subtitleController.onSlice=void 0,this.video.playbackRate=1;break;case te.repeat:this.subtitleController.autoPauseContext.onWillStopShowing=void 0;break}let t=!1;switch(e){case te.autoPause:this.subtitleController.autoPauseContext.onStartedShowing=()=>{this.recordingMedia||this.autoPausePreference!==st.atStart||this.pause()},this.subtitleController.autoPauseContext.onWillStopShowing=()=>{this.recordingMedia||this.autoPausePreference!==st.atEnd||this.pause()},this.subtitleController.notification("info.enabledAutoPause"),t=!0;break;case te.condensed:let r=!1;this.subtitleController.onNextToShow=async s=>{try{if(this.recordingMedia||r||this.video.paused||s.start-this.video.currentTime*1e3<=this.condensedPlaybackMinimumSkipIntervalMs)return;r=!0,this.seek(s.start/1e3),await this.play(),r=!1}finally{r=!1}},this.subtitleController.notification("info.enabledCondensedPlayback"),t=!0;break;case te.fastForward:this.subtitleController.onSlice=async s=>{const a=o=>o&&Math.abs(o-this.video.currentTime*1e3)>this.fastForwardPlaybackMinimumGapMs;s.showing.length===0&&a(Math.max.apply(void 0,((s==null?void 0:s.lastShown)||[]).map(o=>o.end)))&&a(Math.min.apply(void 0,((s==null?void 0:s.nextToShow)||[]).map(o=>o.start)))?this.video.playbackRate=this.fastForwardModePlaybackRate:this.video.playbackRate=1},this.subtitleController.notification("info.enabledFastForwardPlayback"),t=!0;break;case te.repeat:const[n]=this.subtitleController.currentSubtitle();n&&(this.subtitleController.autoPauseContext.onWillStopShowing=()=>{this.seek(n.start/1e3)},this.subtitleController.notification("info.enabledRepeatPlayback"),t=!0);break;case te.normal:this._playMode===te.repeat?this.subtitleController.notification("info.disabledRepeatPlayback"):this._playMode===te.autoPause?this.subtitleController.notification("info.disabledAutoPause"):this._playMode===te.condensed?this.subtitleController.notification("info.disabledCondensedPlayback"):this._playMode===te.fastForward&&this.subtitleController.notification("info.disabledFastForwardPlayback"),t=!0;break;default:console.error("Unknown play mode "+e)}t&&(this._playMode=e,this.mobileVideoOverlayController.updateModel())}subtitleFileName(e=0){var t;return((t=this.subtitleController.subtitleFileNames)==null?void 0:t[e])??""}get _imageCaptureParams(){const e=this.video.getBoundingClientRect();return{maxWidth:this.maxImageWidth,maxHeight:this.maxImageHeight,rect:{left:e.left,top:e.top,width:e.width,height:e.height},frameId:this.frameId}}get _shouldAutoResumeOnSubtitlesMouseOut(){return this.pauseOnHoverMode===Et.inAndOut&&this.pausedDueToHover&&this.video.paused}bind(){let e=!1;this.video.readyState===4?(this._bind(),e=!0):(this.canPlayListener=t=>{e||(this._bind(),e=!0);const r={sender:"asbplayer-video",message:{command:"readyState",value:4},src:this.video.src};W.runtime.sendMessage(r)},this.video.addEventListener("canplay",this.canPlayListener))}_bind(){this._notifyReady(),this._subscribe(),this._refreshSettings().then(()=>{this.videoDataSyncController.requestSubtitles()}),this.subtitleController.bind(),this.dragController.bind(this),this.mobileGestureController.bind();const e=t=>{const r=lt(t,this.video.currentTime*1e3,this.subtitleController.subtitles);r!==null&&this.seek(r.start/1e3)};this.mobileGestureController.onSwipeLeft=()=>e(!1),this.mobileGestureController.onSwipeRight=()=>e(!0)}_notifyReady(){const e={sender:"asbplayer-video",message:{command:"ready",duration:this.video.duration,currentTime:this.video.currentTime,paused:this.video.paused,audioTracks:void 0,selectedAudioTrack:void 0,playbackRate:this.video.playbackRate},src:this.video.src};W.runtime.sendMessage(e)}_subscribe(){this.playListener=e=>{const t={sender:"asbplayer-video",message:{command:"play",echo:!1},src:this.video.src};W.runtime.sendMessage(t),this.pausedDueToHover=!1},this.pauseListener=e=>{const t={sender:"asbplayer-video",message:{command:"pause",echo:!1},src:this.video.src};W.runtime.sendMessage(t),this.recordingMedia&&this.recordingPostMineAction!==void 0&&this._toggleRecordingMedia(this.recordingPostMineAction)},this.seekedListener=e=>{const t={sender:"asbplayer-video",message:{command:"currentTime",value:this.video.currentTime,echo:!1},src:this.video.src},r={sender:"asbplayer-video",message:{command:"readyState",value:this.video.readyState},src:this.video.src};W.runtime.sendMessage(t),W.runtime.sendMessage(r),this.subtitleController.autoPauseContext.clear()},this.playbackRateListener=e=>{const t={sender:"asbplayer-video",message:{command:"playbackRate",value:this.video.playbackRate,echo:!1},src:this.video.src};W.runtime.sendMessage(t),this._synced&&this._playMode!==te.fastForward&&this.subtitleController.notification("info.playbackRate",{rate:this.video.playbackRate.toFixed(1)}),this.mobileVideoOverlayController.updateModel()},this.video.addEventListener("play",this.playListener),this.video.addEventListener("pause",this.pauseListener),this.video.addEventListener("seeked",this.seekedListener),this.video.addEventListener("ratechange",this.playbackRateListener),this.subtitleController.onMouseOver=()=>{this.pauseOnHoverMode!==Et.disabled&&!this.video.paused&&(this.video.pause(),this.pausedDueToHover=!0,this.mouseMoveListener&&(document.removeEventListener("mousemove",this.mouseMoveListener),this.mouseMoveListener=void 0),this.mouseMoveListener=e=>{this._shouldAutoResumeOnSubtitlesMouseOut&&!this.subtitleController.intersects(e.clientX,e.clientY)&&(this.play(),this.pausedDueToHover=!1)},document.addEventListener("mousemove",this.mouseMoveListener))},this.hasPageScript&&(this.videoChangeListener=()=>{this.videoDataSyncController.requestSubtitles(),this._resetSubtitles()},this.video.addEventListener("loadedmetadata",this.videoChangeListener)),this.heartbeatInterval=setInterval(()=>{const e={sender:"asbplayer-video",message:{command:"heartbeat",subscribed:this.subscribed,synced:this._synced,syncedTimestamp:this._syncedTimestamp,loadedSubtitles:this.subtitleController.subtitles.length>0},src:this.video.src};W.runtime.sendMessage(e)},1e3),window.addEventListener("beforeunload",e=>{this.heartbeatInterval&&clearInterval(this.heartbeatInterval)}),this.listener=(e,t,r)=>{if(e.sender==="asbplayer-extension-to-video"&&e.src===this.video.src){switch(e.message.command){case"init":this._notifyReady();break;case"ready":break;case"play":this.play();break;case"pause":this.pause();break;case"currentTime":const n=e.message;this.seek(n.value);break;case"close":break;case"subtitles":const s=e.message,a=s.value;this._updateSubtitles(a.map((b,x)=>({...b,index:x})),s.names||[s.name]);break;case"request-subtitles":r({subtitles:this.subtitleController.subtitles,subtitleFileNames:this.subtitleController.subtitleFileNames??[]});break;case"offset":const o=e.message;this.subtitleController.offset(o.value,!o.echo);break;case"playbackRate":const u=e.message;this.video.playbackRate=u.value;break;case"subtitleSettings":break;case"ankiSettings":break;case"miscSettings":break;case"settings-updated":this._refreshSettings();break;case"copy-subtitle":const v=e.message;if(this._synced){if(v.subtitle!==void 0&&v.surroundingSubtitles!==void 0)this._copySubtitle(v);else if(this.subtitleController.subtitles.length>0){const[b,x]=this.subtitleController.currentSubtitle();b!==null&&x!==null&&this._copySubtitle({...v,subtitle:b,surroundingSubtitles:x})}else this._toggleRecordingMedia(v.postMineAction);this.mobileVideoOverlayController.updateModel()}break;case"toggle-recording":this._synced&&(this._toggleRecordingMedia(ar.showAnkiDialog),this.mobileVideoOverlayController.updateModel());break;case"card-updated":case"card-exported":case"card-saved":const h=e.message;let f;switch(h.command){case"card-updated":f="info.updatedCard";break;case"card-exported":f="info.exportedCard";break;case"card-saved":f="info.copiedSubtitle2";break}this.subtitleController.notification(f,{result:e.message.cardName}),this.ankiUiSavedState={...h,text:h.text??"",definition:h.definition??"",word:h.word??h.cardName,source:hr(this.subtitleFileName(),h.subtitle.start),url:h.url??"",customFieldValues:h.customFieldValues??{},timestampInterval:[h.subtitle.start,h.subtitle.end],initialTimestampInterval:[h.subtitle.start,h.subtitle.end],lastAppliedTimestampIntervalToText:[h.subtitle.start,h.subtitle.end],lastAppliedTimestampIntervalToAudio:[h.subtitle.start,h.subtitle.end],dialogRequestedTimestamp:this.video.currentTime*1e3},this.mobileVideoOverlayController.updateModel();break;case"notify-error":const l=e.message;this.subtitleController.notification("info.error",{message:l.message});break;case"recording-started":this.recordingState=1;break;case"recording-finished":switch(this.recordingState=2,this.recordingMediaStartedTimestamp=void 0,this.postMinePlayback){case Ee.remember:this.wasPlayingBeforeRecordingMedia?this.video.paused||this.mobileVideoOverlayController.hide():this.video.pause();break;case Ee.play:this.mobileVideoOverlayController.hide();break;case Ee.pause:this.video.pause();break}break;case"show-anki-ui":const d=e.message;this.ankiUiController.show(this,d);break;case"show-anki-ui-after-rerecord":const m=e.message;this.ankiUiController.showAfterRerecord(this,m.uiState);break;case"take-screenshot":this._synced&&(this.ankiUiController.showing?this.ankiUiController.requestRewind(this):this._takeScreenshot());break;case"screenshot-taken":const c=e.message;this.subtitleController.forceHideSubtitles=!1,this.mobileVideoOverlayController.forceHide=!1,this.controlsController.show(),!this.recordingMedia&&c.ankiUiState&&this.ankiUiController.showAfterRetakingScreenshot(this,c.ankiUiState);break;case"alert":break;case"request-active-tab-permission":this.notificationController.onClose=()=>{this._notifyRequestingActiveTabPermission(!1)},this.notificationController.show("activeTabPermissionRequest.title","activeTabPermissionRequest.prompt"),this._notifyRequestingActiveTabPermission(!0);break;case"granted-active-tab-permission":this.notificationController.showing&&this.notificationController.show("activeTabPermissionRequest.grantedTitle","activeTabPermissionRequest.grantedPrompt");break;case"load-subtitles":this.showVideoDataDialog(!1);break;case"start-recording-audio-with-timeout":const g=e.message;return this._captureStream().then(b=>this._audioRecorder.stopSafely(!0).then(()=>this._audioRecorder.startWithTimeout(b,g.timeout,()=>r({started:!0}),!0))).then(b=>this._sendAudioBase64(b,g.requestId,g.encodeAsMp3)).catch(b=>{r(ha(b))}),!0;case"start-recording-audio":return this.currentAudioRecordingRequestId=e.message.requestId,this._captureStream().then(b=>this._audioRecorder.stopSafely(!0).then(()=>this._audioRecorder.start(b,!0))).then(()=>r({started:!0})).catch(b=>{r(ha(b))}),!0;case"stop-recording-audio":const p=e.message;return this._audioRecorder.stop(!0).then(b=>{r({stopped:!0}),this._sendAudioBase64(b,this.currentAudioRecordingRequestId,p.encodeAsMp3)}).catch(b=>{let x;b instanceof da?x=gr.timedAudioRecordingInProgress:(console.error(b),x=gr.other);const S={stopped:!1,error:{code:x,message:b.message}};r(S)}),!0;case"notification-dialog":const y=e.message;this.notificationController.show(y.titleLocKey,y.messageLocKey);break}if("messageId"in e.message){const n={sender:"asbplayer-video",message:{command:"ack-message",messageId:e.message.messageId},src:this.video.src};W.runtime.sendMessage(n)}}},W.runtime.onMessage.addListener(this.listener),this.subscribed=!0}async _refreshSettings(){const e=await this.settings.getAll();this._speedChangeStep=e.speedChangeStep,this.recordMedia=e.streamingRecordMedia,this.takeScreenshot=e.streamingTakeScreenshot,this.cleanScreenshot=e.streamingTakeScreenshot&&e.streamingCleanScreenshot,this.condensedPlaybackMinimumSkipIntervalMs=e.streamingCondensedPlaybackMinimumSkipIntervalMs,this.fastForwardModePlaybackRate=e.fastForwardModePlaybackRate,this.imageDelay=e.streamingScreenshotDelay,this.audioPaddingStart=e.audioPaddingStart,this.audioPaddingEnd=e.audioPaddingEnd,this.maxImageWidth=e.maxImageWidth,this.maxImageHeight=e.maxImageHeight,this.copyToClipboardOnMine=e.copyToClipboardOnMine,this.autoPausePreference=e.autoPausePreference,this.alwaysPlayOnSubtitleRepeat=e.alwaysPlayOnSubtitleRepeat,this.pauseOnHoverMode=e.pauseOnHoverMode,this.subtitleController.displaySubtitles=e.streamingDisplaySubtitles,this.subtitleController.bottomSubtitlePositionOffset=e.subtitlePositionOffset,this.subtitleController.topSubtitlePositionOffset=e.topSubtitlePositionOffset,this.subtitleController.subtitlesWidth=e.subtitlesWidth,this.subtitleController.surroundingSubtitlesCountRadius=e.surroundingSubtitlesCountRadius,this.subtitleController.surroundingSubtitlesTimeRadius=e.surroundingSubtitlesTimeRadius,this.subtitleController.autoCopyCurrentSubtitle=e.autoCopyCurrentSubtitle,this.subtitleController.setSubtitleSettings(e),this.subtitleController.refresh(),this.videoDataSyncController.updateSettings(e),this.ankiUiController.updateSettings({...ho(e),themeType:e.themeType,lastSelectedAnkiExportMode:e.lastSelectedAnkiExportMode},this.settings),this.postMinePlayback=e.postMiningPlaybackState,this.keyBindings.setKeyBindSet(this,e.keyBindSet),e.streamingSubsDragAndDrop?this.dragController.bind(this):this.dragController.unbind(),e.streamingEnableOverlay?(this.mobileVideoOverlayController.offsetAnchor=e.subtitleAlignment==="bottom"?ve.top:ve.bottom,this.mobileVideoOverlayController.bind(),this.mobileVideoOverlayController.updateModel()):this.mobileVideoOverlayController.unbind(),await Nu(e.language)}unbind(){this.canPlayListener&&(this.video.removeEventListener("canplay",this.canPlayListener),this.canPlayListener=void 0),this.playListener&&(this.video.removeEventListener("play",this.playListener),this.playListener=void 0),this.pauseListener&&(this.video.removeEventListener("pause",this.pauseListener),this.pauseListener=void 0),this.seekedListener&&(this.video.removeEventListener("seeked",this.seekedListener),this.seekedListener=void 0),this.playbackRateListener&&(this.video.removeEventListener("ratechange",this.playbackRateListener),this.playbackRateListener=void 0),this.videoChangeListener&&(this.video.removeEventListener("loadedmetadata",this.videoChangeListener),this.videoChangeListener=void 0),this.mouseMoveListener&&(document.removeEventListener("mousemove",this.mouseMoveListener),this.mouseMoveListener=void 0),this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=void 0),this.listener&&(W.runtime.onMessage.removeListener(this.listener),this.listener=void 0),this.subtitleController.unbind(),this.dragController.unbind(),this.keyBindings.unbind(),this.videoDataSyncController.unbind(),this.mobileVideoOverlayController.unbind(),this.mobileGestureController.unbind(),this.notificationController.unbind(),this.subscribed=!1;const e={sender:"asbplayer-video",message:{command:"video-disappeared"},src:this.video.src};W.runtime.sendMessage(e)}async _takeScreenshot(){if(!this.takeScreenshot)return;await this._prepareScreenshot();const e={sender:"asbplayer-video",message:{command:"take-screenshot",ankiUiState:this.ankiUiSavedState,...this._imageCaptureParams,subtitleFileName:this.subtitleFileName(),mediaTimestamp:this.video.currentTime*1e3},src:this.video.src};W.runtime.sendMessage(e),this.ankiUiSavedState=void 0}async _copySubtitle({postMineAction:e,subtitle:t,surroundingSubtitles:r,text:n,definition:s,word:a,customFieldValues:o}){if(!t||!r||this.recordMedia&&this.recordingMedia)return;if(this.copyToClipboardOnMine&&navigator.clipboard.writeText(t.text),this.takeScreenshot&&await this._prepareScreenshot(),this.recordMedia){this.recordingState=0,this.recordingPostMineAction=e,this.wasPlayingBeforeRecordingMedia=!this.video.paused,this.recordingMediaStartedTimestamp=this.video.currentTime*1e3,this.recordingMediaWithScreenshot=this.takeScreenshot;const v=Math.max(0,t.start-this.audioPaddingStart);this.seek(v/1e3),await this.play()}(!n||t.text.includes(n.trim()))&&(n=za(t,r));const u={sender:"asbplayer-video",message:{command:"record-media-and-forward-subtitle",subtitle:t,surroundingSubtitles:r,record:this.recordMedia,screenshot:this.takeScreenshot,url:this.url(t.start,t.end),mediaTimestamp:this.video.currentTime*1e3,subtitleFileName:this.subtitleFileName(t.track),postMineAction:e,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,imageDelay:this.imageDelay,playbackRate:this.video.playbackRate,text:n,definition:s,word:a,customFieldValues:o,...this._imageCaptureParams},src:this.video.src};W.runtime.sendMessage(u)}async _toggleRecordingMedia(e){if(this.recordingState!==0)if(this.recordingState===1){const t=this.video.currentTime*1e3,r={sender:"asbplayer-video",message:{command:"stop-recording-media",postMineAction:e,startTimestamp:this.recordingMediaStartedTimestamp,endTimestamp:t,playbackRate:this.video.playbackRate,screenshot:this.recordingMediaWithScreenshot,videoDuration:this.video.duration*1e3,url:this.url(this.recordingMediaStartedTimestamp,t),subtitleFileName:this.subtitleFileName(),...this._imageCaptureParams,...this._surroundingSubtitlesAroundInterval(this.recordingMediaStartedTimestamp,t)},src:this.video.src};W.runtime.sendMessage(r)}else{this.ankiUiSavedState=void 0,this.takeScreenshot&&await this._prepareScreenshot();const t=this.video.currentTime*1e3;this.recordMedia&&(this.recordingState=0,this.wasPlayingBeforeRecordingMedia=!this.video.paused,this.recordingMediaStartedTimestamp=t,this.recordingMediaWithScreenshot=this.takeScreenshot,this.recordingPostMineAction=e,this.video.paused&&await this.play());const r={sender:"asbplayer-video",message:{command:"start-recording-media",mediaTimestamp:t,record:this.recordMedia,postMineAction:e,screenshot:this.takeScreenshot,url:this.url(t),subtitleFileName:this.subtitleFileName(),imageDelay:this.imageDelay,...this._imageCaptureParams},src:this.video.src};W.runtime.sendMessage(r)}}_surroundingSubtitlesAroundInterval(e,t){return Da(this.subtitleController.subtitles,e,t,this.ankiUiController.settings.surroundingSubtitlesCountRadius,this.ankiUiController.settings.surroundingSubtitlesTimeRadius)}async _prepareScreenshot(){this.cleanScreenshot&&(this.notificationController.hide(),this.subtitleController.forceHideSubtitles=!0,this.mobileVideoOverlayController.forceHide=!0,await this.controlsController.hide())}async rerecord(e,t,r){if(this.recordingMedia)return;const n=this.subtitleController.subtitles.length===0,s=n?0:this.audioPaddingStart,a=n?0:this.audioPaddingEnd;this.recordingState=0,this.recordingMediaStartedTimestamp=this.video.currentTime*1e3,this.seek(Math.max(0,e-s)/1e3),await this.play();const o={sender:"asbplayer-video",message:{command:"rerecord-media",duration:t-e,uiState:r,audioPaddingStart:s,audioPaddingEnd:a,playbackRate:this.video.playbackRate,timestamp:e,subtitleFileName:this.subtitleFileName()},src:this.video.src};W.runtime.sendMessage(o)}seek(e){Yt?document.dispatchEvent(new CustomEvent("asbplayer-netflix-seek",{detail:e*1e3})):Ja(this.video,e)}async play(){if(Yt){await this._playNetflix();return}try{await this.video.play()}catch{if(this.video.readyState!==4)return new Promise((t,r)=>{const n=async s=>{let a=3;for(let o=0;o<a;++o)try{await this.video.play();break}catch(u){console.error(u)}t(void 0),this.video.removeEventListener("canplay",n)};this.video.addEventListener("canplay",n)})}}_playNetflix(){return new Promise((e,t)=>{const r=async n=>{this.video.removeEventListener("play",r),this.video.removeEventListener("playing",r),e(void 0)};this.video.addEventListener("play",r),this.video.addEventListener("playing",r),document.dispatchEvent(new CustomEvent("asbplayer-netflix-play"))})}pause(){if(Yt){document.dispatchEvent(new CustomEvent("asbplayer-netflix-pause"));return}this.video.pause()}showVideoDataDialog(e,t){this.videoDataSyncController.show({reason:e?St.miningCommand:St.userRequested,fromAsbplayerId:t})}async cropAndResize(e){const t=this.video.getBoundingClientRect(),r=this.maxImageWidth,n=this.maxImageHeight;return await ti(r,n,t,e)}async loadSubtitles(e,t,r){const{streamingSubtitleListPreference:n,subtitleRegexFilter:s,subtitleRegexFilterTextReplacement:a,rememberSubtitleOffset:o,lastSubtitleOffset:u,subtitleHtml:v}=await this.settings.get(["streamingSubtitleListPreference","subtitleRegexFilter","subtitleRegexFilterTextReplacement","rememberSubtitleOffset","lastSubtitleOffset","subtitleHtml"]),h=async(f,l)=>{const d={sender:"asbplayer-video",message:{command:"sync",subtitles:await Promise.all(e.map(async m=>{const c=await Je(await m.arrayBuffer());return{name:m.name,base64:c}})),withSyncedAsbplayerOnly:f,withAsbplayerId:l},src:this.video.src};W.runtime.sendMessage(d)};switch(n){case xt.noSubtitleList:const f=new Rl({regexFilter:s,regexFilterTextReplacement:a,subtitleHtml:v,pgsParserWorkerFactory:Uu}),l=o?u:0,d=await f.subtitles(e,t);this._updateSubtitles(d.map((c,g)=>({start:c.start+l,end:c.end+l,text:c.text,textImage:c.textImage,track:c.track,index:g,originalStart:c.start,originalEnd:c.end})),t?[e[0].name]:e.map(c=>c.name)),h(r===void 0,r);break;case xt.app:h(!1,void 0);break}}_updateSubtitles(e,t){this.subtitleController.subtitles=e,this.subtitleController.subtitleFileNames=t,this.subtitleController.cacheHtml(),this._playMode!==te.normal&&(!e||e.length===0)&&(this.playMode=te.normal);let r=[];for(let n=0;n<e.length;n++)r.includes(e[n].track)||r.push(e[n].track);this.subtitleController.showLoadedMessage(r),this.ankiUiSavedState=void 0,this._synced=!0,this._syncedTimestamp=Date.now(),this.video.paused&&this.mobileVideoOverlayController.show(),this.mobileVideoOverlayController.updateModel(),!Iu&&e.length>0&&this.settings.get(["streamingDisplaySubtitles","keyBindSet"]).then(({streamingDisplaySubtitles:n,keyBindSet:s})=>{!n&&s.toggleSubtitles.keys&&this.subtitleController.notification("info.toggleSubtitlesShortcut",{keys:s.toggleSubtitles.keys})}),Bu().then(n=>{n&&this.notificationController.updateAlert(W.runtime.getManifest().version)})}_resetSubtitles(){this.subtitleController.reset(),this.ankiUiSavedState=void 0,this._synced=!1,this._syncedTimestamp=void 0,this.mobileVideoOverlayController.disposeOverlay()}_captureStream(){return new Promise((e,t)=>{const r=this._existingActiveAudioStream();if(r!==void 0){e(r);return}try{let n;if(typeof this.video.captureStream=="function"&&(n=this.video.captureStream()),typeof this.video.mozCaptureStreamUntilEnded=="function"&&(n=this.video.mozCaptureStreamUntilEnded()),n===void 0){t(new Error("Unable to capture stream from audio"));return}const s=new MediaStream;for(const u of n.getVideoTracks())u.stop();for(const u of n.getAudioTracks())u.enabled&&s.addTrack(u);const a=new AudioContext;a.createMediaStreamSource(s).connect(a.destination),this.audioStream=s,e(s)}catch(n){t(n)}})}_existingActiveAudioStream(){if(this.audioStream!==void 0)return this.audioStream.active?this.audioStream:void 0}async _sendAudioBase64(e,t,r){if(r){const s=await(await fetch("data:audio/webm;base64,"+e)).blob(),a=await mr.encode(s,Ln);e=Je(await a.arrayBuffer())}const n={sender:"asbplayer-video",message:{command:"audio-base64",base64:e,requestId:t},src:this.video.src};W.runtime.sendMessage(n)}_notifyRequestingActiveTabPermission(e){const t={sender:"asbplayer-video",message:{command:"requesting-active-tab-permission",requesting:e},src:this.video.src};W.runtime.sendMessage(t)}url(e,t){if(ju){const r=s=>Math.floor(s/1e3),n=new URLSearchParams(window.location.search).get("v");if(n!==null){const s=`https://www.youtube.com/embed/${n}?start=${r(e)}&autoplay=1`;return t===void 0?s:`${s}&end=${r(t)}`}}return window.location!==window.parent.location?document.referrer:document.location.href}}class Vu{constructor(e){A(this,"_bindings");A(this,"_frame");A(this,"_settings",new ut(new ft));A(this,"_subtitleFiles");A(this,"messageListener");this._bindings=e,this._frame=new dt(async t=>`<!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="utf-8" />
                    <meta name="viewport" content="width=device-width, initial-scale=1" />
                    <title>asbplayer - Video Select</title>
                    <style>
                        @import url(${W.runtime.getURL("/fonts/fonts.css")});
                    </style>
                </head>
                <body>
                    <div id="root" style="width:100%;height:100vh;"></div>
                    <script type="application/json" id="loc">${JSON.stringify(await qe(t))}<\/script>
                    <script type="module" src="${W.runtime.getURL("/video-select-ui.js")}"><\/script>
                </body>
            </html>`)}bind(){this.messageListener=(e,t,r)=>{if(e.sender==="asbplayer-extension-to-video")switch(e.message.command){case"toggle-video-select":this._trigger(!1,e.message.fromAsbplayerId,e.src,e.message.subtitleFiles);break;case"copy-subtitle":case"toggle-recording":case"take-screenshot":this._bindings.find(n=>n.synced)===void 0&&this._trigger(!0);break;case"subtitles":this._hideUi();break}},W.runtime.onMessage.addListener(this.messageListener)}unbind(){this._frame.unbind(),this.messageListener&&(W.runtime.onMessage.removeListener(this.messageListener),this.messageListener=void 0)}async _trigger(e,t,r,n){if(r!==void 0){var s=this._bindings.find(a=>a.video.src===r);s!==void 0&&s.subscribed&&(n!==void 0?s.loadSubtitles(await this._filesForSubtitleFiles(n),!1,t):s.showVideoDataDialog(e,t))}else if(this._bindings.length===1){const a=this._bindings[0];a.subscribed&&(n!==void 0?a.loadSubtitles(await this._filesForSubtitleFiles(n),!1):a.showVideoDataDialog(e))}else this._bindings.length>1&&(this._showUi(e),this._subtitleFiles=n)}async _showUi(e){const t={sender:"asbplayer-foreground",message:{command:"capture-visible-tab"}},r=await W.runtime.sendMessage(t),n=this._bindings.map(async u=>({src:u.video.src,imageDataUrl:await u.cropAndResize(r)})),s=[];for(const u of n)s.push(await u);const a=await this._prepareAndShowFrame(),o=await this._settings.getSingle("themeType");a.updateState({open:!0,themeType:o,videoElements:s,openedFromMiningCommand:e})}async _prepareAndShowFrame(){this._frame.language=await this._settings.getSingle("language");const e=await this._frame.bind(),t=await this._frame.client();return e&&t.onMessage(async r=>{if(r.command==="confirm"){t.updateState({open:!1}),this._frame.hide();const n=this._bindings.find(s=>s.video.src===r.selectedVideoElementSrc);n!==void 0&&(this._subtitleFiles===void 0?n.showVideoDataDialog(!1):(n.loadSubtitles(await this._filesForSubtitleFiles(this._subtitleFiles),!1),this._subtitleFiles=void 0))}else if(r.command==="openSettings"){const n={sender:"asbplayer-video-tab",message:{command:"open-asbplayer-settings"}};W.runtime.sendMessage(n)}else r.command==="cancel"&&(t.updateState({open:!1}),this._frame.hide(),this._subtitleFiles=void 0)}),this._frame.show(),t}async _hideUi(){if(this._frame.hidden)return;(await this._frame.client()).updateState({open:!1}),this._frame.hide()}async _filesForSubtitleFiles(e){const t=e.map(async r=>new File([await(await fetch("data:text/plain;base64,"+r.base64)).blob()],r.name));return await Promise.all(t)}}var Qt,Hu=new Uint8Array(16);function zu(){if(!Qt&&(Qt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Qt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qt(Hu)}const qu=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Wu(i){return typeof i=="string"&&qu.test(i)}for(var he=[],jn=0;jn<256;++jn)he.push((jn+256).toString(16).substr(1));function Gu(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(he[i[e+0]]+he[i[e+1]]+he[i[e+2]]+he[i[e+3]]+"-"+he[i[e+4]]+he[i[e+5]]+"-"+he[i[e+6]]+he[i[e+7]]+"-"+he[i[e+8]]+he[i[e+9]]+"-"+he[i[e+10]]+he[i[e+11]]+he[i[e+12]]+he[i[e+13]]+he[i[e+14]]+he[i[e+15]]).toLowerCase();if(!Wu(t))throw TypeError("Stringified UUID is invalid");return t}function Ku(i,e,t){i=i||{};var r=i.random||(i.rng||zu)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Gu(r)}class Zu{constructor(){A(this,"frameId",Ku());A(this,"_broadcastInterval");A(this,"_bound",!1)}bind(){this._bound||(this._broadcastInterval=setInterval(()=>this._broadcast(),1e4),this._broadcast(),this._bound=!0)}_broadcast(){window.parent.postMessage({sender:"asbplayer-video",message:{frameId:this.frameId}},"*")}unbind(){this._broadcastInterval!==void 0&&(clearInterval(this._broadcastInterval),this._broadcastInterval=void 0),this._bound=!1}}class Ju{constructor(){A(this,"iframesById",{});A(this,"_listener");A(this,"_bound",!1)}bind(){this._bound||(this._listener=e=>{var n;if(((n=e.data)==null?void 0:n.sender)!=="asbplayer-video")return;const t=this._sourceIframeForEvent(e);if(t===void 0)return;const r=e.data.message.frameId;r&&(this.iframesById[r]=t)},window.addEventListener("message",this._listener),this._bound=!0)}unbind(){this._listener!==void 0&&(window.removeEventListener("message",this._listener),this._listener=void 0),this._bound=!1}_sourceIframeForEvent(e){const t=document.getElementsByTagName("iframe");for(const r of t)if(r.contentWindow===e.source)return r}}navigator.userAgent.toLowerCase().includes("firefox");const pa=new In;async function Xu(i){return`<!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="utf-8" />
                    <meta name="viewport" content="width=device-width, initial-scale=1" />
                    <title>asbplayer - Anki</title>
                    <style>
                        @import url(${W.runtime.getURL("/fonts/fonts.css")});
                    </style>
                </head>
                <body>
                    <div id="root" style="width:100%;height:100vh;"></div>
                    <script type="application/json" id="loc">${JSON.stringify(await qe(i))}<\/script>
                    <script type="module" src="${W.runtime.getURL("/anki-ui.js")}"><\/script>
                </body>
            </html>`}class Yu{constructor(e){A(this,"_frame");A(this,"_settings");A(this,"_inTutorial",Ut());this._frame=new dt(Xu),this._settings=e}async show(e){var v;const{language:t,...r}=await this._settings.get(["language","themeType","lastSelectedAnkiExportMode",...Er]),n=this._settings.profiles(),s=this._settings.activeProfile(),a=pa.getAll(),o=await this._client(t,r),u={type:"initial",open:!0,canRerecord:!1,settings:r,source:hr(e.subtitleFileName,e.mediaTimestamp??0),dialogRequestedTimestamp:0,...e,profiles:await n,activeProfile:(v=await s)==null?void 0:v.name,ftueHasSeenAnkiDialogQuickSelect:(await a).ftueHasSeenAnkiDialogQuickSelectV2,inTutorial:this._inTutorial};o.updateState(u)}async updateSettings(){const e=await this._settings.get(["themeType","lastSelectedAnkiExportMode",...Er]);this._frame.bound&&this._frame.client().then(async t=>{var a;const r=this._settings.profiles(),n=this._settings.activeProfile(),s={command:"settings",settings:e,profiles:await r,activeProfile:(a=await n)==null?void 0:a.name};t.sendMessage(s)})}async _client(e,t){this._frame.fetchOptions={allowedFetchUrl:t.ankiConnectUrl},this._frame.language=e;const r=await this._frame.bind(),n=await this._frame.client();return r&&n.onMessage(async s=>{switch(s.command){case"openSettings":const a={sender:"asbplayer-video-tab",message:{command:"open-asbplayer-settings"}};W.runtime.sendMessage(a);return;case"copy-to-clipboard":const u={sender:"asbplayer-video-tab",message:{command:"copy-to-clipboard",dataUrl:s.dataUrl}};W.runtime.sendMessage(u);return;case"encode-mp3":const{base64:v,messageId:h,extension:f}=s,l=await mr.encode(await gn(v,`audio/${f}`),Ln);n.sendMessage({messageId:h,base64:await ss(l)});return;case"resume":this._frame.hide();return;case"activeProfile":const d=s;this._settings.setActiveProfile(d.profile).then(()=>{const c={sender:"asbplayer-video-tab",message:{command:"settings-updated"}};W.runtime.sendMessage(c)});return;case"dismissedQuickSelectFtue":pa.set({ftueHasSeenAnkiDialogQuickSelectV2:!0}).catch(console.error);return;case"exported":const m=s;this._settings.set({lastSelectedAnkiExportMode:m.mode}).then(()=>{const c={sender:"asbplayer-video-tab",message:{command:"settings-updated"}};W.runtime.sendMessage(c)});return}}),this._frame.show(),n}unbind(){this._frame.unbind()}}const rt=[],gt=[],Qu=100,ec=()=>{let i=0;for(;i<rt.length;){const e=rt[i];!document.contains(e)||!e.shadowRoot?rt.splice(i,1):++i}},tc=()=>{if(ec(),gt.length===0){if(rt.length>0)return;gt.push(document)}let i=0;for(;gt.length>0&&++i<Qu;){const e=gt.pop();if(!e)continue;e.shadowRoot&&rt.push(e);for(const r of e.childNodes)gt.push(r)}},rc={matches:["<all_urls>"],excludeGlobs:["*://killergerbah.github.io/asbplayer*","*://app.asbplayer.dev/*"],allFrames:!0,runAt:"document_idle",main(i){const e=new ft,t=new ut(e);let r;const n=()=>{t.getSingle("keyBindSet").then(o=>{r==null||r(),r=new yi(o).bindToggleSidePanel(u=>{u.preventDefault(),u.stopImmediatePropagation();const v={sender:"asbplayer-video-tab",message:{command:"toggle-side-panel"}};W.runtime.sendMessage(v)},()=>!1,!0)})},s=(o,u)=>{var v;if((v=u==null?void 0:u.config)!=null&&v.allowBlankSrc||o.src)return!0;for(let h=0,f=o.children.length;h<f;h++){const l=o.children[h];if(l.tagName==="SOURCE"&&l.src)return!0}return!1},a=()=>{const o=[],u=Bn();let v=(u==null?void 0:u.config.script)!==void 0,h,f;const l=window.self===window.top;l?(h=new Ju,h.bind()):f=new Zu;const d=()=>{const b=[...document.getElementsByTagName("video")];for(const x of rt)if(x.shadowRoot)for(const S of x.shadowRoot.querySelectorAll("video"))b.push(S);for(let x=0;x<b.length;++x){const S=b[x];if(!(o.filter(w=>w.video.isSameNode(S)).length>0)&&s(S,u)&&!(u!=null&&u.shouldIgnore(S))){const w=new Du(S,v,f==null?void 0:f.frameId);w.bind(),o.push(w)}}for(let x=o.length-1;x>=0;--x){const S=o[x];let _=!1;for(let w=0;w<b.length;++w){const I=b[w];if(I.isSameNode(S.video)&&s(I,u)){_=!0;break}}_||(o.splice(x,1),S.unbind())}o.length===0?f==null||f.unbind():f==null||f.bind()};d();const m=setInterval(d,1e3),c=u!=null&&u.config.searchShadowRoots?setInterval(tc,100):void 0,g=new Vu(o);g.bind();const p=new Yu(t);l&&n();const y=(b,x,S)=>{var _;if(l&&b.sender==="asbplayer-extension-to-video")switch(b.message.command){case"copy-to-clipboard":const w=b.message;fetch(w.dataUrl).then(M=>M.blob()).then(M=>{navigator.clipboard.write([new ClipboardItem({[M.type]:M})]).catch(console.error)});break;case"crop-and-resize":const I=b.message;let V=I.rect;if(I.frameId!==void 0){const M=(_=h==null?void 0:h.iframesById)==null?void 0:_[I.frameId];if(M!==void 0){const j=M.getBoundingClientRect();V={left:V.left+j.left,top:V.top+j.top,width:V.width,height:V.height}}}return ti(I.maxWidth,I.maxHeight,V,I.dataUrl).then(M=>S({dataUrl:M})),!0;case"show-anki-ui":b.src===void 0&&p.show(b.message);break;case"settings-updated":n(),p.updateSettings();break}};W.runtime.onMessage.addListener(y),window.addEventListener("beforeunload",b=>{for(let x of o)x.unbind();o.length=0,clearInterval(m),c!==void 0&&clearInterval(c),g.unbind(),h==null||h.unbind(),f==null||f.unbind(),r==null||r(),W.runtime.onMessage.removeListener(y)})};document.readyState==="complete"?a():document.addEventListener("readystatechange",o=>{document.readyState==="complete"&&a()})}};function er(i,...e){}const nc={debug:(...i)=>er(console.debug,...i),log:(...i)=>er(console.log,...i),warn:(...i)=>er(console.warn,...i),error:(...i)=>er(console.error,...i)},rr=class rr extends Event{constructor(e,t){super(rr.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=t}};A(rr,"EVENT_NAME",Vn("wxt:locationchange"));let Dn=rr;function Vn(i){var e;return`${(e=W==null?void 0:W.runtime)==null?void 0:e.id}:video:${i}`}function ic(i){let e,t;return{run(){e==null&&(t=new URL(location.href),e=i.setInterval(()=>{let r=new URL(location.href);r.href!==t.href&&(window.dispatchEvent(new Dn(r,t)),t=r)},1e3))}}}const yt=class yt{constructor(e,t){A(this,"isTopFrame",window.self===window.top);A(this,"abortController");A(this,"locationWatcher",ic(this));A(this,"receivedMessageIds",new Set);this.contentScriptName=e,this.options=t,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return W.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,t){const r=setInterval(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(e,t){const r=setTimeout(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(e){const t=requestAnimationFrame((...r)=>{this.isValid&&e(...r)});return this.onInvalidated(()=>cancelAnimationFrame(t)),t}requestIdleCallback(e,t){const r=requestIdleCallback((...n)=>{this.signal.aborted||e(...n)},t);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(e,t,r,n){var s;t==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(s=e.addEventListener)==null||s.call(e,t.startsWith("wxt:")?Vn(t):t,r,{...n,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),nc.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:yt.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(e){var s,a,o;const t=((s=e.data)==null?void 0:s.type)===yt.SCRIPT_STARTED_MESSAGE_TYPE,r=((a=e.data)==null?void 0:a.contentScriptName)===this.contentScriptName,n=!this.receivedMessageIds.has((o=e.data)==null?void 0:o.messageId);return t&&r&&n}listenForNewerScripts(e){let t=!0;const r=n=>{if(this.verifyScriptStartedEvent(n)){this.receivedMessageIds.add(n.data.messageId);const s=t;if(t=!1,s&&(e!=null&&e.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};A(yt,"SCRIPT_STARTED_MESSAGE_TYPE",Vn("wxt:content-script-started"));let Hn=yt;function Pc(){}function tr(i,...e){}const sc={debug:(...i)=>tr(console.debug,...i),log:(...i)=>tr(console.log,...i),warn:(...i)=>tr(console.warn,...i),error:(...i)=>tr(console.error,...i)};return(async()=>{try{const{main:i,...e}=rc,t=new Hn("video",e);return await i(t)}catch(i){throw sc.error('The content script "video" crashed on startup!',i),i}})()}();
video;
