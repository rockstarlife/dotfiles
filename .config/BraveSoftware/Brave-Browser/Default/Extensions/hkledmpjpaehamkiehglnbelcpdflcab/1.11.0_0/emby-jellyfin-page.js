var embyJellyfinPage=function(){"use strict";function d(e){return e==null||typeof e=="function"?{main:e}:e}const u=e=>({id:m(e),...e}),m=e=>`${e.language}:${e.label}:${e.url}`,p=d(()=>{document.addEventListener("asbplayer-get-synced-data",async()=>{const e={error:"",basename:"",subtitles:[]};if(!ApiClient)return e.error="ApiClient is undefined",document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:e}));const o=ApiClient==null?void 0:ApiClient._deviceId;let n;for(let t=0;t<5&&(n=(await ApiClient.getSessions({deviceId:o}))[0],!n.PlayState.MediaSourceId);t++)await new Promise(r=>setTimeout(r,1e3));if(!n||!n.PlayState.MediaSourceId)return e.error="Failed to retrieve a valid MediaSourceId after 5 attempts",document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:e}));const f=n.PlayState.MediaSourceId,a=n.NowPlayingItem,l=a.Path;e.basename=a.FileName??(l?l.split(/[\\/]/).pop():a.Name);const c=[];a.MediaStreams.filter(t=>t.IsTextSubtitleStream).forEach(t=>{const i="srt";var r="/Videos/"+a.Id+"/"+f+"/Subtitles/"+t.Index+"/Stream."+i;c.push(u({label:t.DisplayTitle,language:t.Language||"",url:r,extension:i}))}),e.subtitles=c,document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:e}))},!1)});function g(){}function s(e,...o){}const y={debug:(...e)=>s(console.debug,...e),log:(...e)=>s(console.log,...e),warn:(...e)=>s(console.warn,...e),error:(...e)=>s(console.error,...e)};return(async()=>{try{return await p.main()}catch(e){throw y.error('The unlisted script "emby-jellyfin-page" crashed on startup!',e),e}})()}();
embyJellyfinPage;
