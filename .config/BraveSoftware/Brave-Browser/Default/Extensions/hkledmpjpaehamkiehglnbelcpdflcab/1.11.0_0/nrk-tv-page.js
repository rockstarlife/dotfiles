var nrkTvPage=function(){"use strict";function h(t){return t==null||typeof t=="function"?{main:t}:t}function b(t,i=1e4){return new Promise(async(p,c)=>{t()&&p(!0);const n=Date.now();let a=!1;for(;!a&&Date.now()<n+i;)await new Promise(e=>{setTimeout(()=>{a=t(),e()},1e3)});p(a)})}const m=t=>`${t.language}:${t.label}:${t.url}`;function g({onJson:t,onRequest:i,waitForBasename:p},c){setTimeout(()=>{const n={};let a="",e=!1;if(t!==void 0){const r=JSON.parse;JSON.parse=function(){const o=r.apply(this,arguments);let l=!1,d=!1;return t==null||t(o,f=>{const u=window.location.pathname;typeof n[u]>"u"&&(n[u]=[]);const w=m(f);n[u].find($=>$.id===w)===void 0&&(n[u].push({id:w,...f}),l=!0)},f=>{a=f,d=!0}),e&&(l||d)&&document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:{error:"",basename:a,subtitles:n[window.location.pathname]}})),o}}function s(){for(const r of Object.keys(n))r!==window.location.pathname&&delete n[r]}document.addEventListener("asbplayer-get-synced-data",async()=>{i==null||i(o=>{const l=window.location.pathname;typeof n[l]>"u"&&(n[l]=[]);const d=m(o);n[l].find(f=>f.id===d)===void 0&&n[l].push({id:d,...o})},o=>{a=o,e||document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:{error:"",basename:a,subtitles:void 0}}))});const r=()=>a!==""&&window.location.pathname in n;r()||await b(r,c),document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:{error:"",basename:a,subtitles:n[window.location.pathname]??[]}})),s(),e=!0},!1)},0)}const k=h(()=>{const t=window.fetch;let i;window.fetch=(...c)=>{let n;for(const a of c)typeof a=="string"&&a.includes("metadata")&&(n=a),a instanceof Request&&a.url.includes("metadata")&&(n=a.url);return n!==void 0&&(i=n),t(...c)};const p=async c=>{var a;const n=[];try{const e=await(await fetch(c)).json();if(typeof((a=e==null?void 0:e.playable)==null?void 0:a.subtitles)=="object"&&Array.isArray(e.playable.subtitles))for(const s of e.playable.subtitles)typeof s.label=="string"&&typeof s.language=="string"&&typeof s.webVtt=="string"&&n.push({label:s.label,language:s.language,url:s.webVtt,extension:"vtt"})}catch(e){console.error(e)}return n};g({onRequest:async(c,n)=>{var s,r,o,l,d;if(i===void 0)return;const a=new URL(i),e=await(await fetch(i)).json();if(typeof((r=(s=e==null?void 0:e.preplay)==null?void 0:s.titles)==null?void 0:r.title)=="string"&&(typeof((l=(o=e==null?void 0:e.preplay)==null?void 0:o.titles)==null?void 0:l.subtitle)=="string"?n(`${e.preplay.titles.title} ${e.preplay.titles.subtitle}`):n(e.preplay.titles.title)),typeof((d=e==null?void 0:e._links)==null?void 0:d.manifests)=="object"&&Array.isArray(e._links.manifests)){for(const f of e._links.manifests)if(typeof f.href=="string"){const u=await p(`${a.origin}${f.href}`);for(const w of u)c(w)}}},waitForBasename:!0})});function E(){}function y(t,...i){}const v={debug:(...t)=>y(console.debug,...t),log:(...t)=>y(console.log,...t),warn:(...t)=>y(console.warn,...t),error:(...t)=>y(console.error,...t)};return(async()=>{try{return await k.main()}catch(t){throw v.error('The unlisted script "nrk-tv-page" crashed on startup!',t),t}})()}();
nrkTvPage;
