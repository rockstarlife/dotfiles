var tverPage=function(){"use strict";function g(t){return t==null||typeof t=="function"?{main:t}:t}function y(t,i){const a=t.lastIndexOf(".");let e=i;if(a!==-1){e=t.substring(a+1);const n=e.indexOf("?");n!==-1&&(e=e.substring(0,n))}return e}function h(t,i=1e4){return new Promise(async(a,e)=>{t()&&a(!0);const n=Date.now();let s=!1;for(;!s&&Date.now()<n+i;)await new Promise(o=>{setTimeout(()=>{s=t(),o()},1e3)});a(s)})}const w=t=>`${t.language}:${t.label}:${t.url}`;function b({onJson:t,onRequest:i,waitForBasename:a},e){setTimeout(()=>{const n={};let s="",o=!1;if(t!==void 0){const r=JSON.parse;JSON.parse=function(){const c=r.apply(this,arguments);let d=!1,f=!1;return t==null||t(c,l=>{const p=window.location.pathname;typeof n[p]>"u"&&(n[p]=[]);const m=w(l);n[p].find(I=>I.id===m)===void 0&&(n[p].push({id:m,...l}),d=!0)},l=>{s=l,f=!0}),o&&(d||f)&&document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:{error:"",basename:s,subtitles:n[window.location.pathname]}})),c}}function k(){for(const r of Object.keys(n))r!==window.location.pathname&&delete n[r]}document.addEventListener("asbplayer-get-synced-data",async()=>{i==null||i(c=>{const d=window.location.pathname;typeof n[d]>"u"&&(n[d]=[]);const f=w(c);n[d].find(l=>l.id===f)===void 0&&n[d].push({id:f,...c})},c=>{s=c,o||document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:{error:"",basename:s,subtitles:void 0}}))});const r=()=>s!==""&&window.location.pathname in n;r()||await h(r,e),document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:{error:"",basename:s,subtitles:n[window.location.pathname]??[]}})),k(),o=!0},!1)},0)}const x=g(()=>{b({onJson:(t,i,a)=>{if((t==null?void 0:t.text_tracks)instanceof Array){for(const e of t.text_tracks)if(e.kind==="captions"&&e.mime_type==="text/webvtt"&&e.sources instanceof Array&&e.sources.length>0&&typeof e.sources[0].src=="string"&&typeof e.srclang=="string"){const n=typeof e.label=="string"?`${e.srclang} - ${e==null?void 0:e.label}`:e.srclang,s=e.srclang.toLowerCase(),o=e.sources[0].src;i({label:n,language:s,url:o.replace(/^http:\/\//,"https://"),extension:y(o,"vtt")})}typeof(t==null?void 0:t.name)=="string"&&a(t==null?void 0:t.name)}},waitForBasename:!0})});function P(){}function u(t,...i){}const E={debug:(...t)=>u(console.debug,...t),log:(...t)=>u(console.log,...t),warn:(...t)=>u(console.warn,...t),error:(...t)=>u(console.error,...t)};return(async()=>{try{return await x.main()}catch(t){throw E.error('The unlisted script "tver-page" crashed on startup!',t),t}})()}();
tverPage;
