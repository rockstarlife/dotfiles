var youtubePage=function(){"use strict";function g(t){return t==null||typeof t=="function"?{main:t}:t}const b=t=>({id:T(t),...t}),T=t=>`${t.language}:${t.label}:${t.url}`;function v(t){let r="";const e=t.byteLength;for(let n=0;n<e;++n)r+=String.fromCharCode(t[n]);return window.btoa(r)}const k=t=>{const r=atob(t),e=new Uint8Array(r.length);for(let n=0;n<e.length;++n)e[n]=r.charCodeAt(n);return e},h=(t,r=0,e=t.length)=>{let n=0;for(let s=r;s<e;s++){const o=t.charCodeAt(s);n=Math.imul(31,n)+o|0}return n},C=(t,r)=>{const e=r.length>>1,[n,s]=[h(r,0,e),h(r,e)],o=new Uint32Array(t.buffer),i=o[0];for(let a=1;a<o.length;a+=2){let c=i,l=a,u=n,d=s;for(let f=0;f<22;f++)l=(l>>>8|l<<24)+c,l^=u+38293,c=(c<<3|c>>>29)^l,d=(d>>>8|d<<24)+u,d^=f+38293,u=(u<<3|u>>>29)^d;o[a]^=c,a+1<o.length&&(o[a+1]^=l)}},P=(t,r)=>{const e=k(r);C(e,t);let n=4;for(;n<7&&e[n]===0;)n++;const s=[196,200,224,18];for(let a=0;a<s.length;a++)if(e[n++]!==s[a])return;const o=new DataView(e.buffer).getUint32(n);n+=4;const i=v(new Uint8Array(e.buffer,n)).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/g,"");return{expires:new Date(o*1e3),poToken:i}},S=t=>{const r=window.sessionStorage.getItem("iU5q-!O9@$");if(!r)return;const e=r.split(",");let n;for(const s of e){const o=window.sessionStorage.getItem(s);if(!o)continue;const i=P(t,o);i!==void 0&&(n=i)}return n},x=async()=>{let t;return window.trustedTypes!==void 0&&(window.trustedTypes.defaultPolicy===null&&window.trustedTypes.createPolicy("default",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e}),t=window.trustedTypes.createPolicy("passThrough",{createHTML:e=>e,createScript:e=>e})),await fetch(window.location.href).then(e=>{if(!e.ok)throw new Error(`YT Context Retrieval failed with Status ${e.status}/${e.statusText}...`);return e.text()}).then(e=>(t!==void 0&&(e=t.createHTML(e)),new window.DOMParser().parseFromString(e,"text/html"))).then(e=>{var s;const n=e.body.querySelectorAll("script");for(let o=0;o<n.length;++o){const i=n[o];if((s=i.textContent)!=null&&s.includes("ytInitialPlayerResponse")){let a=`${i.textContent}; return ytInitialPlayerResponse;`;t!==void 0&&(a=t.createScript(a));const c=new Function(a)();if(c)return c}}})},y=()=>{var e;const t=window.location.pathname;if(t){const n=(e=/\/(shorts|embed)\/(.*)/.exec(t))==null?void 0:e[2];if(n)return n}return new URLSearchParams(window.location.search).get("v")??void 0},w=(t,r)=>{var n,s,o;r.searchParams.set("fmt","srv3");const e={label:t.name.text||t.name.simpleText||((o=(s=(n=t.name)==null?void 0:n.runs)==null?void 0:s[0])==null?void 0:o.text)||t.languageCode,language:t.languageCode,url:r.toString(),extension:"ytsrv3"};return b(e)},I=async t=>{var a,c,l,u;if(typeof((a=window.ytcfg)==null?void 0:a.get)!="function")return;const r=window.ytcfg.get("INNERTUBE_API_KEY");if(!r)return;const e=await fetch(`https://${window.location.host}/youtubei/v1/player?key=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:{client:{clientName:"ANDROID",clientVersion:"20.10.38",hl:window.ytcfg.get("HL")||"en"}},videoId:t})});if(e.status!==200)return;const n=await e.json(),s=(c=n.videoDetails)==null?void 0:c.title;if(typeof((u=(l=n==null?void 0:n.captions)==null?void 0:l.playerCaptionsTracklistRenderer)==null?void 0:u.captionTracks)!="object")return{basename:s};const i=n.captions.playerCaptionsTracklistRenderer.captionTracks.map(d=>{const f=new URL(d.baseUrl);return w(d,f)});return{basename:s,subtitles:i}},U=async t=>{var i,a,c;const r=S(t);if(!r)return;const e=await x(),s=(((a=(i=e==null?void 0:e.captions)==null?void 0:i.playerCaptionsTracklistRenderer)==null?void 0:a.captionTracks)||[]).map(l=>{const u=l.baseUrl,d=u.startsWith("/")?`https://${window.location.host}${u}`:u,f=new URL(d);return f.searchParams.set("pot",r.poToken),f.searchParams.set("c","WEB"),w(l,f)});return{basename:(c=e.videoDetails)==null?void 0:c.title,subtitles:s}},m=async()=>{const t={error:"",basename:"",subtitles:[]};let r;try{if(r=y(),!r){t.error="Could not determine video ID";return}let e="",n;const s=await I(r);if(s&&(e=s.basename,n=s.subtitles),n===void 0||!e){const o=await U(r);o&&(e=e||(o==null?void 0:o.basename),n=n??(o==null?void 0:o.subtitles))}return t.basename=e||document.title,t.subtitles=n??[],r}catch(e){console.error(e),e instanceof Error?t.error=e.message:t.error=String(e)}finally{r===y()&&document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:t}))}},$=g(()=>{let t;document.addEventListener("asbplayer-get-synced-data",async e=>{t=await m()},!1);let r=!1;setInterval(async()=>{if(!r)try{r=!0;const e=y();t&&e&&t!==e&&(t=await m())}finally{r=!1}},500)});function A(){}function p(t,...r){}const D={debug:(...t)=>p(console.debug,...t),log:(...t)=>p(console.log,...t),warn:(...t)=>p(console.warn,...t),error:(...t)=>p(console.error,...t)};return(async()=>{try{return await $.main()}catch(t){throw D.error('The unlisted script "youtube-page" crashed on startup!',t),t}})()}();
youtubePage;
